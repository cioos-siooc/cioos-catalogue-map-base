"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[380],{3282:t=>{var e={PROCESSOR_VERSION:"1.4.61",error:function(t){if("undefined"==typeof Error)throw Error("citeproc-js error: "+t);throw"citeproc-js error: "+t},debug:function(t){"undefined"==typeof console?dump("CSL: "+t+"\n"):console.log("citeproc-js warning: "+t)},toLocaleUpperCase(t){var e=this.tmp.lang_array;try{t=t.toLocaleUpperCase(e)}catch(e){t=t.toUpperCase()}return t},toLocaleLowerCase(t){var e=this.tmp.lang_array;try{t=t.toLocaleLowerCase(e)}catch(e){t=t.toLowerCase()}return t},LOCATOR_LABELS_REGEXP:RegExp("^((vrs|sv|subpara|op|subch|add|amend|annot|app|art|bibliog|bk|ch|cl|col|cmt|dec|dept|div|ex|fig|fld|fol|n|hypo|illus|intro|l|no|p|pp|para|pt|pmbl|princ|pub|r|rn|sched|sec|ser|subdiv|subsec|supp|tbl|tit|vol)\\.)\\s+(.*)"),STATUTE_SUBDIV_PLAIN_REGEX:/(?:(?:^| )(?:vrs|sv|subpara|op|subch|add|amend|annot|app|art|bibliog|bk|ch|cl|col|cmt|dec|dept|div|ex|fig|fld|fol|n|hypo|illus|intro|l|no|p|pp|para|pt|pmbl|princ|pub|r|rn|sched|sec|ser|subdiv|subsec|supp|tbl|tit|vol)\. *)/,STATUTE_SUBDIV_PLAIN_REGEX_FRONT:/(?:^\s*[.,;]*\s*(?:vrs|sv|subpara|op|subch|add|amend|annot|app|art|bibliog|bk|ch|cl|col|cmt|dec|dept|div|ex|fig|fld|fol|n|hypo|illus|intro|l|no|p|pp|para|pt|pmbl|princ|pub|r|rn|sched|sec|ser|subdiv|subsec|supp|tbl|tit|vol)\. *)/,STATUTE_SUBDIV_STRINGS:{"vrs.":"verse","sv.":"sub-verbo","subpara.":"subparagraph","op.":"opus","subch.":"subchapter","add.":"addendum","amend.":"amendment","annot.":"annotation","app.":"appendix","art.":"article","bibliog.":"bibliography","bk.":"book","ch.":"chapter","cl.":"clause","col.":"column","cmt.":"comment","dec.":"decision","dept.":"department","ex.":"example","fig.":"figure","fld.":"field","fol.":"folio","n.":"note","hypo.":"hypothetical","illus.":"illustration","intro.":"introduction","l.":"line","no.":"issue","p.":"page","pp.":"page","para.":"paragraph","pt.":"part","pmbl.":"preamble","princ.":"principle","pub.":"publication","r.":"rule","rn.":"randnummer","sched.":"schedule","sec.":"section","ser.":"series,","subdiv.":"subdivision","subsec.":"subsection","supp.":"supplement","tbl.":"table","tit.":"title","vol.":"volume"},STATUTE_SUBDIV_STRINGS_REVERSE:{verse:"vrs.","sub-verbo":"sv.","sub verbo":"sv.",subparagraph:"subpara.",opus:"op.",subchapter:"subch.",addendum:"add.",amendment:"amend.",annotation:"annot.",appendix:"app.",article:"art.",bibliography:"bibliog.",book:"bk.",chapter:"ch.",clause:"cl.",column:"col.",comment:"cmt.",decision:"dec.",department:"dept.",example:"ex.",figure:"fig.",field:"fld.",folio:"fol.",note:"n.",hypothetical:"hypo.",illustration:"illus.",introduction:"intro.",line:"l.",issue:"no.",page:"p.",paragraph:"para.",part:"pt.",preamble:"pmbl.",principle:"princ.",publication:"pub.",rule:"r.",randnummer:"rn.",schedule:"sched.",section:"sec.","series,":"ser.",subdivision:"subdiv.",subsection:"subsec.",supplement:"supp.",table:"tbl.",title:"tit.",volume:"vol."},LOCATOR_LABELS_MAP:{vrs:"verse",sv:"sub-verbo",subpara:"subparagraph",op:"opus",subch:"subchapter",add:"addendum",amend:"amendment",annot:"annotation",app:"appendix",art:"article",bibliog:"bibliography",bk:"book",ch:"chapter",cl:"clause",col:"column",cmt:"comment",dec:"decision",dept:"department",ex:"example",fig:"figure",fld:"field",fol:"folio",n:"note",hypo:"hypothetical",illus:"illustration",intro:"introduction",l:"line",no:"issue",p:"page",pp:"page",para:"paragraph",pt:"part",pmbl:"preamble",princ:"principle",pub:"publication",r:"rule",rn:"randnummer",sched:"schedule",sec:"section",ser:"series,",subdiv:"subdivision",subsec:"subsection",supp:"supplement",tbl:"table",tit:"title",vol:"volume"},MODULE_MACROS:{"juris-pretitle":!0,"juris-title":!0,"juris-pretitle-short":!0,"juris-title-short":!0,"juris-main":!0,"juris-main-short":!0,"juris-tail":!0,"juris-tail-short":!0,"juris-locator":!0},MODULE_TYPES:{legal_case:!0,legislation:!0,bill:!0,hearing:!0,gazette:!0,report:!0,regulation:!0,standard:!0,patent:!0,locator:!0},checkNestedBrace:function(t){"note"===t.opt.xclass?(this.depth=0,this.update=function(t){for(var t=t||"",e=t.split(/([\(\)])/),i=1,s=e.length;i<s;i+=2)"("===e[i]?(1==this.depth%2&&(e[i]="["),this.depth+=1):")"===e[i]&&(0==this.depth%2&&(e[i]="]"),this.depth-=1);return e.join("")}):this.update=function(t){return t}},MULTI_FIELDS:["event","publisher","publisher-place","event-place","title","container-title","collection-title","authority","genre","title-short","medium","country","jurisdiction","archive","archive-place"],LangPrefsMap:{title:"titles","title-short":"titles",event:"titles",genre:"titles",medium:"titles","container-title":"journals","collection-title":"titles",archive:"journals",publisher:"publishers",authority:"publishers","publisher-place":"places","event-place":"places","archive-place":"places",jurisdiction:"places",number:"places",edition:"places",issue:"places",volume:"places"},AbbreviationSegments:function(){this["container-title"]={},this["collection-title"]={},this["institution-entire"]={},this["institution-part"]={},this.nickname={},this.number={},this.title={},this.place={},this.hereinafter={},this.classic={},this["container-phrase"]={},this["title-phrase"]={}},getAbbrevsDomain:function(t,e,i){var s=null;if(t.opt.availableAbbrevDomains&&e&&"default"!==e){var r=t.locale[t.opt.lang].opts["jurisdiction-preference"],n=null;if(t.locale[i]&&(n=t.locale[i].opts["jurisdiction-preference"]),n){for(var a=n.length-1;a>-1;a--)if(t.opt.availableAbbrevDomains[e].indexOf(n[a])>-1){s=n[a];break}}if(!s&&r){for(var a=r.length-1;a>-1;a--)if(t.opt.availableAbbrevDomains[e].indexOf(r[a])>-1){s=r[a];break}}}return s},FIELD_CATEGORY_REMAP:{title:"title","container-title":"container-title","collection-title":"collection-title",country:"place",number:"number",place:"place",archive:"container-title","title-short":"title",genre:"title",event:"title",medium:"title","archive-place":"place","publisher-place":"place","event-place":"place",jurisdiction:"place","language-name":"place","language-name-original":"place","call-number":"number","chapter-number":"number","collection-number":"number",edition:"number",page:"number",issue:"number",locator:"number","locator-extra":"number","number-of-pages":"number","number-of-volumes":"number",volume:"number","citation-number":"number",publisher:"institution-part"},parseLocator:function(t){if(this.opt.development_extensions.locator_date_and_revision&&t.locator){t.locator=""+t.locator;var e=t.locator.indexOf("|");if(e>-1){var i=t.locator;t.locator=i.slice(0,e);var s=(i=i.slice(e+1)).match(/^([0-9]{4}-[0-9]{2}-[0-9]{2}).*/);s&&(t["locator-date"]=this.fun.dateparser.parseDateToObject(s[1]),i=i.slice(s[1].length)),t["locator-extra"]=i.replace(/^\s+/,"").replace(/\s+$/,"")}}return t.locator&&(t.locator=(""+t.locator).replace(/\s+$/,"")),t},normalizeLocaleStr:function(t){if(t){var e=t.split("-");return e[0]=e[0].toLowerCase(),e[1]&&(e[1]=e[1].toUpperCase()),e.join("-")}},parseNoteFieldHacks:function(t,i,s){if("string"==typeof t.note){for(var r=[],n=t.note.split("\n"),a=0,o=n.length;a<o;a++){var l=n[a],r=[],u=l.match(e.NOTE_FIELDS_REGEXP);if(u){for(var p=l.split(e.NOTE_FIELDS_REGEXP),h=0,c=p.length-1;h<c;h++)r.push(p[h]),r.push(u[h]);r.push(p[p.length-1]);for(var h=1,c=r.length;h<c;h+=2)if(r[h-1].trim()&&(a>0||h>1)&&!r[h-1].match(e.NOTE_FIELD_REGEXP))break;else r[h]="\n"+r[h].slice(2,-1).trim()+"\n";n[a]=r.join("")}}n=n.join("\n").split("\n");for(var m=0,f={},a=0,o=n.length;a<o;a++){var l=n[a],d=l.match(e.NOTE_FIELD_REGEXP);if(l.trim()){if(!d)if(0===a)continue;else{m=a;break}var g=d[1],b=d[2].replace(/^\s+/,"").replace(/\s+$/,"");if("type"===g)t.type=b,n[a]="";else if(e.DATE_VARIABLES.indexOf(g.replace(/^alt-/,""))>-1)(!t[g]||s)&&(t[g]=e.DateParser.parseDateToArray(b),(!i||i[g]&&this.isDateString(b))&&(n[a]=""));else if(!t[g]){if(e.NAME_VARIABLES.indexOf(g.replace(/^alt-/,""))>-1){f[g]||(f[g]=[]);var _=b.split(/\s*\|\|\s*/);if(1===_.length)f[g].push({literal:_[0]});else if(2===_.length){var v={family:_[0],given:_[1]};e.parseParticles(v),f[g].push(v)}}else t[g]=b;(!i||i[g])&&(n[a]="")}}}for(var g in f)t[g]=f[g];if(i){n[m].trim()&&(n[m]="\n"+n[m]);for(var a=m-1;a>-1;a--)n[a].trim()||(n=n.slice(0,a).concat(n.slice(a+1)))}t.note=n.join("\n").trim()}},checkPrefixSpaceAppend:function(t,i){i||(i="");var s="",r=i.replace(/<[^>]+>/g,"").replace(/["'\u201d\u2019\u00bb\u202f\u00a0 ]+$/g,""),n=r.slice(-1);r.match(e.ENDSWITH_ROMANESQUE_REGEXP)||e.TERMINAL_PUNCTUATION.slice(0,-1).indexOf(n)>-1?s=" ":n.match(/[\)\],0-9]/)&&(s=" ");var i=(i+s).replace(/\s+/g," ");return i},checkIgnorePredecessor:function(t,i){var s=i.replace(/<[^>]+>/g,"").replace(/["'\u201d\u2019\u00bb\u202f\u00a0 ]+$/g,"").slice(-1);return!!(e.TERMINAL_PUNCTUATION.slice(0,-1).indexOf(s)>-1&&i.trim().indexOf(" ")>-1)&&(t.tmp.term_predecessor=!1,!0)},checkSuffixSpacePrepend:function(t,i){return i?((i.match(e.STARTSWITH_ROMANESQUE_REGEXP)||["[","("].indexOf(i.slice(0,1))>-1)&&(i=" "+i),i):""},GENDERS:["masculine","feminine"],ERROR_NO_RENDERED_FORM:1,PREVIEW:"Just for laughs.",ASSUME_ALL_ITEMS_REGISTERED:2,START:0,END:1,SINGLETON:2,SEEN:6,SUCCESSOR:3,SUCCESSOR_OF_SUCCESSOR:4,SUPPRESS:5,SINGULAR:0,PLURAL:1,LITERAL:!0,BEFORE:1,AFTER:2,DESCENDING:1,ASCENDING:2,PRIMARY:1,SECONDARY:2,POSITION_FIRST:0,POSITION_SUBSEQUENT:1,POSITION_IBID:2,POSITION_IBID_WITH_LOCATOR:3,POSITION_CONTAINER_SUBSEQUENT:4,POSITION_MAP:{0:0,4:1,1:2,2:3,3:4},POSITION_TEST_VARS:["position","first-reference-note-number","near-note"],AREAS:["citation","citation_sort","bibliography","bibliography_sort","intext"],CITE_FIELDS:["first-reference-note-number","first-container-reference-note-number","locator","locator-extra"],SWAPPING_PUNCTUATION:[".","!","?",":",","],TERMINAL_PUNCTUATION:[":",".",";","!","?"," "],NONE:0,NUMERIC:1,POSITION:2,TRIGRAPH:3,DATE_PARTS:["year","month","day"],DATE_PARTS_ALL:["year","month","day","season"],DATE_PARTS_INTERNAL:["year","month","day","year_end","month_end","day_end"],NAME_PARTS:["non-dropping-particle","family","given","dropping-particle","suffix","literal"],DISAMBIGUATE_OPTIONS:["disambiguate-add-names","disambiguate-add-givenname","disambiguate-add-year-suffix"],GIVENNAME_DISAMBIGUATION_RULES:["all-names","all-names-with-initials","primary-name","primary-name-with-initials","by-cite"],NAME_ATTRIBUTES:["and","delimiter-precedes-last","delimiter-precedes-et-al","initialize-with","initialize","name-as-sort-order","sort-separator","et-al-min","et-al-use-first","et-al-subsequent-min","et-al-subsequent-use-first","form","prefix","suffix","delimiter"],LOOSE:0,STRICT:1,TOLERANT:2,PREFIX_PUNCTUATION:/[.;:]\s*$/,SUFFIX_PUNCTUATION:/^\s*[.;:,\(\)]/,NUMBER_REGEXP:/(?:^\d+|\d+$)/,NAME_INITIAL_REGEXP:/^([A-Z\u0e01-\u0e5b\u00c0-\u017f\u0400-\u042f\u0590-\u05d4\u05d6-\u05ff\u0600-\u06ff\u0370\u0372\u0376\u0386\u0388-\u03ab\u03e2\u03e4\u03e6\u03e8\u03ea\u03ec\u03ee\u03f4\u03f7\u03fd-\u03ff])([a-zA-Z\u0e01-\u0e5b\u00c0-\u017f\u0400-\u052f\u0600-\u06ff\u0370-\u03ff\u1f00-\u1fff]*|)(\.)*/,ROMANESQUE_REGEXP:/[-0-9a-zA-Z\u0e01-\u0e5b\u00c0-\u017f\u0370-\u03ff\u0400-\u052f\u0590-\u05d4\u05d6-\u05ff\u1f00-\u1fff\u0600-\u06ff\u200c\u200d\u200e\u0218\u0219\u021a\u021b\u202a-\u202e]/,ROMANESQUE_NOT_REGEXP:/[^a-zA-Z\u0e01-\u0e5b\u00c0-\u017f\u0370-\u03ff\u0400-\u052f\u0590-\u05d4\u05d6-\u05ff\u1f00-\u1fff\u0600-\u06ff\u200c\u200d\u200e\u0218\u0219\u021a\u021b\u202a-\u202e]/g,STARTSWITH_ROMANESQUE_REGEXP:/^[&a-zA-Z\u0e01-\u0e5b\u00c0-\u017f\u0370-\u03ff\u0400-\u052f\u0590-\u05d4\u05d6-\u05ff\u1f00-\u1fff\u0600-\u06ff\u200c\u200d\u200e\u0218\u0219\u021a\u021b\u202a-\u202e]/,ENDSWITH_ROMANESQUE_REGEXP:/[.;:&a-zA-Z\u0e01-\u0e5b\u00c0-\u017f\u0370-\u03ff\u0400-\u052f\u0590-\u05d4\u05d6-\u05ff\u1f00-\u1fff\u0600-\u06ff\u200c\u200d\u200e\u0218\u0219\u021a\u021b\u202a-\u202e]$/,ALL_ROMANESQUE_REGEXP:/^[a-zA-Z\u0e01-\u0e5b\u00c0-\u017f\u0370-\u03ff\u0400-\u052f\u0590-\u05d4\u05d6-\u05ff\u1f00-\u1fff\u0600-\u06ff\u200c\u200d\u200e\u0218\u0219\u021a\u021b\u202a-\u202e]+$/,VIETNAMESE_SPECIALS:/[\u00c0-\u00c3\u00c8-\u00ca\u00cc\u00cd\u00d2-\u00d5\u00d9\u00da\u00dd\u00e0-\u00e3\u00e8-\u00ea\u00ec\u00ed\u00f2-\u00f5\u00f9\u00fa\u00fd\u0101\u0103\u0110\u0111\u0128\u0129\u0168\u0169\u01a0\u01a1\u01af\u01b0\u1ea0-\u1ef9]/,VIETNAMESE_NAMES:/^(?:(?:[.AaBbCcDdEeGgHhIiKkLlMmNnOoPpQqRrSsTtUuVvXxYy \u00c0-\u00c3\u00c8-\u00ca\u00cc\u00cd\u00d2-\u00d5\u00d9\u00da\u00dd\u00e0-\u00e3\u00e8-\u00ea\u00ec\u00ed\u00f2-\u00f5\u00f9\u00fa\u00fd\u0101\u0103\u0110\u0111\u0128\u0129\u0168\u0169\u01a0\u01a1\u01af\u01b0\u1ea0-\u1ef9]{2,6})(\s+|$))+$/,NOTE_FIELDS_REGEXP:/\{:(?:[\-_a-z]+|[A-Z]+):[^\}]+\}/g,NOTE_FIELD_REGEXP:/^([\-_a-z]+|[A-Z]+):\s*([^\}]+)$/,PARTICLE_GIVEN_REGEXP:/^([^ ]+(?:\u02bb |\u2019 | |\' ) *)(.+)$/,PARTICLE_FAMILY_REGEXP:/^([^ ]+(?:\-|\u02bb|\u2019| |\') *)(.+)$/,DISPLAY_CLASSES:["block","left-margin","right-inline","indent"],NAME_VARIABLES:["author","chair","collection-editor","compiler","composer","container-author","contributor","curator","director","editor","editor-translator","editorial-director","executive-producer","guest","host","illustrator","interviewer","narrator","organizer","original-author","performer","producer","recipient","reviewed-author","script-writer","series-creator","translator","commenter"],CREATORS:["author","chair","collection-editor","compiler","composer","container-author","contributor","curator","director","editor","editor-translator","editorial-director","executive-producer","guest","host","illustrator","interviewer","narrator","organizer","original-author","performer","producer","recipient","reviewed-author","script-writer","series-creator","translator","commenter"],NUMERIC_VARIABLES:["call-number","chapter-number","collection-number","division","edition","page","issue","locator","locator-extra","number","number-of-pages","number-of-volumes","part-number","printing-number","section","supplement-number","version","volume","supplement","citation-number"],DATE_VARIABLES:["locator-date","issued","event-date","accessed","original-date","publication-date","available-date","submitted","alt-issued","alt-event"],VARIABLES_WITH_SHORT_FORM:["title","container-title"],TITLE_FIELD_SPLITS:function(t){for(var e=["title","short","main","sub","subjoin"],i={},s=0,r=e.length;s<r;s++)i[e[s]]=t+"title"+("title"===e[s]?"":"-"+e[s]);return i},demoteNoiseWords:function(t,e,i){var s=t.locale[t.opt.lang].opts["leading-noise-words"];if(e&&i){(e=e.split(/\s+/)).reverse();for(var r=[],n=e.length-1;n>-1;n+=-1)if(s.indexOf(e[n].toLowerCase())>-1)r.push(e.pop());else break;e.reverse();var a=e.join(" "),o=r.join(" ");"drop"!==i&&o?"demote"===i&&(e=[a,o].join(", ")):e=a}return e},extractTitleAndSubtitle:function(t,i){var s=i?" ":"",r=[""];this.opt.development_extensions.split_container_title&&r.push("container-");for(var n=0,a=r.length;n<a;n++){var o=r[n],l=e.TITLE_FIELD_SPLITS(o),u=[!1];if(t.multi)for(var p in t.multi._keys[l.short])u.push(p);for(var h=0,c=u.length;h<c;h++){var p=u[h],m={};p?(t.multi._keys[l.title]&&(m[l.title]=t.multi._keys[l.title][p]),t.multi._keys[l.short]&&(m[l.short]=t.multi._keys[l.short][p])):(m[l.title]=t[l.title],m[l.short]=t[l.short]),m[l.main]=m[l.title],m[l.sub]=!1;var f=m[l.short];if(m[l.title]){if(f&&f.toLowerCase()===m[l.title].toLowerCase())m[l.main]=m[l.title],m[l.subjoin]="",m[l.sub]="";else if(f){var d=m[l.title].slice(f.replace(/[\?\!]+$/,"").length),g=m[l.title].replace(d.replace(/^[\?\!]+/,""),"").trim(),b=e.TITLE_SPLIT_REGEXP.matchfirst.exec(d);if(b&&g.toLowerCase()===f.toLowerCase())m[l.main]=g,m[l.subjoin]=b[1].replace(/[\?\!]+(\s*)$/,"$1"),m[l.sub]=d.replace(e.TITLE_SPLIT_REGEXP.matchfirst,""),this.opt.development_extensions.force_short_title_casing_alignment&&(m[l.short]=m[l.main]);else{var _=e.TITLE_SPLIT(m[l.title]);3==_.length?(m[l.main]=_[0],m[l.subjoin]=_[1],m[l.sub]=_[2]):(m[l.main]=m[l.title],m[l.subjoin]="",m[l.sub]="")}}else{var _=e.TITLE_SPLIT(m[l.title]);if(3==_.length){if(m[l.main]=_[0],m[l.subjoin]=_[1],m[l.sub]=_[2],this.opt.development_extensions.implicit_short_title&&"legal_case"!==t.type&&!t[l.short]&&!m[l.main].match(/^[\-\.[0-9]+$/)){var v=m[l.subjoin].trim();-1===["?","!"].indexOf(v)&&(v=""),m[l.short]=m[l.main]+v}}else m[l.main]=m[l.title],m[l.subjoin]="",m[l.sub]=""}if(m[l.subjoin]&&m[l.subjoin].match(/([\?\!])/)){var b=m[l.subjoin].match(/(\s*)$/);m[l.main]=m[l.main]+s+m[l.subjoin].trim(),m[l.subjoin]=b[1]}}if(m[l.subjoin]&&(m[l.subjoin].indexOf(":")>-1&&(m[l.subjoin]=s+": "),(m[l.subjoin].indexOf("-")>-1||m[l.subjoin].indexOf("—")>-1)&&(m[l.subjoin]="—")),p)for(var y in m)t.multi._keys[y]||(t.multi._keys[y]={}),t.multi._keys[y][p]=m[y];else for(var y in m)t[y]=m[y]}}},titlecaseSentenceOrNormal:function(t,i,s,r,n){var a=e.TITLE_FIELD_SPLITS(s),o={};if(r&&i.multi?(i.multi._keys[a.title]&&(o[a.title]=i.multi._keys[a.title][r]),i.multi._keys[a.main]&&(o[a.main]=i.multi._keys[a.main][r]),i.multi._keys[a.sub]&&(o[a.sub]=i.multi._keys[a.sub][r]),i.multi._keys[a.subjoin]&&(o[a.subjoin]=i.multi._keys[a.subjoin][r])):(o[a.title]=i[a.title],o[a.main]=i[a.main],o[a.sub]=i[a.sub],o[a.subjoin]=i[a.subjoin]),o[a.main]&&o[a.sub]){var l=o[a.main],u=o[a.subjoin],p=o[a.sub];return n?(l=e.Output.Formatters.sentence(t,l),p=e.Output.Formatters.sentence(t,p)):t.opt.development_extensions.uppercase_subtitles&&(p=e.Output.Formatters["capitalize-first"](t,p)),[l,u,p].join("")}if(!o[a.title])return"";if(n)return e.Output.Formatters.sentence(t,o[a.title]);if(!t.opt.development_extensions.uppercase_subtitles)return o[a.title];for(var h=e.TITLE_SPLIT(o[a.title]),c=0,m=h.length;c<m;c+=2)h[c]=e.Output.Formatters["capitalize-first"](t,h[c]);for(var c=1,m=h.length-1;c<m;c+=2){var f=h[c].match(/([:\?\!] )/);if(f){var d="fr"===t.opt["default-locale"][0].slice(0,2).toLowerCase()?" ":"";h[c]=d+f[1]}(h[c].indexOf("-")>-1||h[c].indexOf("—")>-1)&&(h[c]="—")}return o[a.title]=h.join(""),o[a.title]},getSafeEscape:function(t){if(!(["bibliography","citation"].indexOf(t.tmp.area)>-1))return function(t){return t};var i=[];return(t.opt.development_extensions.thin_non_breaking_space_html_hack&&"html"===t.opt.mode&&i.push(function(t){return t.replace(/\u202f/g,'<span style="white-space:nowrap">&thinsp;</span>')}),i.length)?function(s){for(var r=0,n=i.length;r<n;r+=1)s=i[r](s);return e.Output.Formats[t.opt.mode].text_escape(s)}:e.Output.Formats[t.opt.mode].text_escape},SKIP_WORDS:["about","above","across","afore","after","against","al","along","alongside","amid","amidst","among","amongst","anenst","apropos","apud","around","as","aside","astride","at","athwart","atop","barring","before","behind","below","beneath","beside","besides","between","beyond","but","by","circa","despite","down","during","et","except","for","forenenst","from","given","in","inside","into","lest","like","modulo","near","next","notwithstanding","of","off","on","onto","out","over","per","plus","pro","qua","sans","since","than","through"," thru","throughout","thruout","till","to","toward","towards","under","underneath","until","unto","up","upon","versus","vs.","v.","vs","v","via","vis-\xe0-vis","with","within","without","according to","ahead of","apart from","as for","as of","as per","as regards","aside from","back to","because of","close to","due to","except for","far from","inside of","instead of","near to","next to","on to","out from","out of","outside of","prior to","pursuant to","rather than","regardless of","such as","that of","up to","where as","or","yet","so","for","and","nor","a","an","the","de","d'","von","van","c","ca"],FORMAT_KEY_SEQUENCE:["@strip-periods","@font-style","@font-variant","@font-weight","@text-decoration","@vertical-align","@quotes"],INSTITUTION_KEYS:["font-style","font-variant","font-weight","text-decoration","text-case"],SUFFIX_CHARS:"a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z",ROMAN_NUMERALS:[["","i","ii","iii","iv","v","vi","vii","viii","ix"],["","x","xx","xxx","xl","l","lx","lxx","lxxx","xc"],["","c","cc","ccc","cd","d","dc","dcc","dccc","cm"],["","m","mm","mmm","mmmm","mmmmm"]],LANGS:{"af-ZA":"Afrikaans",ar:"Arabic","bg-BG":"Bulgarian","ca-AD":"Catalan","cs-CZ":"Czech","da-DK":"Danish","de-AT":"Austrian","de-CH":"German (CH)","de-DE":"German (DE)","el-GR":"Greek","en-GB":"English (GB)","en-US":"English (US)","es-ES":"Spanish","et-EE":"Estonian",eu:"European","fa-IR":"Persian","fi-FI":"Finnish","fr-CA":"French (CA)","fr-FR":"French (FR)","he-IL":"Hebrew","hr-HR":"Croatian","hu-HU":"Hungarian","is-IS":"Icelandic","it-IT":"Italian","ja-JP":"Japanese","km-KH":"Khmer","ko-KR":"Korean","lt-LT":"Lithuanian","lv-LV":"Latvian","mn-MN":"Mongolian","nb-NO":"Norwegian (Bokm\xe5l)","nl-NL":"Dutch","nn-NO":"Norwegian (Nynorsk)","pl-PL":"Polish","pt-BR":"Portuguese (BR)","pt-PT":"Portuguese (PT)","ro-RO":"Romanian","ru-RU":"Russian","sk-SK":"Slovak","sl-SI":"Slovenian","sr-RS":"Serbian","sv-SE":"Swedish","th-TH":"Thai","tr-TR":"Turkish","uk-UA":"Ukrainian","vi-VN":"Vietnamese","zh-CN":"Chinese (CN)","zh-TW":"Chinese (TW)"},LANG_BASES:{af:"af_ZA",ar:"ar",bg:"bg_BG",ca:"ca_AD",cs:"cs_CZ",da:"da_DK",de:"de_DE",el:"el_GR",en:"en_US",es:"es_ES",et:"et_EE",eu:"eu",fa:"fa_IR",fi:"fi_FI",fr:"fr_FR",he:"he_IL",hr:"hr-HR",hu:"hu_HU",is:"is_IS",it:"it_IT",ja:"ja_JP",km:"km_KH",ko:"ko_KR",lt:"lt_LT",lv:"lv-LV",mn:"mn_MN",nb:"nb_NO",nl:"nl_NL",nn:"nn-NO",pl:"pl_PL",pt:"pt_PT",ro:"ro_RO",ru:"ru_RU",sk:"sk_SK",sl:"sl_SI",sr:"sr_RS",sv:"sv_SE",th:"th_TH",tr:"tr_TR",uk:"uk_UA",vi:"vi_VN",zh:"zh_CN"},SUPERSCRIPTS:{ª:"a","\xb2":"2","\xb3":"3","\xb9":"1",º:"o",ʰ:"h",ʱ:"ɦ",ʲ:"j",ʳ:"r",ʴ:"ɹ",ʵ:"ɻ",ʶ:"ʁ",ʷ:"w",ʸ:"y",ˠ:"ɣ",ˡ:"l",ˢ:"s",ˣ:"x",ˤ:"ʕ",ᴬ:"A",ᴭ:"\xc6",ᴮ:"B",ᴰ:"D",ᴱ:"E",ᴲ:"Ǝ",ᴳ:"G",ᴴ:"H",ᴵ:"I",ᴶ:"J",ᴷ:"K",ᴸ:"L",ᴹ:"M",ᴺ:"N",ᴼ:"O",ᴽ:"Ȣ",ᴾ:"P",ᴿ:"R",ᵀ:"T",ᵁ:"U",ᵂ:"W",ᵃ:"a",ᵄ:"ɐ",ᵅ:"ɑ",ᵆ:"ᴂ",ᵇ:"b",ᵈ:"d",ᵉ:"e",ᵊ:"ə",ᵋ:"ɛ",ᵌ:"ɜ",ᵍ:"g",ᵏ:"k",ᵐ:"m",ᵑ:"ŋ",ᵒ:"o",ᵓ:"ɔ",ᵔ:"ᴖ",ᵕ:"ᴗ",ᵖ:"p",ᵗ:"t",ᵘ:"u",ᵙ:"ᴝ",ᵚ:"ɯ",ᵛ:"v",ᵜ:"ᴥ",ᵝ:"β",ᵞ:"γ",ᵟ:"δ",ᵠ:"φ",ᵡ:"χ","⁰":"0",ⁱ:"i","⁴":"4","⁵":"5","⁶":"6","⁷":"7","⁸":"8","⁹":"9","⁺":"+","⁻":"−","⁼":"=","⁽":"(","⁾":")",ⁿ:"n","℠":"SM","™":"TM","㆒":"一","㆓":"二","㆔":"三","㆕":"四","㆖":"上","㆗":"中","㆘":"下","㆙":"甲","㆚":"乙","㆛":"丙","㆜":"丁","㆝":"天","㆞":"地","㆟":"人",ˀ:"ʔ",ˁ:"ʕ",ۥ:"و",ۦ:"ي"},SUPERSCRIPTS_REGEXP:RegExp("[\xaa\xb2\xb3\xb9\xbaʰʱʲʳʴʵʶʷʸˠˡˢˣˤᴬᴭᴮᴰᴱᴲᴳᴴᴵᴶᴷᴸᴹᴺᴼᴽᴾᴿᵀᵁᵂᵃᵄᵅᵆᵇᵈᵉᵊᵋᵌᵍᵏᵐᵑᵒᵓᵔᵕᵖᵗᵘᵙᵚᵛᵜᵝᵞᵟᵠᵡ⁰ⁱ⁴⁵⁶⁷⁸⁹⁺⁻⁼⁽⁾ⁿ℠™㆒㆓㆔㆕㆖㆗㆘㆙㆚㆛㆜㆝㆞㆟ˀˁۥۦ]","g"),UPDATE_GROUP_CONTEXT_CONDITION:function(t,e,i,s,r){if(t.opt.use_context_condition){var n=t.tmp.group_context.tip;n.condition?(n.condition.termtxt||(n.condition.termtxt=e,n.condition.valueTerm=i),!n.value_seen&&"comma-safe-numbers-only"===n.condition.test&&r&&(n.value_seen=!0,r.match(/^[0-9]/)||(t.tmp.just_did_number=!1))):s&&s.decorations.filter(t=>"@vertical-align"===t[0]).length>0||s&&s.strings.suffix?t.tmp.just_did_number=!1:e&&(e.match(/[0-9]$/)?t.tmp.just_did_number=!0:t.tmp.just_did_number=!1)}},EVALUATE_GROUP_CONDITION:function(t,i){if(t.opt.use_context_condition){var s,r="comma-safe-numbers-only"===i.condition.test;if("empty-label"===i.condition.test)s=!i.condition.termtxt;else if("empty-label-no-decor"===i.condition.test)s=!i.condition.termtxt||i.condition.termtxt.indexOf("%s")>-1;else if(["comma-safe","comma-safe-numbers-only"].indexOf(i.condition.test)>-1){var n=i.condition.termtxt,a=!1;i.condition.termtxt&&(a=i.condition.termtxt.slice(0,1).match(e.ALL_ROMANESQUE_REGEXP)),s=t.tmp.just_did_number?i.condition.valueTerm?!r:!n||(a?!r:["always","after-number"].indexOf(t.opt.require_comma_on_symbol)>-1):!i.condition.valueTerm&&!!n&&(a?!r:"always"===t.opt.require_comma_on_symbol)}if(s)var o=!1;else var o=!0;return i.condition.not&&(o=!o),o}},SYS_OPTIONS:["prioritize_disambiguate_condition","csl_reverse_lookup_support","main_title_from_short_title","uppercase_subtitles","force_short_title_casing_alignment","implicit_short_title","split_container_title"],TITLE_SPLIT_REGEXP:function(){var t=["\\.\\s+","\\!\\s+","\\?\\s+","\\s*::*\\s+","\\s*—\\s*","\\s+\\-\\s+","\\s*\\-\\-\\-*\\s*"];return{match:RegExp("("+t.join("|")+")","g"),matchfirst:RegExp("^("+t.join("|")+")"),split:RegExp("(?:"+t.join("|")+")")}}(),TITLE_SPLIT:function(t){if(!t)return t;for(var i=t.match(e.TITLE_SPLIT_REGEXP.match),s=t.split(e.TITLE_SPLIT_REGEXP.split),r=s.length-2;r>-1;r--)s[r]=s[r].trim(),s[r]&&s[r].slice(-1).toLowerCase()!==s[r].slice(-1)?(s[r]=s[r]+i[r]+s[r+1],s=s.slice(0,r+1).concat(s.slice(r+2))):s=s.slice(0,r+1).concat([i[r]]).concat(s.slice(r+1));return s},GET_COURT_CLASS:function(t,e,i){var s="",r=null,n=e.jurisdiction?e.jurisdiction.split(":")[0]:null,a="court_condition_classes";return i&&(a="court_key_classes"),n&&e.authority&&("string"==typeof e.authority?r=e.authority:e.authority[0]&&e.authority[0].literal&&(r=e.authority[0].literal)),r&&(this.lang&&t.locale[this.lang].opts[a]&&t.locale[this.lang].opts[a][n]&&t.locale[this.lang].opts[a][n][r]?s=t.locale[this.lang].opts[a][n][r]:t.locale[t.opt["default-locale"][0]].opts[a]&&t.locale[t.opt["default-locale"][0]].opts[a][n]&&t.locale[t.opt["default-locale"][0]].opts[a][n][r]&&(s=t.locale[t.opt["default-locale"][0]].opts[a][n][r])),s},SET_COURT_CLASSES:function(t,e,i,s){for(var r=i.getNodesByName(s,"court-class"),n=0,a=i.numberofnodes(r);n<a;n+=1){var o=r[n],l=i.attributes(o),u=l["@name"],p=l["@country"],h=l["@courts"],c="court_key_classes";if(t.registry&&(c="court_condition_classes"),u&&p&&h){h=h.trim().split(/\s+/),t.locale[e].opts[c]||(t.locale[e].opts[c]={}),t.locale[e].opts[c][p]||(t.locale[e].opts[c][p]={});for(var m=0,f=h.length;m<f;m++)t.locale[e].opts[c][p][h[m]]=u}}},INIT_JURISDICTION_MACROS:function(t,i,s,r){if(i["best-jurisdiction"])return!0;if(!t.sys.retrieveStyleModule||!e.MODULE_MACROS[r]||!i.jurisdiction)return!1;var n=t.getJurisdictionList(i.jurisdiction);if(!t.opt.jurisdictions_seen[n[0]]){var a=t.retrieveAllStyleModules(n);for(var o in a){var l=t.loadStyleModule(o,a[o]);l&&!a[l]&&(Object.assign(a,t.retrieveAllStyleModules([l])),t.loadStyleModule(l,a[l],!0))}}var n=t.getJurisdictionList(i.jurisdiction);t.opt.parallel.enable&&!t.parallel&&(t.parallel=new e.Parallel(t));for(var u=0,p=n.length;u<p;u++){var o=n[u];if(s&&t.juris[o]&&!s["best-jurisdiction"]&&t.juris[o].types.locator&&(i["best-jurisdiction"]=o),t.juris[o]&&t.juris[o].types[i.type])return i["best-jurisdiction"]=o,!0}return!1}};e.XmlJSON=function(t){this.dataObj=t,this.institution={name:"institution",attrs:{"institution-parts":"long",delimiter:", "},children:[{name:"institution-part",attrs:{name:"long"},children:[]}]}},e.XmlJSON.prototype.clean=function(t){return t},e.XmlJSON.prototype.getStyleId=function(t,e){var i="id";e&&(i="title");for(var s="",r=t.children,n=0,a=r.length;n<a;n++)if("info"===r[n].name)for(var o=r[n].children,l=0,u=o.length;l<u;l++)o[l].name===i&&(s=o[l].children[0]);return s},e.XmlJSON.prototype.children=function(t){return!!t&&!!t.children.length&&t.children.slice()},e.XmlJSON.prototype.nodename=function(t){return t?t.name:null},e.XmlJSON.prototype.attributes=function(t){var e={};for(var i in t.attrs)e["@"+i]=t.attrs[i];return e},e.XmlJSON.prototype.content=function(t){var e="";if(!t||!t.children)return e;for(var i=0,s=t.children.length;i<s;i+=1)"string"==typeof t.children[i]&&(e+=t.children[i]);return e},e.XmlJSON.prototype.namespace={},e.XmlJSON.prototype.numberofnodes=function(t){return t&&"number"==typeof t.length?t.length:0},e.XmlJSON.prototype.getAttributeValue=function(t,e,i){var s="";return i&&(e=i+":"+e),t&&t.attrs&&(s=t.attrs[e]?t.attrs[e]:""),s},e.XmlJSON.prototype.getNodeValue=function(t,e){var i="";if(e)for(var s=0,r=t.children.length;s<r;s+=1)t.children[s].name===e&&(i=t.children[s].children.length?t.children[s]:"");else t&&(i=t);return i&&i.children&&1==i.children.length&&"string"==typeof i.children[0]&&(i=i.children[0]),i},e.XmlJSON.prototype.setAttributeOnNodeIdentifiedByNameAttribute=function(t,e,i,s,r){"@"===s.slice(0,1)&&(s=s.slice(1));for(var n=0,a=t.children.length;n<a;n+=1)t.children[n].name===e&&t.children[n].attrs.name===i&&(t.children[n].attrs[s]=r)},e.XmlJSON.prototype.deleteNodeByNameAttribute=function(t,e){var i,s;for(i=0,s=t.children.length;i<s;i+=1)t.children[i]&&"string"!=typeof t.children[i]&&t.children[i].attrs.name==e&&(t.children=t.children.slice(0,i).concat(t.children.slice(i+1)))},e.XmlJSON.prototype.deleteAttribute=function(t,e){void 0!==t.attrs[e]&&t.attrs.pop(e)},e.XmlJSON.prototype.setAttribute=function(t,e,i){return t.attrs[e]=i,!1},e.XmlJSON.prototype.nodeCopy=function(t,e){if(!e)var e={};if("object"==typeof e&&void 0===e.length)for(var i in t)"string"==typeof t[i]?e[i]=t[i]:"object"==typeof t[i]&&(void 0===t[i].length?e[i]=this.nodeCopy(t[i],{}):e[i]=this.nodeCopy(t[i],[]));else for(var s=0,r=t.length;s<r;s+=1)"string"==typeof t[s]?e[s]=t[s]:e[s]=this.nodeCopy(t[s],{});return e},e.XmlJSON.prototype.getNodesByName=function(t,e,i,s){if(!s)var s=[];if(!t||!t.children)return s;e===t.name&&(i?i===t.attrs.name&&s.push(t):s.push(t));for(var r=0,n=t.children.length;r<n;r+=1)"object"==typeof t.children[r]&&this.getNodesByName(t.children[r],e,i,s);return s},e.XmlJSON.prototype.nodeNameIs=function(t,e){return void 0!==t&&e==t.name},e.XmlJSON.prototype.makeXml=function(t){return"string"==typeof t&&(t="<"===t.slice(0,1)?this.jsonStringWalker.walkToObject(t):JSON.parse(t)),t},e.XmlJSON.prototype.insertChildNodeAfter=function(t,e,i,s){for(var r=0,n=t.children.length;r<n;r+=1)if(e===t.children[r]){t.children=t.children.slice(0,r).concat([s]).concat(t.children.slice(r+1));break}return t},e.XmlJSON.prototype.insertPublisherAndPlace=function(t){if("group"===t.name){for(var e=!0,i=["publisher","publisher-place"],s=0,r=t.children.length;s<r;s+=1){var n=i.indexOf(t.children[s].attrs.variable);if("text"!==t.children[s].name||!(n>-1)||t.children[s].attrs.prefix||t.children[s].attrs.suffix){e=!1;break}i=i.slice(0,n).concat(i.slice(n+1))}e&&!i.length&&(t.attrs["has-publisher-and-publisher-place"]=!0)}for(var s=0,r=t.children.length;s<r;s+=1)"object"==typeof t.children[s]&&this.insertPublisherAndPlace(t.children[s])},e.XmlJSON.prototype.isChildOfSubstitute=function(t){if(t.length>0){var e=t.slice();return"substitute"===e.pop()||this.isChildOfSubstitute(e)}return!1},e.XmlJSON.prototype.addMissingNameNodes=function(t,e){if(e||(e=[]),"names"===t.name&&!this.isChildOfSubstitute(e)){for(var i=!0,s=0,r=t.children.length;s<r;s++)if("name"===t.children[s].name){i=!1;break}i&&(t.children=[{name:"name",attrs:{},children:[]}].concat(t.children))}e.push(t.name);for(var s=0,r=t.children.length;s<r;s+=1)"object"==typeof t.children[s]&&this.addMissingNameNodes(t.children[s],e);e.pop()},e.XmlJSON.prototype.addInstitutionNodes=function(t){var i;if("names"===t.name){for(var s={},r=-1,n=0,a=t.children.length;n<a;n+=1){if("name"==t.children[n].name){for(var o in t.children[n].attrs)s[o]=t.children[n].attrs[o];s.delimiter=t.children[n].attrs.delimiter,s.and=t.children[n].attrs.and,r=n;for(var l=0,u=t.children[n].children.length;l<u;l+=1)if("family"===t.children[n].children[l].attrs.name)for(var o in t.children[n].children[l].attrs)s[o]=t.children[n].children[l].attrs[o]}if("institution"==t.children[n].name){r=-1;break}}if(r>-1){for(var i=this.nodeCopy(this.institution),n=0,a=e.INSTITUTION_KEYS.length;n<a;n+=1){var p=e.INSTITUTION_KEYS[n];void 0!==s[p]&&(i.children[0].attrs[p]=s[p]),s.delimiter&&(i.attrs.delimiter=s.delimiter),s.and&&(i.attrs.and=s.and)}t.children=t.children.slice(0,r+1).concat([i]).concat(t.children.slice(r+1))}}for(var n=0,a=t.children.length;n<a;n+=1)"string"!=typeof t.children[n]&&this.addInstitutionNodes(t.children[n])},e.XmlJSON.prototype.flagDateMacros=function(t){for(var e=0,i=t.children.length;e<i;e+=1)"macro"===t.children[e].name&&this.inspectDateMacros(t.children[e])&&(t.children[e].attrs["macro-has-date"]="true")},e.XmlJSON.prototype.inspectDateMacros=function(t){if(!t||!t.children)return!1;if("date"===t.name)return!0;for(var e=0,i=t.children.length;e<i;e+=1)if(this.inspectDateMacros(t.children[e]))return!0;return!1},e.stripXmlProcessingInstruction=function(t){return t?t=(t=(t=(t=t.replace(/^<\?[^?]+\?>/,"")).replace(/<!--[^>]+-->/g,"")).replace(/^\s+/g,"")).replace(/\s+$/g,""):t},e.parseXml=function(t){var e=[],i=[e];function s(t){return t.split("&amp;").join("&").split("&quot;").join('"').split("&gt;").join(">").split("&lt;").join("<").replace(/&#([0-9]{1,6});/gi,function(t,e){return String.fromCharCode(parseInt(e,10))}).replace(/&#x([a-f0-9]{1,6});/gi,function(t,e){return String.fromCharCode(parseInt(e,16))})}function r(t){var e=RegExp("^<([^	 />]+)"),i=t.match(e);return i?i[1]:null}function n(t){var e={};e.name=r(t),e.attrs={};var i=function(t){var e=t.match(/([^\'\"=	 ]+)=(?:\"[^\"]*\"|\'[^\']*\')/g);if(e)for(var i=0,s=e.length;i<s;i++)e[i]=e[i].replace(/=.*/,"");return e}(t);if(i)for(var n=0,a=i.length;n<a;n++){var o={name:i[n],value:function(t,e){var i=RegExp("^.*[	 ]+"+e+"=(\"(?:[^\"]*)\"|'(?:[^']*)').*$"),s=t.match(i);return s?s[1].slice(1,-1):null}(t,i[n])};e.attrs[o.name]=s(o.value)}return e.children=[],e}function a(t){i.slice(-1)[0].push(t)}for(var o=function(t){for(var e=(t=t.split(/(?:\r\n|\n|\r)/).join(" ").replace(/>[	 ]+</g,"><").replace(/<\!--.*?-->/g,"")).split("><"),i=null,s=0,r=e.length;s<r;s++)s>0&&(e[s]="<"+e[s]),s<e.length-1&&(e[s]=e[s]+">"),"number"!=typeof i&&("<style "===e[s].slice(0,7)||"<locale "==e[s].slice(0,8))&&(i=s);e=e.slice(i);for(var s=e.length-2;s>-1;s--)if(-1===e[s].slice(1).indexOf("<")){var n=e[s].slice(0,5);"/>"!==e[s].slice(-2)&&("<term"===n?"</term"===e[s+1].slice(0,6)&&(e[s]=e[s]+e[s+1],e=e.slice(0,s+1).concat(e.slice(s+2))):["<sing","<mult"].indexOf(n)>-1&&"/>"!==e[s].slice(-2)&&"<"===e[s+1].slice(0,1)&&(e[s]=e[s]+e[s+1],e=e.slice(0,s+1).concat(e.slice(s+2))))}return e}(t),l=0,u=o.length;l<u;l++)!function(t){var e,o;t.slice(1).indexOf("<")>-1?((e=n(t.slice(0,t.indexOf(">")+1))).children=[s(t.match(/^.*>([^<]*)<.*$/)[1])],a(e)):"/>"===t.slice(-2)?(e=n(t),"term"===r(t)&&e.children.push(""),a(e)):"</"===t.slice(0,2)?i.pop():(a(e=n(t)),o=e,i.push(o.children))}(o[l]);return e[0]},e.XmlDOM=function(t){this.dataObj=t,"undefined"==typeof DOMParser?((DOMParser=function(){}).prototype.parseFromString=function(t,e){if("undefined"!=typeof ActiveXObject){var i=new ActiveXObject("MSXML.DomDocument");return i.async=!1,i.loadXML(t),i}if("undefined"!=typeof XMLHttpRequest){var i=new XMLHttpRequest;return e||(e="text/xml"),i.open("GET","data:"+e+";charset=utf-8,"+encodeURIComponent(t),!1),i.overrideMimeType&&i.overrideMimeType(e),i.send(null),i.responseXML}if("undefined"!=typeof marknote)return new marknote.Parser().parse(t)},this.hasAttributes=function(t){var e;return!!t.attributes&&!!t.attributes.length}):this.hasAttributes=function(t){var e;return!!t.attributes&&!!t.attributes.length},this.importNode=function(t,e){var i;return void 0===t.importNode?this._importNode(t,e,!0):t.importNode(e,!0)},this._importNode=function(t,e,i){if(1===e.nodeType){var s=t.createElement(e.nodeName);if(e.attributes&&e.attributes.length>0)for(var r=0,n=e.attributes.length;r<n;)s.setAttribute(e.attributes[r].nodeName,e.getAttribute(e.attributes[r++].nodeName));if(i&&e.childNodes&&e.childNodes.length>0)for(var r=0,n=e.childNodes.length;r<n;)s.appendChild(this._importNode(t,e.childNodes[r++],i));return s}},this.parser=new DOMParser;var e=this.parser.parseFromString('<docco><institution institution-parts="long" delimiter=", " substitute-use-first="1" use-last="1"><institution-part name="long"/></institution></docco>',"text/xml"),i=e.getElementsByTagName("institution");this.institution=i.item(0);var s=e.getElementsByTagName("institution-part");this.institutionpart=s.item(0),this.ns="http://purl.org/net/xbiblio/csl"},e.XmlDOM.prototype.clean=function(t){return t=(t=(t=(t=(t=t.replace(/<\?[^?]+\?>/g,"")).replace(/<![^>]+>/g,"")).replace(/^\s+/,"")).replace(/\s+$/,"")).replace(/^\n*/,"")},e.XmlDOM.prototype.getStyleId=function(t,e){var i="",s="id";e&&(s="title");var r=t.getElementsByTagName(s);return r&&r.length&&(r=r.item(0)),r&&(i=r.textContent),i||(i=r.innerText),i||(i=r.innerHTML),i},e.XmlDOM.prototype.children=function(t){var e,i,s,r;if(!t)return[];for(i=0,r=[],s=(e=t.childNodes).length;i<s;i+=1)"#text"!=e[i].nodeName&&r.push(e[i]);return r},e.XmlDOM.prototype.nodename=function(t){return t.nodeName},e.XmlDOM.prototype.attributes=function(t){var e,i,s,r,n;if(e={},t&&this.hasAttributes(t))for(r=0,n=(i=t.attributes).length;r<n;r+=1)e["@"+(s=i[r]).name]=s.value;return e},e.XmlDOM.prototype.content=function(t){var e;return void 0!==t.textContent?t.textContent:void 0!==t.innerText?t.innerText:t.txt},e.XmlDOM.prototype.namespace={xml:"http://www.w3.org/XML/1998/namespace"},e.XmlDOM.prototype.numberofnodes=function(t){return t?t.length:0},e.XmlDOM.prototype.getAttributeName=function(t){return t.name},e.XmlDOM.prototype.getAttributeValue=function(t,e,i){var s="";return i&&(e=i+":"+e),t&&this.hasAttributes(t)&&t.getAttribute(e)&&(s=t.getAttribute(e)),s},e.XmlDOM.prototype.getNodeValue=function(t,e){var i=null;if(e){var s=t.getElementsByTagName(e);s.length>0&&(i=void 0!==s[0].textContent?s[0].textContent:void 0!==s[0].innerText?s[0].innerText:s[0].text)}return null===i&&t&&t.childNodes&&(0==t.childNodes.length||1==t.childNodes.length&&"#text"==t.firstChild.nodeName)&&(i=void 0!==t.textContent?t.textContent:void 0!==t.innerText?t.innerText:t.text),null===i&&(i=t),i},e.XmlDOM.prototype.setAttributeOnNodeIdentifiedByNameAttribute=function(t,e,i,s,r){var n,a,o,l;for("@"===s.slice(0,1)&&(s=s.slice(1)),n=0,a=(o=t.getElementsByTagName(e)).length;n<a;n+=1)(l=o[n]).getAttribute("name")==i&&l.setAttribute(s,r)},e.XmlDOM.prototype.deleteNodeByNameAttribute=function(t,e){var i,s,r,n;for(i=0,s=(n=t.childNodes).length;i<s;i+=1)(r=n[i])&&r.nodeType!=r.TEXT_NODE&&this.hasAttributes(r)&&r.getAttribute("name")==e&&t.removeChild(n[i])},e.XmlDOM.prototype.deleteAttribute=function(t,e){t.removeAttribute(e)},e.XmlDOM.prototype.setAttribute=function(t,e,i){return t.ownerDocument||(t=t.firstChild),["function","unknown"].indexOf(typeof t.setAttribute)>-1&&t.setAttribute(e,i),!1},e.XmlDOM.prototype.nodeCopy=function(t){return t.cloneNode(!0)},e.XmlDOM.prototype.getNodesByName=function(t,e,i){var s,r,n,a,o;for(a=0,s=[],o=(r=t.getElementsByTagName(e)).length;a<o;a+=1)n=r.item(a),(!i||this.hasAttributes(n)&&n.getAttribute("name")==i)&&s.push(n);return s},e.XmlDOM.prototype.nodeNameIs=function(t,e){return e==t.nodeName},e.XmlDOM.prototype.makeXml=function(t){return t||(t="<docco><bogus/></docco>"),t=t.replace(/\s*<\?[^>]*\?>\s*\n*/g,""),this.parser.parseFromString(t,"application/xml").firstChild},e.XmlDOM.prototype.insertChildNodeAfter=function(t,e,i,s){var r;return r=this.importNode(e.ownerDocument,s),t.replaceChild(r,e),t},e.XmlDOM.prototype.insertPublisherAndPlace=function(t){for(var e=t.getElementsByTagName("group"),i=0,s=e.length;i<s;i+=1){for(var r=e.item(i),n=[],a=0,o=r.childNodes.length;a<o;a+=1)1!==r.childNodes.item(a).nodeType&&n.push(a);if(r.childNodes.length-n.length==2){for(var l=[],a=0,o=2;a<o;a+=1)if(!(n.indexOf(a)>-1)){for(var u=r.childNodes.item(a),p=[],h=0,c=u.childNodes.length;h<c;h+=1)1!==u.childNodes.item(h).nodeType&&p.push(h);if(u.childNodes.length-p.length==0&&(l.push(u.getAttribute("variable")),u.getAttribute("suffix")||u.getAttribute("prefix"))){l=[];break}}l.indexOf("publisher")>-1&&l.indexOf("publisher-place")>-1&&r.setAttribute("has-publisher-and-publisher-place",!0)}}},e.XmlDOM.prototype.isChildOfSubstitute=function(t){if(t.parentNode)if("substitute"===t.parentNode.tagName.toLowerCase())return!0;else return this.isChildOfSubstitute(t.parentNode);return!1},e.XmlDOM.prototype.addMissingNameNodes=function(t){for(var e=t.getElementsByTagName("names"),i=0,s=e.length;i<s;i+=1){var r=e.item(i),n=r.getElementsByTagName("name");if((!n||0===n.length)&&!this.isChildOfSubstitute(r)){var a=r.ownerDocument.createElement("name");r.appendChild(a)}}},e.XmlDOM.prototype.addInstitutionNodes=function(t){var i,s,r,n,a,o,l,u;for(l=0,u=(i=t.getElementsByTagName("names")).length;l<u;l+=1)if(0!=(a=(s=i.item(l)).getElementsByTagName("name")).length&&0==s.getElementsByTagName("institution").length){n=(r=this.importNode(t.ownerDocument,this.institution)).getElementsByTagName("institution-part").item(0),o=a.item(0),s.insertBefore(r,o.nextSibling);for(var p=0,h=e.INSTITUTION_KEYS.length;p<h;p+=1){var c=e.INSTITUTION_KEYS[p],m=o.getAttribute(c);m&&n.setAttribute(c,m)}for(var f=o.getElementsByTagName("name-part"),p=0,h=f.length;p<h;p+=1)if("family"===f[p].getAttribute("name"))for(var d=0,g=e.INSTITUTION_KEYS.length;d<g;d+=1){var c=e.INSTITUTION_KEYS[d],m=f[p].getAttribute(c);m&&n.setAttribute(c,m)}}},e.XmlDOM.prototype.flagDateMacros=function(t){var e,i,s,r=t.getElementsByTagName("macro");for(e=0,i=r.length;e<i;e+=1)(s=r.item(e)).getElementsByTagName("date").length&&s.setAttribute("macro-has-date","true")},e.setupXml=function(t){var i={},s=null;return void 0!==t?"string"==typeof t?(i="<"===(t=t.replace("^\uFEFF","").replace(/^\s+/,"")).slice(0,1)?e.parseXml(t):JSON.parse(t),s=new e.XmlJSON(i)):s=void 0!==t.getAttribute?new e.XmlDOM(t):void 0!==t.toXMLString?new e.XmlE4X(t):new e.XmlJSON(t):e.error("unable to parse XML input"),s||e.error("citeproc-js error: unable to parse CSL style or locale object"),s},e.getSortCompare=function(t){if(e.stringCompare)return e.stringCompare;var i,s=this,r={sensitivity:"base",ignorePunctuation:!0,numeric:!0};t||(t="en-US");var n=function(t){return t.replace(/^[\[\]\'\"]*/g,"")},a=!!(i=function(i,n){return e.toLocaleLowerCase.call(s,i).localeCompare(e.toLocaleLowerCase.call(s,n),t,r)})("[x","x")&&function(t,e){return i(n(t),n(e))};return function(t,e){return a?a(t,e):i(t,e)}},e.ambigConfigDiff=function(t,e){var i,s,r,n;if(t.names.length!==e.names.length)return 1;for(i=0,s=t.names.length;i<s;i+=1)if(t.names[i]!==e.names[i])return 1;else for(r=0,n=t.givens[i];r<n;r+=1)if(t.givens[i][r]!==e.givens[i][r])return 1;return+(t.disambiguate!=e.disambiguate||t.year_suffix!==e.year_suffix)},e.cloneAmbigConfig=function(t,e){var i,s,r,n,a,o={};for(i=0,o.names=[],o.givens=[],o.year_suffix=!1,o.disambiguate=!1,s=t.names.length;i<s;i+=1)a=t.names[i],o.names[i]=a;for(i=0,s=t.givens.length;i<s;i+=1){for(r=0,a=[],n=t.givens[i].length;r<n;r+=1)a.push(t.givens[i][r]);o.givens.push(a)}return e?(o.year_suffix=e.year_suffix,o.disambiguate=e.disambiguate):(o.year_suffix=t.year_suffix,o.disambiguate=t.disambiguate),o},e.getAmbigConfig=function(){var t;return(t=this.tmp.disambig_request)||(t=this.tmp.disambig_settings),e.cloneAmbigConfig(t)},e.getMaxVals=function(){return this.tmp.names_max.mystack.slice()},e.getMinVal=function(){return this.tmp["et-al-min"]},e.tokenExec=function(t,e,i){var s=t.next,r=!1;t.test&&(s=(function(e){return e?(this.tmp.jump.replace("succeed"),t.succeed):(this.tmp.jump.replace("fail"),t.fail)}).call(this,t.test(e,i)));for(var n=0,a=t.execs.length;n<a;n++)(r=t.execs[n].call(t,this,e,i))&&(s=r);return s},e.expandMacro=function(t,i){var s,r,n,a=t.postponed_macro,o=t.strings.sort_direction;t=new e.Token("group",e.START);var l=!1,u=!1;(s=this.cslXml.getNodesByName(this.cslXml.dataObj,"macro",a)).length&&(u=this.cslXml.getAttributeValue(s[0],"cslid"),l=this.cslXml.getAttributeValue(s[0],"macro-has-date")),l&&(a=a+"@"+this.build.current_default_locale,n=function(t){t.tmp.extension&&(t.tmp["doing-macro-with-date"]=!0)},t.execs.push(n)),this.build.macro_stack.indexOf(a)>-1?e.error('CSL processor error: call to macro "'+a+'" would cause an infinite loop'):this.build.macro_stack.push(a),t.cslid=u,e.MODULE_MACROS[a]&&(t.juris=a,this.opt.update_mode=e.POSITION),e.Node.group.build.call(t,this,i,!0),this.cslXml.getNodeValue(s)||e.error('CSL style error: undefined macro "'+a+'"');var p=e.getMacroTarget.call(this,a);if(p&&(e.buildMacro.call(this,p,s),e.configureMacro.call(this,p)),!this.build.extension){var h,n=(h=a,function(t,i,s){for(var r=0;r<t.macros[h].length;)r=e.tokenExec.call(t,t.macros[h][r],i,s)}),c=new e.Token("text",e.SINGLETON);c.execs.push(n),i.push(c)}(r=new e.Token("group",e.END)).strings.sort_direction=o,l&&(n=function(t){t.tmp.extension&&(t.tmp["doing-macro-with-date"]=!1)},r.execs.push(n)),t.juris&&(r.juris=a),e.Node.group.build.call(r,this,i,!0),this.build.macro_stack.pop()},e.getMacroTarget=function(t){var e=!1;return this.build.extension?e=this[this.build.root+this.build.extension].tokens:this.macros[t]||(e=[],this.macros[t]=e),e},e.buildMacro=function(t,i){var s;e.makeBuilder(this,t)(void 0===i.length?i:i[0])},e.configureMacro=function(t){this.build.extension||this.configureTokenList(t)},e.XmlToToken=function(t,i,s,r){var n,a,o,l,u,p,h;if(n=t.cslXml.nodename(this),!t.build.skip||t.build.skip===n){if(!n){(a=t.cslXml.content(this))&&(t.build.text=a);return}if(e.Node[t.cslXml.nodename(this)]||e.error('Undefined node name "'+n+'".'),o=t.cslXml.attributes(this),l=e.setDecorations.call(this,t,o),u=new e.Token(n,i),i!==e.END||"if"===n||"else-if"===n||"layout"===n){for(var p in o)if(o.hasOwnProperty(p)){if(i===e.END&&"@language"!==p&&"@locale"!==p)continue;if(o.hasOwnProperty(p))if(e.Attributes[p])try{e.Attributes[p].call(u,t,""+o[p])}catch(t){e.error(p+" attribute: "+t)}else e.debug('warning: undefined attribute "'+p+'" in style')}u.decorations=l,e.DATE_VARIABLES.indexOf(o["@variable"])>-1&&r.push(u.variables)}else i===e.END&&o["@variable"]&&(u.hasVariable=!0,e.DATE_VARIABLES.indexOf(o["@variable"])>-1&&(u.variables=r.pop()));h=s||t[t.build.area].tokens,e.Node[n].build.call(u,t,h,!0)}},e.DateParser=function(){for(var t=[["明治",1867],["大正",1911],["昭和",1925],["平成",1988]],i={},s=0,r=t.length;s<r;s++){var n=t[s][0],a=t[s][1];i[n]=a}for(var o=[],l={},s=0,r=t.length;s<r;s++){var u=t[s],a=u[0];o.push(a),l[u[0]]=u[1]}var p=o.join("|"),h=RegExp("(?:"+p+")(?:[0-9]+)"),c=RegExp("(?:"+p+")(?:[0-9]+)","g"),m=/(\u6708|\u5E74)/g,f=/\u65E5/g,d=/\u301c/g,g="([?0-9]{4}(?:%%NUMD%%[?0-9]{1,2}){0,2}(?![0-9])|(?:[?0-9]{1,2}%%NUMD%%){0,2}[?0-9]{4}(?![0-9])|[?0-9]{1,3}|[%%DATED%%]|[?~]|[^-/~?0-9]+)",b=new RegExp(g.replace(/%%NUMD%%/g,"-").replace(/%%DATED%%/g,"-")),_=new RegExp(g.replace(/%%NUMD%%/g,"-").replace(/%%DATED%%/g,"/")),v=new RegExp(g.replace(/%%NUMD%%/g,"/").replace(/%%DATED%%/g,"-"));this.monthStrings="january february march april may june july august september october november december spring summer fall winter spring summer".split(" "),this.setOrderDayMonth=function(){this.monthGuess=1,this.dayGuess=0},this.setOrderMonthDay=function(){this.monthGuess=0,this.dayGuess=1},this.resetDateParserMonths=function(){this.monthSets=[];for(var t=0,e=this.monthStrings.length;t<e;t++)this.monthSets.push([this.monthStrings[t]]);this.monthAbbrevs=[];for(var t=0,e=this.monthSets.length;t<e;t++){this.monthAbbrevs.push([]);for(var i=0,s=this.monthSets[t].length;i<s;i++)this.monthAbbrevs[t].push(this.monthSets[t][0].slice(0,3))}this.monthRexes=[];for(var t=0,e=this.monthAbbrevs.length;t<e;t++)this.monthRexes.push(RegExp("(?:"+this.monthAbbrevs[t].join("|")+")"))},this.addDateParserMonths=function(t){if("string"==typeof t&&(t=t.split(/\s+/)),12!==t.length&&16!==t.length)return void e.debug("month [+season] list of "+t.length+", expected 12 or 16. Ignoring.");for(var i=0,s=t.length;i<s;i++){for(var r=null,n=!1,a=3,o={},l=0,u=this.monthAbbrevs.length;l<u;l++){if(o[l]={},l===i){for(var p=0,h=this.monthAbbrevs[i].length;p<h;p++)if(this.monthAbbrevs[i][p]===t[i].slice(0,this.monthAbbrevs[i][p].length)){n=!0;break}}else for(var p=0,h=this.monthAbbrevs[l].length;p<h;p++)if(r=this.monthAbbrevs[l][p].length,this.monthAbbrevs[l][p]===t[i].slice(0,r)){for(;this.monthSets[l][p].slice(0,r)===t[i].slice(0,r);)if(r>t[i].length||r>this.monthSets[l][p].length){e.debug("unable to disambiguate month string in date parser: "+t[i]);break}else r+=1;a=r,o[l][p]=r}for(var c in o)for(var m in o[c])r=o[c][m],c=parseInt(c,10),m=parseInt(m,10),this.monthAbbrevs[c][m]=this.monthSets[c][m].slice(0,r)}n||(this.monthSets[i].push(t[i]),this.monthAbbrevs[i].push(t[i].slice(0,a)))}this.monthRexes=[],this.monthRexStrs=[];for(var i=0,s=this.monthAbbrevs.length;i<s;i++)this.monthRexes.push(RegExp("^(?:"+this.monthAbbrevs[i].join("|")+")")),this.monthRexStrs.push("^(?:"+this.monthAbbrevs[i].join("|")+")");if(18===this.monthAbbrevs.length)for(var i=12,s=14;i<s;i++)this.monthRexes[i+4]=RegExp("^(?:"+this.monthAbbrevs[i].join("|")+")"),this.monthRexStrs[i+4]="^(?:"+this.monthAbbrevs[i].join("|")+")"},this.convertDateObjectToArray=function(t){t["date-parts"]=[],t["date-parts"].push([]);for(var e,i=0,s=0,r=3;s<r&&t[e=["year","month","day"][s]];s++)i+=1,t["date-parts"][0].push(t[e]),delete t[e];t["date-parts"].push([]);for(var s=0,r=i;s<r&&t[e=["year_end","month_end","day_end"][s]];s++)t["date-parts"][1].push(t[e]),delete t[e];return t["date-parts"][0].length!==t["date-parts"][1].length&&t["date-parts"].pop(),t},this.convertDateObjectToString=function(t){for(var i=[],s=0;s<3;s+=1)if(t[e.DATE_PARTS_ALL[s]])i.push(t[e.DATE_PARTS_ALL[s]]);else break;return i.join("-")},this._parseNumericDate=function(t,e,i,s){i||(i="");for(var r=s.split(e),n=0,a=r.length;n<a;n++)if(4===r[n].length){t["year"+i]=r[n].replace(/^0*/,""),r=n?r.slice(0,n):r.slice(1);break}for(var n=0,a=r.length;n<a;n++)r[n]=parseInt(r[n],10);if(1!==r.length&&(2!==r.length||r[1])){if(2===r.length)if(r[this.monthGuess]>12){var o=r[this.dayGuess],l=r[this.monthGuess];o&&(t["month"+i]=""+o,l&&(t["day"+i]=""+l))}else{var o=r[this.monthGuess],l=r[this.dayGuess];o&&(t["month"+i]=""+o,l&&(t["day"+i]=""+l))}}else{var o=r[0];o&&(t["month"+i]=""+r[0])}},this.parseDateToObject=function(t){var i,s,r,n=t,a=-1,o=-1,u=!1;if(t){if("-"===(t=t.replace(/^(.*[0-9])T[0-9].*/,"$1")).slice(0,1)&&(u=!0,t=t.slice(1)),t.match(/^[0-9]{1,3}$/))for(;t.length<4;)t="0"+t;var p=(t=(t=""+t).replace(/\s*[0-9]{2}:[0-9]{2}(?::[0-9]+)/,"")).match(m);if(p){var g=(t=(t=(t=(t=(t=(t=t.replace(/\s+/g,"")).replace(f,"")).replace(m,"-")).replace(d,"/")).replace(/\-\//g,"/")).replace(/-$/g,"")).split(h);i=[];var y=t.match(c);if(y){for(var x=[],I=0,O=y.length;I<O;I++)x=x.concat(y[I].match(/([^0-9]+)([0-9]+)/).slice(1));for(var I=0,O=g.length;I<O;I++)if(i.push(g[I]),I!==O-1){var T=2*I;i.push(x[T]),i.push(x[T+1])}}else i=g;for(var I=1,O=i.length;I<O;I+=3)i[I+1]=l[i[I]]+parseInt(i[I+1],10),i[I]="";a=(t=(t=(t=(t=i.join("")).replace(/\s*-\s*$/,"").replace(/\s*-\s*\//,"/")).replace(/\.\s*$/,"")).replace(/\.(?! )/,"")).indexOf("/"),o=t.indexOf("-")}}t=t.replace(/([A-Za-z])\./g,"$1");var S="",N="",A={};if('"'===t.slice(0,1)&&'"'===t.slice(-1))return A.literal=t.slice(1,-1),A;a>-1&&o>-1?t.split("/").length>3?(s="-",t=t.replace(/\_/g,"-"),r="/",i=t.split(v)):(s="/",t=t.replace(/\_/g,"/"),r="-",i=t.split(_)):(t=(t=t.replace(/\//g,"-")).replace(/\_/g,"-"),s="-",r="-",i=t.split(b));for(var E=[],I=0,O=i.length;I<O;I++){var p=i[I].match(/^\s*([\-\/]|[^\-\/\~\?0-9]+|[\-~?0-9]+)\s*$/);p&&E.push(p[1])}var k=E.indexOf(s),R=[],w=!1;k>-1?(R.push([0,k]),R.push([k+1,E.length]),w=!0):R.push([0,E.length]);for(var j="",I=0,O=R.length;I<O;I++){var C=R[I],L=E.slice(C[0],C[1]);t:for(var D=0,P=L.length;D<P;D++){var U=L[D];if(U.indexOf(r)>-1){this._parseNumericDate(A,r,j,U);continue}if(U.match(/[0-9]{4}/)){A["year"+j]=U.replace(/^0*/,"");continue}("~"===U||"?"===U||"c"===U||U.match(/^cir/))&&(A.circa=!0);for(var B=0,M=this.monthRexes.length;B<M;B++)if(U.toLocaleLowerCase().match(this.monthRexes[B])){A["month"+j]=""+(parseInt(B,10)+1);continue t}if(U.match(/^[0-9]+$/)&&(S=U),U.toLocaleLowerCase().match(/^bc/)&&S){A["year"+j]=""+-1*S,S="";continue}if(U.toLocaleLowerCase().match(/^ad/)&&S){A["year"+j]=""+S,S="";continue}if(U.toLocaleLowerCase().match(/(?:mic|tri|hil|eas)/)&&!A["season"+j]){N=U;continue}}S&&(A["day"+j]=S,S=""),N&&!A["season"+j]&&(A["season"+j]=N.trim(),N=""),j="_end"}if(w)for(var D=0,P=e.DATE_PARTS_ALL.length;D<P;D++){var q=e.DATE_PARTS_ALL[D];A[q]&&!A[q+"_end"]?A[q+"_end"]=A[q]:!A[q]&&A[q+"_end"]&&(A[q]=A[q+"_end"])}(!A.year||A.year&&A.day&&!A.month)&&(A={literal:n});for(var X=["year","month","day","year_end","month_end","day_end"],I=0,O=X.length;I<O;I++){var z=X[I];"string"==typeof A[z]&&A[z].match(/^[0-9]+$/)&&(A[z]=parseInt(A[z],10))}return u&&Object.keys(A).indexOf("year")>-1&&(A.year=-1*A.year),A},this.parseDateToArray=function(t){return this.convertDateObjectToArray(this.parseDateToObject(t))},this.parseDateToString=function(t){return this.convertDateObjectToString(this.parseDateToObject(t))},this.parse=function(t){return this.parseDateToObject(t)},this.setOrderMonthDay(),this.resetDateParserMonths()},e.DateParser=new e.DateParser,e.Engine=function(t,i,s,r){for(var n in this.processor_version=e.PROCESSOR_VERSION,this.csl_version="1.0",this.sys=t,"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(t){if(null==t)throw TypeError("Cannot convert undefined or null to object");for(var e=Object(t),i=1;i<arguments.length;i++){var s=arguments[i];if(null!=s)for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e},writable:!0,configurable:!0}),t.variableWrapper&&(e.VARIABLE_WRAPPER_PREPUNCT_REX=RegExp("^(["+[" "].concat(e.SWAPPING_PUNCTUATION).join("")+"]*)(.*)")),e.retrieveStyleModule&&(this.sys.retrieveStyleModule=e.retrieveStyleModule),e.getAbbreviation&&(this.sys.getAbbreviation=e.getAbbreviation),this.sys.stringCompare&&(e.stringCompare=this.sys.stringCompare),this.sys.AbbreviationSegments=e.AbbreviationSegments,this.transform=new e.Transform(this),this.setParseNames=function(t){this.opt["parse-names"]=t},this.opt=new e.Engine.Opt,this.tmp=new e.Engine.Tmp,this.build=new e.Engine.Build,this.fun=new e.Engine.Fun(this),this.configure=new e.Engine.Configure,this.citation_sort=new e.Engine.CitationSort,this.bibliography_sort=new e.Engine.BibliographySort,this.citation=new e.Engine.Citation(this),this.bibliography=new e.Engine.Bibliography,this.intext=new e.Engine.InText,this.output=new e.Output.Queue(this),this.dateput=new e.Output.Queue(this),this.cslXml=e.setupXml(i),e.SYS_OPTIONS){var a,o,l=e.SYS_OPTIONS[n];"boolean"==typeof this.sys[l]&&(this.opt.development_extensions[l]=this.sys[l])}(this.opt.development_extensions.uppercase_subtitles||this.opt.development_extensions.implicit_short_title)&&(this.opt.development_extensions.main_title_from_short_title=!0),this.opt.development_extensions.csl_reverse_lookup_support&&(this.build.cslNodeId=0,this.setCslNodeIds=function(t,e){var i=this.cslXml.children(t);this.cslXml.setAttribute(t,"cslid",this.build.cslNodeId),this.opt.nodenames.push(e),this.build.cslNodeId+=1;for(var s=0,r=this.cslXml.numberofnodes(i);s<r;s+=1)(e=this.cslXml.nodename(i[s]))&&this.setCslNodeIds(i[s],e)},this.setCslNodeIds(this.cslXml.dataObj,"style")),this.cslXml.addMissingNameNodes(this.cslXml.dataObj),this.cslXml.addInstitutionNodes(this.cslXml.dataObj),this.cslXml.insertPublisherAndPlace(this.cslXml.dataObj),this.cslXml.flagDateMacros(this.cslXml.dataObj),void 0===this.cslXml.attributes(this.cslXml.dataObj)["@sort-separator"]&&this.cslXml.setAttribute(this.cslXml.dataObj,"sort-separator",", "),this.opt["initialize-with-hyphen"]=!0,this.setStyleAttributes(),this.opt.xclass=this.cslXml.getAttributeValue(this.cslXml.dataObj,"class"),this.opt.class=this.opt.xclass,this.opt.styleID=this.cslXml.getStyleId(this.cslXml.dataObj),this.opt.styleName=this.cslXml.getStyleId(this.cslXml.dataObj,!0),"1.1m"===this.opt.version.slice(0,4)&&(this.opt.development_extensions.consolidate_legal_items=!0,this.opt.development_extensions.consolidate_container_items=!0,this.opt.development_extensions.main_title_from_short_title=!0,this.opt.development_extensions.expect_and_symbol_form=!0,this.opt.development_extensions.require_explicit_legal_case_title_short=!0,this.opt.development_extensions.force_jurisdiction=!0,this.opt.development_extensions.force_title_abbrev_fallback=!0),s&&(s=s.replace("_","-"),s=e.normalizeLocaleStr(s)),this.opt["default-locale"][0]&&(this.opt["default-locale"][0]=this.opt["default-locale"][0].replace("_","-"),this.opt["default-locale"][0]=e.normalizeLocaleStr(this.opt["default-locale"][0])),s&&r&&(this.opt["default-locale"]=[s]),s&&!r&&this.opt["default-locale"][0]&&(s=this.opt["default-locale"][0]),0===this.opt["default-locale"].length&&(s||(s="en-US"),this.opt["default-locale"].push("en-US")),s||(s=this.opt["default-locale"][0]),o=e.localeResolve(s),this.opt.lang=o.best,this.opt["default-locale"][0]=o.best,this.locale={},this.opt["default-locale-sort"]||(this.opt["default-locale-sort"]=this.opt["default-locale"][0]),"dale|".localeCompare("daleb",this.opt["default-locale-sort"])>-1?this.opt.sort_sep="@":this.opt.sort_sep="|",this.localeConfigure(o),this.locale[this.opt.lang].opts["skip-words-regexp"]=RegExp("(?:(?:[?!:]*\\s+|-|^)(?:"+this.locale[this.opt.lang].opts["skip-words"].slice().join("|")+")(?=[!?:]*\\s+|-|$))","g"),this.output.adjust=new e.Output.Queue.adjust(this.getOpt("punctuation-in-quote")),this.registry=new e.Registry(this),this.macros={},this.build.area="citation";var u=this.cslXml.getNodesByName(this.cslXml.dataObj,this.build.area);this.buildTokenLists(u,this[this.build.area].tokens),this.build.area="bibliography";var u=this.cslXml.getNodesByName(this.cslXml.dataObj,this.build.area);this.buildTokenLists(u,this[this.build.area].tokens),this.build.area="intext";var u=this.cslXml.getNodesByName(this.cslXml.dataObj,this.build.area);this.buildTokenLists(u,this[this.build.area].tokens),this.opt.parallel.enable&&(this.parallel=new e.Parallel(this)),this.juris={},this.configureTokenLists(),this.disambiguate=new e.Disambiguation(this),this.splice_delimiter=!1,this.fun.dateparser=e.DateParser,this.fun.flipflopper=new e.Util.FlipFlopper(this),this.setCloseQuotesArray(),this.fun.ordinalizer.init(this),this.fun.long_ordinalizer.init(this),this.fun.page_mangler=e.Util.PageRangeMangler.getFunction(this,"page"),this.fun.year_mangler=e.Util.PageRangeMangler.getFunction(this,"year"),this.setOutputFormat("html")},e.Engine.prototype.setCloseQuotesArray=function(){var t;(t=[]).push(this.getTerm("close-quote")),t.push(this.getTerm("close-inner-quote")),t.push('"'),t.push("'"),this.opt.close_quotes_array=t},e.makeBuilder=function(t,i){var s=[],r=[];return function n(a,o,l){l||(l=[]),a||(a=[]),void 0===a.length&&(a=[a]);for(var u=0;u<a.length;u++){var p,h,c=a[u];null!==t.cslXml.nodename(c)&&((o&&"date"===t.cslXml.nodename(c)&&(e.Util.fixDateNode.call(t,o,u,c),c=t.cslXml.children(o)[u]),t.cslXml.numberofnodes(t.cslXml.children(c)))?(p=c,r.push(p),e.XmlToToken.call(p,t,e.START,i,s),n(t.cslXml.children(c),c,l),function(){var n=r.pop();e.XmlToToken.call(n,t,e.END,i,s)}()):(h=c,e.XmlToToken.call(h,t,e.SINGLETON,i,s)))}}},e.Engine.prototype.buildTokenLists=function(t,i){if(this.cslXml.getNodeValue(t)){var s;e.makeBuilder(this,i)(void 0===t.length?t:t[0])}},e.Engine.prototype.setStyleAttributes=function(){var t,i,s={};for(i in s.name=this.cslXml.nodename(this.cslXml.dataObj),t=this.cslXml.attributes(this.cslXml.dataObj))t.hasOwnProperty(i)&&e.Attributes[i].call(s,this,t[i])},e.Engine.prototype.getTerm=function(t,i,s,r,n,a){t&&t.match(/[A-Z]/)&&t===t.toUpperCase()&&(e.debug("Warning: term key is in uppercase form: "+t),t=t.toLowerCase());var o=a?this.opt["default-locale"][0]:this.opt.lang,l=e.Engine.getField(e.LOOSE,this.locale[o].terms,t,i,s,r);return l||"range-delimiter"!==t||(l="–"),void 0===l&&(n===e.STRICT?e.error('Error in getTerm: term "'+t+'" does not exist.'):n===e.TOLERANT&&(l="")),l&&(this.tmp.cite_renders_content=!0),l},e.Engine.prototype.getDate=function(t,e){var i;return i=e?this.opt["default-locale"]:this.opt.lang,!!this.locale[i].dates[t]&&this.locale[i].dates[t]},e.Engine.prototype.getOpt=function(t){return void 0!==this.locale[this.opt.lang].opts[t]&&this.locale[this.opt.lang].opts[t]},e.Engine.prototype.getVariable=function(t,i,s,r){return e.Engine.getField(e.LOOSE,t,i,s,r)},e.Engine.prototype.getDateNum=function(t,e){return void 0===t?0:t[e]},e.Engine.getField=function(t,i,s,r,n,a){var o,l,u,p,h,c;if(o="",void 0===i[s])if(t!==e.STRICT)return;else e.error('Error in getField: term "'+s+'" does not exist.');for(c=a&&i[s][a]?i[s][a]:i[s],l=[],"symbol"===r?l=["symbol","short"]:"verb-short"===r?l=["verb-short","verb"]:"long"!==r&&(l=[r]),h=(l=l.concat(["long"])).length,p=0;p<h;p+=1)if(u=l[p],"string"==typeof c||"number"==typeof c)o=c;else if(void 0!==c[u]){o="string"==typeof c[u]||"number"==typeof c[u]?c[u]:"number"==typeof n?c[u][n]:c[u][0];break}return o},e.Engine.prototype.configureTokenLists=function(){var t,i;for(t=0,i=e.AREAS.length;t<i;t+=1){var s=this[e.AREAS[t]].tokens;this.configureTokenList(s)}return this.version=e.version,this.state},e.Engine.prototype.configureTokenList=function(t){var i,s,r,n,a,o,l;for(i=["year","month","day"],n=o=t.length-1;n>-1;n+=-1){if("date"===(s=t[n]).name&&e.END===s.tokentype&&(r=[]),"date-part"===s.name&&s.strings.name)for(a=0,l=i.length;a<l;a+=1)i[a]===s.strings.name&&r.push(s.strings.name);"date"===s.name&&e.START===s.tokentype&&(r.reverse(),s.dateparts=r),s.next=n+1,s.name&&e.Node[s.name].configure&&e.Node[s.name].configure.call(s,this,n)}},e.Engine.prototype.refetchItems=function(t){for(var e=[],i=0,s=t.length;i<s;i+=1)e.push(this.refetchItem(""+t[i]));return e},e.ITERATION=0,e.Engine.prototype.retrieveItem=function(t){if(this.tmp.loadedItemIDs[t])return this.registry.refhash[t];if(this.tmp.loadedItemIDs[t]=!0,this.opt.development_extensions.normalize_lang_keys_to_lowercase&&"boolean"==typeof this.opt.development_extensions.normalize_lang_keys_to_lowercase){for(var i,s=0,r=this.opt["default-locale"].length;s<r;s+=1)this.opt["default-locale"][s]=this.opt["default-locale"][s].toLowerCase();for(var s=0,r=this.opt["locale-translit"].length;s<r;s+=1)this.opt["locale-translit"][s]=this.opt["locale-translit"][s].toLowerCase();for(var s=0,r=this.opt["locale-translat"].length;s<r;s+=1)this.opt["locale-translat"][s]=this.opt["locale-translat"][s].toLowerCase();this.opt.development_extensions.normalize_lang_keys_to_lowercase=100}if(e.ITERATION+=1,m=JSON.parse(JSON.stringify(this.sys.retrieveItem(""+t))),this.opt.development_extensions.normalize_lang_keys_to_lowercase){if(m.multi){if(m.multi._keys)for(var n in m.multi._keys)for(var a in m.multi._keys[n])a!==a.toLowerCase()&&(m.multi._keys[n][a.toLowerCase()]=m.multi._keys[n][a],delete m.multi._keys[n][a]);if(m.multi.main)for(var n in m.multi.main)m.multi.main[n]=m.multi.main[n].toLowerCase()}for(var s=0,r=e.NAME_VARIABLES.length;s>r;s+=1){var o=e.NAME_VARIABLES[s];if(m[o]&&m[o].multi)for(var l=0,u=m[o].length;l<u;l+=1){var p=m[o][l];if(p.multi){if(p.multi._key)for(var a in p.multi._key)a!==a.toLowerCase()&&(p.multi._key[a.toLowerCase()]=p.multi._key[a],delete p.multi._key[a]);p.multi.main&&(p.multi.main=p.multi.main.toLowerCase())}}}}if(m.language&&m.language.match(/[><]/)){var h=m.language.match(/(.*?)([<>])(.*)/);"<"===h[2]?(m["language-name"]=h[1],m["language-name-original"]=h[3]):(m["language-name"]=h[3],m["language-name-original"]=h[1]),this.opt.multi_layout?m["language-name-original"]&&(m.language=m["language-name-original"]):m["language-name"]&&(m.language=m["language-name"])}if(m.page){m["page-first"]=m.page;var h=(""+m.page).split(/\s*(?:&|, |-|\u2013)\s*/);"\\"!==h[0].slice(-1)&&(m["page-first"]=h[0])}for(var a in this.opt.development_extensions.field_hack&&m.note&&e.parseNoteFieldHacks(m,!1,this.opt.development_extensions.allow_field_hack_date_override),m)if(e.DATE_VARIABLES.indexOf(a.replace(/^alt-/,""))>-1){var c=m[a];c&&(this.opt.development_extensions.raw_date_parsing&&c.raw&&(!c["date-parts"]||0===c["date-parts"].length)&&(c=this.fun.dateparser.parseDateToObject(c.raw)),m[a]=this.dateParseArray(c))}if(this.opt.development_extensions.consolidate_legal_items&&m.type&&["bill","gazette","legislation","regulation","treaty"].indexOf(m.type)>-1){for(var m,h,s,f,d=["type","title","jurisdiction","genre","volume","container-title"],g=[],s=0,r=d.length;s<r;s+=1)m[f=d[s]]&&g.push(m[f]);d=["original-date","issued"];for(var s=0,r=d.length;s<r;s+=1)if(m[f=d[s]]&&m[f].year){var b=m[f].year;g.push(b);break}m.legislation_id=g.join("::")}if(this.bibliography.opt.track_container_items&&this.bibliography.opt.track_container_items.indexOf(m.type)>-1){for(var f,d=["type","container-title","publisher","edition"],_=[],s=0,r=d.length;s<r;s+=1)m[f=d[s]]&&_.push(m[f]);m.container_id=_.join("::")}if(this.opt.development_extensions.force_jurisdiction&&"string"==typeof m.authority&&(m.authority=[{literal:m.authority,multi:{_key:{}}}],m.multi&&m.multi._keys&&m.multi._keys.authority))for(var a in m.authority[0].multi._key={},m.multi._keys.authority)m.authority[0].multi._key[a]={literal:m.multi._keys.authority[a]};if(m["title-short"]||(m["title-short"]=m.shortTitle),this.opt.development_extensions.main_title_from_short_title){var v="fr"===this.opt["default-locale"][0].slice(0,2).toLowerCase();e.extractTitleAndSubtitle.call(this,m,v)}var y=["bill","legal_case","legislation","gazette","regulation"].indexOf(m.type)>-1;if(this.opt.development_extensions.force_jurisdiction&&y&&!m.jurisdiction&&(m.jurisdiction="us"),!y&&m.title&&this.sys.getAbbreviation){m.jurisdiction,i=this.sys.normalizeAbbrevsKey?this.sys.normalizeAbbrevsKey("title",m.title):m.title;var x=this.transform.loadAbbreviation(m.jurisdiction,"title",i,m.language);this.transform.abbrevs[x].title&&this.transform.abbrevs[x].title[i]&&(m["title-short"]=this.transform.abbrevs[x].title[i])}if(m["container-title-short"]||(m["container-title-short"]=m.journalAbbreviation),m["container-title"]&&this.sys.getAbbreviation){i=this.sys.normalizeAbbrevsKey?this.sys.normalizeAbbrevsKey(m["container-title"]):m["container-title"];var x=this.transform.loadAbbreviation(m.jurisdiction,"container-title",i,m.language);this.transform.abbrevs[x]["container-title"]&&this.transform.abbrevs[x]["container-title"][i]&&(m["container-title-short"]=this.transform.abbrevs[x]["container-title"][i])}if(m.jurisdiction&&(m.country=m.jurisdiction.split(":")[0]),this.registry.refhash[t]){if(JSON.stringify(this.registry.refhash[t])!=JSON.stringify(m)){for(var a in this.registry.refhash[t])delete this.registry.refhash[t][a];this.tmp.taintedItemIDs[m.id]=!0,Object.assign(this.registry.refhash[t],m)}}else this.registry.refhash[t]=m;return this.registry.refhash[t]},e.Engine.prototype.refetchItem=function(t){return this.registry.refhash[t]},e.Engine.prototype.setOpt=function(t,e,i){"style"===t.name||"cslstyle"===t.name?(this.opt.inheritedAttributes[e]=i,this.citation.opt.inheritedAttributes[e]=i,this.bibliography.opt.inheritedAttributes[e]=i):["citation","bibliography"].indexOf(t.name)>-1?this[t.name].opt.inheritedAttributes[e]=i:t.strings[e]=i},e.Engine.prototype.inheritOpt=function(t,e,i,s){if(void 0!==t.strings[e])return t.strings[e];var r=this[this.tmp.root].opt.inheritedAttributes[i||e];return void 0!==r?r:s},e.Engine.prototype.remapSectionVariable=function(t){for(var i=0,s=t.length;i<s;i+=1){var r=t[i][0],n=t[i][1];if(["bill","gazette","legislation","regulation","treaty"].indexOf(r.type)>-1){if(n.locator){n.locator=n.locator.trim();var a=n.locator.match(e.STATUTE_SUBDIV_PLAIN_REGEX_FRONT);a||(n.label?n.locator=e.STATUTE_SUBDIV_STRINGS_REVERSE[n.label]+" "+n.locator:n.locator="p. "+n.locator)}var o=null;if(r.section){r.section=r.section.trim();var a=r.section.match(e.STATUTE_SUBDIV_PLAIN_REGEX_FRONT);a?o=a[0].trim():(r.section="sec. "+r.section,o="sec.")}if(r.section)if(n.locator){var a=n.locator.match(/^([^ ]*)\s*(.*)/),l=" ";a?("p."===a[1]&&"p."!==o&&(n.locator=a[2]),["[","(",".",",",";",":","?"].indexOf(n.locator.slice(0,1))>-1&&(l="")):l="",n.locator=r.section+l+n.locator}else n.locator=r.section;n.label=""}}},e.Engine.prototype.setNumberLabels=function(t){if(t.number&&["bill","gazette","legislation","regulation","treaty"].indexOf(t.type)>-1&&this.opt.development_extensions.consolidate_legal_items&&!this.tmp.shadow_numbers.number){this.tmp.shadow_numbers.number={},this.tmp.shadow_numbers.number.values=[],this.tmp.shadow_numbers.number.plural=0,this.tmp.shadow_numbers.number.numeric=!1,this.tmp.shadow_numbers.number.label=!1;var i=""+t.number,s=(i=i.split("\\").join("")).split(/\s+/)[0],r=e.STATUTE_SUBDIV_STRINGS[s];if(r){var n=i.split(e.STATUTE_SUBDIV_PLAIN_REGEX);if(n.length>1){for(var a=[],o=1,l=n.length;o<l;o+=1)a.push(n[o].replace(/\s*$/,"").replace(/^\s*/,""));i=a.join(" ")}else i=n[0];this.tmp.shadow_numbers.number.label=r,this.tmp.shadow_numbers.number.values.push(["Blob",i,!1]),this.tmp.shadow_numbers.number.numeric=!1}else this.tmp.shadow_numbers.number.values.push(["Blob",i,!1]),this.tmp.shadow_numbers.number.numeric=!0}},e.substituteOne=function(t){return function(e,i){return i?t.replace("%%STRING%%",i):""}},e.substituteTwo=function(t){return function(e){var i=t.replace("%%PARAM%%",e);return function(t,e){return e?i.replace("%%STRING%%",e):""}}},e.Mode=function(t){var i,s,r,n,a,o;for(r in i={},s=e.Output.Formats[t]){if("@"!==r.slice(0,1)){i[r]=s[r];continue}n=!1,a=s[r],o=r.split("/"),"string"==typeof a&&a.indexOf("%%STRING%%")>-1?n=a.indexOf("%%PARAM%%")>-1?e.substituteTwo(a):e.substituteOne(a):"boolean"!=typeof a||a?"function"==typeof a?n=a:e.error("Bad "+t+" config entry for "+r+": "+a):n=e.Output.Formatters.passthrough,1===o.length?i[o[0]]=n:2===o.length&&(i[o[0]]||(i[o[0]]={}),i[o[0]][o[1]]=n)}return i},e.setDecorations=function(t,i){var s,r,n;for(n in s=[],e.FORMAT_KEY_SEQUENCE){var r=e.FORMAT_KEY_SEQUENCE[n];i[r]&&(s.push([r,i[r]]),delete i[r])}return s},e.Doppeler=function(t,e){var i=RegExp("("+t+")","g"),s=RegExp(t,"g");this.split=function(t){e&&(t=e(t));var r=t.match(i);if(!r)return{tags:[],strings:[t]};for(var n=t.split(s),a=r.length-1;a>-1;a--)"number"==typeof r[a]&&(r[a]=""),"'"===r[a]&&n[a+1].length>0&&(n[a+1]=r[a]+n[a+1],r[a]="");return{tags:r,strings:n,origStrings:n.slice()}},this.join=function(t){for(var e=t.strings.slice(-1),i=t.tags.length-1;i>-1;i--)e.push(t.tags[i]),e.push(t.strings[i]);return e.reverse(),e.join("")}},e.Engine.prototype.normalDecorIsOrphan=function(t,e){if("normal"===e[1]){var i,s=!1;i="citation"===this.tmp.area?[this.citation.opt.layout_decorations].concat(t.alldecor):t.alldecor;for(var r=i.length-1;r>-1;r+=-1)for(var n=i[r].length-1;n>-1;n+=-1)i[r][n][0]===e[0]&&"normal"!==i[r][n][1]&&(s=!0);if(!s)return!0}return!1},e.Engine.prototype.getCitationLabel=function(t){var i="",s=this.getTrigraphParams(),r=s[0],n=this.getTerm("reference","short",0);void 0===n&&(n="reference"),n=(n=n.replace(".","")).slice(0,1).toUpperCase()+n.slice(1);for(var a=0,o=e.NAME_VARIABLES.length;a<o;a+=1){var l=e.NAME_VARIABLES[a];if(t[l]){var u=t[l];r=u.length>s.length?s[s.length-1]:s[u.length-1];for(var p=0,h=u.length;p<h&&p!==r.authors.length;p+=1){var c=this.nameOutput.getName(u[p],"locale-translit",!0).name;c&&c.family?n=(n=c.family).replace(/^([ \'\u2019a-z]+\s+)/,""):c&&c.literal&&(n=c.literal);var m=n.toLowerCase().match(/^(a\s+|the\s+|an\s+)/);if(m&&(n=n.slice(m[1].length)),!(n=n.replace(e.ROMANESQUE_NOT_REGEXP,"")))break;(n=n.slice(0,r.authors[p])).length>1?n=n.slice(0,1).toUpperCase()+n.slice(1).toLowerCase():1===n.length&&(n=n.toUpperCase()),i+=n}break}}if(!i&&t.title){for(var f=this.locale[this.opt.lang].opts["skip-words"],d=t.title.split(/\s+/),a=d.length-1;a>-1;a--)f.indexOf(d[a])>-1&&(d=d.slice(0,a).concat(d.slice(a+1)));var g=d.join("");(g=g.slice(0,s[0].authors[0])).length>1?g=g.slice(0,1).toUpperCase()+g.slice(1).toLowerCase():1===g.length&&(g=g.toUpperCase()),i=g}var b="0000";return t.issued&&t.issued.year&&(b=""+t.issued.year),i+=b=b.slice(-1*r.year)},e.Engine.prototype.getTrigraphParams=function(){var t=[],i=this.opt.trigraph.split(":");this.opt.trigraph&&"A"===this.opt.trigraph.slice(0,1)||e.error("Bad trigraph definition: "+this.opt.trigraph);for(var s=0,r=i.length;s<r;s+=1){for(var n=i[s],a={authors:[],year:0},o=0,l=n.length;o<l;o+=1)switch(n.slice(o,o+1)){case"A":a.authors.push(1);break;case"a":a.authors[a.authors.length-1]+=1;break;case"0":a.year+=1;break;default:e.error("Invalid character in trigraph definition: "+this.opt.trigraph)}t.push(a)}return t},e.Engine.prototype.setOutputFormat=function(t){this.opt.mode=t,this.fun.decorate=e.Mode(t),this.output[t]||(this.output[t]={},this.output[t].tmp={})},e.Engine.prototype.getSortFunc=function(){return function(t,e){return(t=t.split("-"),e=e.split("-"),t.length<e.length)?1:t.length>e.length?-1:(t=t.slice(-1)[0],e=e.slice(-1)[0],t.length<e.length)?1:t.length>e.length?-1:0}},e.Engine.prototype.setLangTagsForCslSort=function(t){var e,i;if(t)for(e=0,this.opt["locale-sort"]=[],i=t.length;e<i;e+=1)this.opt["locale-sort"].push(t[e]);this.opt["locale-sort"].sort(this.getSortFunc())},e.Engine.prototype.setLangTagsForCslTransliteration=function(t){var e,i;if(this.opt["locale-translit"]=[],t)for(e=0,i=t.length;e<i;e+=1)this.opt["locale-translit"].push(t[e]);this.opt["locale-translit"].sort(this.getSortFunc())},e.Engine.prototype.setLangTagsForCslTranslation=function(t){var e,i;if(this.opt["locale-translat"]=[],t)for(e=0,i=t.length;e<i;e+=1)this.opt["locale-translat"].push(t[e]);this.opt["locale-translat"].sort(this.getSortFunc())},e.Engine.prototype.setLangPrefsForCites=function(t,e){var i=this.opt["cite-lang-prefs"];e||(e=function(t){return t.toLowerCase()});for(var s=["Persons","Institutions","Titles","Journals","Publishers","Places"],r=0,n=s.length;r<n;r+=1){var a=e(s[r]),o=s[r].toLowerCase();if(t[a]){for(var l=[];t[a].length>1;)l.push(t[a].pop());var u={orig:1,translit:2,translat:3};for(2===l.length&&u[l[0]]<u[l[1]]&&l.reverse();l.length;)t[a].push(l.pop());for(var p=i[o];p.length;)p.pop();for(var h=0,c=t[a].length;h<c;h+=1)p.push(t[a][h])}}},e.Engine.prototype.setLangPrefsForCiteAffixes=function(t){if(t&&48===t.length){for(var e,i=this.opt.citeAffixes,s=0,r=["persons","institutions","titles","journals","publishers","places"],n=["translit","orig","translit","translat"],a=0,o=r.length;a<o;a+=1)for(var l=0,u=n.length;l<u;l+=1)e="",s%8==4&&(i[r[a]]["locale-"+n[l]].prefix||i[r[a]]["locale-"+n[l]].suffix)||(e=t[s]?t[s]:"",i[r[a]]["locale-"+n[l]].prefix=e,e=t[s]?t[s+1]:"",i[r[a]]["locale-"+n[l]].suffix=e),s+=2;this.opt.citeAffixes=i}},e.Engine.prototype.setAutoVietnameseNamesOption=function(t){t?this.opt["auto-vietnamese-names"]=!0:this.opt["auto-vietnamese-names"]=!1},e.Engine.prototype.setAbbreviations=function(t){this.sys.setAbbreviations&&this.sys.setAbbreviations(t)},e.Engine.prototype.setSuppressTrailingPunctuation=function(t){this.citation.opt.suppressTrailingPunctuation=!!t},e.Output={},e.Output.Queue=function(t){this.levelname=["top"],this.state=t,this.queue=[],this.empty=new e.Token("empty");var i={};i.empty=this.empty,this.formats=new e.Stack(i),this.current=new e.Stack(this.queue)},e.Output.Queue.prototype.pop=function(){var t=this.current.value();return t.length?t.pop():t.blobs.pop()},e.Output.Queue.prototype.getToken=function(t){return this.formats.value()[t]},e.Output.Queue.prototype.mergeTokenStrings=function(t,i){var s,r,n,a;if(s=this.formats.value()[t],r=this.formats.value()[i],n=s,r){s||((s=new e.Token(t,e.SINGLETON)).decorations=[]),n=new e.Token(t,e.SINGLETON);var a="";for(var a in s.strings)s.strings.hasOwnProperty(a)&&(n.strings[a]=s.strings[a]);for(var a in r.strings)r.strings.hasOwnProperty(a)&&(n.strings[a]=r.strings[a]);n.decorations=s.decorations.concat(r.decorations)}return n},e.Output.Queue.prototype.addToken=function(t,i,s){var r,n;if(r=new e.Token("output"),"string"==typeof s&&(s=this.formats.value()[s]),s&&s.strings){for(n in s.strings)s.strings.hasOwnProperty(n)&&(r.strings[n]=s.strings[n]);r.decorations=s.decorations}"string"==typeof i&&(r.strings.delimiter=i),this.formats.value()[t]=r},e.Output.Queue.prototype.pushFormats=function(t){t||(t={}),t.empty=this.empty,this.formats.push(t)},e.Output.Queue.prototype.popFormats=function(){this.formats.pop()},e.Output.Queue.prototype.startTag=function(t,e){var i={};this.state.tmp["doing-macro-with-date"]&&this.state.tmp.extension&&(e=this.empty,t="empty"),i[t]=e,this.pushFormats(i),this.openLevel(t)},e.Output.Queue.prototype.endTag=function(t){this.closeLevel(t),this.popFormats()},e.Output.Queue.prototype.openLevel=function(t){var i,s;"object"==typeof t?i=new e.Blob(void 0,t):void 0===t?i=new e.Blob(void 0,this.formats.value().empty,"empty"):(this.formats.value()&&this.formats.value()[t]||e.error('CSL processor error: call to nonexistent format token "'+t+'"'),i=new e.Blob(void 0,this.formats.value()[t],t)),s=this.current.value(),!this.state.tmp.just_looking&&this.checkNestedBrace&&(i.strings.prefix=this.checkNestedBrace.update(i.strings.prefix)),s.push(i),this.current.push(i)},e.Output.Queue.prototype.closeLevel=function(t){t&&t!==this.current.value().levelname&&e.error("Level mismatch error:  wanted "+t+" but found "+this.current.value().levelname);var i=this.current.pop();!this.state.tmp.just_looking&&this.checkNestedBrace&&(i.strings.suffix=this.checkNestedBrace.update(i.strings.suffix))},e.Output.Queue.prototype.append=function(t,i,s,r,n){var a,o,l,u=!0;if(s&&(r=!0),this.state.tmp["doing-macro-with-date"]&&!s){if("macro-with-date"!==i)return!1;"macro-with-date"===i&&(i="empty")}if(void 0===t||("number"==typeof t&&(t=""+t),!s&&this.state.tmp.element_trace&&"suppress-me"===this.state.tmp.element_trace.value()))return!1;if(o=!1,i?"literal"===i?(a=!0,u=!1):a="string"==typeof i?this.formats.value()[i]:i:a=this.formats.value().empty,a||e.error("CSL processor error: unknown format token name: "+i),a.strings&&void 0===a.strings.delimiter&&(a.strings.delimiter=""),"string"==typeof t&&t.length&&(t=t.replace(/ ([:;?!\u00bb])/g," $1").replace(/\u00ab /g,"\xab "),this.last_char_rendered=t.slice(-1),t=t.replace(/\s+'/g," '"),s||(t=t.replace(/^'/g," '")),r?s&&(this.state.tmp.term_predecessor_name=!0):(this.state.tmp.term_predecessor=!0,this.state.tmp.in_cite_predecessor=!0)),o=new e.Blob(t,a),void 0===(l=this.current.value())&&0===this.current.mystack.length&&(this.current.mystack.push([]),l=this.current.value()),"string"==typeof o.blobs&&(r?s&&(this.state.tmp.term_predecessor_name=!0):(this.state.tmp.term_predecessor=!0,this.state.tmp.in_cite_predecessor=!0)),"string"==typeof t){if("string"==typeof o.blobs&&" "!==o.blobs.slice(0,1)){for(var p="",h=o.blobs;e.TERMINAL_PUNCTUATION.indexOf(h.slice(0,1))>-1;)p+=h.slice(0,1),h=h.slice(1);h&&p&&(o.strings.prefix=o.strings.prefix+p,o.blobs=h)}o.strings["text-case"]&&(o.blobs=e.Output.Formatters[o.strings["text-case"]](this.state,t)),this.state.tmp.strip_periods&&!n&&(o.blobs=o.blobs.replace(/\.([^a-z]|$)/g,"$1"));for(var c=o.decorations.length-1;c>-1;c+=-1)"@quotes"===o.decorations[c][0]&&"false"!==o.decorations[c][1]&&(o.punctuation_in_quote=this.state.getOpt("punctuation-in-quote")),o.blobs.match(e.ROMANESQUE_REGEXP)||"@font-style"!==o.decorations[c][0]||(o.decorations=o.decorations.slice(0,c).concat(o.decorations.slice(c+1)));l.push(o),this.state.fun.flipflopper.processTags(o)}else u?l.push(o):l.push(t);return!0},e.Output.Queue.prototype.string=function(t,i,s){var r,n,a,o,l,u,p,h,c,m=e.getSafeEscape(this.state),f=i.slice(),d=[];if(0===f.length)return d;var g="";s?g=s.strings.delimiter:(t.tmp.count_offset_characters=!1,t.tmp.offset_characters=0),s&&s.new_locale&&(s.old_locale=t.opt.lang,t.opt.lang=s.new_locale);for(var r=0,n=f.length;r<n;r+=1){if((u=f[r]).strings.first_blob&&(t.tmp.count_offset_characters=u.strings.first_blob),"string"==typeof u.blobs){if("number"==typeof u.num)d.push(u);else if(u.blobs){u.particle&&(u.blobs=u.particle+u.blobs,u.particle="");var b=(l=m(u.blobs)).length;if(!t.tmp.suppress_decorations)for(a=0,o=u.decorations.length;a<o;a+=1)"@showid"!==(c=u.decorations[a])[0]&&(t.normalDecorIsOrphan(u,c)||(l=t.fun.decorate[c[0]][c[1]].call(u,t,l,c[2])));if(l&&l.length){if(l=m(u.strings.prefix)+l+m(u.strings.suffix),t.opt.development_extensions.csl_reverse_lookup_support&&!t.tmp.suppress_decorations)for(a=0,o=u.decorations.length;a<o;a+=1)"@showid"===(c=u.decorations[a])[0]&&(l=t.fun.decorate[c[0]][c[1]].call(u,t,l,c[2]));d.push(l),t.tmp.count_offset_characters&&(t.tmp.offset_characters+=b+u.strings.suffix.length+u.strings.prefix.length)}}}else if(u.blobs.length){var _=t.output.string(t,u.blobs,u);if(s&&"string"!==_&&_.length>1&&u.strings.delimiter)for(var v=!1,a=0,o=_.length;a<o;a++)"string"!=typeof _[a]?v=!0:v&&(_[a]=u.strings.delimiter+_[a]);d=d.concat(_)}u.strings.first_blob&&t.registry.registry[u.strings.first_blob]&&(t.registry.registry[u.strings.first_blob].offset=t.tmp.offset_characters,t.tmp.count_offset_characters=!1)}for(r=0,n=d.length-1;r<n;r+=1)"number"!=typeof d[r].num||"number"!=typeof d[r+1].num||d[r+1].UGLY_DELIMITER_SUPPRESS_HACK||(d[r].strings.suffix=d[r].strings.suffix+(g||""),d[r+1].successor_prefix="",d[r+1].UGLY_DELIMITER_SUPPRESS_HACK=!0);for(var y=0,r=0,n=d.length;r<n;r+=1)"string"==typeof d[r]&&(y=parseInt(r,10)+1,r<d.length-1&&"object"==typeof d[r+1]&&(g&&!d[r+1].UGLY_DELIMITER_SUPPRESS_HACK&&(d[r]+=m(g)),d[r+1].UGLY_DELIMITER_SUPPRESS_HACK=!0));if(s&&(s.decorations.length||s.strings.suffix))y=d.length;else if(s&&s.strings.prefix){for(var r=0,n=d.length;r<n;r++)if(void 0!==d[r].num){y=r,0===r&&(d[r].strings.prefix=s.strings.prefix+d[r].strings.prefix);break}}var x=t.output.renderBlobs(d.slice(0,y),g,!1,s);if(x&&s&&(s.decorations.length||s.strings.suffix||s.strings.prefix)){if(!t.tmp.suppress_decorations)for(var r=0,n=s.decorations.length;r<n;r+=1)!(["@cite","@bibliography","@display","@showid"].indexOf((c=s.decorations[r])[0])>-1||t.normalDecorIsOrphan(u,c))&&c[0]&&"string"==typeof x&&(x=t.fun.decorate[c[0]][c[1]].call(s,t,x,c[2]));if(l=x,p=s.strings.suffix,l&&l.length&&(l=m(h=s.strings.prefix)+l+m(p),t.tmp.count_offset_characters&&(t.tmp.offset_characters+=h.length+p.length)),x=l,!t.tmp.suppress_decorations)for(var r=0,n=s.decorations.length;r<n;r+=1)-1!==["@cite","@bibliography","@display","@showid"].indexOf((c=s.decorations[r])[0])&&"string"==typeof x&&(x=t.fun.decorate[c[0]][c[1]].call(s,t,x,c[2]))}var I=d.slice(y,d.length);return!I.length&&x?d=[x]:I.length&&!x?d=I:x&&I.length&&(d=[x].concat(I)),void 0===s?(this.queue=[],this.current.mystack=[],this.current.mystack.push(this.queue),t.tmp.suppress_decorations&&(d=t.output.renderBlobs(d,void 0,!1))):"boolean"==typeof s&&(d=t.output.renderBlobs(d,void 0,!0)),s&&s.new_locale&&(t.opt.lang=s.old_locale),d},e.Output.Queue.prototype.clearlevel=function(){var t,e,i;for(e=0,i=(t=this.current.value()).blobs.length;e<i;e+=1)t.blobs.pop()},e.Output.Queue.prototype.renderBlobs=function(t,i,s,r){if(d=e.getSafeEscape(this.state),i||(i=""),n=this.state,a="",o="",p=t.length,"citation"===this.state.tmp.area&&!this.state.tmp.just_looking&&1===p&&"object"==typeof t[0]&&r)return t[0].strings.prefix=r.strings.prefix+t[0].strings.prefix,t[0].strings.suffix=t[0].strings.suffix+r.strings.suffix,t[0].decorations=t[0].decorations.concat(r.decorations),t[0].params=r.params,t[0];var n,a,o,l,u,p,h,c,m,f,d,g=!0;for(u=0;u<p;u+=1)t[u].checkNext?(t[u].checkNext(t[u+1],g),g=!1):g=!t[u+1]||!t[u+1].splice_prefix;var b=!0;for(u=t.length-1;u>0;u+=-1)t[u].checkLast?b&&t[u].checkLast(t[u-1])&&(b=!1):b=!0;for(u=0,p=t.length;u<p;u+=1)if(l=t[u],a&&(o=i),"string"==typeof l)a+=d(o),a+=l,n.tmp.count_offset_characters&&(n.tmp.offset_characters+=o.length);else if(s)a=a?[a,l]:[l];else if(l.status!==e.SUPPRESS){var _=(m=l.particle?l.particle+l.num:l.formatter.format(l.num,l.gender)).replace(/<[^>]*>/g,"").length;this.append(m,"empty",!0);var v=this.pop(),y=n.tmp.count_offset_characters;if(m=this.string(n,[v],!1),n.tmp.count_offset_characters=y,l.strings["text-case"]&&(m=e.Output.Formatters[l.strings["text-case"]](this.state,m)),m&&this.state.tmp.strip_periods&&(m=m.replace(/\.([^a-z]|$)/g,"$1")),!n.tmp.suppress_decorations)for(h=0,c=l.decorations.length;h<c;h+=1)f=l.decorations[h],n.normalDecorIsOrphan(l,f)||(m=n.fun.decorate[f[0]][f[1]].call(l,n,m,f[2]));m=d(l.strings.prefix)+m+d(l.strings.suffix);var x="";l.status===e.END?x=d(l.range_prefix):l.status===e.SUCCESSOR?x=d(l.successor_prefix):l.status===e.START?x=u>0&&!l.suppress_splice_prefix?d(l.splice_prefix):"":l.status===e.SEEN&&(x=d(l.splice_prefix)),a+=x,a+=m,n.tmp.count_offset_characters&&(n.tmp.offset_characters+=x.length+l.strings.prefix.length+_+l.strings.suffix.length)}return a},e.Output.Queue.purgeEmptyBlobs=function(t){if("object"==typeof t&&"object"==typeof t.blobs&&t.blobs.length)for(var i=t.blobs.length-1;i>-1;i--){e.Output.Queue.purgeEmptyBlobs(t.blobs[i]);var s=t.blobs[i];if(!s||!s.blobs||!s.blobs.length){for(var r=[];t.blobs.length-1>i;)r.push(t.blobs.pop());for(t.blobs.pop();r.length;)t.blobs.push(r.pop())}}},e.Output.Queue.adjust=function(t){var e={";":!0,":":!0},i={".":!0,"!":!0,"?":!0},s={"!":{".":"!","?":"!?",":":"!",",":"!,",";":"!;"},"?":{"!":"?!",".":"?",":":"?",",":"?,",";":"?;"},".":{"!":".!","?":".?",":":".:",",":".,",";":".;"},":":{"!":"!","?":"?",".":":",",":":,",";":":;"},",":{"!":",!","?":",?",":":",:",".":",.",";":",;"},";":{"!":"!","?":"?",":":";",",":";,",".":";"}},r={},n={},a={},o={};for(var l in s)a[l]=!0,o[l]=!0,e[l]||(r[l]=!0),i[l]||(n[l]=!0);o[" "]=!0,o["\xa0"]=!0;var u={};for(var l in s)for(var p in s[l])u[p]||(u[p]={}),u[p][l]=s[l][p];function h(t){return"number"==typeof t.num||t.blobs&&1===t.blobs.length&&"number"==typeof t.blobs[0].num}function c(t,e){var i=!1,s=["@font-style","@font-variant","@font-weight","@text-decoration","@vertical-align"];if(e&&s.push("@quotes"),t.decorations){for(var r=0,n=t.decorations.length;r<n;r++)if(s.indexOf(t.decorations[r][0])>-1){i=!0;break}}return i}function m(t,e,i,r,n){var a="blobs"===e?t:t.strings,o="blobs"===r?i:i.strings,l=a[e].slice(-1),p=o[r].slice(0,1);function h(){o[r]=o[r].slice(1)}function c(){a[e]=a[e].slice(0,-1)}var m=n?function(){return s[l]}:function(){return u[p]},f=n?function(){var t=s[l][p];"string"==typeof t?(c(),h(),o[r]=t+o[r]):(o[r]=l+o[r],c())}:function(){var t=u[p][l];"string"==typeof t?(c(),h(),a[e]+=t):(a[e]+=p,h())};l===p?(n?c:h)():m()&&f()}this.upward=function(t){if(t.blobs&&"string"==typeof t.blobs){a[t.strings.suffix.slice(0,1)]&&t.strings.suffix.slice(0,1)===t.blobs.slice(-1)&&(t.strings.suffix=t.strings.suffix.slice(1));return}if("object"==typeof t&&"object"==typeof t.blobs&&t.blobs.length)for(var e=c(t,!0),i=t.blobs.length-1;i>-1;i--){this.upward(t.blobs[i]);var s=t.strings,r=t.blobs[i].strings;if(0===i){" "===s.prefix.slice(-1)&&" "===r.prefix.slice(0,1)&&(r.prefix=r.prefix.slice(1));var n=r.prefix.slice(0,1);e||!o[n]||s.prefix||(s.prefix+=n,r.prefix=r.prefix.slice(1))}if(i===t.blobs.length-1){var n=r.suffix.slice(-1);!e&&[" "].indexOf(n)>-1&&(s.suffix.slice(0,1)!==n&&(s.suffix=n+s.suffix),r.suffix=r.suffix.slice(0,-1))}s.delimiter&&i>0&&o[s.delimiter.slice(-1)]&&s.delimiter.slice(-1)===r.prefix.slice(0,1)&&(r.prefix=r.prefix.slice(1))}},this.leftward=function(t){if("object"==typeof t&&"object"==typeof t.blobs&&t.blobs.length){for(var e=t.blobs.length-1;e>-1;e--)if(this.leftward(t.blobs[e]),e<t.blobs.length-1&&!t.strings.delimiter){var i=t.blobs[e],s=i.strings.suffix.slice(-1),r=t.blobs[e+1],n=r.strings.prefix.slice(0,1),o=c(i)||c(r),l="number"==typeof s||"number"==typeof n;if(!o&&!l&&a[n]&&!l){var u=n===i.strings.suffix.slice(-1),p=!i.strings.suffix&&"string"==typeof i.blobs&&i.blobs.slice(-1)===n;u||p?r.strings.prefix=r.strings.prefix.slice(1):m(i,"suffix",r,"prefix")}}}},this.downward=function(e){if(e.blobs&&"string"==typeof e.blobs){a[e.strings.suffix.slice(0,1)]&&e.strings.suffix.slice(0,1)===e.blobs.slice(-1)&&(e.strings.suffix=e.strings.suffix.slice(1));return}if("object"==typeof e&&"object"==typeof e.blobs&&e.blobs.length){for(var i=e.strings,s=0,r=e.blobs.length;s<r&&!h(e.blobs[s]);s++);if(i.delimiter&&a[i.delimiter.slice(0,1)]){for(var n=i.delimiter.slice(0,1),s=e.blobs.length-2;s>-1;s--){var l=e.blobs[s].strings;l.suffix.slice(-1)!==n&&(l.suffix+=n)}i.delimiter=i.delimiter.slice(1)}for(var s=e.blobs.length-1;s>-1;s--){var p=e.blobs[s],l=e.blobs[s].strings,f=c(p,!0),d=h(p);if(s===e.blobs.length-1){var g=i.suffix.slice(0,1),b=!1;a[g]&&((b=function t(e,i){var s=i.strings.suffix.slice(-1);s||"string"!=typeof i.blobs||(s=i.blobs.slice(-1));var r=u[e][s];return!!r&&1===r.length||"object"==typeof i.blobs&&!!t(e,i.blobs[i.blobs.length-1])}(g,p))||!t||(b=function t(e){if(e.decorations){for(var i=0,s=e.decorations.length;i<s;i++)if("@quotes"===e.decorations[i][0]&&"false"!==e.decorations[i][1])return!0}return"object"==typeof e.blobs&&t(e.blobs[e.blobs.length-1])}(p))),b&&a[g]&&!function t(e){return"number"==typeof e.num||!!e.blobs&&"object"==typeof e.blobs&&(!!t(e.blobs[e.blobs.length-1])||void 0)}(p)&&("string"==typeof p.blobs?m(p,"blobs",e,"suffix"):m(p,"suffix",e,"suffix"),"."===i.suffix.slice(0,1)&&(l.suffix+=i.suffix.slice(0,1),i.suffix=i.suffix.slice(1))),"\xa0"===l.suffix.slice(-1)&&" "===i.suffix.slice(0,1)&&(i.suffix=i.suffix.slice(1)),o[l.suffix.slice(0,1)]&&("string"==typeof p.blobs&&p.blobs.slice(-1)===l.suffix.slice(0,1)&&(l.suffix=l.suffix.slice(1)),l.suffix.slice(-1)===i.suffix.slice(0,1)&&(i.suffix=i.suffix.slice(0,-1))),function t(e,i){if(!a[i])return!1;if("string"==typeof e.blobs)if(e.blobs.slice(-1)===i)return!0;else return!1;var s=e.blobs[e.blobs.length-1];return!!s&&(s.strings.suffix.slice(-1)?s.strings.suffix.slice(-1)==i:t(s,i))}(e,e.strings.suffix.slice(0,1))&&(e.strings.suffix=e.strings.suffix.slice(1))}else if(i.delimiter)o[i.delimiter.slice(0,1)]&&i.delimiter.slice(0,1)===l.suffix.slice(-1)&&(e.blobs[s].strings.suffix=e.blobs[s].strings.suffix.slice(0,-1));else{var _=e.blobs[s+1].strings;h(p)||f||!o[l.suffix.slice(-1)]||l.suffix.slice(-1)!==_.prefix.slice(0,1)||(_.prefix=_.prefix.slice(1))}d||f||!a[l.suffix.slice(0,1)]||"string"!=typeof p.blobs||m(p,"blobs",p,"suffix"),this.downward(e.blobs[s])}}},this.fix=function(e){if("object"==typeof e&&"object"==typeof e.blobs&&e.blobs.length){for(var i,s=0,a=e.blobs.length;s<a;s++){for(var o=e.blobs[s],l=!1,u=0,p=o.decorations.length;u<p;u++){var h=o.decorations[u];"@quotes"===h[0]&&"false"!==h[1]&&(l=!0)}if(l)if(t)!function(t){var e=t.strings.suffix.slice(0,1);if("string"==typeof t.blobs)for(;r[e];)m(t,"blobs",t,"suffix"),e=t.strings.suffix.slice(0,1);else for(;r[e];)m(t.blobs[t.blobs.length-1],"suffix",t,"suffix"),e=t.strings.suffix.slice(0,1)}(o);else if("string"==typeof o.blobs)for(var c=o.blobs.slice(-1);n[c];)m(o,"blobs",o,"suffix",!0),c=o.blobs.slice(-1);else for(var c=o.blobs[o.blobs.length-1].strings.suffix.slice(-1);n[c];)m(o.blobs[o.blobs.length-1],"suffix",o,"suffix",!0),c=o.blobs[o.blobs.length-1].strings.suffix.slice(-1);i=this.fix(e.blobs[s]),o.blobs&&"string"==typeof o.blobs&&(i=o.blobs.slice(-1))}return i}}},e.Engine.Opt=function(){this.parallel={enable:!1},this.has_disambiguate=!1,this.mode="html",this.dates={},this.jurisdictions_seen={},this.suppressedJurisdictions={},this.inheritedAttributes={},this["locale-sort"]=[],this["locale-translit"]=[],this["locale-translat"]=[],this.citeAffixes={persons:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}},institutions:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}},titles:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}},journals:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}},publishers:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}},places:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}}},this["default-locale"]=[],this.update_mode=e.NONE,this.bib_mode=e.NONE,this.sort_citations=!1,this["et-al-min"]=0,this["et-al-use-first"]=1,this["et-al-use-last"]=!1,this["et-al-subsequent-min"]=!1,this["et-al-subsequent-use-first"]=!1,this["demote-non-dropping-particle"]="display-and-sort",this["parse-names"]=!0,this.citation_number_slug=!1,this.trigraph="Aaaa00:AaAa00:AaAA00:AAAA00",this.nodenames=[],this.gender={},this["cite-lang-prefs"]={persons:["orig"],institutions:["orig"],titles:["orig"],journals:["orig"],publishers:["orig"],places:["orig"],number:["orig"]},this.has_layout_locale=!1,this.disable_duplicate_year_suppression=[],this.use_context_condition=!1,this.jurisdiction_fallbacks={},this.development_extensions={},this.development_extensions.field_hack=!0,this.development_extensions.allow_field_hack_date_override=!0,this.development_extensions.locator_date_and_revision=!0,this.development_extensions.locator_label_parse=!0,this.development_extensions.raw_date_parsing=!0,this.development_extensions.clean_up_csl_flaws=!0,this.development_extensions.consolidate_legal_items=!1,this.development_extensions.csl_reverse_lookup_support=!1,this.development_extensions.wrap_url_and_doi=!1,this.development_extensions.thin_non_breaking_space_html_hack=!1,this.development_extensions.apply_citation_wrapper=!1,this.development_extensions.main_title_from_short_title=!1,this.development_extensions.uppercase_subtitles=!1,this.development_extensions.normalize_lang_keys_to_lowercase=!1,this.development_extensions.strict_text_case_locales=!1,this.development_extensions.expect_and_symbol_form=!1,this.development_extensions.require_explicit_legal_case_title_short=!1,this.development_extensions.spoof_institutional_affiliations=!1,this.development_extensions.force_jurisdiction=!1,this.development_extensions.parse_names=!0,this.development_extensions.hanging_indent_legacy_number=!1,this.development_extensions.throw_on_empty=!1,this.development_extensions.strict_inputs=!0,this.development_extensions.prioritize_disambiguate_condition=!1,this.development_extensions.force_short_title_casing_alignment=!0,this.development_extensions.implicit_short_title=!1,this.development_extensions.force_title_abbrev_fallback=!1,this.development_extensions.split_container_title=!1,this.development_extensions.legacy_institution_name_ordering=!1,this.development_extensions.etal_min_etal_usefirst_hack=!1},e.Engine.Tmp=function(){this.names_max=new e.Stack,this.names_base=new e.Stack,this.givens_base=new e.Stack,this.value=[],this.namepart_decorations={},this.namepart_type=!1,this.area="citation",this.root="citation",this.extension="",this.can_substitute=new e.Stack(0,e.LITERAL),this.element_rendered_ok=!1,this.element_trace=new e.Stack("style"),this.nameset_counter=0,this.group_context=new e.Stack({term_intended:!1,variable_attempt:!1,variable_success:!1,output_tip:void 0,label_form:void 0,parallel_first:void 0,parallel_last:void 0,parallel_delimiter_override:void 0,condition:!1,force_suppress:!1,done_vars:[]}),this.term_predecessor=!1,this.in_cite_predecessor=!1,this.jump=new e.Stack(0,e.LITERAL),this.decorations=new e.Stack,this.tokenstore_stack=new e.Stack,this.last_suffix_used="",this.last_names_used=[],this.last_years_used=[],this.years_used=[],this.names_used=[],this.taintedItemIDs={},this.taintedCitationIDs={},this.initialize_with=new e.Stack,this.disambig_request=!1,this["name-as-sort-order"]=!1,this.suppress_decorations=!1,this.disambig_settings=new e.AmbigConfig,this.bib_sort_keys=[],this.prefix=new e.Stack("",e.LITERAL),this.suffix=new e.Stack("",e.LITERAL),this.delimiter=new e.Stack("",e.LITERAL),this.cite_locales=[],this.cite_affixes={citation:!1,bibliography:!1,citation_sort:!1,bibliography_sort:!1},this.strip_periods=0,this.shadow_numbers={},this.authority_stop_last=0,this.loadedItemIDs={},this.condition_counter=0,this.condition_lang_val_arr=[],this.condition_lang_counter_arr=[]},e.Engine.Fun=function(t){this.match=new e.Util.Match,this.suffixator=new e.Util.Suffixator(e.SUFFIX_CHARS),this.romanizer=new e.Util.Romanizer,this.ordinalizer=new e.Util.Ordinalizer(t),this.long_ordinalizer=new e.Util.LongOrdinalizer},e.Engine.Build=function(){this["alternate-term"]=!1,this.in_bibliography=!1,this.in_style=!1,this.skip=!1,this.postponed_macro=!1,this.layout_flag=!1,this.name=!1,this.names_variables=[[]],this.name_label=[{}],this.form=!1,this.term=!1,this.macro={},this.macro_stack=[],this.text=!1,this.lang=!1,this.area="citation",this.root="citation",this.extension="",this.substitute_level=new e.Stack(0,e.LITERAL),this.names_level=0,this.render_nesting_level=0,this.render_seen=!1,this.bibliography_key_pos=0},e.Engine.Configure=function(){this.tests=[],this.fail=[],this.succeed=[]},e.Engine.Citation=function(t){this.opt={inheritedAttributes:{}},this.tokens=[],this.srt=new e.Registry.Comparifier(t,"citation_sort"),this.opt.collapse=[],this.opt["disambiguate-add-names"]=!1,this.opt["disambiguate-add-givenname"]=!1,this.opt["disambiguate-add-year-suffix"]=!1,this.opt["givenname-disambiguation-rule"]="by-cite",this.opt["near-note-distance"]=5,this.opt.topdecor=[],this.opt.layout_decorations=[],this.opt.layout_prefix="",this.opt.layout_suffix="",this.opt.layout_delimiter="",this.opt.sort_locales=[],this.opt.max_number_of_names=0,this.root="citation"},e.Engine.Bibliography=function(){this.opt={inheritedAttributes:{}},this.tokens=[],this.opt.collapse=[],this.opt.topdecor=[],this.opt.layout_decorations=[],this.opt.layout_prefix="",this.opt.layout_suffix="",this.opt.layout_delimiter="",this.opt["line-spacing"]=1,this.opt["entry-spacing"]=1,this.opt.sort_locales=[],this.opt.max_number_of_names=0,this.root="bibliography"},e.Engine.BibliographySort=function(){this.tokens=[],this.opt={},this.opt.sort_directions=[],this.opt.topdecor=[],this.opt.citation_number_sort_direction=e.ASCENDING,this.opt.citation_number_secondary=!1,this.tmp={},this.keys=[],this.root="bibliography"},e.Engine.CitationSort=function(){this.tokens=[],this.opt={},this.opt.sort_directions=[],this.keys=[],this.opt.topdecor=[],this.root="citation"},e.Engine.InText=function(){this.opt={inheritedAttributes:{}},this.tokens=[],this.opt.collapse=[],this.opt["disambiguate-add-names"]=!1,this.opt["disambiguate-add-givenname"]=!1,this.opt["disambiguate-add-year-suffix"]=!1,this.opt["givenname-disambiguation-rule"]="by-cite",this.opt["near-note-distance"]=5,this.opt.topdecor=[],this.opt.layout_decorations=[],this.opt.layout_prefix="",this.opt.layout_suffix="",this.opt.layout_delimiter="",this.opt.sort_locales=[],this.opt.max_number_of_names=0,this.root="intext"},e.Engine.prototype.previewCitationCluster=function(t,i,s,r){var n=this.opt.mode;this.setOutputFormat(r),t.citationID&&delete t.citationID;var a=this.processCitationCluster(t,i,s,e.PREVIEW);return this.setOutputFormat(n),a[1]},e.Engine.prototype.appendCitationCluster=function(t){for(var e=[],i=this.registry.citationreg.citationByIndex.length,s=0;s<i;s+=1){var r=this.registry.citationreg.citationByIndex[s];e.push([""+r.citationID,r.properties.noteIndex])}return this.processCitationCluster(t,e,[])[1]},e.Engine.prototype.processCitationCluster=function(t,i,s,r){if(this.debug=!1,this.tmp.loadedItemIDs={},this.tmp.citation_errors=[],this.registry.return_data={bibchange:!1},this.setCitationId(t),r===e.PREVIEW){this.debug&&e.debug("****** start state save *********"),ti=this.registry.citationreg.citationByIndex.slice(),ts=this.registry.reflist.slice();for(var n=i.concat(s),a={},o=[],l=0,u=n.length;l<u;l+=1)for(V=0,$=(z=this.registry.citationreg.citationById[n[l][0]]).citationItems.length;V<$;V+=1)a[z.citationItems[V].id]=!0,o.push(""+z.citationItems[V].id);for(V=0,$=t.citationItems.length;V<$;V+=1)a[t.citationItems[V].id]=!0,o.push(""+t.citationItems[V].id);tr={};for(var l=0,u=ts.length;l<u;l+=1)if(!a[ts[l].id]){var p=this.registry.registry[ts[l].id].ambig,h=this.registry.ambigcites[p];if(h)for(V=0,$=h.length;V<$;V+=1)tr[h[V]]=e.cloneAmbigConfig(this.registry.registry[h[V]].disambig)}this.debug&&e.debug("****** end state save *********")}this.tmp.taintedCitationIDs={};for(var c=[],m={},l=0,u=t.citationItems.length;l<u;l+=1){for(var f in Z={},t.citationItems[l])Z[f]=t.citationItems[l][f];if((K=this.retrieveItem(""+Z.id)).id&&this.transform.loadAbbreviation("default","hereinafter",K.id,K.language),Z=e.parseLocator.call(this,Z),this.opt.development_extensions.consolidate_legal_items&&this.remapSectionVariable([[K,Z]]),this.opt.development_extensions.locator_label_parse&&Z.locator&&-1===["bill","gazette","legislation","regulation","treaty"].indexOf(K.type)&&(!Z.label||"page"===Z.label)){var d=e.LOCATOR_LABELS_REGEXP.exec(Z.locator);if(d){var g=e.LOCATOR_LABELS_MAP[d[2]];this.getTerm(g)&&(Z.label=g,Z.locator=d[3])}}var b=[K,Z];c.push(b),t.citationItems[l].item=K}t.sortedItems=c;var _=[],v={};for(l=0,u=i.length;l<u;l+=1)G=i[l],this.opt.development_extensions.strict_inputs&&(v[G[0]]&&e.error("Previously referenced citationID "+G[0]+" encountered in citationsPre"),G[1]&&(tn>G[1]&&e.debug("Note index sequence is not sane at citationsPre["+l+"]"),tn=G[1])),this.registry.citationreg.citationById[G[0]].properties.noteIndex=G[1],_.push(this.registry.citationreg.citationById[G[0]]),v[G[0]]=this.registry.citationreg.citationById[G[0]];for(t.properties||(t.properties={noteIndex:0}),this.opt.development_extensions.strict_inputs&&(v[t.citationID]&&e.error("Citation with previously referenced citationID "+t.citationID),t.properties.noteIndex&&(tn>t.properties.noteIndex&&e.debug("Note index sequence is not sane for citation "+t.citationID),tn=t.properties.noteIndex)),_.push(t),v[t.citationID]=t,l=0,u=s.length;l<u;l+=1)F=s[l],this.opt.development_extensions.strict_inputs&&(v[F[0]]&&e.error("Previously referenced citationID "+F[0]+" encountered in citationsPost"),F[1]&&(tn>F[1]&&e.debug("Note index sequence is not sane at postCitation["+l+"]"),tn=F[1])),this.registry.citationreg.citationById[F[0]].properties.noteIndex=F[1],_.push(this.registry.citationreg.citationById[F[0]]),v[F[0]]=this.registry.citationreg.citationById[F[0]];this.registry.citationreg.citationByIndex=_,this.registry.citationreg.citationById=v,this.registry.citationreg.citationsByItemId={},this.opt.update_mode===e.POSITION&&(tt=[],Y=[],te={});for(var y=[],l=0,u=_.length;l<u;l+=1){for(V=0,_[l].properties.index=l,$=_[l].sortedItems.length;V<$;V+=1)Z=_[l].sortedItems[V],this.registry.citationreg.citationsByItemId[Z[1].id]||(this.registry.citationreg.citationsByItemId[Z[1].id]=[],y.push(""+Z[1].id)),-1===this.registry.citationreg.citationsByItemId[Z[1].id].indexOf(_[l])&&this.registry.citationreg.citationsByItemId[Z[1].id].push(_[l]);this.opt.update_mode===e.POSITION&&(_[l].properties.noteIndex?Y.push(_[l]):(_[l].properties.noteIndex=0,tt.push(_[l])))}if(r!==e.ASSUME_ALL_ITEMS_REGISTERED&&(this.debug&&e.debug("****** start update items *********"),this.updateItems(y,null,null,!0),this.debug&&e.debug("****** endo update items *********")),!this.opt.citation_number_sort&&c&&c.length>1&&this.citation_sort.tokens.length>0){for(var l=0,u=c.length;l<u;l+=1)c[l][1].sortkeys=e.getSortKeys.call(this,c[l][0],"citation_sort");if(this.opt.grouped_sort&&!t.properties.unsorted){for(var l=0,u=c.length;l<u;l+=1){var x=c[l][1].sortkeys;this.tmp.authorstring_request=!0;var I=this.registry.registry[c[l][0].id].disambig;this.tmp.authorstring_request=!0,e.getAmbiguousCite.call(this,c[l][0],I);var O=this.registry.authorstrings[c[l][0].id];this.tmp.authorstring_request=!1,c[l][1].sortkeys=[O].concat(x)}c.sort(this.citation.srt.compareCompositeKeys);for(var T=!1,S=!1,N=!1,l=0,u=c.length;l<u;l+=1)c[l][1].sortkeys[0]!==T&&(N=c[l][1].sortkeys[0],S=c[l][1].sortkeys[1]),c[l][1].sortkeys[0]=""+S+l,T=N}t.properties.unsorted||c.sort(this.citation.srt.compareCompositeKeys)}if(this.opt.parallel.enable&&this.parallel.StartCitation(t.sortedItems),this.opt.update_mode===e.POSITION)for(var l=0;l<2;l+=1){var A={},E={},k={};for(V=0,$=(ta=[tt,Y][l]).length;V<$;V+=1){var R=ta[V];for(ta[V].properties.noteIndex||(ta[V].properties.noteIndex=0),ta[V].properties.noteIndex=parseInt(ta[V].properties.noteIndex,10),V>0&&R.properties.noteIndex&&ta[V-1].properties.noteIndex>R.properties.noteIndex&&(te={},A={},E={},k={}),W=0,J=R.sortedItems.length;W<J;W+=1)R.sortedItems[W][1].parallel&&"first"!==R.sortedItems[W][1].parallel||(te[R.properties.noteIndex]?te[R.properties.noteIndex]+=1:te[R.properties.noteIndex]=1);for(W=0,J=ta[V].sortedItems.length;W<J;W+=1){var w=(Z=ta[V].sortedItems[W])[0].id,j=Z[0].legislation_id?Z[0].legislation_id:Z[0].id,C=Z[0].legislation_id?Z[0].legislation_id:Z[0].container_id?Z[0].container_id:Z[0].id,L=Z[1]["locator-extra"],D=Z[1].locator,P=Z[1].label;if(W>0)if(R.sortedItems[W-1][0].legislation_id)to=R.sortedItems[W-1][0].legislation_id;else{to=R.sortedItems[W-1][1].id,tl=R.sortedItems[W-1][1]["locator-extra"];for(var U=W-2;U>-1;U--)"first"===R.sortedItems[U][1].parallel&&(to=R.sortedItems[U][1].id,tl=R.sortedItems[U][1]["locator-extra"])}if(r===e.PREVIEW&&R.citationID!=t.citationID){void 0===A[Z[1].id]&&(A[j]=R.properties.noteIndex),E[C]=R.properties.noteIndex;continue}var B={};if(B.position=Z[1].position,B["first-reference-note-number"]=Z[1]["first-reference-note-number"],B["first-container-reference-note-number"]=Z[1]["first-container-reference-note-number"],B["near-note"]=Z[1]["near-note"],Z[1]["first-reference-note-number"]=0,Z[1]["first-container-reference-note-number"]=0,Z[1]["near-note"]=!1,this.registry.citationreg.citationsByItemId[w]&&"note"===this.opt.xclass&&this.opt.has_disambiguate){var M=this.registry.registry[Z[0].id]["citation-count"],q=this.registry.citationreg.citationsByItemId[w].length;if(this.registry.registry[Z[0].id]["citation-count"]=this.registry.citationreg.citationsByItemId[w].length,"number"==typeof M){if(M<2!=q<2)for(var U=0,X=this.registry.citationreg.citationsByItemId[w].length;U<X;U++)m[this.registry.registry[Z[0].id].ambig]=!0,this.tmp.taintedCitationIDs[this.registry.citationreg.citationsByItemId[w][U].citationID]=!0}else for(var U=0,X=this.registry.citationreg.citationsByItemId[w].length;U<X;U++)m[this.registry.registry[Z[0].id].ambig]=!0,this.tmp.taintedCitationIDs[this.registry.citationreg.citationsByItemId[w][U].citationID]=!0}if(void 0===E[C]&&"author-only"!==R.properties.mode)A[j]=R.properties.noteIndex,E[C]=R.properties.noteIndex,k[C]=R.properties.noteIndex,Z[1].position=e.POSITION_FIRST;else{var z,G,F,l,u,V,$,W,J,Q,H,f,K,Z,Y,tt,d,te,ti,ts,tr,tn,ta,to,tl,tu,tp,th,tc,tm,tf,td,tg=!1,tb=!1,t_=null;if(V>0)var t_=ta[V-1];var tv=ta[V];if(V>0){var ty=1;"author-only"===t_.properties.mode&&V>1&&(ty=2);var tx=V-ty;ta[tx].sortedItems.length&&(tu=ta[tx].sortedItems.slice(-1)[0][1].id,tp=ta[V-ty].sortedItems.slice(-1)[0][1]["locator-extra"]),t_.sortedItems.length&&t_.sortedItems[0].slice(-1)[0].legislation_id&&(tu=t_.sortedItems[0].slice(-1)[0].legislation_id)}if(V>0&&0===W&&t_.properties.noteIndex!==tv.properties.noteIndex){var tI=!1,tO=t_.sortedItems[0][0].id;if(t_.sortedItems[0][0].legislation_id&&(tO=t_.sortedItems[0][0].legislation_id),tO==j&&t_.properties.noteIndex>=tv.properties.noteIndex-1){var tT=t_.sortedItems[0][1]["locator-extra"],tS=tv.sortedItems[0][1]["locator-extra"];(1===te[t_.properties.noteIndex]||0===t_.properties.noteIndex)&&tT===tS&&(tI=!0)}tI?tg=!0:tb=!0}else W>0&&to==j&&tl==L||0===W&&V>0&&t_.properties.noteIndex==tv.properties.noteIndex&&t_.sortedItems.length&&tu==j&&tp==L?tg=!0:tb=!0;tg&&((th=W>0?R.sortedItems[W-1][1]:ta[V-1].sortedItems[0][1]).locator?(tm=th.label?th.label:"",tc=""+th.locator+tm):tc=th.locator,tf=D?""+D+(P||""):D),tg&&tc&&!tf&&(tg=!1,tb=!0),tg&&(!tc&&tf?Z[1].position=e.POSITION_IBID_WITH_LOCATOR:tc||tf?tc&&tf===tc?Z[1].position=e.POSITION_IBID:tc&&tf&&tf!==tc?Z[1].position=e.POSITION_IBID_WITH_LOCATOR:(tg=!1,tb=!0):Z[1].position=e.POSITION_IBID),tb&&(Z[1].position=e.POSITION_CONTAINER_SUBSEQUENT,void 0===A[j]?A[j]=R.properties.noteIndex:Z[1].position=e.POSITION_SUBSEQUENT),(tb||tg)&&("author-only"===R.properties.mode&&(Z[1].position=e.POSITION_FIRST),k[C]!=R.properties.noteIndex&&(Z[1]["first-container-reference-note-number"]=k[C],this.registry.registry[Z[0].id]&&(this.registry.registry[Z[0].id]["first-container-reference-note-number"]=k[C])),A[j]!=R.properties.noteIndex&&(Z[1]["first-reference-note-number"]=A[j],this.registry.registry[Z[0].id]&&(this.registry.registry[Z[0].id]["first-reference-note-number"]=A[j])))}if(R.properties.noteIndex){var tN=parseInt(R.properties.noteIndex,10)-parseInt(E[C],10);Z[1].position!==e.POSITION_FIRST&&tN<=this.citation.opt["near-note-distance"]&&(Z[1]["near-note"]=!0),E[C]=R.properties.noteIndex}else Z[1].position!==e.POSITION_FIRST&&(Z[1]["near-note"]=!0);if(R.citationID!=t.citationID)for(Q=0,H=e.POSITION_TEST_VARS.length;Q<H;Q+=1){var tA=e.POSITION_TEST_VARS[Q];Z[1][tA]!==B[tA]&&(this.registry.registry[Z[0].id]&&"first-reference-note-number"===tA&&(m[this.registry.registry[Z[0].id].ambig]=!0,this.tmp.taintedItemIDs[Z[0].id]=!0),this.tmp.taintedCitationIDs[R.citationID]=!0)}this.sys.variableWrapper&&(Z[1].index=R.properties.index,Z[1].noteIndex=R.properties.noteIndex)}}}if(this.opt.citation_number_sort&&c&&c.length>1&&this.citation_sort.tokens.length>0&&!t.properties.unsorted){for(var l=0,u=c.length;l<u;l+=1)c[l][1].sortkeys=e.getSortKeys.call(this,c[l][0],"citation_sort");c.sort(this.citation.srt.compareCompositeKeys)}for(var f in this.tmp.taintedItemIDs)if(this.tmp.taintedItemIDs.hasOwnProperty(f)&&(ta=this.registry.citationreg.citationsByItemId[f]))for(var l=0,u=ta.length;l<u;l+=1)this.tmp.taintedCitationIDs[ta[l].citationID]=!0;var tE=[];if(r===e.PREVIEW){this.debug&&e.debug("****** start run processor *********");try{tE=this.process_CitationCluster.call(this,t.sortedItems,t)}catch(t){e.error("Error running CSL processor for preview: "+t)}this.debug&&(e.debug("****** end run processor *********"),e.debug("****** start state restore *********")),this.registry.citationreg.citationByIndex=ti,this.registry.citationreg.citationById={};for(var l=0,u=ti.length;l<u;l+=1)this.registry.citationreg.citationById[ti[l].citationID]=ti[l];this.debug&&e.debug("****** start final update *********");for(var tk=[],l=0,u=ts.length;l<u;l+=1)tk.push(""+ts[l].id);for(var f in this.updateItems(tk,null,null,!0),this.debug&&e.debug("****** end final update *********"),tr)tr.hasOwnProperty(f)&&(this.registry.registry[f].disambig=tr[f]);this.debug&&e.debug("****** end state restore *********")}else{for(var tR in m)this.disambiguate.run(tR,t);for(var f in this.tmp.taintedCitationIDs)if(f!=t.citationID){var tw,tj=this.registry.citationreg.citationById[f];if(!tj.properties.unsorted){for(var l=0,u=tj.sortedItems.length;l<u;l+=1)tj.sortedItems[l][1].sortkeys=e.getSortKeys.call(this,tj.sortedItems[l][0],"citation_sort");tj.sortedItems.sort(this.citation.srt.compareCompositeKeys)}this.tmp.citation_pos=tj.properties.index,this.tmp.citation_note_index=tj.properties.noteIndex,this.tmp.citation_id=""+tj.citationID,(tw=[]).push(tj.properties.index),tw.push(this.process_CitationCluster.call(this,tj.sortedItems,tj)),tw.push(tj.citationID),tE.push(tw)}this.tmp.taintedItemIDs={},this.tmp.taintedCitationIDs={},this.tmp.citation_pos=t.properties.index,this.tmp.citation_note_index=t.properties.noteIndex,this.tmp.citation_id=""+t.citationID,(tw=[]).push(i.length),tw.push(this.process_CitationCluster.call(this,c,t)),tw.push(t.citationID),tE.push(tw),tE.sort(function(t,e){return t[0]>e[0]?1:t[0]<e[0]?-1:0})}return this.registry.return_data.citation_errors=this.tmp.citation_errors.slice(),[this.registry.return_data,tE]},e.Engine.prototype.process_CitationCluster=function(t,i){var s="";if(i&&i.properties&&"composite"===i.properties.mode){i.properties.mode="author-only";var r=e.getCitationCluster.call(this,t,i);i.properties.mode="suppress-author";var n="";i.properties.infix&&(this.output.append(i.properties.infix),"object"==typeof(n=this.output.string(this,this.output.queue))&&(n=n.join("")));var a=e.getCitationCluster.call(this,t,i);i.properties.mode="composite",r&&n&&e.SWAPPING_PUNCTUATION.concat(["’","'"]).indexOf(n[0])>-1&&(r+=n,n=!1),s=[r,n,a].filter(function(t){return t}).join(" ")}else s=e.getCitationCluster.call(this,t,i);return s},e.Engine.prototype.makeCitationCluster=function(t){for(a=0,s=[],o=t.length;a<o;a+=1){for(var i in l={},t[a])l[i]=t[a][i];if(u=this.retrieveItem(""+l.id),this.opt.development_extensions.locator_label_parse&&l.locator&&-1===["bill","gazette","legislation","regulation","treaty"].indexOf(u.type)&&(!l.label||"page"===l.label)){var s,r,n,a,o,l,u,p=e.LOCATOR_LABELS_REGEXP.exec(l.locator);if(p){var h=e.LOCATOR_LABELS_MAP[p[2]];this.getTerm(h)&&(l.label=h,l.locator=p[3])}}l.locator&&(l.locator=(""+l.locator).replace(/\s+$/,"")),r=[u,l],s.push(r)}if(this.opt.development_extensions.consolidate_legal_items&&this.remapSectionVariable(s),s&&s.length>1&&this.citation_sort.tokens.length>0){for(a=0,o=s.length;a<o;a+=1)s[a][1].sortkeys=e.getSortKeys.call(this,s[a][0],"citation_sort");s.sort(this.citation.srt.compareCompositeKeys)}this.tmp.citation_errors=[];var n=e.getCitationCluster.call(this,s);return n},e.getAmbiguousCite=function(t,i,s,r){var n,a=this.tmp.group_context.tip,o={term_intended:a.term_intended,variable_attempt:a.variable_attempt,variable_success:a.variable_success,output_tip:a.output_tip,label_form:a.label_form,non_parallel:a.non_parallel,parallel_last:a.parallel_last,parallel_first:a.parallel_first,parallel_last_override:a.parallel_last_override,parallel_delimiter_override:a.parallel_delimiter_override,parallel_delimiter_override_on_suppress:a.parallel_delimiter_override_on_suppress,condition:a.condition,force_suppress:a.force_suppress,done_vars:a.done_vars.slice()};i?this.tmp.disambig_request=i:this.tmp.disambig_request=!1;var l={position:e.POSITION_SUBSEQUENT,"near-note":!0};r&&(l.locator=r.locator,l.label=r.label),this.registry.registry[t.id]&&this.registry.citationreg.citationsByItemId&&this.registry.citationreg.citationsByItemId[t.id]&&this.registry.citationreg.citationsByItemId[t.id].length&&s&&"by-cite"===this.citation.opt["givenname-disambiguation-rule"]&&(l["first-reference-note-number"]=this.registry.registry[t.id]["first-reference-note-number"]),this.tmp.area="citation",this.tmp.root="citation";var u=this.tmp.suppress_decorations;this.tmp.suppress_decorations=!0,this.tmp.just_looking=!0,e.getCite.call(this,t,l,null,!1);for(var p=0,h=this.output.queue.length;p<h;p+=1)e.Output.Queue.purgeEmptyBlobs(this.output.queue[p]);if(this.opt.development_extensions.clean_up_csl_flaws)for(var c=0,m=this.output.queue.length;c<m;c+=1)this.output.adjust.upward(this.output.queue[c]),this.output.adjust.leftward(this.output.queue[c]),this.output.adjust.downward(this.output.queue[c]),this.output.adjust.fix(this.output.queue[c]);var n=this.output.string(this,this.output.queue);return this.tmp.just_looking=!1,this.tmp.suppress_decorations=u,this.tmp.group_context.replace(o),n},e.getSpliceDelimiter=function(t,i,s){if(void 0!==this.citation.opt["after-collapse-delimiter"])t||i&&!this.tmp.have_collapsed?this.tmp.splice_delimiter=this.citation.opt["after-collapse-delimiter"]:i||this.tmp.have_collapsed||"year-suffix"===this.citation.opt.collapse?this.tmp.splice_delimiter=this.citation.opt.layout_delimiter:this.tmp.splice_delimiter=this.citation.opt["after-collapse-delimiter"];else if(this.tmp.use_cite_group_delimiter)this.tmp.splice_delimiter=this.citation.opt.cite_group_delimiter;else if(this.tmp.have_collapsed&&"in-text"===this.opt.xclass&&this.opt.update_mode!==e.NUMERIC)this.tmp.splice_delimiter=", ";else if(this.tmp.cite_locales[s-1]){var r=this.tmp.cite_affixes[this.tmp.area][this.tmp.cite_locales[s-1]];r&&r.delimiter&&(this.tmp.splice_delimiter=r.delimiter)}else this.tmp.splice_delimiter||(this.tmp.splice_delimiter="");return this.tmp.splice_delimiter},e.getCitationCluster=function(t,i){var s,r,n,a,o,l,u,p,h,c,m,f,d,g,b,_,v,y,x,I,O,T="";this.output.checkNestedBrace=new e.checkNestedBrace(this),i&&(x=i.citationID,I="author-only"===i.properties.mode&&!!i.properties.mode,"note"!==this.opt.xclass&&(O="suppress-author"===i.properties.mode&&!!i.properties.mode),i.properties.prefix&&(T=e.checkPrefixSpaceAppend(this,i.properties.prefix))),t=t||[],this.tmp.last_primary_names_string=!1,v=e.getSafeEscape(this),this.tmp.area="citation",this.tmp.root="citation",s="",r=[],this.tmp.last_suffix_used="",this.tmp.last_names_used=[],this.tmp.last_years_used=[],this.tmp.backref_index=[],this.tmp.cite_locales=[],this.tmp.just_looking||(this.tmp.abbrev_trimmer={QUASHES:{}});var S=this.output.checkNestedBrace.update(this.citation.opt.layout_prefix+T),N=!1;if(this.citation.opt.suppressTrailingPunctuation&&(N=!0),x&&this.registry.citationreg.citationById[x].properties["suppress-trailing-punctuation"]&&(N=!0),"note"===this.opt.xclass){for(var A=[],E=!1,k=!1,R=[],w=0,j=t.length;w<j;w+=1){var C=t[w][0].type,L=t[w][0].title,D=t[w][1].position,P=t[w][0].id;L&&"legal_case"===C&&P!==k&&D&&((L!==E||0===A.length)&&(R=[],A.push(R)),R.push(t[w][1])),E=L,k=P}for(w=0,j=A.length;w<j;w+=1)if(!((R=A[w]).length<2)){var U=R.slice(-1)[0].locator;if(U)for(var B=0,M=R.length-1;B<M;B+=1)R[B].locator&&(U=!1);U&&(R[0].locator=U,delete R.slice(-1)[0].locator,R[0].label=R.slice(-1)[0].label,R.slice(-1)[0].label&&delete R.slice(-1)[0].label)}}for(n=[],a=t.length,t[0]&&t[0][1]&&(I?(delete t[0][1]["suppress-author"],t[0][1]["author-only"]=!0):O&&(delete t[0][1]["author-only"],t[0][1]["suppress-author"]=!0)),this.opt.parallel.enable&&this.parallel.StartCitation(t),o=0;o<a;o+=1){this.tmp.cite_index=o,f=t[o][0],l=t[o][1],l=e.parseLocator.call(this,l),u=this.tmp.have_collapsed;var q=!1;if(o>0&&t[o-1][1]&&(q=!!t[o-1][1].locator),p={},this.tmp.shadow_numbers={},!this.tmp.just_looking&&this.opt.hasPlaceholderTerm){var X=this.output;this.output=new e.Output.Queue(this),this.output.adjust=new e.Output.Queue.adjust,e.getAmbiguousCite.call(this,f,null,!1,l),this.output=X}if(this.tmp.in_cite_predecessor=!1,o>0?e.getCite.call(this,f,l,""+t[o-1][0].id,!0):(this.tmp.term_predecessor=!1,e.getCite.call(this,f,l,null,!0)),this.tmp.cite_renders_content||(y={citationID:""+this.tmp.citation_id,index:this.tmp.citation_pos,noteIndex:this.tmp.citation_note_index,itemID:""+f.id,citationItems_pos:o,error_code:e.ERROR_NO_RENDERED_FORM},this.tmp.citation_errors.push(y)),p.splice_delimiter=e.getSpliceDelimiter.call(this,q,u,o),l&&l["author-only"]&&(this.tmp.suppress_decorations=!0),o>0){var z=(_=t[o-1][1]).suffix&&[";",".",","].indexOf(_.suffix.slice(-1))>-1,G=!_.suffix&&l.prefix&&[";",".",","].indexOf(l.prefix.slice(0,1))>-1;if(z||G){var F=p.splice_delimiter.indexOf(" ");F>-1&&!G?p.splice_delimiter=p.splice_delimiter.slice(F):p.splice_delimiter=""}}if(p.suppress_decorations=this.tmp.suppress_decorations,p.have_collapsed=this.tmp.have_collapsed,n.push(p),l["author-only"])break}m=this.output.queue.slice();var V="";i&&(V=e.checkSuffixSpacePrepend(this,i.properties.suffix));var $=this.citation.opt.layout_suffix,W=this.tmp.cite_locales[this.tmp.cite_locales.length-1];W&&this.tmp.cite_affixes[this.tmp.area][W]&&this.tmp.cite_affixes[this.tmp.area][W].suffix&&($=this.tmp.cite_affixes[this.tmp.area][W].suffix),e.TERMINAL_PUNCTUATION.slice(0,-1).indexOf($.slice(0,1))>-1&&($=$.slice(0,1)),$=this.output.checkNestedBrace.update(V+$);for(var w=0,j=this.output.queue.length;w<j;w+=1)e.Output.Queue.purgeEmptyBlobs(this.output.queue[w]);if(this.tmp.suppress_decorations||!this.output.queue.length||this.opt.development_extensions.apply_citation_wrapper&&this.sys.wrapCitationEntry&&!this.tmp.just_looking&&"citation"===this.tmp.area||(N||(this.output.queue[this.output.queue.length-1].strings.suffix=$),this.output.queue[0].strings.prefix=S),this.opt.development_extensions.clean_up_csl_flaws)for(var B=0,M=this.output.queue.length;B<M;B+=1)this.output.adjust.upward(this.output.queue[B]),this.output.adjust.leftward(this.output.queue[B]),this.output.adjust.downward(this.output.queue[B]),this.tmp.last_chr=this.output.adjust.fix(this.output.queue[B]);for(o=0,a=m.length;o<a;o+=1){var J=[];if(this.output.queue=[m[o]],this.tmp.suppress_decorations=n[o].suppress_decorations,this.tmp.splice_delimiter=n[o].splice_delimiter,m[o].parallel_delimiter&&(this.tmp.splice_delimiter=m[o].parallel_delimiter),this.tmp.have_collapsed=n[o].have_collapsed,h=this.output.string(this,this.output.queue),this.tmp.suppress_decorations=!1,"string"==typeof h)return this.tmp.suppress_decorations=!1,h||(this.opt.development_extensions.throw_on_empty?e.error("Citation would render no content"):h="[NO_PRINTED_FORM]"),h;if("object"==typeof h&&0===h.length&&!l["suppress-author"]){if(0===o){var Q=0===o?v(this.citation.opt.layout_prefix):"",H=o===m.length-1?v(this.citation.opt.layout_suffix):"";h.push(Q+"[CSL STYLE ERROR: reference with no printed form.]"+H)}else if(o===m.length-1){var K=r[r.length-1];"string"==typeof K?r[r.length-1]+=v(this.citation.opt.layout_suffix):"object"==typeof K&&(K.strings.suffix+=v(this.citation.opt.layout_suffix))}}if(J.length&&"string"==typeof h[0]){h.reverse();var Z=h.pop();Z&&","===Z.slice(0,1)?J.push(Z):"string"==typeof J.slice(-1)[0]&&","===J.slice(-1)[0].slice(-1)?J.push(" "+Z):Z&&J.push(v(this.tmp.splice_delimiter)+Z)}else h.reverse(),void 0!==(c=h.pop())&&(J.length&&"string"==typeof J[J.length-1]&&(J[J.length-1]+=c.successor_prefix),J.push(c));for(g=0,d=h.length;g<d;g+=1){if("string"==typeof(b=h[g])){J.push(v(this.tmp.splice_delimiter)+b);continue}void 0!==(c=h.pop())&&J.push(c)}0===J.length&&t[o][1]["suppress-author"],J.length>1&&"string"!=typeof J[0]&&(J=[this.output.renderBlobs(J)]),J.length&&("string"==typeof J[0]?o>0&&(J[0]=v(this.tmp.splice_delimiter)+J[0]):o>0?J[0].splice_prefix=this.tmp.splice_delimiter:J[0].splice_prefix=""),r=r.concat(J)}if((s+=this.output.renderBlobs(r))&&!this.tmp.suppress_decorations)for(o=0,a=this.citation.opt.layout_decorations.length;o<a;o+=1)"normal"!==(p=this.citation.opt.layout_decorations[o])[1]&&(l&&l["author-only"]||(s=this.fun.decorate[p[0]][p[1]](this,s)));return this.tmp.suppress_decorations=!1,s||(this.opt.development_extensions.throw_on_empty?e.error("Citation would render no content"):s="[NO_PRINTED_FORM]"),s},e.getCite=function(t,i,s,r){var n,a,o=this.tmp.area;for(i&&i["author-only"]&&this.intext&&this.intext.tokens.length>0&&(this.tmp.area="intext"),this.tmp.cite_renders_content=!1,this.tmp.probably_rendered_something=!1,this.tmp.prevItemID=s,e.citeStart.call(this,t,i,r),n=0,this.tmp.name_node={},this.nameOutput=new e.NameOutput(this,t,i);n<this[this.tmp.area].tokens.length;)n=e.tokenExec.call(this,this[this.tmp.area].tokens[n],t,i);return e.citeEnd.call(this,t,i),this.tmp.cite_renders_content||this.tmp.just_looking||"bibliography"!==this.tmp.area||(a={index:this.tmp.bibliography_pos,itemID:""+t.id,error_code:e.ERROR_NO_RENDERED_FORM},this.tmp.bibliography_errors.push(a)),this.tmp.area=o,""+t.id},e.citeStart=function(t,i,s){if(this.tmp.lang_array=[],t.language){var r=t.language.match(/^([a-zA-Z]+).*/);r&&this.tmp.lang_array.push(r[1].toLowerCase())}if(this.tmp.lang_array.push(this.opt.lang),s||(this.tmp.shadow_numbers={}),this.tmp.disambiguate_count=0,this.tmp.disambiguate_maxMax=0,this.tmp.same_author_as_previous_cite=!1,this.tmp.suppress_decorations?this.tmp.subsequent_author_substitute_ok=!1:this.tmp.subsequent_author_substitute_ok=!0,this.tmp.lastchr="","citation"===this.tmp.area&&this.citation.opt.collapse&&this.citation.opt.collapse.length?this.tmp.have_collapsed=!0:this.tmp.have_collapsed=!1,this.tmp.render_seen=!1,this.tmp.disambig_request&&!this.tmp.disambig_override?this.tmp.disambig_settings=this.tmp.disambig_request:this.registry.registry[t.id]&&!this.tmp.disambig_override?(this.tmp.disambig_request=this.registry.registry[t.id].disambig,this.tmp.disambig_settings=this.registry.registry[t.id].disambig):this.tmp.disambig_settings=new e.AmbigConfig,"citation"!==this.tmp.area)if(this.registry.registry[t.id]){if(this.tmp.disambig_restore=e.cloneAmbigConfig(this.registry.registry[t.id].disambig),"bibliography"===this.tmp.area&&this.tmp.disambig_settings&&this.tmp.disambig_override&&(this.opt["disambiguate-add-names"]&&(this.tmp.disambig_settings.names=this.registry.registry[t.id].disambig.names.slice(),this.tmp.disambig_request&&(this.tmp.disambig_request.names=this.registry.registry[t.id].disambig.names.slice())),this.opt["disambiguate-add-givenname"])){this.tmp.disambig_request=this.tmp.disambig_settings,this.tmp.disambig_settings.givens=this.registry.registry[t.id].disambig.givens.slice(),this.tmp.disambig_request.givens=this.registry.registry[t.id].disambig.givens.slice();for(var n=0,a=this.tmp.disambig_settings.givens.length;n<a;n+=1)this.tmp.disambig_settings.givens[n]=this.registry.registry[t.id].disambig.givens[n].slice();for(var n=0,a=this.tmp.disambig_request.givens.length;n<a;n+=1)this.tmp.disambig_request.givens[n]=this.registry.registry[t.id].disambig.givens[n].slice()}}else this.tmp.disambig_restore=new e.AmbigConfig;this.tmp.names_used=[],this.tmp.nameset_counter=0,this.tmp.years_used=[],this.tmp.names_max.clear(),this.tmp.just_looking||i&&"first"!==i.parallel&&i.parallel||(this.tmp.abbrev_trimmer={QUASHES:{}}),this.tmp.splice_delimiter=this[this.tmp.area].opt.layout_delimiter,this.bibliography_sort.keys=[],this.citation_sort.keys=[],this.tmp.has_done_year_suffix=!1,this.tmp.last_cite_locale=!1,!this.tmp.just_looking&&i&&!i.position&&this.registry.registry[t.id]&&(this.tmp.disambig_restore=e.cloneAmbigConfig(this.registry.registry[t.id].disambig)),this.tmp.first_name_string=!1,this.tmp.authority_stop_last=0},e.citeEnd=function(t,e){if(this.tmp.disambig_restore&&this.registry.registry[t.id]){this.registry.registry[t.id].disambig.names=this.tmp.disambig_restore.names.slice(),this.registry.registry[t.id].disambig.givens=this.tmp.disambig_restore.givens.slice();for(var i=0,s=this.registry.registry[t.id].disambig.givens.length;i<s;i+=1)this.registry.registry[t.id].disambig.givens[i]=this.tmp.disambig_restore.givens[i].slice()}if(this.tmp.disambig_restore=!1,e&&e.suffix?this.tmp.last_suffix_used=e.suffix:this.tmp.last_suffix_used="",this.tmp.last_years_used=this.tmp.years_used.slice(),this.tmp.last_names_used=this.tmp.names_used.slice(),this.tmp.cut_var=!1,this.tmp.disambig_request=!1,this.tmp.cite_locales.push(this.tmp.last_cite_locale),this.tmp.issued_date&&this.tmp.renders_collection_number){for(var r=[],i=this.tmp.issued_date.list.length-1;i>this.tmp.issued_date.pos;i+=-1)r.push(this.tmp.issued_date.list.pop());for(this.tmp.issued_date.list.pop(),i=r.length-1;i>-1;i+=-1)this.tmp.issued_date.list.push(r.pop())}this.tmp.issued_date=!1,this.tmp.renders_collection_number=!1},e.Engine.prototype.makeBibliography=function(t){if(!t&&(this.bibliography.opt.exclude_types||this.bibliography.opt.exclude_with_fields)){if(t={exclude:[]},this.bibliography.opt.exclude_types)for(var i in this.bibliography.opt.exclude_types){var s,r,n,a,o,l,u,p=this.bibliography.opt.exclude_types[i];t.exclude.push({field:"type",value:p})}if(this.bibliography.opt.exclude_with_fields)for(var i in this.bibliography.opt.exclude_with_fields){var h=this.bibliography.opt.exclude_with_fields[i];t.exclude.push({field:h,value:!0})}}if(!this.bibliography.tokens.length)return!1;"string"==typeof t&&(this.opt.citation_number_slug=t,t=!1),l=(s=e.getBibliographyEntries.call(this,t))[0],u=s[1];var c=s[2];for(r={maxoffset:0,entryspacing:this.bibliography.opt["entry-spacing"],linespacing:this.bibliography.opt["line-spacing"],"second-field-align":!1,entry_ids:l,bibliography_errors:this.tmp.bibliography_errors.slice(),done:c},this.bibliography.opt["second-field-align"]&&(r["second-field-align"]=this.bibliography.opt["second-field-align"]),o=0,a=this.registry.reflist.length;o<a;o+=1)(n=this.registry.reflist[o]).offset>r.maxoffset&&(r.maxoffset=n.offset);return this.bibliography.opt.hangingindent&&(r.hangingindent=this.bibliography.opt.hangingindent),r.bibstart=this.fun.decorate.bibstart,r.bibend=this.fun.decorate.bibend,this.opt.citation_number_slug=!1,[r,u]},e.getBibliographyEntries=function(t){function i(t,e){return t===e}function s(t,e){if("boolean"!=typeof t&&t)if("string"==typeof e)return t===e;else{if(!e)return!1;for(f=0,m=e.length;f<m;f+=1)if(t===e[f])return!0;return!1}return t?!!e:!e}if(r=[],O=[],this.tmp.area="bibliography",this.tmp.root="bibliography",this.tmp.last_rendered_name=!1,this.tmp.bibliography_errors=[],this.tmp.bibliography_pos=0,n=t&&t.page_start&&t.page_length?this.registry.getSortedIds():this.refetchItems(this.registry.getSortedIds()),this.tmp.disambig_override=!0,x={},t&&t.page_start&&t.page_length&&(N=0,!0!==t.page_start))for(_=0,v=n.length;_<v&&(x[n[_]]=!0,t.page_start!=n[_]);_+=1);var r,n,a,o,l,u,p,h,c,m,f,d,g,b,_,v,y,x,I,O,T,S,N,A=[],E={};for(_=0,this.tmp.container_item_count={},n=n.filter(t=>{var e=t;return t.legislation_id?E[t.legislation_id]?e=!1:E[t.legislation_id]=!0:t.container_id&&(this.tmp.container_item_count[t.container_id]||(this.tmp.container_item_count[t.container_id]=0),this.tmp.container_item_count[t.container_id]++,this.bibliography.opt.consolidate_containers.indexOf(t.type)>-1&&(E[t.container_id]?e=!1:E[t.container_id]=!0)),e}),this.tmp.container_item_pos={},v=n.length;_<v;_+=1){if(t&&t.page_start&&t.page_length){if(x[n[_]])continue;if(h=this.refetchItem(n[_]),N===t.page_length)break}else if(x[(h=n[_]).id])continue;if(t){if(a=!0,t.include){for(T=0,a=!1,S=t.include.length;T<S;T+=1)if(s((c=t.include[T]).value,h[c.field])){a=!0;break}}else if(t.exclude){for(T=0,o=!1,S=t.exclude.length;T<S;T+=1)if(s((c=t.exclude[T]).value,h[c.field])){o=!0;break}o&&(a=!1)}else if(t.select){for(T=0,a=!1,l=!0,S=t.select.length;T<S;T+=1)s((c=t.select[T]).value,h[c.field])||(l=!1);l&&(a=!0)}if(t.quash){for(T=0,l=!0,S=t.quash.length;T<S;T+=1)s((c=t.quash[T]).value,h[c.field])||(l=!1);l&&(a=!1)}if(!a)continue}if(b&&e.debug("BIB: "+h.id),h.container_id&&(this.tmp.container_item_pos[h.container_id]||(this.tmp.container_item_pos[h.container_id]=0),this.tmp.container_item_pos[h.container_id]++),(u=new e.Token("group",e.START)).decorations=[["@bibliography","entry"]].concat(this.bibliography.opt.layout_decorations),this.output.startTag("bib_entry",u),h.system_id&&this.sys.embedBibliographyEntry?this.output.current.value().item_id=h.system_id:this.output.current.value().system_id=h.id,g=[],this.registry.registry[h.id].master&&!(t&&t.page_start&&t.page_length)){I=[[h,{id:h.id}]],y=this.registry.registry[h.id].siblings;for(var T=0,S=y.length;T<S;T++)I.push([this.refetchItem(y[T]),{id:y[T]}]);for(this.parallel.StartCitation(I),this.registry.registry[h.id].parallel_delimiter_override?this.output.queue[0].strings.delimiter=this.registry.registry[h.id].parallel_delimiter_override:this.output.queue[0].strings.delimiter=", ",this.tmp.term_predecessor=!1,this.tmp.cite_index=0,T=0,S=I.length;T<S;T+=1)T<I.length-1?this.tmp.parallel_and_not_last=!0:delete this.tmp.parallel_and_not_last,g.push(""+e.getCite.call(this,I[T][0],I[T][1])),this.tmp.cite_index++,x[I[T][0].id]=!0}else!this.registry.registry[h.id].siblings&&(this.tmp.term_predecessor=!1,this.tmp.cite_index=0,g.push(""+e.getCite.call(this,h)),t&&t.page_start&&t.page_length&&(N+=1));for(O.push(""),this.tmp.bibliography_pos+=1,A.push(g),this.output.endTag("bib_entry"),this.output.queue[0].blobs.length&&this.output.queue[0].blobs[0].blobs.length&&((d=this.output.queue[0].blobs[0].blobs[0].strings?this.output.queue[0].blobs[0].blobs:this.output.queue[0].blobs)[0].strings.prefix=this.bibliography.opt.layout_prefix+d[0].strings.prefix),T=0,S=this.output.queue.length;T<S;T+=1)e.Output.Queue.purgeEmptyBlobs(this.output.queue[T]);for(T=0,S=this.output.queue.length;T<S;T+=1)this.output.adjust.upward(this.output.queue[T]),this.output.adjust.leftward(this.output.queue[T]),this.output.adjust.downward(this.output.queue[T],!0),this.output.adjust.fix(this.output.queue[T]);if(!(p=this.output.string(this,this.output.queue)[0])&&this.opt.update_mode===e.NUMERIC){var k=r.length+1+". [CSL STYLE ERROR: reference with no printed form.]";p=e.Output.Formats[this.opt.mode]["@bibliography/entry"](this,k)}p&&r.push(p)}var R=!1;if(t&&t.page_start&&t.page_length){var w=n.slice(-1)[0],j=A.slice(-1)[0];w&&j&&w!=j||(R=!0)}return this.tmp.disambig_override=!1,[A,r,R]},e.Engine.prototype.setCitationId=function(t,e){var i,s,r;if(i=!1,!t.citationID||e){for(s=Math.floor(1e14*Math.random());;){if(r=0,this.registry.citationreg.citationById[s])r=!r&&s<5e13?1:-1;else{t.citationID="a"+s.toString(32);break}1===r?s+=1:s+=-1}i=""+s}return this.registry.citationreg.citationById[t.citationID]=t,i},e.Engine.prototype.rebuildProcessorState=function(t,i,s){t||(t=[]),i||(i="html");for(var r={},n=[],a=0,o=t.length;a<o;a+=1)for(var l=0,u=t[a].citationItems.length;l<u;l+=1){var p=""+t[a].citationItems[l].id;r[p]||n.push(p),r[p]=!0}this.updateItems(n);var h=[],c=[],m=[],f=this.opt.mode;this.setOutputFormat(i);for(var a=0,o=t.length;a<o;a+=1){var d=this.processCitationCluster(t[a],h,c,e.ASSUME_ALL_ITEMS_REGISTERED);h.push([t[a].citationID,t[a].properties.noteIndex]);for(var l=0,u=d[1].length;l<u;l+=1){var g=d[1][l][0];m[g]=[h[g][0],h[g][1],d[1][l][1]]}}return this.updateUncitedItems(s),this.setOutputFormat(f),m},e.Engine.prototype.restoreProcessorState=function(t){t||(t=[]);var i,s,r,n,a,o,l,u,p=[],h=[],c=[],m={};for(i=0,s=t.length;i<s;i+=1)m[t[i].citationID]&&this.setCitationId(t[i],!0),m[t[i].citationID]=!0,c.push(t[i].properties.index);var f=t.slice();for(f.sort(function(t,e){return t.properties.index<e.properties.index?-1:+(t.properties.index>e.properties.index)}),i=0,s=f.length;i<s;i+=1)f[i].properties.index=i;for(i=0,s=f.length;i<s;i+=1){for(r=0,u=[],n=f[i].citationItems.length;r<n;r+=1)void 0===(a=f[i].citationItems[r]).sortkeys&&(a.sortkeys=[]),l=[o=this.retrieveItem(""+a.id),a],u.push(l),f[i].citationItems[r].item=o,h.push(""+a.id);f[i].properties.unsorted||u.sort(this.citation.srt.compareCompositeKeys),f[i].sortedItems=u,this.registry.citationreg.citationById[f[i].citationID]=f[i]}for(this.updateItems(h),i=0,s=t.length;i<s;i+=1)p.push([""+t[i].citationID,t[i].properties.noteIndex]);var d=[];return t&&t.length?d=this.processCitationCluster(t[0],[],p.slice(1)):(this.registry=new e.Registry(this),this.tmp=new e.Engine.Tmp,this.disambiguate=new e.Disambiguation(this)),d},e.Engine.prototype.updateItems=function(t,e,i,s){var r=this.tmp.area,n=this.tmp.root,a=this.tmp.extension;if(0===this.bibliography_sort.tokens.length&&(e=!0),this.tmp.area="citation",this.tmp.root="citation",this.tmp.extension="",s||(this.tmp.loadedItemIDs={}),this.registry.init(t),i)for(var o in this.registry.ambigcites)this.registry.ambigsTouched[o]=!0;return this.registry.dodeletes(this.registry.myhash),this.registry.doinserts(this.registry.mylist),this.registry.dorefreshes(),this.registry.rebuildlist(e),this.registry.setsortkeys(),this.registry.setdisambigs(),this.registry.sorttokens(e),this.registry.renumber(),this.tmp.extension=a,this.tmp.area=r,this.tmp.root=n,this.registry.getSortedIds()},e.Engine.prototype.updateUncitedItems=function(t,e){var i,s=this.tmp.area,r=this.tmp.root,n=this.tmp.extension;if(0===this.bibliography_sort.tokens.length&&(e=!0),this.tmp.area="citation",this.tmp.root="citation",this.tmp.extension="",this.tmp.loadedItemIDs={},t||(t=[]),"object"==typeof t){if(void 0===t.length)for(var a in i=t,t=[],i)t.push(a);else if("number"==typeof t.length){i={};for(var o=0,l=t.length;o<l;o+=1)i[t[o]]=!0}}return this.registry.init(t,!0),this.registry.dopurge(i),this.registry.doinserts(this.registry.mylist),this.registry.dorefreshes(),this.registry.rebuildlist(e),this.registry.setsortkeys(),this.registry.setdisambigs(),this.registry.sorttokens(e),this.registry.renumber(),this.tmp.extension=n,this.tmp.area=s,this.tmp.root=r,this.registry.getSortedIds()},e.localeResolve=function(t,i){var s,r;return(i||(i="en-US"),t||(t=i),s={},r=t.split(/[\-_]/),s.base=e.LANG_BASES[r[0]],void 0===s.base)?{base:i,best:t,bare:r[0]}:(1===r.length&&(s.generic=!0),1===r.length||"x"===r[1]?s.best=s.base.replace("_","-"):s.best=r.slice(0,2).join("-"),s.base=s.base.replace("_","-"),s.bare=r[0],s)},e.Engine.prototype.localeConfigure=function(t,i){var s;if((!i||!this.locale[t.best])&&("en-US"===t.best?(s=e.setupXml(this.sys.retrieveLocale("en-US")),this.localeSet(s,"en-US",t.best)):"en-US"!==t.best&&(t.base!==t.best&&(s=e.setupXml(this.sys.retrieveLocale(t.base)),this.localeSet(s,t.base,t.best)),s=e.setupXml(this.sys.retrieveLocale(t.best)),this.localeSet(s,t.best,t.best)),this.localeSet(this.cslXml,"",t.best),this.localeSet(this.cslXml,t.bare,t.best),t.base!==t.best&&this.localeSet(this.cslXml,t.base,t.best),this.localeSet(this.cslXml,t.best,t.best),void 0===this.locale[t.best].terms["page-range-delimiter"]&&(["fr","pt"].indexOf(t.best.slice(0,2).toLowerCase())>-1?this.locale[t.best].terms["page-range-delimiter"]="-":this.locale[t.best].terms["page-range-delimiter"]="–"),void 0===this.locale[t.best].terms["year-range-delimiter"]&&(this.locale[t.best].terms["year-range-delimiter"]="–"),void 0===this.locale[t.best].terms["citation-range-delimiter"]&&(this.locale[t.best].terms["citation-range-delimiter"]="–"),this.opt.development_extensions.normalize_lang_keys_to_lowercase)){for(var r=["default-locale","locale-sort","locale-translit","locale-translat"],n=0,a=r.length;n<a;n+=1)for(var o=0,l=this.opt[r[n]].length;o<l;o+=1)this.opt[r[n]][o]=this.opt[r[n]][o].toLowerCase();this.opt.lang=this.opt.lang.toLowerCase()}},e.Engine.prototype.localeSet=function(t,i,s){if(i=i.replace("_","-"),s=s.replace("_","-"),this.opt.development_extensions.normalize_lang_keys_to_lowercase&&(i=i.toLowerCase(),s=s.toLowerCase()),this.locale[s]||(this.locale[s]={},this.locale[s].terms={},this.locale[s].opts={},this.locale[s].opts["skip-words"]=e.SKIP_WORDS,this.locale[s].opts["leading-noise-words"]||(this.locale[s].opts["leading-noise-words"]=[]),this.locale[s].dates={},this.locale[s].ord={"1.0.1":!1,keys:{}},this.locale[s]["noun-genders"]={}),n=t.makeXml(),t.nodeNameIs(t.dataObj,"locale"))n=t.dataObj;else{var r,n,a,o,l,u,p,h,c,m,f,d,g,b,_,v=t.getNodesByName(t.dataObj,"locale"),y=!1;for(o=0,f=t.numberofnodes(v);o<f;o+=1)if(r=v[o],y||t.getAttributeValue(r,"lang","xml")!==i){var x=t.getAttributeValue(r,"lang","xml"),I=t.getNodesByName(r,"style-options");if(x&&I&&I.length){var O=t.getAttributeValue(I[0],"jurisdiction-preference");O&&(this.locale[x]||(this.locale[x]={opts:{}}),this.locale[x].opts["jurisdiction-preference"]=O.split(/\s+/))}}else n=r,y=!0}for(b=0,v=t.getNodesByName(n,"type"),_=t.numberofnodes(v);b<_;b+=1){var T=v[b],S=t.getAttributeValue(T,"name"),N=t.getAttributeValue(T,"gender");this.opt.gender[S]=N}if(t.getNodesByName(n,"term","ordinal").length){for(var A in this.locale[s].ord.keys)delete this.locale[s].terms[A];this.locale[s].ord={"1.0.1":!1,keys:{}}}v=t.getNodesByName(n,"term");var E={"last-digit":{},"last-two-digits":{},"whole-number":{}},k=!1,R={};for(o=0,f=t.numberofnodes(v);o<f;o+=1){if(l=v[o],"sub verbo"===(p=t.getAttributeValue(l,"name"))&&(p="sub-verbo"),"ordinal"===p.slice(0,7)){if("ordinal"===p)k=!0;else{var w=t.getAttributeValue(l,"match"),j=p.slice(8),d=t.getAttributeValue(l,"gender-form");d||(d="neuter"),w||(w="last-two-digits","0"===j.slice(0,1)&&(w="last-digit")),"0"===j.slice(0,1)&&(j=j.slice(1)),E[w][j]||(E[w][j]={}),E[w][j][d]=p}this.locale[s].ord.keys[p]=!0}void 0===this.locale[s].terms[p]&&(this.locale[s].terms[p]={}),u="long",d=!1,t.getAttributeValue(l,"form")&&(u=t.getAttributeValue(l,"form")),t.getAttributeValue(l,"gender-form")&&(d=t.getAttributeValue(l,"gender-form")),t.getAttributeValue(l,"gender")&&(this.locale[s]["noun-genders"][p]=t.getAttributeValue(l,"gender")),d?(this.locale[s].terms[p][d]={},this.locale[s].terms[p][d][u]=[],g=this.locale[s].terms[p][d],R[p]=!0):(this.locale[s].terms[p][u]=[],g=this.locale[s].terms[p]),t.numberofnodes(t.getNodesByName(l,"multiple"))?(g[u][0]=t.getNodeValue(l,"single"),g[u][0].indexOf("%s")>-1&&(this.opt.hasPlaceholderTerm=!0),g[u][1]=t.getNodeValue(l,"multiple"),g[u][1].indexOf("%s")>-1&&(this.opt.hasPlaceholderTerm=!0)):(g[u]=t.getNodeValue(l),g[u].indexOf("%s")>-1&&(this.opt.hasPlaceholderTerm=!0))}if(this.locale[s].terms.supplement||(this.locale[s].terms.supplement={}),this.locale[s].terms.supplement.long||(this.locale[s].terms.supplement.long=["supplement","supplements"]),k){for(var C in R){var L={},D=0;for(var P in this.locale[s].terms[C])["masculine","feminine"].indexOf(P)>-1?L[P]=this.locale[s].terms[C][P]:D+=1;if(!D){if(L.feminine)for(var P in L.feminine)this.locale[s].terms[C][P]=L.feminine[P];else if(L.masculine)for(var P in L.masculine)this.locale[s].terms[C][P]=L.masculine[P]}}this.locale[s].ord["1.0.1"]=E}for(p in this.locale[s].terms)for(b=0,_=2;b<_;b+=1)if(d=e.GENDERS[b],this.locale[s].terms[p][d])for(u in this.locale[s].terms[p])this.locale[s].terms[p][d][u]||(this.locale[s].terms[p][d][u]=this.locale[s].terms[p][u]);for(o=0,v=t.getNodesByName(n,"style-options"),f=t.numberofnodes(v);o<f;o+=1)for(m in h=v[o],a=t.attributes(h))if(a.hasOwnProperty(m)){if("@punctuation-in-quote"===m||"@limit-day-ordinals-to-day-1"===m)"true"===a[m]?this.locale[s].opts[m.slice(1)]=!0:this.locale[s].opts[m.slice(1)]=!1;else if("@jurisdiction-preference"===m){var U=a[m].split(/\s+/);this.locale[s].opts[m.slice(1)]=U}else if("@skip-words"===m){var B=a[m].split(/\s*,\s*/);this.locale[s].opts[m.slice(1)]=B}else if("@leading-noise-words"===m){var M=a[m].split(/\s*,\s*/);this.locale[s].opts["leading-noise-words"]=M}else if("@name-as-sort-order"===m){this.locale[s].opts["name-as-sort-order"]={};for(var q=a[m].split(/\s+/),b=0,_=q.length;b<_;b+=1)this.locale[s].opts["name-as-sort-order"][q[b]]=!0}else if("@name-as-reverse-order"===m){this.locale[s].opts["name-as-reverse-order"]={};for(var q=a[m].split(/\s+/),b=0,_=q.length;b<_;b+=1)this.locale[s].opts["name-as-reverse-order"][q[b]]=!0}else if("@name-never-short"===m){this.locale[s].opts["name-never-short"]={};for(var q=a[m].split(/\s+/),b=0,_=q.length;b<_;b+=1)this.locale[s].opts["name-never-short"][q[b]]=!0}}for(o=0,v=t.getNodesByName(n,"date"),f=t.numberofnodes(v);o<f;o+=1){var c=v[o];this.locale[s].dates[t.getAttributeValue(c,"form")]=c}e.SET_COURT_CLASSES(this,s,t,n)},e.getLocaleNames=function(t,i){var s=e.setupXml(t);function r(t,i){var s=["base","best"];if(i)for(var r=e.localeResolve(i),n=0,a=s.length;n<a;n++)r[s[n]]&&-1===t.indexOf(r[s[n]])&&t.push(r[s[n]])}var n=["en-US"];r(n,i);var a=s.getNodesByName(s.dataObj,"style")[0];r(n,s.getAttributeValue(a,"default-locale"));for(var o=["layout","if","else-if","condition"],l=0,u=o.length;l<u;l++)!function(t){for(var e=s.getNodesByName(s.dataObj,t),i=0,r=e.length;i<r;i++){var a=s.getAttributeValue(e[i],"locale");if(a){a=a.split(/ +/);for(var o=0,l=a.length;o<l;o++)this.extendLocaleList(n,a[o])}}}(s,n,o[l]);return n},e.Node={},e.Node.bibliography={build:function(t,i){this.tokentype===e.START&&(t.build.area="bibliography",t.build.root="bibliography",t.build.extension="",this.execs.push(function(t){t.tmp.area="bibliography",t.tmp.root="bibliography",t.tmp.extension=""})),i.push(this)}},e.Node.choose={build:function(t,i){var s;this.tokentype===e.START&&(s=function(t){t.tmp.jump.push(void 0,e.LITERAL)}),this.tokentype===e.END&&(s=function(t){t.tmp.jump.pop()}),this.execs.push(s),i.push(this)},configure:function(t,i){this.tokentype===e.END?(t.configure.fail.push(i),t.configure.succeed.push(i)):(t.configure.fail.pop(),t.configure.succeed.pop())}},e.Node.citation={build:function(t,i){if(this.tokentype===e.START&&(t.build.area="citation",t.build.root="citation",t.build.extension="",this.execs.push(function(t){t.tmp.area="citation",t.tmp.root="citation",t.tmp.extension=""})),this.tokentype===e.END){if(t.opt.grouped_sort="in-text"===t.opt.xclass&&t.citation.opt.collapse&&t.citation.opt.collapse.length||t.citation.opt.cite_group_delimiter&&t.citation.opt.cite_group_delimiter.length&&t.opt.update_mode!==e.POSITION&&t.opt.update_mode!==e.NUMERIC,t.opt.grouped_sort&&t.citation_sort.opt.sort_directions.length){var s=t.citation_sort.opt.sort_directions[0].slice();t.citation_sort.opt.sort_directions=[s].concat(t.citation_sort.opt.sort_directions)}t.citation.srt=new e.Registry.Comparifier(t,"citation_sort")}i.push(this)}},e.Node["#comment"]={build:function(){}},e.Node.date={build:function(t,i){var s,r,n,a,o,l,u,p;(this.tokentype===e.START||this.tokentype===e.SINGLETON)&&(t.dateput.string(t,t.dateput.queue),t.tmp.date_token=e.Util.cloneToken(this),t.tmp.date_token.strings.prefix="",t.tmp.date_token.strings.suffix="",t.dateput.openLevel(this),t.build.date_parts=[],t.build.date_variables=this.variables,t.build.extension||e.Util.substituteStart.call(this,t,i),s=t.build.extension?e.dateMacroAsSortKey:function(t,e,i){var s;if(t.tmp.element_rendered_ok=!1,t.tmp.donesies=[],t.tmp.dateparts=[],s=[],this.variables.length&&!(t.tmp.just_looking&&"accessed"===this.variables[0])){for(void 0===(r=e[this.variables[0]])&&(r={"date-parts":[[0]]},t.opt.development_extensions.locator_date_and_revision&&i&&"locator-date"===this.variables[0]&&i["locator-date"]&&(r=i["locator-date"])),t.tmp.date_object=r,n=this.dateparts.length,a=0;a<n;a+=1)o=this.dateparts[a],void 0!==t.tmp.date_object[o+"_end"]?s.push(o):"month"===o&&void 0!==t.tmp.date_object.season_end&&s.push(o);for(a=0,l=[],n=(u=["year","month","day"]).length;a<n;a+=1)s.indexOf(u[a])>-1&&l.push(u[a]);for(a=0,s=l.slice(),p=2,n=s.length;a<n;a+=1)if(o=s[a],t.tmp.date_object[o]!==t.tmp.date_object[o+"_end"]){p=a;break}t.tmp.date_collapse_at=s.slice(p)}else t.tmp.date_object=!1},this.execs.push(s),s=function(t,e){if(e[this.variables[0]]&&(t.output.startTag("date",this),"issued"===this.variables[0]&&("legal_case"===e.type||"legislation"===e.type)&&-1===t.opt.disable_duplicate_year_suppression.indexOf(e.country)&&!t.tmp.extension&&""+e["collection-number"]==""+t.tmp.date_object.year&&1===this.dateparts.length&&"year"===this.dateparts[0])){for(var i in t.tmp.date_object)if(t.tmp.date_object.hasOwnProperty(i)&&"year"===i.slice(0,4)){t.tmp.issued_date={};var s=t.output.current.mystack.slice(-2)[0].blobs;t.tmp.issued_date.list=s,t.tmp.issued_date.pos=s.length-1}}},this.execs.push(s)),t.build.extension||this.tokentype!==e.END&&this.tokentype!==e.SINGLETON||(s=function(t,e){e[this.variables[0]]&&t.output.endTag()},this.execs.push(s)),i.push(this),this.tokentype!==e.END&&this.tokentype!==e.SINGLETON||t.build.extension||e.Util.substituteEnd.call(this,t,i)}},e.Node["date-part"]={build:function(t,i){this.strings.form||(this.strings.form="long"),t.build.date_parts.push(this.strings.name);var s,r,n,a,o,l,u,p,h,c,m,f,d,g,b,_,v,y,x,I=t.build.date_variables[0];function O(i,s,r){if(!r)return r;if(r=""+e.Util.Dates[this.strings.name][i](t,r,s,this.default_locale),"month"===this.strings.name){if(t.tmp.strip_periods)r=r.replace(/\./g,"");else for(var n=0,a=this.decorations.length;n<a;n+=1)if("@strip-periods"===this.decorations[n][0]&&"true"===this.decorations[n][1]){r=r.replace(/\./g,"");break}}return r}this.execs.push(function(t,i){if(t.tmp.date_object){t.tmp.probably_rendered_something=!0;var T="";if(n=!0,a="",o="",t.tmp.donesies.push(this.strings.name),t.tmp.date_object.literal&&"year"===this.strings.name&&(T=t.tmp.date_object.literal,t.output.append(t.tmp.date_object.literal,this)),t.tmp.date_object&&(a=t.tmp.date_object[this.strings.name],o=t.tmp.date_object[this.strings.name+"_end"]),"year"!==this.strings.name||0!==a||t.tmp.suppress_decorations||(a=!1),l=!t.tmp.suppress_decorations,u=t.tmp.have_collapsed,p="year-suffix"===t[t.tmp.area].opt.collapse||"year-suffix-ranged"===t[t.tmp.area].opt.collapse,h=t.opt["disambiguate-add-year-suffix"],l&&h&&p&&(t.tmp.years_used.push(a),t.tmp.last_years_used.length>=t.tmp.years_used.length&&u&&t.tmp.last_years_used[t.tmp.years_used.length-1]===a&&(a=!1)),void 0!==a){c=!1,m=!1,"year"===this.strings.name&&(500>parseInt(a,10)&&parseInt(a,10)>0&&(m=t.getTerm("ad")),0>parseInt(a,10)&&(c=t.getTerm("bc"),a=-1*parseInt(a,10)),o&&(500>parseInt(o,10)&&parseInt(o,10)>0&&t.getTerm("ad"),0>parseInt(o,10)&&(t.getTerm("bc"),o=-1*parseInt(o,10))));for(var S=""+t.tmp.date_object.month;S.length<2;)S="0"+S;S="month-"+S;var N=t.locale[t.opt.lang]["noun-genders"][S];if(this.strings.form){var A=this.strings.form,E=this.strings.form;"day"===this.strings.name&&"ordinal"===A&&t.locale[t.opt.lang].opts["limit-day-ordinals-to-day-1"]&&(1!=a&&(A="numeric"),1!=o&&(E="numeric")),a=O.call(this,A,N,a),o=O.call(this,E,N,o)}if(t.output.openLevel("empty"),t.tmp.date_collapse_at.length){for(s=0,f=!0,r=t.tmp.date_collapse_at.length;s<r;s+=1)if(y=t.tmp.date_collapse_at[s],-1===t.tmp.donesies.indexOf(y)){f=!1;break}if(f){if(""+o!="0"){if(0===t.dateput.queue.length&&(n=!0),t.opt["year-range-format"]&&"expanded"!==t.opt["year-range-format"]&&!t.tmp.date_object.day&&!t.tmp.date_object.month&&!t.tmp.date_object.season&&"year"===this.strings.name&&a&&o){o=t.fun.year_mangler(a+"-"+o,!0);var k=t.getTerm("year-range-delimiter");o=o.slice(o.indexOf(k)+1)}T=o,t.dateput.append(o,this),n&&(x=t.dateput.current.value().blobs[0])&&(x.strings.prefix="")}T=a,t.output.append(a,this),(x=(d=t.output.current.value()).blobs[d.blobs.length-1])&&(x.strings.suffix=""),this.strings["range-delimiter"]?t.output.append(this.strings["range-delimiter"]):t.output.append(t.getTerm("year-range-delimiter"),"empty"),t.dateput.closeLevel(),g=t.dateput.current.value(),d.blobs=d.blobs.concat(g),t.dateput.string(t,t.dateput.queue),t.dateput.openLevel(t.tmp.date_token),t.tmp.date_collapse_at=[]}else T=a,t.output.append(a,this),t.tmp.date_collapse_at.indexOf(this.strings.name)>-1&&""+o!="0"&&(0===t.dateput.queue.length&&(n=!0),t.dateput.openLevel("empty"),T=o,t.dateput.append(o,this),n&&(x=t.dateput.current.value().blobs[0])&&(x.strings.prefix=""),c&&(T=c,t.dateput.append(c)),m&&(T=m,t.dateput.append(m)),t.dateput.closeLevel())}else T=a,t.output.append(a,this);c&&(T=c,t.output.append(c)),m&&(T=m,t.output.append(m)),t.output.closeLevel()}else"month"===this.strings.name&&t.tmp.date_object.season&&((a=""+t.tmp.date_object.season)&&a.match(/^[1-4]$/)?(t.tmp.group_context.tip.variable_success=!0,T="winter",t.output.append(t.getTerm("season-0"+a),this)):a&&(T=a,t.output.append(a,this)));t.tmp.value=[],i[I]&&(a||t.tmp.have_collapsed)&&!t.opt.has_year_suffix&&"year"===this.strings.name&&!t.tmp.just_looking&&t.registry.registry[i.id]&&!1!==t.registry.registry[i.id].disambig.year_suffix&&!t.tmp.has_done_year_suffix&&(t.tmp.has_done_year_suffix=!0,T="x",_=parseInt(t.registry.registry[i.id].disambig.year_suffix,10),b=new e.NumericBlob(t,!1,_,this,i.id),this.successor_prefix=t[t.build.area].opt.layout_delimiter,this.splice_prefix=t[t.build.area].opt.layout_delimiter,v=new e.Util.Suffixator(e.SUFFIX_CHARS),b.setFormatter(v),"year-suffix-ranged"===t[t.tmp.area].opt.collapse&&(b.range_prefix=t.getTerm("citation-range-delimiter")),t[t.tmp.area].opt.cite_group_delimiter?b.successor_prefix=t[t.tmp.area].opt.cite_group_delimiter:t[t.tmp.area].opt["year-suffix-delimiter"]?b.successor_prefix=t[t.tmp.area].opt["year-suffix-delimiter"]:b.successor_prefix=t[t.tmp.area].opt.layout_delimiter,b.UGLY_DELIMITER_SUPPRESS_HACK=!0,t.output.append(b,"literal")),T&&!t.tmp.group_context.tip.condition&&(t.tmp.just_did_number=T.match(/[0-9]$/),t.output.current.tip.strings.suffix&&(t.tmp.just_did_number=!1))}}),i.push(this)}},e.Node["else-if"]={build:function(t,i){e.Conditions.TopNode.call(this,t,i),i.push(this)},configure:function(t,i){e.Conditions.Configure.call(this,t,i)}},e.Node.else={build:function(t,e){e.push(this)},configure:function(t,i){this.tokentype===e.START&&(t.configure.fail[t.configure.fail.length-1]=i)}},e.Node["et-al"]={build:function(t,e){("citation"===t.build.area||"bibliography"===t.build.area)&&this.execs.push(function(t){t.tmp.etal_node=this,"string"==typeof this.strings.term&&(t.tmp.etal_term=this.strings.term)}),e.push(this)}},e.Node.group={build:function(t,i,s){var r,n;if(this.realGroup=s,this.tokentype===e.START&&(e.Util.substituteStart.call(this,t,i),t.build.substitute_level.value()&&t.build.substitute_level.replace(t.build.substitute_level.value()+1),this.juris||i.push(this),r=function(t){if(t.output.startTag("group",this),this.strings.label_form_override&&!t.tmp.group_context.tip.label_form&&(t.tmp.group_context.tip.label_form=this.strings.label_form_override),this.strings.label_capitalize_if_first_override&&!t.tmp.group_context.tip.label_capitalize_if_first&&(t.tmp.group_context.tip.label_capitalize_if_first=this.strings.label_capitalize_if_first_override),this.realGroup){t.tmp.group_context.tip.condition&&e.UPDATE_GROUP_CONTEXT_CONDITION(t,this.strings.prefix,null,this);var i=!1,s=!1;t.tmp.group_context.mystack.length&&(t.output.current.value().parent=t.tmp.group_context.tip.output_tip);var r=t.tmp.group_context.tip.label_form;r||(r=this.strings.label_form_override);var n=t.tmp.group_context.tip.label_capitalize_if_first;n||(n=this.strings.label_capitalize_if_first),t.tmp.group_context.tip.condition?(i=t.tmp.group_context.tip.condition,s=t.tmp.group_context.tip.force_suppress):this.strings.reject?i={test:this.strings.reject,not:!0}:this.strings.require&&(i={test:this.strings.require,not:!1});var a={old_term_predecessor:t.tmp.term_predecessor,term_intended:!1,variable_attempt:!1,variable_success:!1,variable_success_parent:t.tmp.group_context.tip.variable_success,output_tip:t.output.current.tip,label_form:r,label_static:t.tmp.group_context.tip.label_static,label_capitalize_if_first:n,parallel_delimiter_override:this.strings.set_parallel_delimiter_override,parallel_delimiter_override_on_suppress:this.strings.set_parallel_delimiter_override_on_suppress,condition:i,force_suppress:s,done_vars:t.tmp.group_context.tip.done_vars.slice()};if(this.non_parallel){var o=t.tmp.group_context.tip.non_parallel;o||(o={}),Object.assign(o,this.non_parallel),a.non_parallel=o}if(this.parallel_first){var l=t.tmp.group_context.tip.parallel_first;l||(l={}),Object.assign(l,this.parallel_first),a.parallel_first=l}if(this.parallel_last){var u=t.tmp.group_context.tip.parallel_last;u||(u={}),Object.assign(u,this.parallel_last),a.parallel_last=u}if(t.tmp.abbrev_trimmer&&t.tmp.abbrev_trimmer.LAST_TO_FIRST&&a.parallel_last)for(var p in a.parallel_first||(a.parallel_first={}),t.tmp.abbrev_trimmer.LAST_TO_FIRST)a.parallel_last[p]&&(a.parallel_first[p]=!0,delete a.parallel_last[p]);if(t.tmp.group_context.push(a),t.tmp.abbrev_trimmer&&this.parallel_last_to_first)for(var p in t.tmp.abbrev_trimmer.LAST_TO_FIRST||(t.tmp.abbrev_trimmer.LAST_TO_FIRST={}),this.parallel_last_to_first)t.tmp.abbrev_trimmer.LAST_TO_FIRST[p]=!0}},(n=[]).push(r),this.execs=n.concat(this.execs),this.strings["has-publisher-and-publisher-place"]&&(t.build["publisher-special"]=!0,this.strings["subgroup-delimiter"]&&(r=function(t,i){if(i.publisher&&i["publisher-place"]){var s=i.publisher.split(/;\s*/),r=i["publisher-place"].split(/;\s*/);s.length>1&&s.length===r.length&&(t.publisherOutput=new e.PublisherOutput(t,this),t.publisherOutput["publisher-list"]=s,t.publisherOutput["publisher-place-list"]=r)}},this.execs.push(r))),this.juris)){var a,o=new e.Token("choose",e.START);e.Node.choose.build.call(o,t,i);var l=new e.Token("if",e.START);a=this.juris,r=function(i,s){return e.INIT_JURISDICTION_MACROS(t,i,s,a)},l.tests||(l.tests=[]),l.tests.push(r),l.test=t.fun.match.any(l,t,l.tests),i.push(l);var u=new e.Token("text",e.SINGLETON);r=function(t,i,s){var r=i;s&&s["best-jurisdiction"]&&"juris-locator"===this.juris&&(r=s);var n=0;if(t.juris[r["best-jurisdiction"]][this.juris])for(;n<t.juris[r["best-jurisdiction"]][this.juris].length;)n=e.tokenExec.call(t,t.juris[r["best-jurisdiction"]][this.juris][n],i,s)},u.juris=this.juris,u.execs.push(r),i.push(u);var p=new e.Token("if",e.END);e.Node.if.build.call(p,t,i);var h=new e.Token("else",e.START);e.Node.else.build.call(h,t,i)}if(this.tokentype===e.END&&(t.build["publisher-special"]&&(t.build["publisher-special"]=!1,r=function(t){t.publisherOutput&&(t.publisherOutput.render(),t.publisherOutput=!1)},this.execs.push(r)),r=function(t,i,s){if(!t.tmp.group_context.tip.condition&&t.output.current.tip.strings.suffix&&(t.tmp.just_did_number=!1),t.output.endTag(),this.realGroup){var r=t.tmp.group_context.pop();if(r.parallel_delimiter_override&&(t.tmp.group_context.tip.parallel_delimiter_override=r.parallel_delimiter_override,!t.tmp.just_looking&&t.registry.registry[i.id].master&&(t.registry.registry[i.id].parallel_delimiter_override=r.parallel_delimiter_override)),r.parallel_delimiter_override_on_suppress&&(t.tmp.group_context.tip.parallel_delimiter_override_on_suppress=r.parallel_delimiter_override_on_suppress),"bibliography_sort"===t.tmp.area){var n=r.done_vars.indexOf("citation-number");this.strings.sort_direction&&n>-1&&1==t.tmp.group_context.length()&&(this.strings.sort_direction===e.DESCENDING?t.bibliography_sort.opt.citation_number_sort_direction=e.DESCENDING:t.bibliography_sort.opt.citation_number_sort_direction=e.ASCENDING,r.done_vars=r.done_vars.slice(0,n).concat(r.done_vars.slice(n+1)))}if(r.condition&&(r.force_suppress=e.EVALUATE_GROUP_CONDITION(t,r)),t.tmp.group_context.tip.condition&&(t.tmp.group_context.tip.force_suppress=r.force_suppress),!r.force_suppress&&(r.variable_success||r.term_intended&&!r.variable_attempt)){this.isJurisLocatorLabel||(t.tmp.group_context.tip.variable_success=!0);var a=t.output.current.value().blobs;if(t.output.current.value().blobs.length,!t.tmp.just_looking&&(r.non_parallel||r.parallel_last||r.parallel_first||r.parallel_delimiter_override||r.parallel_delimiter_override_on_suppress)){var o=t.parallel.checkRepeats(r);if(o&&a&&a.pop(),t.tmp.cite_index>0&&(o||!r.parallel_first&&!r.parallel_last&&!r.non_parallel)){var l=t.tmp.suppress_repeats[t.tmp.cite_index-1];o&&r.parallel_delimiter_override_on_suppress&&(l.SIBLING||l.ORPHAN)?t.output.queue.slice(-1)[0].parallel_delimiter=r.parallel_delimiter_override_on_suppress:r.parallel_delimiter_override&&l.SIBLING&&(t.output.queue.slice(-1)[0].parallel_delimiter=r.parallel_delimiter_override)}}}else{if(t.tmp.term_predecessor=r.old_term_predecessor,t.tmp.group_context.tip.variable_attempt=r.variable_attempt,r.force_suppress&&!t.tmp.group_context.tip.condition&&(t.tmp.group_context.tip.variable_attempt=!0,t.tmp.group_context.tip.variable_success=r.variable_success_parent),r.force_suppress)for(var u=0,p=r.done_vars.length;u<p;u++)for(var h=r.done_vars[u],c=0,m=t.tmp.done_vars.length;c<m;c++)t.tmp.done_vars[c]===h&&(t.tmp.done_vars=t.tmp.done_vars.slice(0,c).concat(t.tmp.done_vars.slice(c+1)));t.output.current.value().blobs&&t.output.current.value().blobs.pop()}}},this.execs.push(r),this.juris)){var c=new e.Token("else",e.END);e.Node.else.build.call(c,t,i);var m=new e.Token("choose",e.END);e.Node.choose.build.call(m,t,i)}this.tokentype===e.END&&(this.juris||i.push(this),t.build.substitute_level.value()&&t.build.substitute_level.replace(t.build.substitute_level.value()-1),e.Util.substituteEnd.call(this,t,i))}},e.Node.if={build:function(t,i){e.Conditions.TopNode.call(this,t,i),i.push(this)},configure:function(t,i){e.Conditions.Configure.call(this,t,i)}},e.Node.conditions={build:function(t){this.tokentype===e.START&&t.tmp.conditions.addMatch(this.match),this.tokentype===e.END&&t.tmp.conditions.matchCombine()}},e.Node.condition={build:function(t){if(this.tokentype===e.SINGLETON){var i=t.fun.match[this.match](this,t,this.tests);t.tmp.conditions.addTest(i)}}},e.Conditions={},e.Conditions.TopNode=function(t){var i;(this.tokentype===e.START||this.tokentype===e.SINGLETON)&&(this.locale&&(t.opt.lang=this.locale),this.tests&&this.tests.length?this.test=t.fun.match[this.match](this,t,this.tests):t.tmp.conditions=new e.Conditions.Engine(t,this),0===t.build.substitute_level.value()&&(i=function(t){t.tmp.condition_counter++},this.execs.push(i))),(this.tokentype===e.END||this.tokentype===e.SINGLETON)&&(0===t.build.substitute_level.value()&&(i=function(t){t.tmp.condition_counter--,t.tmp.condition_lang_counter_arr.length>0&&t.tmp.condition_lang_counter_arr.slice(-1)[0]===t.tmp.condition_counter&&(t.opt.lang=t.tmp.condition_lang_val_arr.pop(),t.tmp.condition_lang_counter_arr.pop()),this.locale_default&&(t.output.current.value().old_locale=this.locale_default,t.output.closeLevel("empty"),t.opt.lang=this.locale_default)},this.execs.push(i)),i=function(t){return this[t.tmp.jump.value()]},this.execs.push(i),this.locale_default&&(t.opt.lang=this.locale_default))},e.Conditions.Configure=function(t,i){this.tokentype===e.START?(this.fail=t.configure.fail.slice(-1)[0],this.succeed=this.next,t.configure.fail[t.configure.fail.length-1]=i):this.tokentype===e.SINGLETON?(this.fail=this.next,this.succeed=t.configure.succeed.slice(-1)[0],t.configure.fail[t.configure.fail.length-1]=i):(this.succeed=t.configure.succeed.slice(-1)[0],this.fail=this.next)},e.Conditions.Engine=function(t,e){this.token=e,this.state=t},e.Conditions.Engine.prototype.addTest=function(t){this.token.tests||(this.token.tests=[]),this.token.tests.push(t)},e.Conditions.Engine.prototype.addMatch=function(t){this.token.match=t},e.Conditions.Engine.prototype.matchCombine=function(){this.token.test=this.state.fun.match[this.token.match](this.token,this.state,this.token.tests)},e.Node.info={build:function(t){this.tokentype===e.START?t.build.skip="info":t.build.skip=!1}},e.Node.institution={build:function(t,i){[e.SINGLETON,e.START].indexOf(this.tokentype)>-1&&this.execs.push(function(t){"string"==typeof this.strings.delimiter?t.tmp.institution_delimiter=this.strings.delimiter:t.tmp.institution_delimiter=t.tmp.name_delimiter,"text"===t.inheritOpt(this,"and")?this.and_term=t.getTerm("and","long",0):"symbol"===t.inheritOpt(this,"and")?t.opt.development_extensions.expect_and_symbol_form?this.and_term=t.getTerm("and","symbol",0):this.and_term="&":"none"===t.inheritOpt(this,"and")&&(this.and_term=t.tmp.institution_delimiter),void 0===this.and_term&&t.tmp.and_term&&(this.and_term=t.tmp.and_term),e.STARTSWITH_ROMANESQUE_REGEXP.test(this.and_term)?(this.and_prefix_single=" ",this.and_prefix_multiple=", ","string"==typeof t.tmp.institution_delimiter&&(this.and_prefix_multiple=t.tmp.institution_delimiter),this.and_suffix=" "):(this.and_prefix_single="",this.and_prefix_multiple="",this.and_suffix=""),"always"===t.inheritOpt(this,"delimiter-precedes-last")?this.and_prefix_single=t.tmp.institution_delimiter:"never"===t.inheritOpt(this,"delimiter-precedes-last")&&this.and_prefix_multiple&&(this.and_prefix_multiple=" "),this.and={},void 0!==this.and_term?(t.output.append(this.and_term,"empty",!0),this.and.single=t.output.pop(),this.and.single.strings.prefix=this.and_prefix_single,this.and.single.strings.suffix=this.and_suffix,t.output.append(this.and_term,"empty",!0),this.and.multiple=t.output.pop(),this.and.multiple.strings.prefix=this.and_prefix_multiple,this.and.multiple.strings.suffix=this.and_suffix):"undefined"!==this.strings.delimiter&&(this.and.single=new e.Blob(t.tmp.institution_delimiter),this.and.single.strings.prefix="",this.and.single.strings.suffix="",this.and.multiple=new e.Blob(t.tmp.institution_delimiter),this.and.multiple.strings.prefix="",this.and.multiple.strings.suffix=""),t.nameOutput.institution=this}),i.push(this)},configure:function(t){[e.SINGLETON,e.START].indexOf(this.tokentype)>-1&&(t.build.has_institution=!0)}},e.Node["institution-part"]={build:function(t,e){var i;"long"===this.strings.name?i=this.strings["if-short"]?function(t){t.nameOutput.institutionpart["long-with-short"]=this}:function(t){t.nameOutput.institutionpart.long=this}:"short"===this.strings.name&&(i=function(t){t.nameOutput.institutionpart.short=this}),this.execs.push(i),e.push(this)}},e.Node.key={build:function(t,i){i=t[t.build.root+"_sort"].tokens;var s,r=new e.Token("key",e.START);t.tmp.root=t.build.root,r.strings["et-al-min"]=t.inheritOpt(this,"et-al-min"),r.strings["et-al-use-first"]=t.inheritOpt(this,"et-al-use-first"),r.strings["et-al-use-last"]=t.inheritOpt(this,"et-al-use-last"),s=function(t){t.tmp.done_vars=[]},r.execs.push(s),s=function(t){t.output.openLevel("empty")},r.execs.push(s);var n=[];if(this.strings.sort_direction===e.DESCENDING?(n.push(1),n.push(-1)):(n.push(-1),n.push(1)),t[t.build.area].opt.sort_directions.push(n),e.DATE_VARIABLES.indexOf(this.variables[0])>-1&&(t.build.date_key=!0),s=function(t){t.tmp.sort_key_flag=!0,t.inheritOpt(this,"et-al-min")&&(t.tmp["et-al-min"]=t.inheritOpt(this,"et-al-min")),t.inheritOpt(this,"et-al-use-first")&&(t.tmp["et-al-use-first"]=t.inheritOpt(this,"et-al-use-first")),"boolean"==typeof t.inheritOpt(this,"et-al-use-last")&&(t.tmp["et-al-use-last"]=t.inheritOpt(this,"et-al-use-last"))},r.execs.push(s),i.push(r),this.variables.length){var a=this.variables[0];if(e.NAME_VARIABLES.indexOf(a)>-1){var o=new e.Token("names",e.START);o.tokentype=e.START,o.variables=this.variables,e.Node.names.build.call(o,t,i);var l=new e.Token("name",e.SINGLETON);l.tokentype=e.SINGLETON,l.strings["name-as-sort-order"]="all",l.strings["sort-separator"]=" ",l.strings["et-al-use-last"]=t.inheritOpt(this,"et-al-use-last"),l.strings["et-al-min"]=t.inheritOpt(this,"et-al-min"),l.strings["et-al-use-first"]=t.inheritOpt(this,"et-al-use-first"),e.Node.name.build.call(l,t,i);var u=new e.Token("institution",e.SINGLETON);u.tokentype=e.SINGLETON,e.Node.institution.build.call(u,t,i);var p=new e.Token("names",e.END);p.tokentype=e.END,e.Node.names.build.call(p,t,i)}else{var h=new e.Token("text",e.SINGLETON);h.strings.sort_direction=this.strings.sort_direction,h.dateparts=this.dateparts,e.NUMERIC_VARIABLES.indexOf(a)>-1?s="citation-number"===a?function(t,i){if("bibliography_sort"===t.tmp.area&&(this.strings.sort_direction===e.DESCENDING?t.bibliography_sort.opt.citation_number_sort_direction=e.DESCENDING:t.bibliography_sort.opt.citation_number_sort_direction=e.ASCENDING),"citation_sort"===t.tmp.area&&t.bibliography_sort.tmp.citation_number_map)var s=t.bibliography_sort.tmp.citation_number_map[t.registry.registry[i.id].seq];else var s=t.registry.registry[i.id].seq;s&&(s=e.Util.padding(""+s)),t.output.append(s,this)}:function(t,i){var s=!1;(s=i[a])&&(s=e.Util.padding(s)),t.output.append(s,this)}:"citation-label"===a?s=function(t,e){var i=t.getCitationLabel(e);t.output.append(i,this)}:e.DATE_VARIABLES.indexOf(a)>-1?(s=e.dateAsSortKey,h.variables=this.variables):s="title"===a?t.transform.getOutputFunction(this.variables,"title",!1,!1,!0):"court-class"===a?function(t,i,s){e.INIT_JURISDICTION_MACROS(t,i,s,"juris-main");var r=e.GET_COURT_CLASS(t,i,!0);t.output.append(r,"empty")}:function(t,e){var i=e[a];t.output.append(i,"empty")},h.execs.push(s),i.push(h)}}else{var c=new e.Token("text",e.SINGLETON);c.strings.sort_direction=this.strings.sort_direction,c.postponed_macro=this.postponed_macro,e.expandMacro.call(t,c,i)}var m=new e.Token("key",e.END);s=function(t){var e=t.output.string(t,t.output.queue);t.sys.normalizeUnicode&&(e=t.sys.normalizeUnicode(e)),""===(e=e?e.split(" ").join(t.opt.sort_sep)+t.opt.sort_sep:"")&&(e=void 0),"string"!=typeof e&&(e=void 0),t[t[t.tmp.area].root+"_sort"].keys.push(e),t.tmp.value=[]},m.execs.push(s),t.build.date_key&&("citation"===t.build.area&&"_sort"===t.build.extension&&(t[t.build.area].opt.sort_directions.push([-1,1]),s=function(t,i){var s=t.registry.registry[i.id].disambig.year_suffix;s||(s=0);var r=e.Util.padding(""+s);t[t.tmp.area].keys.push(r)},m.execs.push(s)),t.build.date_key=!1),s=function(t){t.tmp["et-al-min"]=void 0,t.tmp["et-al-use-first"]=void 0,t.tmp["et-al-use-last"]=void 0,t.tmp.sort_key_flag=!1},m.execs.push(s),i.push(m)}},e.Node.label={build:function(t,i){if(this.strings.term)this.execs.push(function(t,i,s){var r=e.evaluateLabel(this,t,i,s);s&&"locator"===this.strings.term&&(s.section_form_override=this.strings.form),r&&(t.tmp.group_context.tip.term_intended=!0),e.UPDATE_GROUP_CONTEXT_CONDITION(t,r,null,this),-1===r.indexOf("%s")&&(this.strings.capitalize_if_first&&!t.tmp.term_predecessor&&("in-text"!==t.opt.class||"citation"!==t.tmp.area)&&(r=e.Output.Formatters["capitalize-first"](t,r)),t.output.append(r,this))});else{this.strings.form||(this.strings.form="long");for(var s=t.build.names_variables[t.build.names_variables.length-1],r=t.build.name_label[t.build.name_label.length-1],n=0,a=s.length;n<a;n+=1)r[s[n]]||(r[s[n]]={});if(t.build.name_flag)for(var n=0,a=s.length;n<a;n+=1)r[s[n]].after=this;else for(var n=0,a=s.length;n<a;n+=1)r[s[n]].before=this}i.push(this)}},e.Node.layout={build:function(t,i){function s(){"bibliography"===t.build.area&&(a=new e.Token("text",e.SINGLETON),r=function(t){if(!t.tmp.parallel_and_not_last){var e=t.tmp.cite_affixes[t.tmp.area][t.tmp.last_cite_locale]?t.tmp.cite_affixes[t.tmp.area][t.tmp.last_cite_locale].suffix:t.bibliography.opt.layout_suffix,i=t.output.current.value();t.opt.using_display?i.blobs[i.blobs.length-1].strings.suffix=e:i.strings.suffix=e}t.bibliography.opt["second-field-align"]&&t.output.endTag("bib_other")},a.execs.push(r),i.push(a))}if(this.tokentype===e.START&&(this.locale_raw?t.build.current_default_locale=this.locale_raw:t.build.current_default_locale=t.opt["default-locale"],r=function(t,i,s){if(t.opt.development_extensions.apply_citation_wrapper&&t.sys.wrapCitationEntry&&!t.tmp.just_looking&&i.system_id&&"citation"===t.tmp.area){var r=new e.Token("group",e.START);r.decorations=[["@cite","entry"]],t.output.startTag("cite_entry",r),t.output.current.value().item_id=i.system_id,s&&(t.output.current.value().locator_txt=s.locator_txt,t.output.current.value().suffix_txt=s.suffix_txt)}},this.execs.push(r)),this.tokentype!==e.START||t.tmp.cite_affixes[t.build.area]||(r=function(t,e,i){if(t.tmp.done_vars=[],i&&i["author-only"]&&t.tmp.done_vars.push("locator"),t.opt.suppressedJurisdictions[e.country]&&e.country&&-1===["treaty","patent"].indexOf(e.type)&&t.tmp.done_vars.push("country"),!t.tmp.just_looking&&t.registry.registry[e.id]&&t.registry.registry[e.id].parallel&&t.tmp.done_vars.push("first-reference-note-number"),!t.tmp.just_looking&&t.tmp.abbrev_trimmer&&e.jurisdiction)for(var s in t.tmp.abbrev_trimmer.QUASHES[e.jurisdiction])t.tmp.done_vars.push(s);t.tmp.rendered_name=!1},this.execs.push(r),r=function(t){t.tmp.sort_key_flag=!1},this.execs.push(r),r=function(t){t.tmp.nameset_counter=0},this.execs.push(r),r=function(t,i){var s=new e.Token;t.output.openLevel(s)},this.execs.push(r),i.push(this),"citation"===t.build.area&&(n=new e.Token("text",e.SINGLETON),r=function(t,i,s){if(s&&s.prefix){var r=e.checkPrefixSpaceAppend(t,s.prefix);t.tmp.just_looking||(r=t.output.checkNestedBrace.update(r));var n=e.checkIgnorePredecessor(t,r);t.output.append(r,this,!1,n)}},n.execs.push(r),i.push(n))),this.locale_raw&&((l=new e.Token("dummy",e.START)).locale=this.locale_raw,l.strings.delimiter=this.strings.delimiter,l.strings.suffix=this.strings.suffix,t.tmp.cite_affixes[t.build.area]||(t.tmp.cite_affixes[t.build.area]={})),this.tokentype===e.START&&(t.build.layout_flag=!0,!this.locale_raw&&(t[t.tmp.area].opt.topdecor=[this.decorations],t[t.tmp.area+"_sort"].opt.topdecor=[this.decorations],t[t.build.area].opt.layout_prefix=this.strings.prefix,t[t.build.area].opt.layout_suffix=this.strings.suffix,t[t.build.area].opt.layout_delimiter=this.strings.delimiter,t[t.build.area].opt.layout_decorations=this.decorations,t.tmp.cite_affixes[t.build.area]&&(o=new e.Token("else",e.START),e.Node.else.build.call(o,t,i))),this.locale_raw)){if(t.build.layout_locale_flag)l.name="else-if",e.Attributes["@locale-internal"].call(l,t,this.locale_raw),e.Node["else-if"].build.call(l,t,i);else{var r,n,a,o,l,u=new e.Token("choose",e.START);e.Node.choose.build.call(u,t,i),l.name="if",e.Attributes["@locale-internal"].call(l,t,this.locale_raw),e.Node.if.build.call(l,t,i)}t.tmp.cite_affixes[t.build.area][l.locale]={},t.tmp.cite_affixes[t.build.area][l.locale].delimiter=this.strings.delimiter,t.tmp.cite_affixes[t.build.area][l.locale].suffix=this.strings.suffix}this.tokentype===e.END&&(this.locale_raw&&(s(),t.build.layout_locale_flag?(l.name="else-if",l.tokentype=e.END,e.Attributes["@locale-internal"].call(l,t,this.locale_raw),e.Node["else-if"].build.call(l,t,i)):(l.name="if",l.tokentype=e.END,e.Attributes["@locale-internal"].call(l,t,this.locale_raw),e.Node.if.build.call(l,t,i),t.build.layout_locale_flag=!0)),this.locale_raw||(s(),t.tmp.cite_affixes[t.build.area]&&t.build.layout_locale_flag&&(o=new e.Token("else",e.END),e.Node.else.build.call(o,t,i),o=new e.Token("choose",e.END),e.Node.choose.build.call(o,t,i)),t.build_layout_locale_flag=!0,"citation"===t.build.area&&(a=new e.Token("text",e.SINGLETON),r=function(t,i,s){if(s&&s.suffix){var r=e.checkSuffixSpacePrepend(t,s.suffix);t.tmp.just_looking||(r=t.output.checkNestedBrace.update(r)),t.output.append(r,this)}},a.execs.push(r),i.push(a)),r=function(t){t.output.closeLevel()},this.execs.push(r),r=function(t,e){t.opt.development_extensions.apply_citation_wrapper&&t.sys.wrapCitationEntry&&!t.tmp.just_looking&&e.system_id&&"citation"===t.tmp.area&&t.output.endTag()},this.execs.push(r),i.push(this),t.build.layout_flag=!1,t.build.layout_locale_flag=!1))}},e.Node.macro={build:function(){}},e.Node.alternative={build:function(t,i){if(this.tokentype===e.START){var s=new e.Token("choose",e.START);e.Node.choose.build.call(s,t,i);var r=new e.Token("if",e.START);e.Attributes["@alternative-node-internal"].call(r,t),e.Node.if.build.call(r,t,i);var n=function(t,i){if(t.tmp.oldItem=i,t.tmp.oldLang=t.opt.lang,t.tmp.abort_alternative=!0,i["language-name"]&&i["language-name-original"]){var s=JSON.parse(JSON.stringify(i));s.language=s["language-name"];var r=e.localeResolve(s.language,t.opt["default-locale"][0]);if(t.opt.multi_layout)for(var n in t.opt.multi_layout){var a=t.opt.multi_layout[n],o=!1;for(var l in a){var u=a[l];if(r.best===u.best||r.base===u.base||r.bare===u.bare){o=a[0].best;break}}o||(o=t.opt["default-locale"][0]),t.opt.lang=o}for(var p in s)if(-1===["id","type","language","multi"].indexOf(p)&&"alt-"!==p.slice(0,4))if(s.multi&&s.multi._keys[p]){var h=!0;for(var c in s.multi._keys[p])if(r.bare===c.replace(/^([a-zA-Z]+).*/,"$1")){h=!1;break}h&&delete s[p]}else delete s[p];for(var p in s)"alt-"===p.slice(0,4)?(s[p.slice(4)]=s[p],t.tmp.abort_alternative=!1):s.multi&&s.multi._keys&&!s["alt-"+p]&&s.multi._keys[p]&&(s.multi._keys[p][r.best]?(s[p]=s.multi._keys[p][r.best],t.tmp.abort_alternative=!1):s.multi._keys[p][r.base]?(s[p]=s.multi._keys[p][r.base],t.tmp.abort_alternative=!1):s.multi._keys[p][r.bare]&&(s[p]=s.multi._keys[p][r.bare],t.tmp.abort_alternative=!1))}t.output.openLevel(this),t.registry.refhash[i.id]=s,t.nameOutput=new e.NameOutput(t,s)};this.execs.push(n),i.push(this);var s=new e.Token("choose",e.START);e.Node.choose.build.call(s,t,i);var r=new e.Token("if",e.START);e.Attributes["@alternative-node-internal"].call(r,t);var n=function(t){t.tmp.abort_alternative=!0};r.execs.push(n),e.Node.if.build.call(r,t,i)}else if(this.tokentype===e.END){var r=new e.Token("if",e.END);e.Node.if.build.call(r,t,i);var s=new e.Token("choose",e.END);e.Node.choose.build.call(s,t,i);var n=function(t,i){t.output.closeLevel(),t.registry.refhash[i.id]=t.tmp.oldItem,t.opt.lang=t.tmp.oldLang,t.nameOutput=new e.NameOutput(t,t.tmp.oldItem),t.tmp.abort_alternative=!1};this.execs.push(n),i.push(this);var r=new e.Token("if",e.END);e.Node.if.build.call(r,t,i);var s=new e.Token("choose",e.END);e.Node.choose.build.call(s,t,i)}}},e.Node["alternative-text"]={build:function(t,i){this.tokentype===e.SINGLETON&&this.execs.push(function(t,i){var i=t.refetchItem(i.id);e.getCite.call(t,i)}),i.push(this)}},e.NameOutput=function(t,e,i){this.debug=!1,this.state=t,this.debug&&this.state.sys.print("(1)"),this.Item=e,this.item=i,this.nameset_base=0,this.etal_spec={},this._first_creator_variable=!1,this._please_chop=!1},e.NameOutput.prototype.init=function(t){this.requireMatch=t.requireMatch,this.state.tmp.term_predecessor&&(this.state.tmp.subsequent_author_substitute_ok=!1),this.nameset_offset&&(this.nameset_base=this.nameset_base+this.nameset_offset),this.nameset_offset=0,this.names=t,this.variables=t.variables,this.state.tmp.value=[],this.state.tmp.rendered_name=[],this.state.tmp.label_blob=!1,this.state.tmp.etal_node=!1,this.state.tmp.etal_term=!1;for(var e=0,i=this.variables.length;e<i;e+=1)this.Item[this.variables[e]]&&this.Item[this.variables[e]].length&&(this.state.tmp.value=this.state.tmp.value.concat(this.Item[this.variables[e]]));if(this["et-al"]=void 0,this.with=void 0,this.name=void 0,this.institutionpart={},this.state.tmp.group_context.tip.variable_attempt=!0,this.labelVariable=this.variables[0],this.state.tmp.value.length&&this.checkCommonAuthor(this.requireMatch)){for(var e in this.state.tmp.can_substitute.pop(),this.state.tmp.can_substitute.push(!0),this.variables){var s=this.state.tmp.done_vars.indexOf(this.variables[e]);s>-1&&(this.state.tmp.done_vars=this.state.tmp.done_vars.slice(0,s).concat(this.state.tmp.done_vars.slice(e+1)))}this.state.tmp.common_term_match_fail=!0,this.variables=[]}},e.NameOutput.prototype.reinit=function(t,i){if(this.requireMatch=t.requireMatch,this.labelVariable=i,this.state.tmp.can_substitute.value()){this.nameset_offset=0,this.variables=t.variables;var s=this.state.tmp.value.slice();this.state.tmp.value=[];for(var r=0,n=this.variables.length;r<n;r+=1)this.Item[this.variables[r]]&&this.Item[this.variables[r]].length&&(this.state.tmp.value=this.state.tmp.value.concat(this.Item[this.variables[r]]));this.state.tmp.value.length&&this.state.tmp.can_substitute.replace(!1,e.LITERAL),this.state.tmp.value=s}if(this.checkCommonAuthor(this.requireMatch)){for(var r in this.state.tmp.can_substitute.pop(),this.state.tmp.can_substitute.push(!0),this.variables){var a=this.state.tmp.done_vars.indexOf(this.variables[r]);a>-1&&(this.state.tmp.done_vars=this.state.tmp.done_vars.slice(0,a).concat(this.state.tmp.done_vars.slice(r+1)))}this.variables=[]}},e.NameOutput.prototype.outputNames=function(){var t,i,s=this.variables;if(this.institution.and&&(this.institution.and.single.blobs&&this.institution.and.single.blobs.length||(this.institution.and.single.blobs=this.name.and.single.blobs),this.institution.and.multiple.blobs&&this.institution.and.multiple.blobs.length||(this.institution.and.multiple.blobs=this.name.and.multiple.blobs)),this.variable_offset={},this.family)for(t=0,this.family_decor=e.Util.cloneToken(this.family),this.family_decor.strings.prefix="",this.family_decor.strings.suffix="",i=this.family.execs.length;t<i;t+=1)this.family.execs[t].call(this.family_decor,this.state,this.Item);else this.family_decor=!1;if(this.given)for(t=0,this.given_decor=e.Util.cloneToken(this.given),this.given_decor.strings.prefix="",this.given_decor.strings.suffix="",i=this.given.execs.length;t<i;t+=1)this.given.execs[t].call(this.given_decor,this.state,this.Item);else this.given_decor=!1;if(this.debug&&this.state.sys.print("(2)"),this.getEtAlConfig(),this.debug&&this.state.sys.print("(3)"),this.divideAndTransliterateNames(),this.debug&&this.state.sys.print("(4)"),this.truncatePersonalNameLists(),this.debug&&this.state.sys.print("(5)"),this.debug&&this.state.sys.print("(6)"),this.disambigNames(),this.constrainNames(),this.debug&&this.state.sys.print("(7)"),"count"===this.name.strings.form){(this.state.tmp.extension||0!=this.names_count)&&(this.state.output.append(this.names_count,"empty"),this.state.tmp.group_context.tip.variable_success=!0);return}this.debug&&this.state.sys.print("(8)"),this.setEtAlParameters(),this.debug&&this.state.sys.print("(9)"),this.setCommonTerm(this.requireMatch),this.debug&&this.state.sys.print("(10)"),this.renderAllNames(),this.debug&&this.state.sys.print("(11)");var r=[];for(t=0,i=s.length;t<i;t+=1){var n=s[t],a=[],o=!1,l=null;if(this.state.opt.development_extensions.spoof_institutional_affiliations){this.debug&&this.state.sys.print("(11a)");for(var u=0,p=this.institutions[n].length;u<p;u+=1)a.push(this.joinPersonsAndInstitutions([this.persons[n][u],this.institutions[n][u]]));if(this.debug&&this.state.sys.print("(11b)"),this.institutions[n].length){var h=this.nameset_base+this.variable_offset[n];this.freeters[n].length&&(h+=1),o=this.joinInstitutionSets(a,h)}this.debug&&this.state.sys.print("(11c)");var l=this.joinFreetersAndInstitutionSets([this.freeters[n],o]);this.debug&&this.state.sys.print("(11d)")}else l=this._join([this.freeters[n]],"");if(l&&(this.state.tmp.extension||(l=this._applyLabels(l,n)),r.push(l)),this.debug&&this.state.sys.print("(11e)"),this.common_term)break}for(this.debug&&this.state.sys.print("(12)"),this.state.output.openLevel("empty"),this.state.output.current.value().strings.delimiter=this.state.inheritOpt(this.names,"delimiter","names-delimiter"),this.debug&&this.state.sys.print("(13)"),t=0,i=r.length;t<i;t+=1)this.state.output.append(r[t],"literal",!0);!this.state.tmp.just_looking&&r.length>0&&(this.state.tmp.probably_rendered_something=!0),this.debug&&this.state.sys.print("(14)"),this.state.output.closeLevel("empty"),this.debug&&this.state.sys.print("(15)");var c=this.state.output.pop();this.state.tmp.name_node.top=c,this.debug&&this.state.sys.print("(16)");var m=e.Util.cloneToken(this.names);if(this.state.tmp.group_context.tip.condition&&e.UPDATE_GROUP_CONTEXT_CONDITION(this.state,this.names.strings.prefix,null,this.names),this.state.output.append(c,m),this.state.tmp.term_predecessor_name&&(this.state.tmp.term_predecessor=!0),this.debug&&this.state.sys.print("(17)"),this.debug&&this.state.sys.print("(18)"),"authority"!==s[0]){var f=[],d=this.Item[s[0]];if(d)for(var t=0,i=d.length;t<i;t+=1){var g=e.Util.Names.getRawName(d[t]);g&&f.push(g)}(f=f.join(", "))&&(this.state.tmp.name_node.string=f)}if(this.state.tmp.name_node.string&&!this.state.tmp.first_name_string&&(this.state.tmp.first_name_string=this.state.tmp.name_node.string),"classic"===this.Item.type&&this.state.tmp.first_name_string){var b=[];b.push(this.state.tmp.first_name_string),this.Item.title&&b.push(this.Item.title),(b=b.join(", "))&&this.state.sys.getAbbreviation&&(this.state.sys.normalizeAbbrevsKey&&(b=this.state.sys.normalizeAbbrevsKey("classic",b)),this.state.transform.loadAbbreviation("default","classic",b,this.Item.language),this.state.transform.abbrevs.default.classic[b]&&(this.state.tmp.done_vars.push("title"),this.state.output.append(this.state.transform.abbrevs.default.classic[b],"empty",!0),c=this.state.output.pop(),this.state.tmp.name_node.top.blobs.pop(),this.state.tmp.name_node.top.blobs.push(c)))}this._collapseAuthor(),this.variables=[],this.state.tmp.authority_stop_last=0,this.debug&&this.state.sys.print("(19)")},e.NameOutput.prototype._applyLabels=function(t,e){if(!this.label||!this.label[this.labelVariable])return t;var i,s=0,r=this.freeters_count[e]+this.institutions_count[e];if(r>1)s=1;else{for(var n=0,a=this.persons[e].length;n<a;n+=1)r+=this.persons_count[e][n];r>1&&(s=1)}return this.label[this.labelVariable].before?("number"==typeof this.label[this.labelVariable].before.strings.plural&&(s=this.label[this.labelVariable].before.strings.plural),i=this._buildLabel(e,s,"before",this.labelVariable),this.state.output.openLevel("empty"),this.state.output.append(i,this.label[this.labelVariable].before,!0),this.state.output.append(t,"literal",!0),this.state.output.closeLevel("empty"),t=this.state.output.pop()):this.label[this.labelVariable].after&&("number"==typeof this.label[this.labelVariable].after.strings.plural&&(s=this.label[this.labelVariable].after.strings.plural),i=this._buildLabel(e,s,"after",this.labelVariable),this.state.output.openLevel("empty"),this.state.output.append(t,"literal",!0),this.state.output.append(i,this.label[this.labelVariable].after,!0),this.state.tmp.label_blob=this.state.output.pop(),this.state.output.append(this.state.tmp.label_blob,"literal",!0),this.state.output.closeLevel("empty"),t=this.state.output.pop()),t},e.NameOutput.prototype._buildLabel=function(t,i,s,r){this.common_term&&(t=this.common_term);var n=!1,a=this.label[r][s];return a&&(n=e.castLabel(this.state,a,t,i,e.TOLERANT)),n},e.NameOutput.prototype._collapseAuthor=function(){var t,e,i;0!==this.state.tmp.name_node.top.blobs.length&&(0===this.nameset_base&&this.Item[this.variables[0]]&&!this._first_creator_variable&&(this._first_creator_variable=this.variables[0]),(this.state[this.state.tmp.area].opt.collapse&&this.state[this.state.tmp.area].opt.collapse.length||this.state[this.state.tmp.area].opt.cite_group_delimiter&&this.state[this.state.tmp.area].opt.cite_group_delimiter.length)&&(this.state.tmp.authorstring_request?(e="",t=this.state.tmp.name_node.top.blobs.slice(-1)[0].blobs,i=this.state.tmp.offset_characters,t&&(e=this.state.output.string(this.state,t,!1)),this.state.tmp.offset_characters=i,this.state.registry.authorstrings[this.Item.id]=e):!this.state.tmp.just_looking&&!this.state.tmp.suppress_decorations&&(this.state[this.state.tmp.area].opt.collapse&&this.state[this.state.tmp.area].opt.collapse.length||this.state[this.state.tmp.area].opt.cite_group_delimiter&&this.state[this.state.tmp.area].opt.cite_group_delimiter)&&(e="",t=this.state.tmp.name_node.top.blobs.slice(-1)[0].blobs,i=this.state.tmp.offset_characters,t&&(e=this.state.output.string(this.state,t,!1)),e===this.state.tmp.last_primary_names_string?((this.item["suppress-author"]||this.state[this.state.tmp.area].opt.collapse&&this.state[this.state.tmp.area].opt.collapse.length)&&(this.state.tmp.name_node.top.blobs.pop(),this.state.tmp.name_node.children=[],this.state.tmp.offset_characters=i),this.state[this.state.tmp.area].opt.cite_group_delimiter&&this.state[this.state.tmp.area].opt.cite_group_delimiter&&(this.state.tmp.use_cite_group_delimiter=!0)):(this.state.tmp.last_primary_names_string=e,this.variables.indexOf(this._first_creator_variable)>-1&&this.item&&this.item["suppress-author"]&&"legal_case"!==this.Item.type&&(this.state.tmp.name_node.top.blobs.pop(),this.state.tmp.name_node.children=[],this.state.tmp.offset_characters=i,this.state.tmp.term_predecessor=!1),this.state.tmp.have_collapsed=!1,this.state[this.state.tmp.area].opt.cite_group_delimiter&&this.state[this.state.tmp.area].opt.cite_group_delimiter&&(this.state.tmp.use_cite_group_delimiter=!1)))))},e.NameOutput.prototype.isPerson=function(t){return!t.literal&&(!!t.given||!t.family||!t.isInstitution)},e.NameOutput.prototype.truncatePersonalNameLists=function(){var t,e,i,s,r,n;for(t in this.freeters_count={},this.persons_count={},this.institutions_count={},this.freeters)this.freeters.hasOwnProperty(t)&&(this.freeters_count[t]=this.freeters[t].length,this.freeters[t]=this._truncateNameList(this.freeters,t));for(t in this.persons)if(this.persons.hasOwnProperty(t))for(this.institutions_count[t]=this.institutions[t].length,this._truncateNameList(this.institutions,t),this.persons[t]=this.persons[t].slice(0,this.institutions[t].length),this.persons_count[t]=[],s=0,r=this.persons[t].length;s<r;s+=1)this.persons_count[t][s]=this.persons[t][s].length,this.persons[t][s]=this._truncateNameList(this.persons,t,s);if((n=!!this.state.opt.development_extensions.etal_min_etal_usefirst_hack&&1===this.etal_min&&1===this.etal_use_first&&!this.state.tmp.extension&&!this.state.tmp.just_looking&&t)||this._please_chop)for(e=0,i=this.variables.length;e<i;e+=1){t=this.variables[e],this.freeters[t].length&&(this._please_chop===t?(this.freeters[t]=this.freeters[t].slice(1),this.freeters_count[t]+=-1,this._please_chop=!1):n&&!this._please_chop&&(this.freeters[t]=this.freeters[t].slice(0,1),this.freeters_count[t]=1,this.institutions[t]=[],this.persons[t]=[],this._please_chop=n));for(var s=0,r=this.persons[t].length;s<r;s++)if(this.persons[t][s].length){if(this._please_chop===t){this.persons[t][s]=this.persons[t][s].slice(1),this.persons_count[t][s]+=-1,this._please_chop=!1;break}else if(n&&!this._please_chop){this.freeters[t]=this.persons[t][s].slice(0,1),this.freeters_count[t]=1,this.institutions[t]=[],this.persons[t]=[],this._please_chop=n;break}}this.institutions[t].length&&(this._please_chop===t?(this.institutions[t]=this.institutions[t].slice(1),this.institutions_count[t]+=-1,this._please_chop=!1):n&&!this._please_chop&&(this.institutions[t]=this.institutions[t].slice(0,1),this.institutions_count[t]=1,this._please_chop=n))}for(e=0,i=this.variables.length;e<i;e+=1){this.institutions[t].length&&(this.nameset_offset+=1);for(var s=0,r=this.persons[t].length;s<r;s++)this.persons[t][s].length&&(this.nameset_offset+=1)}},e.NameOutput.prototype._truncateNameList=function(t,e,i){var s;if(s=void 0===i?t[e]:t[e][i],this.state[this.state[this.state.tmp.area].root].opt.max_number_of_names&&s.length>50&&s.length>this.state[this.state[this.state.tmp.area].root].opt.max_number_of_names+2){var r=this.state[this.state[this.state.tmp.area].root].opt.max_number_of_names;s=s.slice(0,r+1).concat(s.slice(-1))}return s},e.NameOutput.prototype.divideAndTransliterateNames=function(){var t,e,i,s,r=this.Item,n=this.variables;for(t=0,this.varnames=n.slice(),this.freeters={},this.persons={},this.institutions={},e=n.length;t<e;t+=1){var a=n[t];this.variable_offset[a]=this.nameset_offset;var o=this._normalizeVariableValue(r,a);if(this.name.strings["suppress-min"]&&o.length>=this.name.strings["suppress-min"]&&(o=[]),this.name.strings["suppress-max"]&&o.length<=this.name.strings["suppress-max"]&&(o=[]),this._getFreeters(a,o),this._getPersonsAndInstitutions(a,o),this.state.opt.development_extensions.spoof_institutional_affiliations){if(0===this.name.strings["suppress-min"])for(i=0,this.freeters[a]=[],s=this.persons[a].length;i<s;i+=1)this.persons[a][i]=[];else if(0===this.institution.strings["suppress-min"]){for(i=0,this.institutions[a]=[],this.freeters[a]=this.freeters[a].concat(this.persons[a]),s=this.persons[a].length;i<s;i+=1)for(var l=0,u=this.persons[a][i].length;l<u;l+=1)this.freeters[a].push(this.persons[a][i][l]);this.persons[a]=[]}}}},e.NameOutput.prototype._normalizeVariableValue=function(t,i){var s;return"string"==typeof t[i]||"number"==typeof t[i]?(e.debug('name variable "'+i+'" is string or number, not array. Attempting to fix.'),s=[{literal:t[i]+""}]):t[i]?("number"!=typeof t[i].length&&(e.debug('name variable "'+i+'" is object, not array. Attempting to fix.'),t[i]=[t[i]]),s=t[i].slice()):s=[],s},e.NameOutput.prototype._getFreeters=function(t,e){if(this.freeters[t]=[],this.state.opt.development_extensions.spoof_institutional_affiliations)for(var i=e.length-1;i>-1;i--)if(this.isPerson(e[i])){var s=this._checkNickname(e.pop());s&&this.freeters[t].push(s)}else break;else for(var i=e.length-1;i>-1;i--){var s=e.pop();if(this.isPerson(s))var s=this._checkNickname(s);this.freeters[t].push(s)}this.freeters[t].reverse(),this.freeters[t].length&&(this.nameset_offset+=1)},e.NameOutput.prototype._getPersonsAndInstitutions=function(t,e){if(this.persons[t]=[],this.institutions[t]=[],this.state.opt.development_extensions.spoof_institutional_affiliations){for(var i=[],s=!1,r=!0,n=e.length-1;n>-1;n+=-1)if(this.isPerson(e[n])){var a=this._checkNickname(e[n]);a&&i.push(a)}else s=!0,this.institutions[t].push(e[n]),r||(i.reverse(),this.persons[t].push(i),i=[]),r=!1;s&&(i.reverse(),this.persons[t].push(i),this.persons[t].reverse(),this.institutions[t].reverse())}},e.NameOutput.prototype._clearValues=function(t){for(var e=t.length-1;e>-1;e+=-1)t.pop()},e.NameOutput.prototype._checkNickname=function(t){if(["interview","personal_communication"].indexOf(this.Item.type)>-1){var i="";if((i=e.Util.Names.getRawName(t))&&this.state.sys.getAbbreviation&&!(this.item&&this.item["suppress-author"])){var s=i;this.state.sys.normalizeAbbrevsKey&&(s=this.state.sys.normalizeAbbrevsKey("author",i)),this.state.transform.loadAbbreviation("default","nickname",s,this.Item.language);var r=this.state.transform.abbrevs.default.nickname[s];r&&(t="!here>>>"!==r&&{family:r,given:""})}}return t},e.NameOutput.prototype._purgeEmptyBlobs=function(t){for(var e=t.length-1;e>-1;e+=-1)t[e]&&0!==t[e].length&&t[e].blobs.length||(t=t.slice(0,e).concat(t.slice(e+1)));return t},e.NameOutput.prototype.joinPersons=function(t,e,i,s){var r;return t=this._purgeEmptyBlobs(t),s||(s="name"),void 0===i?1===this.etal_spec[e].freeters?this._joinEtAl(t):2===this.etal_spec[e].freeters?this._joinEllipsis(t):this.state.tmp.sort_key_flag?this._join(t,this.state.inheritOpt(this.name,"delimiter","name-delimiter",", ")):this._joinAnd(t):1===this.etal_spec[e].persons[i]?this._joinEtAl(t):2===this.etal_spec[e].persons[i]?this._joinEllipsis(t):this.state.tmp.sort_key_flag?this._join(t,this.state.inheritOpt(this.name,"delimiter","name-delimiter",", ")):this._joinAnd(t)},e.NameOutput.prototype.joinInstitutionSets=function(t,e){var i;return t=this._purgeEmptyBlobs(t),1===this.etal_spec[e].institutions?this._joinEtAl(t,"institution"):2===this.etal_spec[e].institutions?this._joinEllipsis(t,"institution"):this._joinAnd(t)},e.NameOutput.prototype.joinPersonsAndInstitutions=function(t){t=this._purgeEmptyBlobs(t);var e=this._join(t,this.state.tmp.name_delimiter);return e.isInstitution=!0,e},e.NameOutput.prototype.joinFreetersAndInstitutionSets=function(t){return t=this._purgeEmptyBlobs(t),this._join(t,"[never here]",this.with.single,this.with.multiple)},e.NameOutput.prototype._getAfterInvertedName=function(t,e,i){if(i&&t.length>1&&"after-inverted-name"===this.state.inheritOpt(this.name,"delimiter-precedes-last")){var s=t[t.length-2];s.blobs.length>0&&s.blobs[0].isInverted&&(i.strings.prefix=e)}return i},e.NameOutput.prototype._getAndJoin=function(t,e){var i=!1;if(t.length>1){var s="single";t.length>2&&(s="multiple"),i=JSON.parse(JSON.stringify(i=t[t.length-1].isInstitution?this.institution.and[s]:this.name.and[s])),i=this._getAfterInvertedName(t,e,i)}return i},e.NameOutput.prototype._joinEtAl=function(t){var e=this.state.inheritOpt(this.name,"delimiter","name-delimiter",", "),i=this._join(t,e);return this.state.output.openLevel(this._getToken("name")),this.state.output.current.value().strings.delimiter="",this.state.output.append(i,"literal",!0),t.length>1?this.state.output.append(this["et-al"].multiple,"literal",!0):1===t.length&&this.state.output.append(this["et-al"].single,"literal",!0),this.state.output.closeLevel(),this.state.output.pop()},e.NameOutput.prototype._joinEllipsis=function(t){var e=this.state.inheritOpt(this.name,"delimiter","name-delimiter",", "),i=!1;if(t.length>1){var s="single";t.length>2&&(s="multiple"),i=JSON.parse(JSON.stringify(this.name.ellipsis[s])),i=this._getAfterInvertedName(t,e,i)}return this._join(t,e,i)},e.NameOutput.prototype._joinAnd=function(t){var e=this.state.inheritOpt(this.name,"delimiter","name-delimiter",", "),i=this._getAndJoin(t,e);return this._join(t,e,i)},e.NameOutput.prototype._join=function(t,e,i){var s,r;if(!t||!(t=this._purgeEmptyBlobs(t)).length)return!1;if(t.length>1)if(2===t.length)i?t=[t[0],i,t[1]]:t[0].strings.suffix+=e;else{for(var n=+!!i,a=t.pop(),s=0,r=t.length-n;s<r;s++)t[s].strings.suffix+=e;t.push(i),t.push(a)}for(this.state.output.openLevel(),s=0,r=t.length;s<r;s+=1)this.state.output.append(t[s],!1,!0);return this.state.output.closeLevel(),this.state.output.pop()},e.NameOutput.prototype._getToken=function(t){var i=this[t];return"institution"===t?new e.Token:i},e.NameOutput.prototype.checkCommonAuthor=function(t){if(!t)return!1;var e=!1;if(2===this.variables.length){var i=this.variables.slice();i.sort(),e=i.join("")}if(!e)return!1;var s=!1;if(this.state.locale[this.state.opt.lang].terms[e]&&(s=!0),!s)return this.state.tmp.done_vars.push(this.variables[0]),this.state.tmp.done_vars.push(this.variables[1]),!1;var r=this.Item[this.variables[0]],n=this.Item[this.variables[1]],a=this._compareNamesets(r,n);return!0===a&&(this.state.tmp.done_vars.push(this.variables[0]),this.state.tmp.done_vars.push(this.variables[1])),!a},e.NameOutput.prototype.setCommonTerm=function(){var t=this.variables.slice();if(t.sort(),this.common_term=t.join(""),this.common_term){var e=!1;if(this.label&&this.label[this.variables[0]]&&(this.label[this.variables[0]].before?e=this.state.getTerm(this.common_term,this.label[this.variables[0]].before.strings.form,0):this.label[this.variables[0]].after&&(e=this.state.getTerm(this.common_term,this.label[this.variables[0]].after.strings.form,0))),!this.state.locale[this.state.opt.lang].terms[this.common_term]||!e||this.variables.length<2){this.common_term=!1;return}for(var i=0,s=this.variables.length-1;i<s;i+=1){var r=this.variables[i],n=this.variables[i+1];if((this.freeters[r].length||this.freeters[n].length)&&(this.etal_spec[r].freeters!==this.etal_spec[n].freeters||!this._compareNamesets(this.freeters[r],this.freeters[n]))||this.persons[r].length!==this.persons[n].length){this.common_term=!1;return}for(var a=0,o=this.persons[r].length;a<o;a+=1)if(this.etal_spec[r].persons[a]!==this.etal_spec[n].persons[a]||!this._compareNamesets(this.persons[r][a],this.persons[n][a])){this.common_term=!1;return}}}},e.NameOutput.prototype._compareNamesets=function(t,i){if(!t||!i||t.length!==i.length)return!1;for(var s=0,r=i.length;s<r;s+=1)for(var n=0,a=e.NAME_PARTS.length;n<a;n+=1){var o=e.NAME_PARTS[n];if(!t[s]||t[s][o]!=i[s][o])return!1}return!0},e.NameOutput.prototype.constrainNames=function(){this.names_count=0;for(var t,e=0,i=this.variables.length;e<i;e+=1){var s=this.variables[e];t=this.nameset_base+e,this.freeters[s].length&&(this.state.tmp.names_max.push(this.freeters[s].length,"literal"),this._imposeNameConstraints(this.freeters,this.freeters_count,s,t),this.names_count+=this.freeters[s].length),this.institutions[s].length&&(this.state.tmp.names_max.push(this.institutions[s].length,"literal"),this._imposeNameConstraints(this.institutions,this.institutions_count,s,t),this.persons[s]=this.persons[s].slice(0,this.institutions[s].length),this.names_count+=this.institutions[s].length);for(var r=0,n=this.persons[s].length;r<n;r+=1)this.persons[s][r].length&&(this.state.tmp.names_max.push(this.persons[s][r].length,"literal"),this._imposeNameConstraints(this.persons[s],this.persons_count[s],r,t),this.names_count+=this.persons[s][r].length)}},e.NameOutput.prototype._imposeNameConstraints=function(t,e,i,s){var r=t[i],n=this.state.tmp["et-al-min"];this.state.tmp.suppress_decorations?this.state.tmp.disambig_request&&this.state.tmp.disambig_request.names[s]?n=this.state.tmp.disambig_request.names[s]:e[i]>=this.etal_min&&(n=this.etal_use_first):(this.state.tmp.disambig_request&&this.state.tmp.disambig_request.names[s]>this.etal_use_first?n=e[i]<this.etal_min?e[i]:this.state.tmp.disambig_request.names[s]:e[i]>=this.etal_min&&(n=this.etal_use_first),this.etal_use_last&&n>this.etal_min-2&&(n=this.etal_min-2));var a=this.etal_min>=this.etal_use_first,o=e[i]>n;n>e[i]&&(n=r.length),a&&o&&(this.etal_use_last?t[i]=r.slice(0,n).concat(r.slice(-1)):t[i]=r.slice(0,n)),this.state.tmp.disambig_settings.names[s]=t[i].length,this.state.disambiguate.padBase(this.state.tmp.disambig_settings)},e.NameOutput.prototype.disambigNames=function(){for(var t,e=0,i=this.variables.length;e<i;e+=1){var s=this.variables[e];if(t=this.nameset_base+e,this.freeters[s].length&&this._runDisambigNames(this.freeters[s],t),this.institutions[s].length){void 0===this.state.tmp.disambig_settings.givens[t]&&(this.state.tmp.disambig_settings.givens[t]=[]);for(var r=0,n=this.institutions[s].length;r<n;r+=1)void 0===this.state.tmp.disambig_settings.givens[t][r]&&this.state.tmp.disambig_settings.givens[t].push(2)}for(var r=0,n=this.persons[s].length;r<n;r+=1)this.persons[s][r].length&&this._runDisambigNames(this.persons[s][r],t)}},e.NameOutput.prototype._runDisambigNames=function(t,i){var s,r,n,a,o,l,u;for(o=0,l=t.length;o<l;o+=1)if(t[o].given||t[o].family){if(n=this.state.inheritOpt(this.name,"initialize-with"),this.state.registry.namereg.addname(""+this.Item.id,t[o],o),void 0===this.state.tmp.disambig_settings.givens[i])for(var p=0,h=i+1;p<h;p+=1)this.state.tmp.disambig_settings.givens[p]||(this.state.tmp.disambig_settings.givens[p]=[]);if(void 0===this.state.tmp.disambig_settings.givens[i][o]&&(r=this.state.inheritOpt(this.name,"form","name-form","long"),a=this.state.registry.namereg.evalname(""+this.Item.id,t[o],o,0,r,n),this.state.tmp.disambig_settings.givens[i].push(a)),r=this.state.inheritOpt(this.name,"form","name-form","long"),u=this.state.registry.namereg.evalname(""+this.Item.id,t[o],o,0,r,n),this.state.tmp.disambig_request){var c=this.state.tmp.disambig_settings.givens[i][o];1===c&&"by-cite"===this.state.citation.opt["givenname-disambiguation-rule"]&&(void 0===this.state.inheritOpt(this.name,"initialize-with")||void 0===t[o].given)&&(c=2),a=c,this.state.opt["disambiguate-add-givenname"]&&t[o].given&&(a=this.state.registry.namereg.evalname(""+this.Item.id,t[o],o,a,this.state.inheritOpt(this.name,"form","name-form","long"),this.state.inheritOpt(this.name,"initialize-with")))}else a=u;!this.state.tmp.just_looking&&this.item&&this.item.position===e.POSITION_FIRST&&u>a&&(a=u),this.state.tmp.sort_key_flag||(this.state.tmp.disambig_settings.givens[i][o]=a,"string"==typeof n&&(void 0===this.name.strings.initialize||!0===this.name.strings.initialize)&&(this.state.tmp.disambig_settings.use_initials=!0))}},e.NameOutput.prototype.getEtAlConfig=function(){var t=this.item;this["et-al"]={},this.state.output.append(this.etal_term,this.etal_style,!0),this["et-al"].single=this.state.output.pop(),this["et-al"].single.strings.suffix=this.etal_suffix,this["et-al"].single.strings.prefix=this.etal_prefix_single,this.state.output.append(this.etal_term,this.etal_style,!0),this["et-al"].multiple=this.state.output.pop(),this["et-al"].multiple.strings.suffix=this.etal_suffix,this["et-al"].multiple.strings.prefix=this.etal_prefix_multiple,void 0===t&&(t={}),t.position?(this.state.inheritOpt(this.name,"et-al-subsequent-min")?this.etal_min=this.state.inheritOpt(this.name,"et-al-subsequent-min"):this.etal_min=this.state.inheritOpt(this.name,"et-al-min"),this.state.inheritOpt(this.name,"et-al-subsequent-use-first")?this.etal_use_first=this.state.inheritOpt(this.name,"et-al-subsequent-use-first"):this.etal_use_first=this.state.inheritOpt(this.name,"et-al-use-first")):(this.state.tmp["et-al-min"]?this.etal_min=this.state.tmp["et-al-min"]:this.etal_min=this.state.inheritOpt(this.name,"et-al-min"),this.state.tmp["et-al-use-first"]?this.etal_use_first=this.state.tmp["et-al-use-first"]:this.etal_use_first=this.state.inheritOpt(this.name,"et-al-use-first"),"boolean"==typeof this.state.tmp["et-al-use-last"]?this.etal_use_last=this.state.tmp["et-al-use-last"]:this.etal_use_last=this.state.inheritOpt(this.name,"et-al-use-last")),this.state.tmp["et-al-min"]||(this.state.tmp["et-al-min"]=this.etal_min)},e.NameOutput.prototype.setEtAlParameters=function(){var t,e,i,s;for(t=0,e=this.variables.length;t<e;t+=1){var r=this.variables[t];for(void 0===this.etal_spec[r]&&(this.etal_spec[r]={freeters:0,institutions:0,persons:[]}),this.etal_spec[this.nameset_base+t]=this.etal_spec[r],this.freeters[r].length&&this._setEtAlParameter("freeters",r),i=0,s=this.persons[r].length;i<s;i+=1)void 0===this.etal_spec[r][i]&&(this.etal_spec[r].persons[i]=0),this._setEtAlParameter("persons",r,i);this.institutions[r].length&&this._setEtAlParameter("institutions",r)}},e.NameOutput.prototype._setEtAlParameter=function(t,e,i){var s,r;"persons"===t?(s=this.persons[e][i],r=this.persons_count[e][i]):(s=this[t][e],r=this[t+"_count"][e]),s.length<r&&!this.state.tmp.sort_key_flag?this.etal_use_last?"persons"===t?this.etal_spec[e].persons[i]=2:this.etal_spec[e][t]=2:"persons"===t?this.etal_spec[e].persons[i]=1:this.etal_spec[e][t]=1:"persons"===t?this.etal_spec[e].persons[i]=0:this.etal_spec[e][t]=0},e.NameOutput.prototype.renderAllNames=function(){for(var t,e=0,i=this.variables.length;e<i;e+=1){var s=this.variables[e];(this.freeters[s].length||this.institutions[s].length)&&!this.state.tmp.group_context.tip.condition&&(this.state.tmp.just_did_number=!1),t=this.nameset_base+e,this.freeters[s].length&&(this.freeters[s]=this._renderNames(s,this.freeters[s],t));for(var r=0,n=this.institutions[s].length;r<n;r+=1)this.persons[s][r]=this._renderNames(s,this.persons[s][r],t,r)}this.renderInstitutionNames()},e.NameOutput.prototype.renderInstitutionNames=function(){for(var t=0,e=this.variables.length;t<e;t+=1)for(var i=this.variables[t],s=0,r=this.institutions[i].length;s<r;s+=1){var n,s,r,a,o=this.institutions[i][s];a=this.state.tmp.extension?["sort"]:o.isInstitution||o.literal?this.state.opt["cite-lang-prefs"].institutions:this.state.opt["cite-lang-prefs"].persons;var l={primary:"locale-orig",secondary:!1,tertiary:!1};if(a)for(var u=["primary","secondary","tertiary"],p=0,h=u.length;p<h&&!(a.length-1<p);p+=1)a[p]&&(l[u[p]]="locale-"+a[p]);else l.primary="locale-translat";"bibliography"===this.state.tmp.area||"citation"===this.state.tmp.area&&"note"===this.state.opt.xclass&&this.item&&!this.item.position||(l.secondary=!1,l.tertiary=!1),this.setRenderedName(o);var n=this._renderInstitutionName(i,o,l,s);this.institutions[i][s]=n}},e.NameOutput.prototype._renderInstitutionName=function(t,e,i,s){var r,n,a,o,l,u,p,h=this.getName(e,i.primary,!0),c=h.name,m=h.usedOrig;if(c&&(c=this.fixupInstitution(c,t,s)),r=!1,i.secondary){var r=(h=this.getName(e,i.secondary,!1,m)).name;m=h.usedOrig,r&&(r=this.fixupInstitution(r,t,s))}n=!1,i.tertiary&&(n=(h=this.getName(e,i.tertiary,!1,m)).name)&&(n=this.fixupInstitution(n,t,s));var f={l:{pri:!1,sec:!1,ter:!1},s:{pri:!1,sec:!1,ter:!1}};switch(c&&(f.l.pri=c.long,f.s.pri=c.short.length?c.short:c.long),r&&(f.l.sec=r.long,f.s.sec=r.short.length?r.short:r.long),n&&(f.l.ter=n.long,f.s.ter=n.short.length?n.short:n.long),this.institution.strings["institution-parts"]){case"short":c.short.length?(o=this._getShortStyle(),l=[this._composeOneInstitutionPart([f.s.pri,f.s.sec,f.s.ter],i,o,t)]):(a=this._getLongStyle(c,t,s),l=[this._composeOneInstitutionPart([f.l.pri,f.l.sec,f.l.ter],i,a,t)]);break;case"short-long":a=this._getLongStyle(c,t,s),o=this._getShortStyle(),l=[u=this._renderOneInstitutionPart(c.short,o),this._composeOneInstitutionPart([f.l.pri,f.l.sec,f.l.ter],i,a,t)];break;case"long-short":a=this._getLongStyle(c,t,s),o=this._getShortStyle(),u=this._renderOneInstitutionPart(c.short,o),l=[this._composeOneInstitutionPart([f.l.pri,f.l.sec,f.l.ter],i,a,t),u];break;default:a=this._getLongStyle(c,t,s),l=[this._composeOneInstitutionPart([f.l.pri,f.l.sec,f.l.ter],i,a,t)]}var d=this._join(l," ");return d&&(d.isInstitution=!0),this.state.tmp.name_node.children.push(d),d},e.NameOutput.prototype._composeOneInstitutionPart=function(t,i,s){var r,n,a,o,l=!1,u=!1,p=!1;if(t[0]){if(n=e.Util.cloneToken(s),this.state.opt.citeAffixes[i.primary]&&"<i>"===this.state.opt.citeAffixes.institutions[i.primary].prefix){for(var h=!1,c=0,m=n.decorations.length;c<m;c+=1)"@font-style"===s.decorations[c][0]&&"italic"===n.decorations[c][1]&&(h=!0);h||n.decorations.push(["@font-style","italic"])}l=this._renderOneInstitutionPart(t[0],n)}if(t[1]&&(u=this._renderOneInstitutionPart(t[1],s)),t[2]&&(p=this._renderOneInstitutionPart(t[2],s)),u||p){this.state.output.openLevel("empty"),this.state.output.append(l),a=e.Util.cloneToken(s),i.secondary&&(a.strings.prefix=this.state.opt.citeAffixes.institutions[i.secondary].prefix,a.strings.suffix=this.state.opt.citeAffixes.institutions[i.secondary].suffix,a.strings.prefix||(a.strings.prefix=" "));var f=new e.Token;f.decorations.push(["@font-style","normal"]),f.decorations.push(["@font-weight","normal"]),this.state.output.openLevel(f),this.state.output.append(u,a),this.state.output.closeLevel(),o=e.Util.cloneToken(s),i.tertiary&&(o.strings.prefix=this.state.opt.citeAffixes.institutions[i.tertiary].prefix,o.strings.suffix=this.state.opt.citeAffixes.institutions[i.tertiary].suffix,o.strings.prefix||(o.strings.prefix=" "));var d=new e.Token;d.decorations.push(["@font-style","normal"]),d.decorations.push(["@font-weight","normal"]),this.state.output.openLevel(d),this.state.output.append(p,o),this.state.output.closeLevel(),this.state.output.closeLevel(),r=this.state.output.pop()}else r=l;return r},e.NameOutput.prototype._renderOneInstitutionPart=function(t,i){for(var s=0,r=t.length;s<r;s+=1)if(t[s]){var n=t[s];if(this.state.tmp.strip_periods)n=n.replace(/\./g,"");else for(var a=0,o=i.decorations.length;a<o;a+=1)if("@strip-periods"===i.decorations[a][0]&&"true"===i.decorations[a][1]){n=n.replace(/\./g,"");break}this.state.tmp.group_context.tip.variable_success=!0,this.state.tmp.can_substitute.replace(!1,e.LITERAL),"!here>>>"===n?t[s]=!1:(this.state.output.append(n,i,!0),t[s]=this.state.output.pop())}return void 0===this.institution.strings["part-separator"]&&(this.institution.strings["part-separator"]=this.state.tmp.name_delimiter),this._join(t,this.institution.strings["part-separator"])},e.NameOutput.prototype._renderNames=function(t,i,s,r){var n=!1;if(i.length){for(var a=[],o=0,l=i.length;o<l;o+=1){var n,u,p=i[o];u=this.state.tmp.extension?["sort"]:p.isInstitution||p.literal?this.state.opt["cite-lang-prefs"].institutions:this.state.opt["cite-lang-prefs"].persons;var h={primary:"locale-orig",secondary:!1,tertiary:!1};if(u)for(var c=["primary","secondary","tertiary"],m=0,f=c.length;m<f&&!(u.length-1<m);m+=1)h[c[m]]="locale-"+u[m];else h.primary="locale-translat";if((this.state.tmp.sort_key_flag||"bibliography"!==this.state.tmp.area&&!("citation"===this.state.tmp.area&&"note"===this.state.opt.xclass&&this.item&&!this.item.position))&&(h.secondary=!1,h.tertiary=!1),this.setRenderedName(p),p.literal||p.isInstitution)a.push(this._renderInstitutionName(t,p,h,r));else{var d=this._renderPersonalName(t,p,h,s,o,r),g=e.Util.cloneToken(this.name);this.state.output.append(d,g,!0),a.push(this.state.output.pop())}}n=this.joinPersons(a,s,r)}return n},e.NameOutput.prototype._renderPersonalName=function(t,i,s,r,n,a){var o,l=this.getName(i,s.primary,!0),u=this._renderOnePersonalName(l.name,r,n,a),p=!1;s.secondary&&(l=this.getName(i,s.secondary,!1,l.usedOrig)).name&&(p=this._renderOnePersonalName(l.name,r,n,a));var h=!1;if(s.tertiary&&(l=this.getName(i,s.tertiary,!1,l.usedOrig)).name&&(h=this._renderOnePersonalName(l.name,r,n,a)),p||h){this.state.output.openLevel("empty"),this.state.output.append(u);var c=new e.Token;s.secondary&&(c.strings.prefix=this.state.opt.citeAffixes.persons[s.secondary].prefix,c.strings.suffix=this.state.opt.citeAffixes.persons[s.secondary].suffix,c.strings.prefix||(c.strings.prefix=" ")),this.state.output.append(p,c);var m=new e.Token;s.tertiary&&(m.strings.prefix=this.state.opt.citeAffixes.persons[s.tertiary].prefix,m.strings.suffix=this.state.opt.citeAffixes.persons[s.tertiary].suffix,m.strings.prefix||(m.strings.prefix=" ")),this.state.output.append(h,m),this.state.output.closeLevel(),o=this.state.output.pop()}else o=u;return o},e.NameOutput.prototype._isRomanesque=function(t){var i,s=2;return t.family.replace(/\"/g,"").match(e.ROMANESQUE_REGEXP)||(s=0),!s&&t.given&&t.given.match(e.STARTSWITH_ROMANESQUE_REGEXP)&&(s=1),2==s&&(t.multi&&t.multi.main?i=t.multi.main.slice(0,2):this.Item.language&&(i=this.Item.language.slice(0,2)),["ja","zh"].indexOf(i)>-1&&(s=1)),s},e.NameOutput.prototype._renderOnePersonalName=function(t,i,s,r){var n=this._droppingParticle(t,i,r),a=this._familyName(t),o=this._nonDroppingParticle(t),l=this._givenName(t,i,s),u=l.blob,p=this._nameSuffix(t);!1===u&&(n=!1,p=!1);var h=this.state.inheritOpt(this.name,"sort-separator");h||(h=""),f=t["comma-suffix"]?", ":" ";var c=this._isRomanesque(t),m=function t(e){return!!e&&("string"!=typeof e.blobs?t(e.blobs[e.blobs.length-1]):!!(["’","'","-"," "].indexOf(e.blobs.slice(-1))>-1)||!1)}(o);if(d=["fr","ru","cs"].indexOf(this.state.opt["default-locale"][0].slice(0,2))>-1?"\xa0":" ",0===c)g=this._join([o,a,u],"");else if(1===c||t["static-ordering"])b=this._join([o,a],d),g=this._join([b,u]," ");else if(t["reverse-ordering"])b=this._join([o,a],d),g=this._join([u,b]," ");else if(this.state.tmp.sort_key_flag)"never"===this.state.opt["demote-non-dropping-particle"]?(b=this._join([o,a],d),b=this._join([b,n]," "),b=this._join([b,u],this.state.opt.sort_sep)):(v=this._join([u,n,o]," "),b=this._join([a,v],this.state.opt.sort_sep)),g=this._join([b,p]," ");else if("all"===this.state.inheritOpt(this.name,"name-as-sort-order")||"first"===this.state.inheritOpt(this.name,"name-as-sort-order")&&0===s&&(0===r||void 0===r))["Lord","Lady"].indexOf(t.given)>-1&&(h=", "),["always","display-and-sort"].indexOf(this.state.opt["demote-non-dropping-particle"])>-1?(v=this._join([u,n],t["comma-dropping-particle"]+" "),(v=this._join([v,o]," "))&&this.given&&(v.strings.prefix=this.given.strings.prefix,v.strings.suffix=this.given.strings.suffix),a&&this.family&&(a.strings.prefix=this.family.strings.prefix,a.strings.suffix=this.family.strings.suffix),b=this._join([a,v],h)):((_=m?this._join([o,a],""):this._join([o,a],d))&&this.family&&(_.strings.prefix=this.family.strings.prefix,_.strings.suffix=this.family.strings.suffix),(v=this._join([u,n],t["comma-dropping-particle"]+" "))&&this.given&&(v.strings.prefix=this.given.strings.prefix,v.strings.suffix=this.given.strings.suffix),b=this._join([_,v],h)),(g=this._join([b,p],h)).isInverted=!0;else{if(t["dropping-particle"]&&t.family&&!t["non-dropping-particle"]){var f,d,g,b,_,v,y,x=t["dropping-particle"];["'","ʼ","’","-"].indexOf(x.slice(-1))>-1&&"de"!==x.slice(0,-1)&&(a=this._join([n,a],""),n=!1)}m?(v=this._join([o,a],""),v=this._join([n,v],d)):v=this._join([n,o,a],d),(v=this._join([v,p],f))&&this.family&&(v.strings.prefix=this.family.strings.prefix,v.strings.suffix=this.family.strings.suffix),u&&this.given&&(u.strings.prefix=this.given.strings.prefix,u.strings.suffix=this.given.strings.suffix),v.strings.prefix&&(t["comma-dropping-particle"]=""),y=this.state.inheritOpt(this.name,"initialize-with")&&this.state.inheritOpt(this.name,"initialize-with").match(/[\u00a0\ufeff]/)&&1===l.initializationLevel?d:" ",g=this._join([u,v],t["comma-dropping-particle"]+y)}return this.state.tmp.group_context.tip.variable_success=!0,this.state.tmp.can_substitute.replace(!1,e.LITERAL),this.state.tmp.term_predecessor=!0,this.state.tmp.name_node.children.push(g),g},e.NameOutput.prototype._normalizeNameInput=function(t){var e={literal:t.literal,family:t.family,isInstitution:t.isInstitution,given:t.given,suffix:t.suffix,"comma-suffix":t["comma-suffix"],"non-dropping-particle":t["non-dropping-particle"],"dropping-particle":t["dropping-particle"],"static-ordering":t["static-ordering"],"static-particles":t["static-particles"],"reverse-ordering":t["reverse-ordering"],"full-form-always":t["full-form-always"],"parse-names":t["parse-names"],"comma-dropping-particle":"",block_initialize:t.block_initialize,multi:t.multi};return this._parseName(e),e},e.NameOutput.prototype._stripPeriods=function(t,e){var i=this[t+"_decor"];if(e){if(this.state.tmp.strip_periods)e=e.replace(/\./g,"");else if(i){for(var s=0,r=i.decorations.length;s<r;s+=1)if("@strip-periods"===i.decorations[s][0]&&"true"===i.decorations[s][1]){e=e.replace(/\./g,"");break}}}return e},e.NameOutput.prototype._nonDroppingParticle=function(t){var e=t["non-dropping-particle"];e&&this.state.tmp.sort_key_flag&&(e=e.replace(/[\'\u2019]/,""));var i=this._stripPeriods("family",e);return!!this.state.output.append(i,this.family_decor,!0)&&this.state.output.pop()},e.NameOutput.prototype._droppingParticle=function(t,e,i){var s=t["dropping-particle"];s&&this.state.tmp.sort_key_flag&&(s=s.replace(/[\'\u2019]/,""));var r=this._stripPeriods("given",s);if(t["dropping-particle"]&&t["dropping-particle"].match(/^et.?al[^a-z]$/))this.state.inheritOpt(this.name,"et-al-use-last")?void 0===i?this.etal_spec[e].freeters=2:this.etal_spec[e].persons=2:void 0===i?this.etal_spec[e].freeters=1:this.etal_spec[e].persons=1,t["comma-dropping-particle"]="";else if(this.state.output.append(r,this.given_decor,!0))return this.state.output.pop();return!1},e.NameOutput.prototype._familyName=function(t){var e=this._stripPeriods("family",t.family);return!!this.state.output.append(e,this.family_decor,!0)&&this.state.output.pop()},e.NameOutput.prototype._givenName=function(t,i,s){var r,n,a="long"!==this.state.inheritOpt(this.name,"form","name-form","long"),o=!1!==this.state.inheritOpt(this.name,"initialize"),l="string"==typeof this.state.inheritOpt(this.name,"initialize-with")&&!t.block_initialize;if(t["full-form-always"])n=2;else{r=a?0:l?1:2;var u=this.state.tmp.disambig_settings.givens[i][s];n=u>r?u:r}var p=this.state.citation.opt["givenname-disambiguation-rule"];if(p&&"-with-initials"===p.slice(-14)&&(l=!0),t.family&&1===n)if(l){var h=this.state.inheritOpt(this.name,"initialize-with",!1,"");t.given=e.Util.Names.initializeWith(this.state,t.given,h,!o)}else t.given=e.Util.Names.unInitialize(this.state,t.given);else{if(0===n)return{blob:!1};2===n&&(t.given=e.Util.Names.unInitialize(this.state,t.given))}var c=this._stripPeriods("given",t.given);return this.state.output.append(c,this.given_decor,!0)?{blob:this.state.output.pop(),initializationLevel:n}:{blob:!1}},e.NameOutput.prototype._nameSuffix=function(t){var i,s=t.suffix;s&&"string"==typeof this.state.inheritOpt(this.name,"initialize-with")&&(s=e.Util.Names.initializeWith(this.state,s,this.state.inheritOpt(this.name,"initialize-with"),!0));var r="";return(s=this._stripPeriods("family",s))&&"."===s.slice(-1)&&(s=s.slice(0,-1),r="."),!!this.state.output.append(s,"empty",!0)&&((i=this.state.output.pop()).strings.suffix=r+i.strings.suffix,i)},e.NameOutput.prototype._getLongStyle=function(t){var i;return(i=t.short.length&&this.institutionpart["long-with-short"]?this.institutionpart["long-with-short"]:this.institutionpart.long)||(i=new e.Token),i},e.NameOutput.prototype._getShortStyle=function(){var t;return this.institutionpart.short?this.institutionpart.short:new e.Token},e.NameOutput.prototype._parseName=function(t){var i;if(!t["parse-names"]&&void 0!==t["parse-names"])return t;t.family&&!t.given&&t.isInstitution&&(t.literal=t.family,t.family=void 0,t.isInstitution=void 0),t.family&&'"'===t.family.slice(0,1)&&'"'===t.family.slice(-1)||!t["parse-names"]&&void 0!==t["parse-names"]?(t.family=t.family.slice(1,-1),i=!0,t["parse-names"]=0):i=!1,this.state.opt.development_extensions.parse_names&&!t["non-dropping-particle"]&&t.family&&!i&&t.given&&!t["static-particles"]&&e.parseParticles(t,!0)},e.NameOutput.prototype.getName=function(t,e,i,s){if(s&&"locale-orig"===e)return{name:!1,usedOrig:s};t.family||(t.family=""),t.given||(t.given="");var r,n,a={};a["static-ordering"]=this.getStaticOrder(t);var o=!0;if("locale-orig"!==e&&(o=!1,t.multi)){for(var l=this.state.opt[e],u=0,p=l.length;u<p;u+=1)if(r=l[u],t.multi._key[r]){o=!0;var h=t.isInstitution;(t=t.multi._key[r]).isInstitution=h,(a=this.getNameParams(r)).transliterated=!0;break}}return(!o&&(r=!1,t.multi&&t.multi.main?r=t.multi.main:this.Item.language&&(r=this.Item.language),r&&(a=this.getNameParams(r))),i||o)?(t.family||(t.family=""),t.given||(t.given=""),t.literal&&(delete t.family,delete t.given),!(t={family:t.family,given:t.given,"non-dropping-particle":t["non-dropping-particle"],"dropping-particle":t["dropping-particle"],suffix:t.suffix,"static-ordering":a["static-ordering"],"static-particles":t["static-particles"],"reverse-ordering":a["reverse-ordering"],"full-form-always":a["full-form-always"],"parse-names":t["parse-names"],"comma-suffix":t["comma-suffix"],"comma-dropping-particle":t["comma-dropping-particle"],transliterated:a.transliterated,block_initialize:a["block-initialize"],literal:t.literal,isInstitution:t.isInstitution,multi:t.multi}).literal&&!t.given&&t.family&&t.isInstitution&&(t.literal=t.family),t.literal&&(delete t.family,delete t.given),{name:t=this._normalizeNameInput(t),usedOrig:s||!o}):{name:!1,usedOrig:s}},e.NameOutput.prototype.getNameParams=function(t){var i={},s=e.localeResolve(this.Item.language,this.state.opt["default-locale"][0]),r=this.state.locale[s.best]?s.best:this.state.opt["default-locale"][0],n=this.state.locale[r].opts["name-as-sort-order"],a=this.state.locale[r].opts["name-as-reverse-order"],o=this.state.locale[r].opts["name-never-short"],l=t.split("-")[0];return n&&n[l]&&(i["static-ordering"]=!0,i["reverse-ordering"]=!1),a&&a[l]&&(i["reverse-ordering"]=!0,i["static-ordering"]=!1),o&&o[l]&&(i["full-form-always"]=!0),i["static-ordering"]&&(i["block-initialize"]=!0),i},e.NameOutput.prototype.setRenderedName=function(t){if("bibliography"===this.state.tmp.area){for(var i="",s=0,r=e.NAME_PARTS.length;s<r;s+=1)t[e.NAME_PARTS[s]]&&(i+=t[e.NAME_PARTS[s]]);this.state.tmp.rendered_name.push(i)}},e.NameOutput.prototype.fixupInstitution=function(t,e,i){!t.literal&&t.family&&(t.literal=t.family,delete t.family);var s=t.literal,r=s,n={long:s.split(/\s*\|\s*/),short:r.split(/\s*\|\s*/)};if(this.state.sys.getAbbreviation){if("short"===this.institution.strings.form){let t=this.Item.jurisdiction;t=this.state.transform.loadAbbreviation(t,"institution-entire",s,this.Item.language),this.state.transform.abbrevs[t]["institution-entire"][s]?s=this.state.transform.abbrevs[t]["institution-entire"][s]:(t=this.Item.jurisdiction,t=this.state.transform.loadAbbreviation(t,"institution-part",s,this.Item.language),this.state.transform.abbrevs[t]["institution-part"][s]&&(s=this.state.transform.abbrevs[t]["institution-part"][s])),s=this._quashChecks(t,s)}if(["short","short-long","long-short"].indexOf(this.institution.strings["institution-parts"])>-1){let t=this.Item.jurisdiction;t=this.state.transform.loadAbbreviation(t,"institution-part",r,this.Item.language),this.state.transform.abbrevs[t]["institution-part"][r]&&(r=this.state.transform.abbrevs[t]["institution-part"][r]),r=this._quashChecks(t,r),["short-long","long-short"].indexOf(this.institution.strings["institution-parts"])>-1&&r===s&&(r="")}if(n.long=s.split(/\s*\|\s*/),n.short=r.split(/\s*\|\s*/),["short","short-long","long-short"].indexOf(this.institution.strings["institution-parts"])>-1)for(var a=n.short.length-1;a>-1;a--){let t=this.Item.jurisdiction;var o=n.short[a];if(t=this.state.transform.loadAbbreviation(t,"institution-part",o,this.Item.language),this.state.transform.abbrevs[t]["institution-part"][o]&&(n.short[a]=this.state.transform.abbrevs[t]["institution-part"][o]),n.short[a].indexOf("|")>-1){let t=n.short,e=t[a].split(/\s*\|\s*/);n.short=t.slice(0,a).concat(e).concat(t.slice(a+1))}}if(this.state.opt.development_extensions.legacy_institution_name_ordering&&n.short.reverse(),n.short=this._trimInstitution(n.short),this.institution.strings["reverse-order"]&&n.short.reverse(),!this.state.tmp.just_looking&&this.Item.jurisdiction){let t=this.Item.jurisdiction;var l=this.state.tmp.abbrev_trimmer;if(l&&l[t]&&l[t][e])for(var u=0,p=n.short.length;u<p;u++){var h=n.short[u];n.short[u]=h.replace(l[t][e],"").trim()}}}return this.state.opt.development_extensions.legacy_institution_name_ordering&&n.long.reverse(),n.long=this._trimInstitution(n.long),this.institution.strings["reverse-order"]&&n.long.reverse(),n},e.NameOutput.prototype.getStaticOrder=function(t,i){var s=!1;return!i&&t["static-ordering"]||0===this._isRomanesque(t)||(!t.multi||!t.multi.main)&&this.Item.language&&["vi","hu"].indexOf(this.Item.language)>-1||t.multi&&t.multi.main&&["vi","hu"].indexOf(t.multi.main.slice(0,2))>-1?s=!0:this.state.opt["auto-vietnamese-names"]&&e.VIETNAMESE_NAMES.exec(t.family+" "+t.given)&&e.VIETNAMESE_SPECIALS.exec(t.family+t.given)&&(s=!0),s},e.NameOutput.prototype._quashChecks=function(t,e){var e=this.state.transform.quashCheck(t,e),i=e.split(/>>[0-9]{4}>>/),s=e.match(/>>([0-9]{4})>>/);e=i.pop();var r=this.Item["original-date"]?this.Item["original-date"]:this.Item.issued;if(r&&(r=!isNaN(r=parseInt(r.year,10))&&r),r){if(i.length>0)for(var n=s.length-1;n>0&&!(r>=parseInt(s[n],10));n--)e=i.pop();e=e.replace(/\s*\|\s*/g,"|")}return e},e.NameOutput.prototype._trimInstitution=function(t){var e=!1,i=!1,s=!1,r=!1,n=t.slice();if(this.institution){if(void 0!==this.institution.strings["use-first"]&&(e=this.institution.strings["use-first"]),void 0!==this.institution.strings["use-last"]&&(s=this.institution.strings["use-last"]),void 0!==this.institution.strings["stop-first"]&&(r=this.institution.strings["stop-first"]),void 0!==this.institution.strings["stop-last"]&&(i=this.institution.strings["stop-last"]),e&&(i&&(n=n.slice(0,-1*i)),n=n.slice(0,e)),s){var a=t.slice();e?r=e:n=[],r&&(a=a.slice(r)),a=a.slice(-1*s),n=n.concat(a)}t=n}return t},e.PublisherOutput=function(t,e){this.state=t,this.group_tok=e,this.varlist=[]},e.PublisherOutput.prototype.render=function(){this.clearVars(),this.composeAndBlob(),this.composeElements(),this.composePublishers(),this.joinPublishers()},e.PublisherOutput.prototype.composeAndBlob=function(){this.and_blob={};var t=!1;"text"===this.group_tok.strings.and?t=this.state.getTerm("and"):"symbol"===this.group_tok.strings.and&&(t="&");var i=new e.Token;i.strings.suffix=" ",i.strings.prefix=" ",this.state.output.append(t,i,!0);var s=this.state.output.pop();i.strings.prefix=this.group_tok.strings["subgroup-delimiter"],this.state.output.append(t,i,!0);var r=this.state.output.pop();this.and_blob.single=!1,this.and_blob.multiple=!1,t&&("always"===this.group_tok.strings["subgroup-delimiter-precedes-last"]?this.and_blob.single=r:"never"===this.group_tok.strings["subgroup-delimiter-precedes-last"]?(this.and_blob.single=s,this.and_blob.multiple=s):(this.and_blob.single=s,this.and_blob.multiple=r))},e.PublisherOutput.prototype.composeElements=function(){for(var t=0;t<2;t+=1)for(var e=["publisher","publisher-place"][t],i=0,s=this["publisher-list"].length;i<s;i+=1){var r=this[e+"-list"][i],n=this[e+"-token"];this.state.output.append(r,n,!0),this[e+"-list"][i]=this.state.output.pop()}},e.PublisherOutput.prototype.composePublishers=function(){for(var t,e=0,i=this["publisher-list"].length;e<i;e+=1)t=[this[this.varlist[0]+"-list"][e],this[this.varlist[1]+"-list"][e]],this["publisher-list"][e]=this._join(t,this.group_tok.strings.delimiter)},e.PublisherOutput.prototype.joinPublishers=function(){var t=this["publisher-list"],e=this._join(t,this.group_tok.strings["subgroup-delimiter"],this.and_blob.single,this.and_blob.multiple,this.group_tok);this.state.output.append(e,"literal")},e.PublisherOutput.prototype._join=e.NameOutput.prototype._join,e.PublisherOutput.prototype._getToken=e.NameOutput.prototype._getToken,e.PublisherOutput.prototype.clearVars=function(){this.state.tmp["publisher-list"]=!1,this.state.tmp["publisher-place-list"]=!1,this.state.tmp["publisher-group-token"]=!1,this.state.tmp["publisher-token"]=!1,this.state.tmp["publisher-place-token"]=!1},e.evaluateLabel=function(t,i,s,r){"locator"===t.strings.term?(r&&r.label&&(n="sub verbo"===r.label?"sub-verbo":r.label),n||(n="page")):n=t.strings.term;var n,a=t.strings.plural;if("number"!=typeof a){var o=r&&"locator"===t.strings.term?r:s;o[t.strings.term]&&(i.processNumber(!1,o,t.strings.term,s.type),a=i.tmp.shadow_numbers[t.strings.term].plural,i.tmp.shadow_numbers[t.strings.term].labelForm||i.tmp.shadow_numbers[t.strings.term].labelDecorations||(t.strings.form?i.tmp.shadow_numbers[t.strings.term].labelForm=t.strings.form:i.tmp.group_context.tip.label_form&&(i.tmp.shadow_numbers[t.strings.term].labelForm=i.tmp.group_context.tip.label_form),i.tmp.shadow_numbers[t.strings.term].labelCapitalizeIfFirst=t.strings.capitalize_if_first,i.tmp.shadow_numbers[t.strings.term].labelDecorations=t.decorations.slice()),["locator","number","page"].indexOf(t.strings.term)>-1&&i.tmp.shadow_numbers[t.strings.term].label&&(n=i.tmp.shadow_numbers[t.strings.term].label),t.decorations&&i.opt.development_extensions.csl_reverse_lookup_support&&(t.decorations.reverse(),t.decorations.push(["@showid","true",t.cslid]),t.decorations.reverse()))}return e.castLabel(i,t,n,a,e.TOLERANT)},e.castLabel=function(t,i,s,r,n){var a=i.strings.form,o=i.strings.capitalize_if_first;t.tmp.group_context.tip.label_form&&("static"===a?t.tmp.group_context.tip.label_static=!0:a=t.tmp.group_context.tip.label_form),t.tmp.group_context.tip.label_capitalize_if_first&&(o=t.tmp.group_context.tip.label_capitalize_if_first);var l=t.getTerm(s,a,r,!1,n,i.default_locale);if(o&&(l=e.Output.Formatters["capitalize-first"](t,l)),t.tmp.strip_periods)l=l.replace(/\./g,"");else for(var u=0,p=i.decorations.length;u<p;u+=1)if("@strip-periods"===i.decorations[u][0]&&"true"===i.decorations[u][1]){l=l.replace(/\./g,"");break}return l},e.Node.name={build:function(t,i){var s;[e.SINGLETON,e.START].indexOf(this.tokentype)>-1&&(void 0===t.tmp.root?(s=void 0,t.tmp.root="citation"):s=t.tmp.root,t.inheritOpt(this,"et-al-subsequent-min")&&t.inheritOpt(this,"et-al-subsequent-min")!==t.inheritOpt(this,"et-al-min")&&(t.opt.update_mode=e.POSITION),t.inheritOpt(this,"et-al-subsequent-use-first")&&t.inheritOpt(this,"et-al-subsequent-use-first")!==t.inheritOpt(this,"et-al-use-first")&&(t.opt.update_mode=e.POSITION),t.tmp.root=s,t.build.name_flag=!0,this.execs.push(function(t){t.tmp.etal_term="et-al",t.tmp.name_delimiter=t.inheritOpt(this,"delimiter","name-delimiter",", "),t.tmp["delimiter-precedes-et-al"]=t.inheritOpt(this,"delimiter-precedes-et-al"),"text"===t.inheritOpt(this,"and")?this.and_term=t.getTerm("and","long",0):"symbol"===t.inheritOpt(this,"and")&&(t.opt.development_extensions.expect_and_symbol_form?this.and_term=t.getTerm("and","symbol",0):this.and_term="&"),t.tmp.and_term=this.and_term,e.STARTSWITH_ROMANESQUE_REGEXP.test(this.and_term)?(this.and_prefix_single=" ",this.and_prefix_multiple=", ","string"==typeof t.tmp.name_delimiter&&(this.and_prefix_multiple=t.tmp.name_delimiter),this.and_suffix=" "):(this.and_prefix_single="",this.and_prefix_multiple="",this.and_suffix=""),"always"===t.inheritOpt(this,"delimiter-precedes-last")?this.and_prefix_single=t.tmp.name_delimiter:"never"===t.inheritOpt(this,"delimiter-precedes-last")?this.and_prefix_multiple&&(this.and_prefix_multiple=" "):"after-inverted-name"===t.inheritOpt(this,"delimiter-precedes-last")&&(this.and_prefix_single&&(this.and_prefix_single=t.tmp.name_delimiter),this.and_prefix_multiple&&(this.and_prefix_multiple=" ")),this.and={},t.inheritOpt(this,"and")?(t.output.append(this.and_term,"empty",!0),this.and.single=t.output.pop(),this.and.single.strings.prefix=this.and_prefix_single,this.and.single.strings.suffix=this.and_suffix,t.output.append(this.and_term,"empty",!0),this.and.multiple=t.output.pop(),this.and.multiple.strings.prefix=this.and_prefix_multiple,this.and.multiple.strings.suffix=this.and_suffix):t.tmp.name_delimiter&&(this.and.single=new e.Blob(t.tmp.name_delimiter),this.and.single.strings.prefix="",this.and.single.strings.suffix="",this.and.multiple=new e.Blob(t.tmp.name_delimiter),this.and.multiple.strings.prefix="",this.and.multiple.strings.suffix=""),this.ellipsis={},t.inheritOpt(this,"et-al-use-last")&&(this.ellipsis_term="…",this.ellipsis_prefix_single=" ",this.ellipsis_prefix_multiple=t.inheritOpt(this,"delimiter","name-delimiter",", "),this.ellipsis_suffix=" ",this.ellipsis.single=new e.Blob(this.ellipsis_term),this.ellipsis.single.strings.prefix=this.ellipsis_prefix_single,this.ellipsis.single.strings.suffix=this.ellipsis_suffix,this.ellipsis.multiple=new e.Blob(this.ellipsis_term),this.ellipsis.multiple.strings.prefix=this.ellipsis_prefix_multiple,this.ellipsis.multiple.strings.suffix=this.ellipsis_suffix),void 0===t.tmp["et-al-min"]&&(t.tmp["et-al-min"]=t.inheritOpt(this,"et-al-min")),void 0===t.tmp["et-al-use-first"]&&(t.tmp["et-al-use-first"]=t.inheritOpt(this,"et-al-use-first")),void 0===t.tmp["et-al-use-last"]&&(t.tmp["et-al-use-last"]=t.inheritOpt(this,"et-al-use-last")),t.nameOutput.name=this})),i.push(this)}},e.Node["name-part"]={build:function(t){t.build[this.strings.name]=this}},e.Node.names={build:function(t,i){var s;if((this.tokentype===e.START||this.tokentype===e.SINGLETON)&&(e.Util.substituteStart.call(this,t,i),t.build.substitute_level.push(1)),this.tokentype===e.SINGLETON){for(var r in t.build.names_variables[t.build.names_variables.length-1].concat(this.variables),this.variables){var n=this.variables[r],a=t.build.name_label[t.build.name_label.length-1];Object.keys(a).length&&(a[n]=a[Object.keys(a)[0]])}s=function(t){t.nameOutput.reinit(this,this.variables_real[0])},this.execs.push(s)}if(this.tokentype===e.START&&(t.build.names_flag=!0,t.build.name_flag=!1,t.build.names_level+=1,t.build.names_variables.push(this.variables),t.build.name_label.push({}),s=function(t){t.tmp.can_substitute.push(!0),t.tmp.name_node={},t.tmp.name_node.children=[],t.nameOutput.init(this)},this.execs.push(s)),this.tokentype===e.END){for(var r=0;r<3;r+=1){var o=["family","given","et-al"][r];this[o]=t.build[o],1===t.build.names_level&&(t.build[o]=void 0)}this.label=t.build.name_label[t.build.name_label.length-1],t.build.names_level+=-1,t.build.names_variables.pop(),t.build.name_label.pop(),s=function(t){t.tmp.etal_node?this.etal_style=t.tmp.etal_node:this.etal_style="empty",this.etal_term=t.getTerm(t.tmp.etal_term,"long",0),this.etal_prefix_single=" ",this.etal_prefix_multiple=t.tmp.name_delimiter,"always"===t.tmp["delimiter-precedes-et-al"]?this.etal_prefix_single=t.tmp.name_delimiter:"never"===t.tmp["delimiter-precedes-et-al"]?this.etal_prefix_multiple=" ":"after-inverted-name"===t.tmp["delimiter-precedes-et-al"]&&(this.etal_prefix_single=t.tmp.name_delimiter,this.etal_prefix_multiple=" "),this.etal_suffix="",e.STARTSWITH_ROMANESQUE_REGEXP.test(this.etal_term)||(" "===this.etal_prefix_single&&(this.etal_prefix_single="")," "===this.etal_prefix_multiple&&(this.etal_prefix_multiple="")," "===this.etal_suffix&&(this.etal_suffix=""));for(var i=0;i<3;i+=1){var s=["family","given"][i];t.nameOutput[s]=this[s]}t.nameOutput.with=this.with;var r="with",n="",a="";e.STARTSWITH_ROMANESQUE_REGEXP.test(r)&&(n=" ",a=" ");var o={};o.single=new e.Blob(r),o.single.strings.suffix=a,o.multiple=new e.Blob(r),o.multiple.strings.suffix=a,"always"===t.inheritOpt(t.nameOutput.name,"delimiter-precedes-last")?(o.single.strings.prefix=t.inheritOpt(this,"delimiter","names-delimiter"),o.multiple.strings.prefix=t.inheritOpt(this,"delimiter","names-delimiter")):"contextual"===t.inheritOpt(t.nameOutput.name,"delimiter-precedes-last")?(o.single.strings.prefix=n,o.multiple.strings.prefix=t.inheritOpt(this,"delimiter","names-delimiter")):("after-inverted-name"===t.inheritOpt(t.nameOutput.name,"delimiter-precedes-last")?o.single.strings.prefix=t.inheritOpt(this,"delimiter","names-delimiter"):o.single.strings.prefix=n,o.multiple.strings.prefix=n),t.nameOutput.with=o,t.nameOutput.label=this.label,t.nameOutput.etal_style=this.etal_style,t.nameOutput.etal_term=this.etal_term,t.nameOutput.etal_prefix_single=this.etal_prefix_single,t.nameOutput.etal_prefix_multiple=this.etal_prefix_multiple,t.nameOutput.etal_suffix=this.etal_suffix,t.nameOutput.outputNames(),t.tmp["et-al-use-first"]=void 0,t.tmp["et-al-min"]=void 0,t.tmp["et-al-use-last"]=void 0},this.execs.push(s),s=function(t){t.tmp.can_substitute.pop()||t.tmp.can_substitute.replace(!1,e.LITERAL),1===t.tmp.can_substitute.mystack.length&&(t.tmp.can_block_substitute=!1)},this.execs.push(s),t.build.name_flag=!1}i.push(this),(this.tokentype===e.END||this.tokentype===e.SINGLETON)&&(t.build.substitute_level.pop(),e.Util.substituteEnd.call(this,t,i))}},e.Node.number={build:function(t,i){e.Util.substituteStart.call(this,t,i),"roman"===this.strings.form?this.formatter=t.fun.romanizer:"ordinal"===this.strings.form?this.formatter=t.fun.ordinalizer:"long-ordinal"===this.strings.form&&(this.formatter=t.fun.long_ordinalizer),void 0===this.successor_prefix&&(this.successor_prefix=t[t.build.area].opt.layout_delimiter),void 0===this.splice_prefix&&(this.splice_prefix=t[t.build.area].opt.layout_delimiter),this.execs.push(function(t,i,s){if(0!==this.variables.length){if(r=this.variables[0],void 0===s)var r,s={};if(["locator","locator-extra"].indexOf(r)>-1){if(t.tmp.just_looking||!s[r])return}else if(!i[r])return;if("collection-number"===r&&"legal_case"===i.type&&(t.tmp.renders_collection_number=!0),t.tmp.group_context.tip.force_suppress)return!1;if(["locator","locator-extra"].indexOf(r)>-1?t.processNumber.call(t,this,s,r,i.type):(!t.tmp.group_context.tip.condition&&i[r]&&(t.tmp.just_did_number=(""+i[r]).match(/[0-9]$/)),t.processNumber.call(t,this,i,r,i.type)),this.substring){var n=i[r].slice(this.substring);t.output.append(n,this)}else e.Util.outputNumericField(t,r,i.id);["locator","locator-extra"].indexOf(this.variables_real[0])>-1&&!t.tmp.just_looking&&(t.tmp.done_vars.push(this.variables_real[0]),t.tmp.group_context.tip.done_vars.push(this.variables_real[0]))}}),i.push(this),e.Util.substituteEnd.call(this,t,i)}},e.Node.sort={build:function(t,i){if(i=t[t.build.root+"_sort"].tokens,this.tokentype===e.START){"citation"===t.build.area&&(t.opt.sort_citations=!0),t.build.area=t.build.root+"_sort",t.build.extension="_sort";var s=function(t,i){if(t.opt.has_layout_locale){for(var s,r=e.localeResolve(i.language,t.opt["default-locale"][0]),n=t[t.tmp.area.slice(0,-5)].opt.sort_locales,a=0,o=n.length;a<o&&((s=n[a][r.bare])||(s=n[a][r.best]),!s);a+=1);s||(s=t.opt["default-locale"][0]),t.tmp.lang_sort_hold=t.opt.lang,t.opt.lang=s}};this.execs.push(s)}if(this.tokentype===e.END){t.build.area=t.build.root,t.build.extension="";var s=function(t){t.opt.has_layout_locale&&(t.opt.lang=t.tmp.lang_sort_hold,delete t.tmp.lang_sort_hold)};this.execs.push(s)}i.push(this)}},e.Node.substitute={build:function(t,i){var s;if(this.tokentype===e.START){var r=new e.Token("choose",e.START);e.Node.choose.build.call(r,t,i);var n=new e.Token("if",e.SINGLETON);n.tests=[s=function(){return!!t.tmp.value.length&&!t.tmp.common_term_match_fail}],n.test=t.fun.match.any(n,t,n.tests),i.push(n),s=function(t){t.tmp.can_block_substitute=!0,t.tmp.value.length&&!t.tmp.common_term_match_fail&&t.tmp.can_substitute.replace(!1,e.LITERAL),t.tmp.common_term_match_fail=!1},this.execs.push(s),i.push(this)}if(this.tokentype===e.END){i.push(this);var a=new e.Token("choose",e.END);e.Node.choose.build.call(a,t,i)}}},e.Node.text={build:function(t,i){var s,r,n,a,o,l,u,p,h,c,m;if(this.postponed_macro){var f=e.Util.cloneToken(this);f.name="group",f.tokentype=e.START,e.Node.group.build.call(f,t,i),e.expandMacro.call(t,this,i);var d=e.Util.cloneToken(this);d.name="group",d.tokentype=e.END,"juris-locator-label"===this.postponed_macro&&(d.isJurisLocatorLabel=!0),e.Node.group.build.call(d,t,i)}else{if(e.Util.substituteStart.call(this,t,i),this.variables_real||(this.variables_real=[]),this.variables||(this.variables=[]),r="long",n=0,this.strings.form&&(r=this.strings.form),this.strings.plural&&(n=this.strings.plural),"citation-number"===this.variables_real[0]||"year-suffix"===this.variables_real[0]||"citation-label"===this.variables_real[0])"citation-number"===this.variables_real[0]?("citation"===t.build.root&&(t.opt.update_mode=e.NUMERIC),"bibliography"===t.build.root&&(t.opt.bib_mode=e.NUMERIC),"citation-number"===t[t.tmp.area].opt.collapse&&(this.range_prefix=t.getTerm("citation-range-delimiter")),this.successor_prefix=t[t.build.area].opt.layout_delimiter,this.splice_prefix=t[t.build.area].opt.layout_delimiter,s=function(t,i,s){if(a=""+i.id,!t.tmp.just_looking){if("_sort"===t.tmp.area.slice(-5)&&"citation-number"===this.variables[0]){if("bibliography_sort"===t.tmp.area&&t.tmp.group_context.tip.done_vars.push("citation-number"),"citation_sort"===t.tmp.area&&t.bibliography_sort.tmp.citation_number_map)var r=t.bibliography_sort.tmp.citation_number_map[t.registry.registry[i.id].seq];else var r=t.registry.registry[i.id].seq;r&&(r=e.Util.padding(""+r)),t.output.append(r,this);return}s&&s["author-only"]&&t.tmp.element_trace.replace("suppress-me"),r="bibliography_sort"!==t.tmp.area&&t.bibliography_sort.tmp.citation_number_map&&t.bibliography_sort.opt.citation_number_sort_direction===e.DESCENDING?t.bibliography_sort.tmp.citation_number_map[t.registry.registry[a].seq]:t.registry.registry[a].seq,t.opt.citation_number_slug?t.output.append(t.opt.citation_number_slug,this):(l=new e.NumericBlob(t,!1,r,this,i.id),t.tmp.in_cite_predecessor&&(l.suppress_splice_prefix=!0),t.output.append(l,"literal"))}},this.execs.push(s)):"year-suffix"===this.variables_real[0]?(t.opt.has_year_suffix=!0,"year-suffix-ranged"===t[t.tmp.area].opt.collapse&&(this.range_prefix=t.getTerm("citation-range-delimiter")),this.successor_prefix=t[t.build.area].opt.layout_delimiter,t[t.tmp.area].opt["year-suffix-delimiter"]&&(this.successor_prefix=t[t.build.area].opt["year-suffix-delimiter"]),s=function(t,i){if(t.registry.registry[i.id]&&!1!==t.registry.registry[i.id].disambig.year_suffix&&!t.tmp.just_looking){o=parseInt(t.registry.registry[i.id].disambig.year_suffix,10),t[t.tmp.area].opt.cite_group_delimiter&&(this.successor_prefix=t[t.tmp.area].opt.cite_group_delimiter),l=new e.NumericBlob(t,!1,o,this,i.id),u=new e.Util.Suffixator(e.SUFFIX_CHARS),l.setFormatter(u),t.output.append(l,"literal"),p=!1;for(var s=0,r=t.tmp.group_context.mystack.length;s<r;s++){var n=t.tmp.group_context.mystack[s];if(!n.variable_success&&(n.variable_attempt||!n.variable_attempt&&!n.term_intended)){p=!0;break}}h=t[t.tmp.area].opt["year-suffix-delimiter"],p&&h&&!t.tmp.sort_key_flag&&(t.tmp.splice_delimiter=t[t.tmp.area].opt["year-suffix-delimiter"])}},this.execs.push(s)):"citation-label"===this.variables_real[0]&&("bibliography"===t.build.root&&(t.opt.bib_mode=e.TRIGRAPH),t.opt.has_year_suffix=!0,s=function(t,e){(c=e["citation-label"])||(c=t.getCitationLabel(e)),t.tmp.just_looking||(m="",t.registry.registry[e.id]&&!1!==t.registry.registry[e.id].disambig.year_suffix&&(o=parseInt(t.registry.registry[e.id].disambig.year_suffix,10),m=t.fun.suffixator.format(o)),c+=m),t.output.append(c,this)},this.execs.push(s));else if(this.strings.term)s=function(t,i){var s,a=t.opt.gender[i.type],o=this.strings.term;if(""!==(o=t.getTerm(o,r,n,a,e.TOLERANT,this.default_locale))&&(t.tmp.group_context.tip.term_intended=!0),e.UPDATE_GROUP_CONTEXT_CONDITION(t,o,null,this),s=t.tmp.term_predecessor||"in-text"===t.opt.class&&"citation"===t.tmp.area?o:e.Output.Formatters["capitalize-first"](t,o),t.tmp.strip_periods)s=s.replace(/\./g,"");else for(var l=0,u=this.decorations.length;l<u;l+=1)if("@strip-periods"===this.decorations[l][0]&&"true"===this.decorations[l][1]){s=s.replace(/\./g,"");break}t.output.append(s,this),t.tmp.can_block_substitute&&t.tmp.can_substitute.replace(!1,e.LITERAL)},this.execs.push(s),t.build.term=!1,t.build.form=!1,t.build.plural=!1;else if(this.variables_real.length){if(s=function(t,e){"locator"!==this.variables_real[0]&&(t.tmp.have_collapsed=!1),!t.tmp.group_context.tip.condition&&e[this.variables[0]]&&(t.tmp.just_did_number=!1);var i=e[this.variables[0]];i&&!t.tmp.group_context.tip.condition&&((""+i).slice(-1).match(/[0-9]/)?t.tmp.just_did_number=!0:t.tmp.just_did_number=!1)},this.execs.push(s),e.MULTI_FIELDS.indexOf(this.variables_real[0])>-1||this.variables_real[0].indexOf("-main")>-1||this.variables_real[0].indexOf("-sub")>-1||["language-name","language-name-original"].indexOf(this.variables_real[0])>-1){var g=this.variables[0],b=!1,_=!1,v=!1;"short"===r?"-short"!==this.variables_real[0].slice(-6)&&(_=this.variables_real[0]+"-short"):g=!1,t.build.extension?v=!0:(v=!0,b=!0),s=t.transform.getOutputFunction(this.variables,g,b,_,v)}else s=e.CITE_FIELDS.indexOf(this.variables_real[0])>-1?function(t,i,s){s&&s[this.variables[0]]&&(t.processNumber(this,s,this.variables[0],i.type),e.Util.outputNumericField(t,this.variables[0],i.id),["locator","locator-extra"].indexOf(this.variables_real[0])>-1&&!t.tmp.just_looking&&t.tmp.done_vars.push(this.variables_real[0]))}:["page","page-first","chapter-number","collection-number","edition","issue","number","number-of-pages","number-of-volumes","volume"].indexOf(this.variables_real[0])>-1?function(t,i){t.processNumber(this,i,this.variables[0],i.type),e.Util.outputNumericField(t,this.variables[0],i.id)}:["URL","DOI"].indexOf(this.variables_real[0])>-1?function(t,i){var s;if(this.variables[0]&&(s=t.getVariable(i,this.variables[0],r)))if("URL"===this.variables[0]&&"short"===r&&(s=s.replace(/(.*\.[^\/]+)\/.*/,"$1")).match(/\/\/www\./)&&(s=s.replace(/https?:\/\//,"")),t.opt.development_extensions.wrap_url_and_doi)if(this.decorations.length&&this.decorations[0][0]==="@"+this.variables[0])t.output.append(s,this,!1,!1,!0);else{var n=e.Util.cloneToken(this),a=new e.Blob(null,null,"url-wrapper");if(a.decorations.push(["@DOI","true"]),"DOI"===this.variables_real[0]){this.strings.prefix&&this.strings.prefix.match(/^.*https:\/\/doi\.org\/$/)&&(o=(s=s.replace(/^https?:\/\/doi\.org\//,"")).match(/^https?:\/\//)?"":"https://doi.org/",n.strings.prefix=this.strings.prefix.slice(0,n.strings.prefix.length-16));var o,l=new e.Blob(o),u=new e.Blob(s);a.push(l),a.push(u),t.output.append(a,n,!1,!1,!0)}else{var u=new e.Blob(s);a.push(u),t.output.append(a,n,!1,!1,!0)}}else{if(this.decorations.length)for(var p=this.decorations.length-1;p>-1;p--)this.decorations[p][0]==="@"+this.variables[0]&&(this.decorations=this.decorations.slice(0,p).concat(this.decorations.slice(p+1)));t.output.append(s,this,!1,!1,!0)}}:"section"===this.variables_real[0]?function(t,e){var i;(i=t.getVariable(e,this.variables[0],r))&&t.output.append(i,this)}:"hereinafter"===this.variables_real[0]?function(t,e){var i=t.transform.abbrevs.default.hereinafter[e.id];i&&(t.output.append(i,this),t.tmp.group_context.tip.variable_success=!0)}:function(t,e){var i;this.variables[0]&&(i=t.getVariable(e,this.variables[0],r))&&(i=(i=""+i).split("\\").join(""),t.output.append(i,this))};this.execs.push(s)}else this.strings.value&&(s=function(t){t.tmp.group_context.tip.term_intended=!0,e.UPDATE_GROUP_CONTEXT_CONDITION(t,this.strings.value,!0,this),t.output.append(this.strings.value,this),t.tmp.can_block_substitute&&t.tmp.can_substitute.replace(!1,e.LITERAL)},this.execs.push(s));i.push(this),e.Util.substituteEnd.call(this,t,i)}}},e.Node.intext={build:function(t,i){this.tokentype===e.START&&(t.build.area="intext",t.build.root="intext",t.build.extension="",this.execs.push(function(t,e){t.tmp.area="intext",t.tmp.root="intext",t.tmp.extension=""})),this.tokentype===e.END&&(t.intext_sort={opt:{sort_directions:t.citation_sort.opt.sort_directions}},t.intext.srt=t.citation.srt),i.push(this)}},e.Attributes={},e.Attributes["@disambiguate"]=function(t,e){if(this.tests||(this.tests=[]),"true"===e){t.opt.has_disambiguate=!0;var i=function(e){if("bibliography"===t.tmp.area){if(t.tmp.disambiguate_count<t.registry.registry[e.id].disambig.disambiguate)return t.tmp.disambiguate_count+=1,!0}else if(t.tmp.disambiguate_maxMax+=1,t.tmp.disambig_settings.disambiguate&&t.tmp.disambiguate_count<t.tmp.disambig_settings.disambiguate)return t.tmp.disambiguate_count+=1,!0;return!1};this.tests.push(i)}else if("check-ambiguity-and-backreference"===e){var i=function(e){return!!t.registry.registry[e.id].disambig.disambiguate&&!!(t.registry.registry[e.id]["citation-count"]>1)};this.tests.push(i)}},e.Attributes["@is-numeric"]=function(t,i){this.tests||(this.tests=[]);for(var s=i.split(/\s+/),r=function(i){return function(s,r){var n=s;if(r&&["locator","locator-extra"].indexOf(i)>-1&&(n=r),!n[i])return!1;if(e.NUMERIC_VARIABLES.indexOf(i)>-1){if(t.tmp.shadow_numbers[i]||t.processNumber(!1,n,i,s.type),t.tmp.shadow_numbers[i].numeric)return!0}else if(["title","version"].indexOf(i)>-1&&n[i].slice(-1)===""+parseInt(n[i].slice(-1),10))return!0;return!1}},n=0;n<s.length;n+=1)this.tests.push(r(s[n]))},e.Attributes["@is-uncertain-date"]=function(t,e){this.tests||(this.tests=[]);for(var i=e.split(/\s+/),s=function(t){return function(e){return!!e[t]&&!!e[t].circa}},r=0,n=i.length;r<n;r+=1)this.tests.push(s(i[r]))},e.Attributes["@locator"]=function(t,e){this.tests||(this.tests=[]);var i=e.replace("sub verbo","sub-verbo");i=i.split(/\s+/);for(var s=function(e){return function(i,s){var r;return t.processNumber(!1,s,"locator"),!!(r=t.tmp.shadow_numbers.locator.label)&&e===r}},r=0,n=i.length;r<n;r+=1)this.tests.push(s(i[r]))},e.Attributes["@position"]=function(t,i){this.tests||(this.tests=[]),t.opt.update_mode=e.POSITION;for(var s,r=i.split(/\s+/),n=function(t,i){return!!i&&!!(e.POSITION_MAP[i.position]>=e.POSITION_MAP[e.POSITION_SUBSEQUENT])&&!!i["near-note"]},a=function(t,i){return!!i&&e.POSITION_MAP[i.position]==e.POSITION_MAP[e.POSITION_SUBSEQUENT]&&!i["near-note"]},o=function(i){return function(s,r){if("bibliography"===t.tmp.area)return!1;if(r&&void 0===r.position&&(r.position=0),r&&"number"==typeof r.position){if(0===r.position&&0===i)return!0;else if(i>0&&e.POSITION_MAP[r.position]>=e.POSITION_MAP[i])return!0}else if(0===i)return!0;return!1}},l=0,u=r.length;l<u;l+=1){var s=r[l];"first"===s?s=e.POSITION_FIRST:"container-subsequent"===s?s=e.POSITION_CONTAINER_SUBSEQUENT:"subsequent"===s?s=e.POSITION_SUBSEQUENT:"ibid"===s?s=e.POSITION_IBID:"ibid-with-locator"===s&&(s=e.POSITION_IBID_WITH_LOCATOR),"near-note"===s?this.tests.push(n):"far-note"===s?this.tests.push(a):this.tests.push(o(s))}},e.Attributes["@type"]=function(t,e){this.tests||(this.tests=[]);for(var i=e.split(/\s+/),s=function(t){return function(e){return e.type===t}},r=[],n=0,a=i.length;n<a;n+=1)r.push(s(i[n]));this.tests.push(t.fun.match.any(this,t,r))},e.Attributes["@variable"]=function(t,i){if(this.tests||(this.tests=[]),this.variables=i.split(/\s+/),this.variables_real=this.variables.slice(),"label"===this.name&&this.variables[0])this.strings.term=this.variables[0];else if(["names","date","text","number"].indexOf(this.name)>-1)s=function(t,e,i){for(var s=this.variables.length-1;s>-1;s+=-1)this.variables.pop();for(var s=0,r=this.variables_real.length;s<r;s++)-1===t.tmp.done_vars.indexOf(this.variables_real[s])&&this.variables.push(this.variables_real[s]),t.tmp.can_block_substitute&&t.tmp.done_vars.push(this.variables_real[s])},this.execs.push(s),s=function(t,i,s){for(var r=!1,n=0,a=this.variables.length;n<a;n++){var o=this.variables[n];if(["authority","committee"].indexOf(o)>-1&&"string"==typeof i[o]&&"names"===this.name){var l=!0,u=i[o].split(/\s*;\s*/),p={};if(i.multi&&i.multi._keys[o]){for(var h in i.multi._keys[o])if(p[h]=i.multi._keys[o][h].split(/\s*;\s*/),p[h].length!==u.length){l=!1;break}}l||(u=[i[o]],p=i.multi._keys[o]);for(var c=0,m=u.length;c<m;c++){var f={literal:u[c],multi:{_key:{}}};for(var h in p){var d={literal:p[h][c]};f.multi._key[h]=d}u[c]=f}i[o]=u}if("short"!==this.strings.form||i[o]||("title"===o?o="title-short":"container-title"===o&&(o="container-title-short")),"year-suffix"===o){r=!0;break}if(e.DATE_VARIABLES.indexOf(o)>-1){if(t.opt.development_extensions.locator_date_and_revision&&"locator-date"===o){r=!0;break}if(i[o]){for(var g in i[o])if((-1!==this.dateparts.indexOf(g)||"literal"===g)&&i[o][g]){r=!0;break}if(r)break}}else if("locator"===o){s&&s.locator&&(r=!0);break}else if("locator-extra"===o){s&&s["locator-extra"]&&(r=!0);break}else if(["citation-number","citation-label"].indexOf(o)>-1){r=!0;break}else if("first-reference-note-number"===o){s&&s["first-reference-note-number"]&&(r=!0);break}else if("first-container-reference-note-number"===o){s&&s["first-container-reference-note-number"]&&(r=!0);break}else if("hereinafter"===o){t.transform.abbrevs.default.hereinafter[i.id]&&t.sys.getAbbreviation&&i.id&&(r=!0);break}else if("object"==typeof i[o])break;else if("string"==typeof i[o]&&i[o]){r=!0;break}else if("number"==typeof i[o]){r=!0;break}if(r)break}if(r){for(var n=0,a=this.variables_real.length;n<a;n++){var o=this.variables_real[n];("citation-number"!==o||"bibliography"!==t.tmp.area)&&(t.tmp.cite_renders_content=!0),t.tmp.group_context.tip.variable_success=!0,t.tmp.can_substitute.value()&&"bibliography"===t.tmp.area&&"string"==typeof i[o]&&(t.tmp.name_node.top=t.output.current.value(),t.tmp.rendered_name.push(i[o]))}t.tmp.can_substitute.replace(!1,e.LITERAL)}else t.tmp.group_context.tip.variable_attempt=!0},this.execs.push(s);else if(["if","else-if","condition"].indexOf(this.name)>-1)for(var s,r=function(e){return function(i,s){var r=i;if(s&&["locator","locator-extra","first-reference-note-number","first-container-reference-note-number","locator-date"].indexOf(e)>-1&&(r=s),"hereinafter"===e&&t.sys.getAbbreviation&&r.id){if(t.transform.abbrevs.default.hereinafter[r.id])return!0}else if(r[e]){if("number"==typeof r[e]||"string"==typeof r[e])return!0;else if("object"==typeof r[e]){for(var n in r[e])if(r[e][n])return!0}}return!1}},n=0,a=this.variables.length;n<a;n+=1)this.tests.push(r(this.variables[n]))},e.Attributes["@page"]=function(t,e){this.tests||(this.tests=[]);var i=e.replace("sub verbo","sub-verbo");i=i.split(/\s+/);for(var s=function(e){return function(i){var s;return t.processNumber(!1,i,"page",i.type),s=t.tmp.shadow_numbers.page.label?"sub verbo"===t.tmp.shadow_numbers.page.label?"sub-verbo":t.tmp.shadow_numbers.page.label:"page",t.tmp.shadow_numbers.page.values.length>0&&t.tmp.shadow_numbers.page.values[0].gotosleepability&&(t.tmp.shadow_numbers.page.values[0].labelVisibility=!1),e===s}},r=0,n=i.length;r<n;r+=1)this.tests.push(s(i[r]))},e.Attributes["@number"]=function(t,e){this.tests||(this.tests=[]);for(var i=e.split(/\s+/),s=function(e){return function(i){var s;return t.processNumber(!1,i,"number",i.type),e===(t.tmp.shadow_numbers.number.label?t.tmp.shadow_numbers.number.label:"number")}},r=0,n=i.length;r<n;r+=1)this.tests.push(s(i[r]))},e.Attributes["@jurisdiction"]=function(t,e){this.tests||(this.tests=[]);var i=e.split(/\s+/);this.tests.push(function(t){if(!t.jurisdiction)return!1;for(var e=t.jurisdiction,s=0,r=i.length;s<r;s++)if(e===i[s])return!0;return!1})},e.Attributes["@country"]=function(t,e){this.tests||(this.tests=[]);var i=e.split(/\s+/);this.tests.push(function(t){if(!t.country)return!1;for(var e=t.country,s=0,r=i.length;s<r;s++)if(e===i[s])return!0;return!1})},e.Attributes["@context"]=function(t,e){this.tests||(this.tests=[]),this.tests.push(function(){return["bibliography","citation"].indexOf(e)>-1?t.tmp.area.slice(0,e.length)===e:"alternative"===e?!!t.tmp.abort_alternative:void 0})},e.Attributes["@has-year-only"]=function(t,e){this.tests||(this.tests=[]);for(var i=e.split(/\s+/),s=function(t){return function(e){var i=e[t];return!!i&&!i.month&&!i.season}},r=0,n=i.length;r<n;r+=1)this.tests.push(s(i[r]))},e.Attributes["@has-to-month-or-season"]=function(t,e){this.tests||(this.tests=[]);for(var i=e.split(/\s+/),s=function(t){return function(e){var i=e[t];return!!i&&(!!i.month||!!i.season)&&!i.day}},r=0,n=i.length;r<n;r+=1)this.tests.push(s(i[r]))},e.Attributes["@has-day"]=function(t,e){this.tests||(this.tests=[]);for(var i=e.split(/\s+/),s=function(t){return function(e){var i=e[t];return!!i&&!!i.day}},r=0,n=i.length;r<n;r+=1)this.tests.push(s(i[r]))},e.Attributes["@is-plural"]=function(t,e){this.tests||(this.tests=[]),this.tests.push(function(i){var s=i[e];if(s&&s.length){for(var r=0,n=0,a=!1,o=0,l=s.length;o<l;o+=1)t.opt.development_extensions.spoof_institutional_affiliations&&(s[o].literal||s[o].isInstitution&&s[o].family&&!s[o].given)?(n+=1,a=!1):(r+=1,a=!0);if(r>1)return!0;if(n>1)return!0;if(n&&a)return!0}return!1})},e.Attributes["@is-multiple"]=function(t,e){this.tests||(this.tests=[]),this.tests.push(function(t){return(""+t[e]).split(/(?:,\s|\s(?:tot\sen\smet|līdz|oraz|and|bis|έως|και|och|až|do|en|et|in|ir|ja|og|sa|to|un|und|és|și|i|u|y|à|e|a|и|-|–)\s|—|\&)/).length>1})},e.Attributes["@locale"]=function(t,i){this.tests||(this.tests=[]);var s,r,n,a,o,l=t.opt["default-locale"][0];if("layout"===this.name){if(this.locale_raw=i,this.tokentype===e.START){t.opt.multi_layout||(t.opt.multi_layout=[]);var u=[],p=i.split(/\s+/),h={},c=e.localeResolve(p[0],l);u.push(c),c.generic?h[c.generic]=c.best:h[c.best]=c.best;for(var a=1,o=p.length;a<o;a+=1){var m=e.localeResolve(p[a],l);u.push(m),m.generic?h[m.generic]=c.best:h[m.best]=c.best}t[t.build.area].opt.sort_locales.push(h),t.opt.multi_layout.push(u)}t.opt.has_layout_locale=!0}else{n=i.split(/\s+/);var f=[];for(a=0,o=n.length;a<o;a+=1)r=n[a],s=e.localeResolve(r,l),2===n[a].length&&f.push(s.bare),t.localeConfigure(s,!0),n[a]=s;var d=n.slice();this.tests.push(function(i){var s,r=!1,n=!1;for(a=0,s=i.language?i.language:l,n=e.localeResolve(s,l),o=d.length;a<o;a+=1)if(n.best===d[a].best){t.tmp.condition_lang_counter_arr.push(t.tmp.condition_counter),t.tmp.condition_lang_val_arr.push(t.opt.lang),t.opt.lang=d[0].best,r=!0;break}return!r&&f.indexOf(n.bare)>-1&&(t.tmp.condition_lang_counter_arr.push(t.tmp.condition_counter),t.tmp.condition_lang_val_arr.push(t.opt.lang),t.opt.lang=d[0].best,r=!0),r})}},e.Attributes["@alternative-node-internal"]=function(t){this.tests||(this.tests=[]),this.tests.push(function(){return!t.tmp.abort_alternative})},e.Attributes["@locale-internal"]=function(t,i){var s,r,n,a,o,l;for(this.tests||(this.tests=[]),n=i.split(/\s+/),this.locale_bares=[],a=0,o=n.length;a<o;a+=1)r=n[a],s=e.localeResolve(r,t.opt["default-locale"][0]),2===n[a].length&&this.locale_bares.push(s.bare),t.localeConfigure(s),n[a]=s;this.locale_default=t.opt["default-locale"][0],this.locale=n[0].best,this.locale_list=n.slice(),this.tests.push((l=this,function(i){var s=!1,n=!1;if(i.language&&(r=i.language,(n=e.localeResolve(r,t.opt["default-locale"][0])).best===t.opt["default-locale"][0]&&(n=!1)),n){for(a=0,o=l.locale_list.length;a<o;a+=1)if(n.best===l.locale_list[a].best){t.opt.lang=l.locale,t.tmp.last_cite_locale=l.locale,t.output.openLevel("empty"),t.output.current.value().new_locale=l.locale,s=!0;break}!s&&l.locale_bares.indexOf(n.bare)>-1&&(t.opt.lang=l.locale,t.tmp.last_cite_locale=l.locale,t.output.openLevel("empty"),t.output.current.value().new_locale=l.locale,s=!0)}return s}))},e.Attributes["@court-class"]=function(t,i){this.tests||(this.tests=[]);for(var s=i.split(/\s+/),r=function(i){return function(s){return e.GET_COURT_CLASS(t,s)===i}},n=0,a=s.length;n<a;n++)this.tests.push(r(s[n]))},e.Attributes["@container-multiple"]=function(t,e){var i;this.tests||(this.tests=[]),this.tests.push((i="true"===e,function(e){if(t.tmp.container_item_count[e.container_id]&&t.tmp.container_item_count[e.container_id]>1)return i;return!i}))},e.Attributes["@container-subsequent"]=function(t,e){var i;this.tests||(this.tests=[]),this.tests.push((i="true"===e,function(e){return t.tmp.container_item_pos[e.container_id]>1?i:!i}))},e.Attributes["@has-subunit"]=function(t,e){this.tests||(this.tests=[]),this.tests.push(function(t){var i=0;for(var s in t[e]){var r=t[e][s];if(!r.given){var n=(r.literal?r.literal:r.family).split("|").length;(0===i||n<i)&&(i=n)}}return i>1})},e.Attributes["@cite-form"]=function(t,e){this.tests||(this.tests=[]),this.tests.push(function(t){return t["cite-form"]===e})},e.Attributes["@disable-duplicate-year-suppression"]=function(t,e){t.opt.disable_duplicate_year_suppression=e.split(/\s+/)},e.Attributes["@consolidate-containers"]=function(t,i){e.Attributes["@track-containers"](t,i);var s=i.split(/\s+/);t.bibliography.opt.consolidate_containers=s},e.Attributes["@track-containers"]=function(t,e){var i=e.split(/\s+/);t.bibliography.opt.track_container_items||(t.bibliography.opt.track_container_items=[]),t.bibliography.opt.consolidate_containers||(t.bibliography.opt.consolidate_containers=[]),t.bibliography.opt.track_container_items=t.bibliography.opt.track_container_items.concat(i)},e.Attributes["@parallel-first"]=function(t,e){t.opt.parallel.enable=!0;var i=e.split(/\s+/);for(var s in t.opt.track_repeat||(t.opt.track_repeat={}),this.parallel_first={},i){var r=i[s];this.parallel_first[r]=!0,t.opt.track_repeat[r]=!0}},e.Attributes["@parallel-last"]=function(t,e){t.opt.parallel.enable=!0;var i=e.split(/\s+/);for(var s in t.opt.track_repeat||(t.opt.track_repeat={}),this.parallel_last={},i){var r=i[s];this.parallel_last[r]=!0,t.opt.track_repeat[r]=!0}},e.Attributes["@parallel-last-to-first"]=function(t,e){t.opt.parallel.enable=!0;var i=e.split(/\s+/);this.parallel_last_to_first={};for(var s=0,r=i.length;s<r;s++)this.parallel_last_to_first[i[s]]=!0},e.Attributes["@parallel-delimiter-override"]=function(t,e){t.opt.parallel.enable=!0,this.strings.set_parallel_delimiter_override=e},e.Attributes["@parallel-delimiter-override-on-suppress"]=function(t,e){t.opt.parallel.enable=!0,this.strings.set_parallel_delimiter_override_on_suppress=e},e.Attributes["@no-repeat"]=function(t,e){t.opt.parallel.enable=!0;var i=e.split(/\s+/);for(var s in t.opt.track_repeat||(t.opt.track_repeat={}),this.non_parallel={},i){var r=i[s];this.non_parallel[r]=!0,t.opt.track_repeat[r]=!0}},e.Attributes["@require"]=function(t,e){t.opt.use_context_condition=!0,this.strings.require=e},e.Attributes["@reject"]=function(t,e){t.opt.use_context_condition=!0,this.strings.reject=e},e.Attributes["@require-comma-on-symbol"]=function(t,e){t.opt.require_comma_on_symbol=e},e.Attributes["@gender"]=function(t,e){this.gender=e},e.Attributes["@cslid"]=function(t,e){this.cslid=parseInt(e,10)},e.Attributes["@capitalize-if-first"]=function(t,e){this.strings.capitalize_if_first_override=e},e.Attributes["@label-capitalize-if-first"]=function(t,e){this.strings.label_capitalize_if_first_override=e},e.Attributes["@label-form"]=function(t,e){this.strings.label_form_override=e},e.Attributes["@part-separator"]=function(t,e){this.strings["part-separator"]=e},e.Attributes["@leading-noise-words"]=function(t,e){this["leading-noise-words"]=e},e.Attributes["@name-never-short"]=function(t,e){this["name-never-short"]=e},e.Attributes["@class"]=function(t,e){t.opt.class=e},e.Attributes["@version"]=function(t,e){t.opt.version=e},e.Attributes["@value"]=function(t,e){this.strings.value=e},e.Attributes["@name"]=function(t,e){this.strings.name=e},e.Attributes["@form"]=function(t,e){this.strings.form=e},e.Attributes["@date-parts"]=function(t,e){this.strings["date-parts"]=e},e.Attributes["@range-delimiter"]=function(t,e){this.strings["range-delimiter"]=e},e.Attributes["@macro"]=function(t,e){this.postponed_macro=e},e.Attributes["@term"]=function(t,e){"sub verbo"===e?this.strings.term="sub-verbo":this.strings.term=e},e.Attributes["@xmlns"]=function(){},e.Attributes["@lang"]=function(t,e){e&&(t.build.lang=e)},e.Attributes["@lingo"]=function(){},e.Attributes["@macro-has-date"]=function(){this["macro-has-date"]=!0},e.Attributes["@suffix"]=function(t,e){this.strings.suffix=e},e.Attributes["@prefix"]=function(t,e){this.strings.prefix=e},e.Attributes["@delimiter"]=function(t,e){this.strings.delimiter=e},e.Attributes["@match"]=function(t,e){this.match=e},e.Attributes["@names-min"]=function(t,e){var i=parseInt(e,10);t[t.build.area].opt.max_number_of_names<i&&(t[t.build.area].opt.max_number_of_names=i),this.strings["et-al-min"]=i},e.Attributes["@names-use-first"]=function(t,e){this.strings["et-al-use-first"]=parseInt(e,10)},e.Attributes["@names-use-last"]=function(t,e){"true"===e?this.strings["et-al-use-last"]=!0:this.strings["et-al-use-last"]=!1},e.Attributes["@sort"]=function(t,i){"descending"===i&&(this.strings.sort_direction=e.DESCENDING)},e.Attributes["@plural"]=function(t,e){"always"===e||"true"===e?this.strings.plural=1:"never"===e||"false"===e?this.strings.plural=0:"contextual"===e&&(this.strings.plural=!1)},e.Attributes["@has-publisher-and-publisher-place"]=function(){this.strings["has-publisher-and-publisher-place"]=!0},e.Attributes["@publisher-delimiter-precedes-last"]=function(t,e){this.strings["publisher-delimiter-precedes-last"]=e},e.Attributes["@publisher-delimiter"]=function(t,e){this.strings["publisher-delimiter"]=e},e.Attributes["@publisher-and"]=function(t,e){this.strings["publisher-and"]=e},e.Attributes["@givenname-disambiguation-rule"]=function(t,i){e.GIVENNAME_DISAMBIGUATION_RULES.indexOf(i)>-1&&(t.citation.opt["givenname-disambiguation-rule"]=i)},e.Attributes["@collapse"]=function(t,e){e&&(t[this.name].opt.collapse=e)},e.Attributes["@cite-group-delimiter"]=function(t,e){e&&(t[t.tmp.area].opt.cite_group_delimiter=e)},e.Attributes["@names-delimiter"]=function(t,e){t.setOpt(this,"names-delimiter",e)},e.Attributes["@name-form"]=function(t,e){t.setOpt(this,"name-form",e)},e.Attributes["@subgroup-delimiter"]=function(t,e){this.strings["subgroup-delimiter"]=e},e.Attributes["@subgroup-delimiter-precedes-last"]=function(t,e){this.strings["subgroup-delimiter-precedes-last"]=e},e.Attributes["@name-delimiter"]=function(t,e){t.setOpt(this,"name-delimiter",e)},e.Attributes["@et-al-min"]=function(t,e){var i=parseInt(e,10);t[t.build.area].opt.max_number_of_names<i&&(t[t.build.area].opt.max_number_of_names=i),t.setOpt(this,"et-al-min",i)},e.Attributes["@et-al-use-first"]=function(t,e){t.setOpt(this,"et-al-use-first",parseInt(e,10))},e.Attributes["@et-al-use-last"]=function(t,e){"true"===e?t.setOpt(this,"et-al-use-last",!0):t.setOpt(this,"et-al-use-last",!1)},e.Attributes["@et-al-subsequent-min"]=function(t,e){var i=parseInt(e,10);t[t.build.area].opt.max_number_of_names<i&&(t[t.build.area].opt.max_number_of_names=i),t.setOpt(this,"et-al-subsequent-min",i)},e.Attributes["@et-al-subsequent-use-first"]=function(t,e){t.setOpt(this,"et-al-subsequent-use-first",parseInt(e,10))},e.Attributes["@suppress-min"]=function(t,e){this.strings["suppress-min"]=parseInt(e,10)},e.Attributes["@suppress-max"]=function(t,e){this.strings["suppress-max"]=parseInt(e,10)},e.Attributes["@and"]=function(t,e){t.setOpt(this,"and",e)},e.Attributes["@delimiter-precedes-last"]=function(t,e){t.setOpt(this,"delimiter-precedes-last",e)},e.Attributes["@delimiter-precedes-et-al"]=function(t,e){t.setOpt(this,"delimiter-precedes-et-al",e)},e.Attributes["@initialize-with"]=function(t,e){t.setOpt(this,"initialize-with",e)},e.Attributes["@initialize"]=function(t,e){"false"===e&&t.setOpt(this,"initialize",!1)},e.Attributes["@name-as-reverse-order"]=function(t,e){this["name-as-reverse-order"]=e},e.Attributes["@name-as-sort-order"]=function(t,e){"style-options"===this.name?this["name-as-sort-order"]=e:t.setOpt(this,"name-as-sort-order",e)},e.Attributes["@sort-separator"]=function(t,e){t.setOpt(this,"sort-separator",e)},e.Attributes["@require-match"]=function(t,e){"true"===e&&(this.requireMatch=!0)},e.Attributes["@exclude-types"]=function(t,e){t.bibliography.opt.exclude_types=e.split(/\s+/)},e.Attributes["@exclude-with-fields"]=function(t,e){t.bibliography.opt.exclude_with_fields=e.split(/\s+/)},e.Attributes["@year-suffix-delimiter"]=function(t,e){t[this.name].opt["year-suffix-delimiter"]=e},e.Attributes["@after-collapse-delimiter"]=function(t,e){t[this.name].opt["after-collapse-delimiter"]=e},e.Attributes["@subsequent-author-substitute"]=function(t,e){t[this.name].opt["subsequent-author-substitute"]=e},e.Attributes["@subsequent-author-substitute-rule"]=function(t,e){t[this.name].opt["subsequent-author-substitute-rule"]=e},e.Attributes["@disambiguate-add-names"]=function(t,e){"true"===e&&(t.opt["disambiguate-add-names"]=!0)},e.Attributes["@disambiguate-add-givenname"]=function(t,e){"true"===e&&(t.opt["disambiguate-add-givenname"]=!0)},e.Attributes["@disambiguate-add-year-suffix"]=function(t,e){"true"===e&&"numeric"!==t.opt.xclass&&(t.opt["disambiguate-add-year-suffix"]=!0)},e.Attributes["@second-field-align"]=function(t,e){("flush"===e||"margin"===e)&&(t[this.name].opt["second-field-align"]=e)},e.Attributes["@hanging-indent"]=function(t,e){"true"===e&&(t.opt.development_extensions.hanging_indent_legacy_number?t[this.name].opt.hangingindent=2:t[this.name].opt.hangingindent=!0)},e.Attributes["@line-spacing"]=function(t,e){e&&e.match(/^[.0-9]+$/)&&(t[this.name].opt["line-spacing"]=parseFloat(e,10))},e.Attributes["@entry-spacing"]=function(t,e){e&&e.match(/^[.0-9]+$/)&&(t[this.name].opt["entry-spacing"]=parseFloat(e,10))},e.Attributes["@near-note-distance"]=function(t,e){t[this.name].opt["near-note-distance"]=parseInt(e,10)},e.Attributes["@substring"]=function(t,e){this.substring=parseInt(e,10)},e.Attributes["@text-case"]=function(t,e){this.execs.push(function(t,i){"normal"===e?this.text_case_normal=!0:(this.strings["text-case"]=e,"title"===e&&i.jurisdiction&&(this.strings["text-case"]="passthrough"))})},e.Attributes["@page-range-format"]=function(t,e){t.opt["page-range-format"]=e},e.Attributes["@year-range-format"]=function(t,e){t.opt["year-range-format"]=e},e.Attributes["@default-locale"]=function(t,e){if("style"===this.name){var i,s,r,n,a=e.match(/-x-(sort|translit|translat)-/g);if(a)for(r=0,s=a.length;r<s;r+=1)a[r]=a[r].replace(/^-x-/,"").replace(/-$/,"");for(r=1,n=[(i=e.split(/-x-(?:sort|translit|translat)-/))[0]],s=i.length;r<s;r+=1)n.push(a[r-1]),n.push(i[r]);for(r=1,s=(i=n.slice()).length;r<s;r+=2)t.opt["locale-"+i[r]].push(i[r+1].replace(/^\s*/g,"").replace(/\s*$/g,""));i.length?t.opt["default-locale"]=i.slice(0,1):t.opt["default-locale"]=["en"]}else"true"===e&&(this.default_locale=!0)},e.Attributes["@default-locale-sort"]=function(t,e){t.opt["default-locale-sort"]=e},e.Attributes["@demote-non-dropping-particle"]=function(t,e){t.opt["demote-non-dropping-particle"]=e},e.Attributes["@initialize-with-hyphen"]=function(t,e){"false"===e&&(t.opt["initialize-with-hyphen"]=!1)},e.Attributes["@institution-parts"]=function(t,e){this.strings["institution-parts"]=e},e.Attributes["@if-short"]=function(t,e){"true"===e&&(this.strings["if-short"]=!0)},e.Attributes["@substitute-use-first"]=function(t,e){this.strings["substitute-use-first"]=parseInt(e,10)},e.Attributes["@use-first"]=function(t,e){this.strings["use-first"]=parseInt(e,10)},e.Attributes["@use-last"]=function(t,e){this.strings["use-last"]=parseInt(e,10)},e.Attributes["@stop-first"]=function(t,e){this.strings["stop-first"]=parseInt(e,10)},e.Attributes["@stop-last"]=function(t,e){this.strings["stop-last"]=-1*parseInt(e,10)},e.Attributes["@reverse-order"]=function(t,e){"true"===e&&(this.strings["reverse-order"]=!0)},e.Attributes["@display"]=function(t,e){2===t.bibliography.tokens.length&&(t.opt.using_display=!0),this.strings.cls=e},e.Stack=function(t,e){this.mystack=[],(e||t)&&this.mystack.push(t),this.tip=this.mystack[0]},e.Stack.prototype.push=function(t,e){e||t?this.mystack.push(t):this.mystack.push(""),this.tip=this.mystack[this.mystack.length-1]},e.Stack.prototype.clear=function(){this.mystack=[],this.tip={}},e.Stack.prototype.replace=function(t,i){0===this.mystack.length&&e.error("Internal CSL processor error: attempt to replace nonexistent stack item with "+t),i||t?this.mystack[this.mystack.length-1]=t:this.mystack[this.mystack.length-1]="",this.tip=this.mystack[this.mystack.length-1]},e.Stack.prototype.pop=function(){var t=this.mystack.pop();return this.mystack.length?this.tip=this.mystack[this.mystack.length-1]:this.tip={},t},e.Stack.prototype.value=function(){return this.mystack.slice(-1)[0]},e.Stack.prototype.length=function(){return this.mystack.length},e.Parallel=function(t){this.state=t},e.Parallel.prototype.StartCitation=function(t,e){if(this.state.tmp.suppress_repeats=[],!(t.length<2)){for(var i=0,s=!1,r=[],n=0,a=t.length-1;n<a;n++){var o=t[n][0],l=t[n+1][0],u=!1,p={};if(t[n][0].seeAlso&&t[n][0].seeAlso.length>0&&!s){u=!0;var h=(s=[t[n][0].id].concat(t[n][0].seeAlso)).slice(),c=t.slice(n);c[0][1].parallel="first";for(var m=0,f=c.length;m<f;m++){var d=c[m][0].id,g=h.indexOf(d);if(i=!1,-1===g?i=n+m-1:n+m===t.length-1&&(i=n+m),i){r.push([n,i]);break}h=h.slice(0,g).concat(h.slice(g+1))}}for(var b in n>0&&u&&(this.state.tmp.suppress_repeats[n-1].START=!0,u=!1),this.state.opt.track_repeat)if(o[b]&&l[b])if("string"==typeof l[b]||"number"==typeof l[b]){if("title"===b&&o["title-short"]&&l["title-short"])var _=o["title-short"],v=l["title-short"];else var _=o[b],v=l[b];_==v?p[b]=!0:p[b]=!1}else if(void 0===o[b].length){p[b]=!1;var y=o[b].year,x=l[b].year;y&&x&&y==x&&(p[b]=!0)}else{var _=JSON.stringify(o[b]),v=JSON.stringify(l[b]);_===v?p[b]=!0:p[b]=!1}else p[b]=!1;s||(p.ORPHAN=!0),i===n&&(p.END=!0,s=!1),this.state.tmp.suppress_repeats.push(p)}for(var m=0,f=r.length;m<f;m++){var I=t[r[m][0]][0].id;this.state.registry.registry[I].master=!0,this.state.registry.registry[I].siblings=[];for(var O=r[m][0],T=r[m][1],S=O;S<T;S++){this.state.tmp.suppress_repeats[S].SIBLING=!0;var N=t[S+1][0].id;t[S+1][1].parallel="other",this.state.registry.registry[I].siblings.push(N)}}}},e.Parallel.prototype.checkRepeats=function(t){var e=this.state.tmp.cite_index;if(this.state.tmp.suppress_repeats){if(t.parallel_first&&Object.keys(t.parallel_first).length>0){var i=[{}].concat(this.state.tmp.suppress_repeats),s=!0;for(var r in t.parallel_first)(!i[e][r]||i[e].START)&&(s=!1);return s}if(t.parallel_last&&Object.keys(t.parallel_last).length>0){var i=this.state.tmp.suppress_repeats.concat([{}]),s=Object.keys(t.parallel_last).length>0;for(var r in t.parallel_last)(!i[e][r]||i[e].END)&&(s=!1);return s}if(t.non_parallel&&Object.keys(t.non_parallel).length>0){var i=[{}].concat(this.state.tmp.suppress_repeats),s=!0;for(var r in t.non_parallel)i[e][r]||(s=!1);return s}}return!1},e.Util={},e.Util.Match=function(){this.any=function(t,e,i){return function(t,e){for(var s=0,r=i.length;s<r;s+=1)if(i[s](t,e))return!0;return!1}},this.none=function(t,e,i){return function(t,e){for(var s=0,r=i.length;s<r;s+=1)if(i[s](t,e))return!1;return!0}},this.all=function(t,e,i){return function(t,e){for(var s=0,r=i.length;s<r;s+=1)if(!i[s](t,e))return!1;return!0}},this[void 0]=this.all,this.nand=function(t,e,i){return function(t,e){for(var s=0,r=i.length;s<r;s+=1)if(!i[s](t,e))return!0;return!1}}},e.Transform=function(t){function i(e,i,s){var r="";return t.sys.getHumanForm&&("country"===e?r=(r=t.sys.getHumanForm(i.toLowerCase(),!1,!0)).split("|")[0]:"jurisdiction"===e&&(r=t.sys.getHumanForm(i.toLowerCase(),!1,!0),r=s?"":r.split("|").slice(1).join(", "))),r}function s(t,s,r,n,a,o,l){var u,p="",h=e.FIELD_CATEGORY_REMAP[o];if(!h)return a;var c=a;t.sys.normalizeAbbrevsKey&&(c=t.sys.normalizeAbbrevsKey(o,a));var m=!1;if("jurisdiction"===o&&c&&(m=-1===c.indexOf(":")),["jurisdiction","country"].indexOf(o)>-1&&a===a.toLowerCase()&&(c=a.toUpperCase()),t.sys.getAbbreviation){u=["jurisdiction","country","language-name","language-name-original"].indexOf(o)>-1?"default":r.jurisdiction?r.jurisdiction:"default";var f=t.transform.loadAbbreviation(u,h,c,r.language);if(t.transform.abbrevs[f][h]&&c){var d=t.transform.abbrevs[f][h][c];p="short"===s.strings.form&&d?m?"":d:i(o,c,m)}}return!p&&(!t.opt.development_extensions.require_explicit_legal_case_title_short||"legal_case"!==r.type)&&n&&r[n]&&l&&(p=r[n]),p||t.sys.getAbbreviation||!t.sys.getHumanForm||(p=i(o,c,m)),p||m||t.sys.getHumanForm&&"jurisdiction"===o||(p=a),t.opt.development_extensions.force_title_abbrev_fallback&&"title"===o&&p===a&&r["title-short"]&&(p=r["title-short"]),p}function r(e,i){var s,r=t.opt["default-locale"][0].slice(0,2);if(s=t.opt.development_extensions.strict_text_case_locales?RegExp("^([a-zA-Z]{2})(?:$|-.*| .*)"):RegExp("^([a-zA-Z]{2})(?:$|-.*|.*)"),e.language){var n=(""+e.language).match(s);r=n?n[1]:"tlh"}return e.multi&&e.multi&&e.multi.main&&e.multi.main[i]&&(r=e.multi.main[i]),(!t.opt.development_extensions.strict_text_case_locales||t.opt.development_extensions.normalize_lang_keys_to_lowercase)&&(r=r.toLowerCase()),r}function n(i,s,n,a,o,l){var u=!1;if(!i[s])return{name:"",usedOrig:o,token:e.Util.cloneToken(this)};var p=!1;e.VARIABLES_WITH_SHORT_FORM.indexOf(s)>-1&&l&&(s+="-short",p=!0);var h=!1,c=null,m=[];"-short"===s.slice(-6)?(m.push(s),m.push(s.slice(0,-6))):m.push(s);for(var f=0,d=m.length;f<d;f++){var g=!1,s=m[f];I={name:"",usedOrig:o,locale:r(i,s)},O=t.opt[n]?t.opt[n].slice():[];var b=!1;if("locale-orig"===n?(o||(I.name=i[s],I.usedOrig=!1),b=!0,u=!0):a&&(void 0===O||0===O.length)&&(I.name=i[s],I.usedOrig=!0,b=!0,u=!0),!b){for(var _=0,v=O.length;_<v;_+=1){if(x=(y=O[_]).split(/[\-_]/)[0],y&&i.multi&&i.multi._keys[s]&&i.multi._keys[s][y]){I.name=i.multi._keys[s][y],I.locale=y,b=!0,g=!0,u=!1;break}if(x&&i.multi&&i.multi._keys[s]&&i.multi._keys[s][x]){I.name=i.multi._keys[s][x],I.locale=x,b=!0,g=!0,u=!1;break}}!I.name&&a&&(I={name:i[s],usedOrig:!0,locale:r(i,s)},u=!0)}if(I.token=e.Util.cloneToken(this),0===f?(g&&(I.found_variant_ok=!0),c=I,p||void 0!==O&&0!==O.length||(h=!0),g&&(h=!0)):p||g||!c?g&&(I.found_variant_ok=!0):(I=c,s=m[0]),["title","container-title"].indexOf(s)>-1&&!o&&(!I.token.strings["text-case"]||"sentence"===I.token.strings["text-case"]||"normal"===I.token.strings["text-case"])){t.opt.lang;var y,x,I,O,T=!u&&I.locale,S=s.slice(0,-5),N="sentence"===I.token.strings["text-case"];I.name=e.titlecaseSentenceOrNormal(t,i,S,T,N),delete I.token.strings["text-case"]}if(h)break}return I}function a(e,i){var s=i.match(/^(?:#[0-9]+)*(?:!((?:[-_a-z]+(?:(?:.*)))(?:,(?:[-_a-z]+(?:(?:.*))))*))*>>>/);if(s&&(i=i.slice(s[0].length),s[1]))for(var r=s[1].split(","),n=0,a=r.length;n<a;n+=1){var o=r[n].match(/^([-_a-z]+)(?:\:(.*))*$/),l=o[1],u=t.tmp.abbrev_trimmer;o[2]?u&&e&&(u[e]||(u[e]={}),u[e][l]=o[2]):-1===t.tmp.done_vars.indexOf(l)&&(u&&e&&(u.QUASHES[e]||(u.QUASHES[e]={}),u.QUASHES[e][l]=!0),t.tmp.done_vars.push(l))}return i}this.abbrevs={},this.abbrevs.default=new t.sys.AbbreviationSegments,this.getTextSubField=n,this.loadAbbreviation=function(i,s,r,n){i||(i="default");var a=i.split(":")[0],o=e.getAbbrevsDomain(t,a,n);return(o&&(i+="@"+o),r)?t.sys.getAbbreviation&&((i=t.sys.getAbbreviation(t.opt.styleID,t.transform.abbrevs,i,s,r))||(i="default",o&&(i+="@"+o))):(t.transform.abbrevs[i]||(t.transform.abbrevs[i]=new t.sys.AbbreviationSegments),t.transform.abbrevs[i][s]||(t.transform.abbrevs[i][s]={})),i},this.quashCheck=a,this.getOutputFunction=function(i,r,o,l){var u,p=e.LangPrefsMap[i[0]];return u=!!p&&t.opt["cite-lang-prefs"][p],function(o,h,c){if(!i[0]||!h[i[0]]&&!h[l]||!o.tmp.just_looking&&c&&c["suppress-author"]&&!o.tmp.probably_rendered_something&&o.tmp.can_substitute.length()>1)return null;var m,f,d,g,b,_,v,y,x,I,O,T={primary:!1,secondary:!1,tertiary:!1};if("_sort"===o.tmp.area.slice(-5))T.primary="locale-sort";else if(u&&1===u.length&&"locale-orig"===u[0])T.primary="locale-orig",u=!1;else if(u&&!o.tmp.multi_layout)for(var S=["primary","secondary","tertiary"],N=0,A=S.length;N<A&&!(u.length-1<N);N+=1)u[N]&&(T[S[N]]="locale-"+u[N]);else T.primary="locale-orig";if("title-short"!==i[0]&&("bibliography"===o.tmp.area||"citation"===o.tmp.area&&"note"===o.opt.xclass&&c&&!c.position)||(T.secondary=!1,T.tertiary=!1),o.tmp.multi_layout&&(T.secondary=!1,T.tertiary=!1),o.tmp["publisher-list"])return"publisher"===i[0]?o.tmp["publisher-token"]=this:"publisher-place"===i[0]&&(o.tmp["publisher-place-token"]=this),null;var E=o.tmp.lang_array.slice(),k=n.call(this,h,i[0],T.primary,!0,null,r);f=k.name,d=k.locale;var y=k.token,R=k.usedOrig;if(r&&!k.found_variant_ok&&(f=s(o,y,h,l,f,r,!0))&&((m=f.match(/^#([0-9]+).*>>>/))&&m[1]&&(h["cite-form"]=m[1]),o.tmp.just_looking||(f=a(h.jurisdiction,f))),function(e,i,r,n){var a=e.variables[0];if(t.publisherOutput&&r)if(-1===["publisher","publisher-place"].indexOf(a));else{t.publisherOutput[a+"-token"]=e,t.publisherOutput.varlist.push(a);var o=r.split(/;\s*/);o.length===t.publisherOutput[a+"-list"].length&&(t.publisherOutput[a+"-list"]=o);for(var l=0,u=o.length;l<u;l+=1)o[l]=s(t,e,i,!1,o[l],n,!0);return t.tmp[a+"-token"]=e,!0}return!1}(this,h,f,r))return o.tmp.lang_array=E,null;if(g=!1,_=!1,T.secondary&&(g=(k=n.call(this,h,i[0],T.secondary,!1,k.usedOrig,null,r)).name,b=k.locale,x=k.token,r&&!k.found_variant_ok&&g&&(g=s(o,x,h,!1,g,r,!0))),T.tertiary&&(_=(k=n.call(this,h,i[0],T.tertiary,!1,k.usedOrig,null,r)).name,v=k.locale,I=k.token,r&&!k.found_variant_ok&&_&&(_=s(o,I,h,!1,_,r,!0))),"locale-translit"===T.primary&&(O=o.opt.citeAffixes[p][T.primary].prefix),"<i>"===O&&"title"===i[0]&&!R){for(var w=!1,N=0,A=y.decorations.length;N<A;N+=1)"@font-style"===y.decorations[N][0]&&"italic"===y.decorations[N][1]&&(w=!0);w||y.decorations.push(["@font-style","italic"])}if("en"!==d&&"title"===y.strings["text-case"]&&(y.strings["text-case"]="passthrough"),"title"===i[0]&&(f=e.demoteNoiseWords(o,f,this["leading-noise-words"])),g||_){if(o.output.openLevel("empty"),y.strings.suffix=y.strings.suffix.replace(/[ .,]+$/,""),d&&(o.tmp.lang_array=[d].concat(E)),e.UPDATE_GROUP_CONTEXT_CONDITION(o,null,null,y,y.strings.prefix+f),o.output.append(f,y),o.tmp.probably_rendered_something=!0,f===g&&(g=!1),g){x.strings.prefix=o.opt.citeAffixes[p][T.secondary].prefix,x.strings.suffix=o.opt.citeAffixes[p][T.secondary].suffix,x.strings.prefix||(x.strings.prefix=" ");for(var N=x.decorations.length-1;N>-1;N+=-1)["@quotes/true","@font-style/italic","@font-style/oblique","@font-weight/bold"].indexOf(x.decorations[N].join("/"))>-1&&(x.decorations=x.decorations.slice(0,N).concat(x.decorations.slice(N+1)));"en"!==b&&"title"===x.strings["text-case"]&&(x.strings["text-case"]="passthrough"),b&&(o.tmp.lang_array=[b].concat(E));var j=new e.Token;j.decorations.push(["@font-style","normal"]),j.decorations.push(["@font-weight","normal"]),o.output.openLevel(j),o.output.append(g,x),o.output.closeLevel(),o.output.current.value(),o.output.current.value().blobs.length}if(f===_&&(_=!1),_){I.strings.prefix=o.opt.citeAffixes[p][T.tertiary].prefix,I.strings.suffix=o.opt.citeAffixes[p][T.tertiary].suffix,I.strings.prefix||(I.strings.prefix=" ");for(var N=I.decorations.length-1;N>-1;N+=-1)["@quotes/true","@font-style/italic","@font-style/oblique","@font-weight/bold"].indexOf(I.decorations[N].join("/"))>-1&&(I.decorations=I.decorations.slice(0,N).concat(I.decorations.slice(N+1)));"en"!==v&&"title"===I.strings["text-case"]&&(I.strings["text-case"]="passthrough"),v&&(o.tmp.lang_array=[v].concat(E));var C=new e.Token;C.decorations.push(["@font-style","normal"]),C.decorations.push(["@font-weight","normal"]),o.output.openLevel(C),o.output.append(_,I),o.output.closeLevel(),o.output.current.value(),o.output.current.value().blobs.length}o.output.closeLevel()}else d&&(o.tmp.lang_array=[d].concat(E)),e.UPDATE_GROUP_CONTEXT_CONDITION(o,null,null,y,y.strings.prefix+f),o.output.append(f,y),o.tmp.probably_rendered_something=!0;return o.tmp.lang_array=E,o.tmp.can_block_substitute&&o.tmp.name_node.children.push(o.output.current.value()),null}}},e.Token=function(t,e,i){this.name=t,this.strings={},this.strings.delimiter=void 0,this.strings.prefix="",this.strings.suffix="",this.decorations=[],this.variables=[],this.execs=[],this.tokentype=e},e.Util.cloneToken=function(t){var i,s,r,n;if("string"==typeof t)return t;for(var s in i=new e.Token(t.name,t.tokentype),t.strings)t.strings.hasOwnProperty(s)&&(i.strings[s]=t.strings[s]);if(t.decorations)for(r=0,i.decorations=[],n=t.decorations.length;r<n;r+=1)i.decorations.push(t.decorations[r].slice());return t.variables&&(i.variables=t.variables.slice()),t.execs&&(i.execs=t.execs.slice(),t.tests&&(i.tests=t.tests.slice())),i},e.AmbigConfig=function(){this.maxvals=[],this.minval=1,this.names=[],this.givens=[],this.year_suffix=!1,this.disambiguate=0},e.Blob=function(t,e,i){var s,r,n;if(this.levelname=i,e){for(var n in this.strings={prefix:"",suffix:""},e.strings)e.strings.hasOwnProperty(n)&&(this.strings[n]=e.strings[n]);for(r=0,this.decorations=[],s=void 0===e.decorations?0:e.decorations.length;r<s;r+=1)this.decorations.push(e.decorations[r].slice())}else this.strings={},this.strings.prefix="",this.strings.suffix="",this.strings.delimiter="",this.decorations=[];"string"==typeof t?this.blobs=t:t?this.blobs=[t]:this.blobs=[],this.alldecor=[this.decorations]},e.Blob.prototype.push=function(t){"string"==typeof this.blobs?e.error("Attempt to push blob onto string object"):!1!==t&&(t.alldecor=t.alldecor.concat(this.alldecor),this.blobs.push(t))},e.NumericBlob=function(t,i,s,r,n){if(this.id=n,this.alldecor=[],this.num=s,this.particle=i,this.blobs=s.toString(),this.status=e.START,this.strings={},r){if(r.strings["text-case"]){var a=r.strings["text-case"];this.particle=e.Output.Formatters[a](t,this.particle),this.blobs=e.Output.Formatters[a](t,this.blobs)}this.gender=r.gender,this.decorations=r.decorations,this.strings.prefix=r.strings.prefix,this.strings.suffix=r.strings.suffix,this.strings["text-case"]=r.strings["text-case"],this.successor_prefix=r.successor_prefix,this.range_prefix=r.range_prefix,this.splice_prefix=r.splice_prefix,this.formatter=r.formatter,this.formatter||(this.formatter=new e.Output.DefaultFormatter),this.formatter&&(this.type=this.formatter.format(1))}else this.decorations=[],this.strings.prefix="",this.strings.suffix="",this.successor_prefix="",this.range_prefix="",this.splice_prefix="",this.formatter=new e.Output.DefaultFormatter},e.NumericBlob.prototype.setFormatter=function(t){this.formatter=t,this.type=this.formatter.format(1)},e.Output.DefaultFormatter=function(){},e.Output.DefaultFormatter.prototype.format=function(t){return t.toString()},e.NumericBlob.prototype.checkNext=function(t,i){i?(this.status=e.START,"object"==typeof t&&(t.num===this.num+1?t.status=e.SUCCESSOR:t.status=e.SEEN)):t&&t.num&&this.type===t.type&&t.num===this.num+1?this.status===e.START||this.status===e.SEEN?t.status=e.SUCCESSOR:(this.status===e.SUCCESSOR||this.status===e.SUCCESSOR_OF_SUCCESSOR)&&(this.range_prefix?(t.status=e.SUCCESSOR_OF_SUCCESSOR,this.status=e.SUPPRESS):t.status=e.SUCCESSOR):(this.status===e.SUCCESSOR_OF_SUCCESSOR&&(this.status=e.END),"object"==typeof t&&(t.status=e.SEEN))},e.NumericBlob.prototype.checkLast=function(t){return(this.status===e.SEEN||t.num!==this.num-1&&this.status===e.SUCCESSOR)&&(this.status=e.SUCCESSOR,!0)},e.Util.fixDateNode=function(t,e,i){var s,r,n,a,o,l,u,p,h,c,m,f,d,g=this.cslXml.getAttributeValue(i,"lingo"),b=this.cslXml.getAttributeValue(i,"default-locale");if(this.build.date_key=!0,s=this.cslXml.getAttributeValue(i,"form"),g=b?this.opt["default-locale"][0]:this.cslXml.getAttributeValue(i,"lingo"),!this.getDate(s,b))return t;var _=this.cslXml.getAttributeValue(i,"date-parts");for(var v in r=this.cslXml.getAttributeValue(i,"variable"),p=this.cslXml.getAttributeValue(i,"prefix"),h=this.cslXml.getAttributeValue(i,"suffix"),f=this.cslXml.getAttributeValue(i,"display"),d=this.cslXml.getAttributeValue(i,"cslid"),n=this.cslXml.nodeCopy(this.getDate(s,b)),this.cslXml.setAttribute(n,"lingo",this.opt.lang),this.cslXml.setAttribute(n,"form",s),this.cslXml.setAttribute(n,"date-parts",_),this.cslXml.setAttribute(n,"cslid",d),this.cslXml.setAttribute(n,"variable",r),this.cslXml.setAttribute(n,"default-locale",b),p&&this.cslXml.setAttribute(n,"prefix",p),h&&this.cslXml.setAttribute(n,"suffix",h),f&&this.cslXml.setAttribute(n,"display",f),c=this.cslXml.children(n))a=c[v],"date-part"===this.cslXml.nodename(a)&&(o=this.cslXml.getAttributeValue(a,"name"),b&&this.cslXml.setAttributeOnNodeIdentifiedByNameAttribute(n,"date-part",o,"@default-locale","true"));for(var v in c=this.cslXml.children(i))if(a=c[v],"date-part"===this.cslXml.nodename(a))for(l in o=this.cslXml.getAttributeValue(a,"name"),m=this.cslXml.attributes(a))"@name"!==l&&(g&&g!==this.opt.lang&&["@suffix","@prefix","@form"].indexOf(l)>-1||(u=m[l],this.cslXml.setAttributeOnNodeIdentifiedByNameAttribute(n,"date-part",o,l,u)));if("year"===this.cslXml.getAttributeValue(i,"date-parts"))this.cslXml.deleteNodeByNameAttribute(n,"month"),this.cslXml.deleteNodeByNameAttribute(n,"day");else if("year-month"===this.cslXml.getAttributeValue(i,"date-parts"))this.cslXml.deleteNodeByNameAttribute(n,"day");else if("month-day"===this.cslXml.getAttributeValue(i,"date-parts")){for(var y=this.cslXml.children(n),x=1,I=this.cslXml.numberofnodes(y);x<I;x++)if("year"===this.cslXml.getAttributeValue(y[x],"name")){this.cslXml.setAttribute(y[x-1],"suffix","");break}this.cslXml.deleteNodeByNameAttribute(n,"year")}return this.cslXml.insertChildNodeAfter(t,i,e,n)},e.dateMacroAsSortKey=function(t,i){e.dateAsSortKey.call(this,t,i,!0)},e.dateAsSortKey=function(t,i,s){var r,n,a,o,l,u,p,h,c=this.variables[0],m="empty";if(s&&t.tmp.extension&&(m="macro-with-date"),void 0===(r=i[c])&&(r={"date-parts":[[0]]}),void 0===this.dateparts&&(this.dateparts=["year","month","day"]),r.raw?r=t.fun.dateparser.parseDateToArray(r.raw):r["date-parts"]&&(r=t.dateParseArray(r)),void 0===r&&(r={}),r.year)for(p=0,h=e.DATE_PARTS_INTERNAL.length;p<h;p+=1)if(n=e.DATE_PARTS_INTERNAL[p],a=0,"_end"===(o=n).slice(-4)&&(o=o.slice(0,-4)),r[n]&&this.dateparts.indexOf(o)>-1&&(a=r[n]),"year"===n.slice(0,4)){l=e.Util.Dates[o].numeric(t,a);var u="1";"-"===l[0]&&(u="0",l=9999-parseInt(l=l.slice(1),10)),t.output.append(e.Util.Dates[n.slice(0,4)].numeric(t,u+l),m)}else(a=e.Util.Dates[o]["numeric-leading-zeros"](t,a))||(a="00"),t.output.append(a,m)},e.Engine.prototype.dateParseArray=function(t){var i,s,r,n;for(s in i={},t)if("date-parts"===s){(r=t["date-parts"]).length>1&&r[0].length!==r[1].length&&e.error("CSL data error: element mismatch in date range input."),n=["","_end"];for(var a=0,o=r.length;a<o;a+=1)for(var l=0,u=e.DATE_PARTS.length;l<u;l+=1)isNaN(parseInt(r[a][l],10))?i[e.DATE_PARTS[l]+n[a]]=void 0:i[e.DATE_PARTS[l]+n[a]]=parseInt(r[a][l],10)}else t.hasOwnProperty(s)&&("literal"===s&&"object"==typeof t.literal&&"string"==typeof t.literal.part?(e.debug("Warning: fixing up weird literal date value"),i.literal=t.literal.part):i[s]=t[s]);return i},e.Util.Names={},e.Util.Names.compareNamesets=e.NameOutput.prototype._compareNamesets,e.Util.Names.unInitialize=function(t,e){var i,s,r,n,a;if(!e)return"";for(i=0,r=e.split(/(?:\-|\s+)/),n=e.match(/(\-|\s+)/g),a="",s=r.length;i<s;i+=1)a+=r[i],i<s-1&&(a+=n[i]);return a},e.Util.Names.initializeWith=function(t,i,s,r){if(!i)return"";if(s||(s=""),["Lord","Lady"].indexOf(i)>-1||!i.replace(/^(?:<[^>]+>)*/,"").match(e.STARTSWITH_ROMANESQUE_REGEXP)&&!s.match("%s"))return i;!1===t.opt["initialize-with-hyphen"]&&(i=i.replace(/\-/g," ")),i=(i=i.replace(/\s*\-\s*/g,"-").replace(/\s+/g," ")).replace(/-([a-z])/g,"–$1");for(var n,a,o,n=i.length-2;n>-1;n+=-1)"."===i.slice(n,n+1)&&" "!==i.slice(n+1,n+2)&&(i=i.slice(0,n)+". "+i.slice(n+1));var l=e.Output.Formatters.nameDoppel.split(i),u=[];if(u=[l.strings[0]],0===l.tags.length){var p=u[0].match(/[^\.]+$/);p&&1===p[0].length&&p[0]!==p[0].toLowerCase()&&(u[0]+=".")}for(n=1,a=l.strings.length;n<a;n+=1)u.push(l.tags[n-1]),u.push(l.strings[n]);return(r?this.doNormalize(t,u,s):this.doInitialize(t,u,s)).replace(/\u2013([a-z])/g,"-$1")},e.Util.Names.notag=function(t){return t.replace(/^(?:<[^>]+>)*/,"")},e.Util.Names.mergetag=function(t,e,i){var s=e.match(/(?:-*<[^>]+>-*)/g);return s&&(e=s.join(""),(s=i.match(/^(.*[^\s])*(\s+)$/))?(s[1]=s[1]?s[1]:"",i=s[1]+e+s[2]):i+=e),i},e.Util.Names.tagonly=function(t,e){var i=e.match(/(?:<[^>]+>)+/);return i?i.join(""):e},e.Util.Names.doNormalize=function(t,e,i){i=i||"";var s,r,n=[];for(s=0,r=e.length;s<r;s+=1)this.notag(e[s]).length>1&&"."===this.notag(e[s]).slice(-1)?(e[s]=e[s].replace(/^(.*)\.(.*)$/,"$1$2"),n.push(!0)):1===e[s].length&&e[s].toUpperCase()===e[s]?n.push(!0):n.push(!1);for(s=0,r=e.length;s<r;s+=2)n[s]&&(s<e.length-2&&(e[s+1]=this.tagonly(t,e[s+1]),n[s+2]||(e[s+1]=this.tagonly(t,e[s+1])+" "),e[s+2].length>1?e[s+1]=i.replace(/\ufeff$/,"")+e[s+1]:e[s+1]=this.mergetag(t,e[s+1],i)),s===e.length-1&&(e[s]=e[s]+i));return e.join("").replace(/[\u0009\u000a\u000b\u000c\u000d\u0020\ufeff\u00a0]+$/,"").replace(/\s*\-\s*/g,"-").replace(/[\u0009\u000a\u000b\u000c\u000d\u0020]+/g," ")},e.Util.Names.doInitialize=function(t,i,s){for(r=0,n=i.length;r<n;r+=2)if(p=i[r])if(!(a=p.match(e.NAME_INITIAL_REGEXP))&&!p.match(e.STARTSWITH_ROMANESQUE_REGEXP)&&p.length>1&&s.match("%s")&&(a=p.match(/(.)(.*)/)),a&&a[2]&&a[3]&&(a[1]=a[1]+a[2],a[2]=""),a&&a[1].slice(0,1)===a[1].slice(0,1).toUpperCase()){var r,n,a,o,l,u,p,h="";if(a[2]){var c="";for(o=0,l=(u=a[2].split("")).length;o<l;o+=1){var m=u[o];if(m===m.toUpperCase())c+=m;else break}c.length<a[2].length&&(h=e.toLocaleLowerCase.call(t,c))}i[r]=a[1]+h,r<n-1?s.match("%s")?i[r]=s.replace("%s",i[r]):i[r+1].indexOf("-")>-1?i[r+1]=this.mergetag(t,i[r+1].replace("-",""),s)+"-":i[r+1]=this.mergetag(t,i[r+1],s):s.match("%s")?i[r]=s.replace("%s",i[r]):i.push(s)}else!p.match(e.ROMANESQUE_REGEXP)||a&&a[3]||(i[r]=" "+p);var f=i.join("");return f.replace(/[\u0009\u000a\u000b\u000c\u000d\u0020\ufeff\u00a0]+$/,"").replace(/\s*\-\s*/g,"-").replace(/[\u0009\u000a\u000b\u000c\u000d\u0020]+/g," ")},e.Util.Names.getRawName=function(t){var e=[];return t.literal?e.push(t.literal):(t.given&&e.push(t.given),t.family&&e.push(t.family)),e.join(" ")},e.Util.Dates={},e.Util.Dates.year={},e.Util.Dates.year.long=function(t,e){return e||(e="boolean"==typeof e?"":0),e.toString()},e.Util.Dates.year.imperial=function(t,e,i){var s,r,n="";e||(e="boolean"==typeof e?"":0),i=i?"_end":"";var a=t.tmp.date_object["month"+i];for(a=a?""+a:"1";a.length<2;)a="0"+a;var o=t.tmp.date_object["day"+i];for(o=o?""+o:"1";o.length<2;)o="0"+o;var l=parseInt(e+a+o,10);if(l>=0x11d0c4c&&l<0x123c25a?(s="明治",r=1867):l>=0x123c25a&&l<0x125e729?(s="大正",r=1911):l>=0x125e729&&l<0x12f7fbc?(s="昭和",r=1925):l>=0x12f7fbc&&(s="平成",r=1988),s&&r){var u=s;t.sys.normalizeAbbrevsKey&&(u=t.sys.normalizeAbbrevsKey("number",s)),t.transform.abbrevs.default.number[u]||t.transform.loadAbbreviation("default","number",u,null),t.transform.abbrevs.default.number[u]&&(s=t.transform.abbrevs.default.number[u]),n=s+(e-r)}return n},e.Util.Dates.year.short=function(t,e){if((e=e.toString())&&4===e.length)return e.substr(2)},e.Util.Dates.year.numeric=function(t,e){var i,s=(e=""+e).match(/([0-9]*)$/);for(s?(i=e.slice(0,-1*s[1].length),e=s[1]):(i=e,e="");e.length<4;)e="0"+e;return i+e},e.Util.Dates.normalizeMonth=function(t,e){var i;if(t||(t=0),(t=""+t).match(/^[0-9]+$/)||(t=0),t=parseInt(t,10),e){var s={stub:"month-",num:t};if(s.num<1||s.num>24)s.num=0;else{for(;s.num>16;)s.num=s.num-4;s.num>12&&(s.stub="season-",s.num=s.num-12)}i=s}else(t<1||t>12)&&(t=0),i=t;return i},e.Util.Dates.month={},e.Util.Dates.month.numeric=function(t,i){var i=e.Util.Dates.normalizeMonth(i);return i||(i=""),i},e.Util.Dates.month["numeric-leading-zeros"]=function(t,i){var i=e.Util.Dates.normalizeMonth(i);if(i)for(i=""+i;i.length<2;)i="0"+i;else i="";return i},e.Util.Dates.month.long=function(t,i,s,r){var n=e.Util.Dates.normalizeMonth(i,!0),i=n.num;if(i){for(i=""+i;i.length<2;)i="0"+i;i=t.getTerm(n.stub+i,"long",0,0,!1,r)}else i="";return i},e.Util.Dates.month.short=function(t,i,s,r){var n=e.Util.Dates.normalizeMonth(i,!0),i=n.num;if(i){for(i=""+i;i.length<2;)i="0"+i;i=t.getTerm(n.stub+i,"short",0,0,!1,r)}else i="";return i},e.Util.Dates.day={},e.Util.Dates.day.numeric=function(t,e){return e.toString()},e.Util.Dates.day.long=e.Util.Dates.day.numeric,e.Util.Dates.day["numeric-leading-zeros"]=function(t,e){for(e||(e=0),e=e.toString();e.length<2;)e="0"+e;return e.toString()},e.Util.Dates.day.ordinal=function(t,e,i){return t.fun.ordinalizer.format(e,i)},e.Util.Sort={},e.Util.Sort.strip_prepositions=function(t){var e;return"string"==typeof t&&(e=t.match(/^(([aA]|[aA][nN]|[tT][hH][eE])\s+)/)),e&&(t=t.substr(e[1].length)),t},e.Util.substituteStart=function(t,i){var s,r,n,a,o;n=function(t,e,i){for(var s=0,r=this.decorations.length;s<r;s+=1)if("@strip-periods"===this.decorations[s][0]&&"true"===this.decorations[s][1]){t.tmp.strip_periods+=1;break}},this.execs.push(n),this.decorations&&t.opt.development_extensions.csl_reverse_lookup_support&&(this.decorations.reverse(),this.decorations.push(["@showid","true",this.cslid]),this.decorations.reverse()),("text"===this.name&&!this.postponed_macro||["number","date","names"].indexOf(this.name)>-1)&&this.execs.push(function(t,e,i){"author"===t.tmp.element_trace.value()||"names"===this.name?(!t.tmp.just_looking&&i&&i["author-only"]&&"intext"!==t.tmp.area&&t.tmp.probably_rendered_something&&t.tmp.element_trace.push("suppress-me"),!t.tmp.just_looking&&i&&i["suppress-author"]&&!t.tmp.probably_rendered_something&&t.tmp.element_trace.push("suppress-me")):"date"===this.name?!t.tmp.just_looking&&i&&i["author-only"]&&"intext"!==t.tmp.area&&t.tmp.probably_rendered_something&&t.tmp.element_trace.push("suppress-me"):!t.tmp.just_looking&&i&&i["author-only"]&&"intext"!==t.tmp.area?!t.tmp.probably_rendered_something&&t.tmp.can_block_substitute||t.tmp.element_trace.push("suppress-me"):i&&i["suppress-author"]&&t.tmp.element_trace.push("do-not-suppress-me")}),s=this.strings.cls,this.strings.cls=!1,0===t.build.render_nesting_level&&("bibliography"===t.build.area&&t.bibliography.opt["second-field-align"]?((r=new e.Token("group",e.START)).decorations=[["@display","left-margin"]],n=function(t,e){t.tmp.render_seen||(r.strings.first_blob=e.id,t.output.startTag("bib_first",r))},r.execs.push(n),i.push(r)):e.DISPLAY_CLASSES.indexOf(s)>-1&&((r=new e.Token("group",e.START)).decorations=[["@display",s]],n=function(t,e){r.strings.first_blob=e.id,t.output.startTag("bib_first",r)},r.execs.push(n),i.push(r)),t.build.cls=s),t.build.render_nesting_level+=1,1===t.build.substitute_level.value()&&(a=new e.Token("choose",e.START),e.Node.choose.build.call(a,t,i),o=new e.Token("if",e.START),n=function(){return!!t.tmp.can_substitute.value()},o.tests||(o.tests=[]),o.tests.push(n),o.test=t.fun.match.any(this,t,o.tests),i.push(o)),t.sys.variableWrapper&&this.variables_real&&this.variables_real.length&&(n=function(t,i,s){if(!t.tmp.just_looking&&!t.tmp.suppress_decorations){var r=new e.Token("text",e.START);r.decorations=[["@showid","true"]],t.output.startTag("variable_entry",r);var n=null;s&&(n=s.position),n||(n=0);var a=0;s&&s.noteIndex&&(a=s.noteIndex);var o=0;s&&s["first-reference-note-number"]&&(o=s["first-reference-note-number"]);var l=0;s&&s["first-container-reference-note-number"]&&(l=s["first-container-reference-note-number"]);var u=0;s&&s["citation-number"]&&(u=s["citation-number"]);var p=0;s&&s.index&&(p=s.index);var h={itemData:i,variableNames:this.variables,context:t.tmp.area,xclass:t.opt.xclass,position:["first","container-subsequent","subsequent","ibid","ibid-with-locator"][n],"note-number":a,"first-reference-note-number":o,"first-container-reference-note-number":l,"citation-number":u,index:p,mode:t.opt.mode};t.output.current.value().params=h}},this.execs.push(n))},e.Util.substituteEnd=function(t,i){var s,r,n,a,o,l;if(t.sys.variableWrapper&&(this.hasVariable||this.variables_real&&this.variables_real.length)&&(s=function(t){t.tmp.just_looking||t.tmp.suppress_decorations||t.output.endTag("variable_entry")},this.execs.push(s)),s=function(t){for(var e=0,i=this.decorations.length;e<i;e+=1)if("@strip-periods"===this.decorations[e][0]&&"true"===this.decorations[e][1]){t.tmp.strip_periods+=-1;break}},this.execs.push(s),t.build.render_nesting_level+=-1,0===t.build.render_nesting_level&&(t.build.cls?(s=function(t){t.output.endTag("bib_first")},this.execs.push(s),t.build.cls=!1):"bibliography"===t.build.area&&t.bibliography.opt["second-field-align"]&&(r=new e.Token("group",e.END),s=function(t){t.tmp.render_seen||t.output.endTag("bib_first")},r.execs.push(s),i.push(r),(n=new e.Token("group",e.START)).decorations=[["@display","right-inline"]],s=function(t){t.tmp.render_seen||(t.tmp.render_seen=!0,t.output.startTag("bib_other",n))},n.execs.push(s),i.push(n))),1===t.build.substitute_level.value()&&(a=new e.Token("if",e.END),i.push(a),o=new e.Token("choose",e.END),e.Node.choose.build.call(o,t,i)),"names"===this.name||"text"===this.name&&"title"!==this.variables_real){new e.Token("text",e.SINGLETON);var u=this.name;s=function(t,i){if("bibliography"===t.tmp.area&&"string"==typeof t.bibliography.opt["subsequent-author-substitute"]&&(!this.variables_real||i[this.variables_real])&&(!this.variables_real||"names"!==u)){var s,r,n=t.bibliography.opt["subsequent-author-substitute-rule"];if(!t.tmp.suppress_decorations&&t.tmp.subsequent_author_substitute_ok&&t.tmp.rendered_name){if("partial-each"===n||"partial-first"===n){var a=!0,o=[];for(s=0,r=t.tmp.name_node.children.length;s<r;s+=1){var p=t.tmp.rendered_name[s];a&&t.tmp.last_rendered_name&&t.tmp.last_rendered_name.length>s-1&&p&&!p.localeCompare(t.tmp.last_rendered_name[s])?(l=new e.Blob(t[t.tmp.area].opt["subsequent-author-substitute"]),t.tmp.name_node.children[s].blobs=[l],"partial-first"===n&&(a=!1)):a=!1,o.push(p)}t.tmp.last_rendered_name=o}else if("complete-each"===n){var o=t.tmp.rendered_name.join(",");if(o){if(t.tmp.last_rendered_name&&!o.localeCompare(t.tmp.last_rendered_name))for(s=0,r=t.tmp.name_node.children.length;s<r;s+=1)l=new e.Blob(t[t.tmp.area].opt["subsequent-author-substitute"]),t.tmp.name_node.children[s].blobs=[l];t.tmp.last_rendered_name=o}}else{var o=t.tmp.rendered_name.join(",");o&&(t.tmp.last_rendered_name&&!o.localeCompare(t.tmp.last_rendered_name)&&(l=new e.Blob(t[t.tmp.area].opt["subsequent-author-substitute"]),t.tmp.label_blob?t.tmp.name_node.top.blobs=[l,t.tmp.label_blob]:t.tmp.name_node.top.blobs.length?t.tmp.name_node.top.blobs[0].blobs=[l]:t.tmp.name_node.top.blobs=[l],t.tmp.substituted_variable=u),t.tmp.last_rendered_name=o)}t.tmp.subsequent_author_substitute_ok=!1}}},this.execs.push(s)}("text"===this.name&&!this.postponed_macro||["number","date","names"].indexOf(this.name)>-1)&&(s=function(t,e){t.tmp.element_trace.mystack.length>1&&t.tmp.element_trace.pop()},this.execs.push(s))},e.Util.padding=function(t){var e=t.match(/\s*(-{0,1}[0-9]+)/);if(e)for((t=parseInt(e[1],10))<0&&(t=1e20+t),t=""+t;t.length<20;)t="0"+t;return t},e.Util.LongOrdinalizer=function(){},e.Util.LongOrdinalizer.prototype.init=function(t){this.state=t},e.Util.LongOrdinalizer.prototype.format=function(t,i){t<10&&(t="0"+t);var s=e.Engine.getField(e.LOOSE,this.state.locale[this.state.opt.lang].terms,"long-ordinal-"+t,"long",0,i);return s||(s=this.state.fun.ordinalizer.format(t,i)),this.state.tmp.cite_renders_content=!0,s},e.Util.Ordinalizer=function(t){this.state=t,this.suffixes={}},e.Util.Ordinalizer.prototype.init=function(){if(!this.suffixes[this.state.opt.lang]){this.suffixes[this.state.opt.lang]={};for(var t=0;t<3;t+=1){var e=[void 0,"masculine","feminine"][t];this.suffixes[this.state.opt.lang][e]=[];for(var i=1;i<5;i+=1){var s=this.state.getTerm("ordinal-0"+i,"long",!1,e);if(void 0===s){delete this.suffixes[this.state.opt.lang][e];break}this.suffixes[this.state.opt.lang][e].push(s)}}}},e.Util.Ordinalizer.prototype.format=function(t,e){r=""+(t=parseInt(t,10));var i="",s=[];if(e&&s.push(e),s.push("neuter"),this.state.locale[this.state.opt.lang].ord["1.0.1"]){i=this.state.getTerm("ordinal",!1,0,e);for(var r,n,a=0,o=s.length;a<o;a+=1){n=s[a];var l=this.state.locale[this.state.opt.lang].ord["1.0.1"];if(l["whole-number"][r]&&l["whole-number"][r][n]?i=this.state.getTerm(this.state.locale[this.state.opt.lang].ord["1.0.1"]["whole-number"][r][n],!1,0,e):l["last-two-digits"][r.slice(r.length-2)]&&l["last-two-digits"][r.slice(r.length-2)][n]?i=this.state.getTerm(this.state.locale[this.state.opt.lang].ord["1.0.1"]["last-two-digits"][r.slice(r.length-2)][n],!1,0,e):l["last-digit"][r.slice(r.length-1)]&&l["last-digit"][r.slice(r.length-1)][n]&&(i=this.state.getTerm(this.state.locale[this.state.opt.lang].ord["1.0.1"]["last-digit"][r.slice(r.length-1)][n],!1,0,e)),i)break}}else e||(e=void 0),this.state.fun.ordinalizer.init(),i=t/10%10==1||t>10&&t<20?this.suffixes[this.state.opt.lang][e][3]:t%10==1&&t%100!=11?this.suffixes[this.state.opt.lang][e][0]:t%10==2&&t%100!=12?this.suffixes[this.state.opt.lang][e][1]:t%10==3&&t%100!=13?this.suffixes[this.state.opt.lang][e][2]:this.suffixes[this.state.opt.lang][e][3];return r+i},e.Util.Romanizer=function(){},e.Util.Romanizer.prototype.format=function(t){var i,s,r,n,a;if(i="",t<6e3)for((n=t.toString().split("")).reverse(),s=0,r=0,a=n.length,s=0;s<a;s+=1)r=parseInt(n[s],10),i=e.ROMAN_NUMERALS[s][r]+i;return i},e.Util.Suffixator=function(t){t||(t=e.SUFFIX_CHARS),this.slist=t.split(",")},e.Util.Suffixator.prototype.format=function(t){t+=1;var e,i="";do{e=t%26==0?26:t%26;var i=this.slist[e-1]+i;t=(t-e)/26}while(0!==t);return i},e.Engine.prototype.processNumber=function(t,i,s){var r,n=this,a=s;s="page-first"===s?"page":s;var o=",\\s+and\\s+|\\s+and\\s+";"en"!==this.opt.lang.slice(0,2)&&(o+="|,\\s+"+this.getTerm("and")+"\\s+|\\s+"+this.getTerm("and")+"\\s+");var l="\\s*&\\s*",u=RegExp("^"+l+"$"),p=RegExp("("+l+"|"+o+"|;\\s+|,\\s+|\\s*\\\\*[\\-\\u2013]+\\s*)","g"),h=RegExp("(?:"+l+"|"+o+"|;\\s+|,\\s+|\\s*\\\\*[\\-\\u2013]+\\s*)"),c=this.getTerm("and"),m=this.getTerm("and","symbol");function f(t,i,r,n,o){n=n||"";var l={};if(i||e.STATUTE_SUBDIV_STRINGS_REVERSE[s]||(i="var:"+s),i){var u=i.match(/(\s*)([^\s]+)(\s*)/);"page"===a&&0===o&&-1===["p.","pp."].indexOf(u[2])?(l.gotosleepability=!0,l.labelVisibility=!0):l.labelVisibility=!1,l.label=u[2],l.origLabel=t,l.labelSuffix=u[3]?u[3]:"",l.plural=0}var u=r.match(/^([0-9]*[a-zA-Z]+0*)?([0-9]+(?:[a-zA-Z]*|[-,a-zA-Z]+))$/);return u?(l.particle=u[1]?u[1]:"",l.value=u[2]):(l.particle="",l.value=r),l.joiningSuffix=n.replace(/\s*-\s*/,"-"),l}function d(t,e,i){var s=t[i.pos],r=t[e].value,n="\\-"===s.joiningSuffix;r.particle&&r.particle!==s.particle&&(i.collapsible=!1);var a=r.match(/^[0-9]+([-,:a-zA-Z]*)$/),o=s.value.match(/^(?:[0-9]+|[ixv]+)([-,:a-zA-Z]*|\-[\-0-9]+)$/);if((!r||!a||!o||n)&&(i.collapsible=!1,r&&o||(i.numeric=!1),n&&i.count--),(a&&a[1]||o&&o[1])&&(i.collapsible=!1),void 0===t[e].collapsible){for(var l=e,u=e+i.count;l<u;l++)isNaN(parseInt(t[l].value))&&!t[l].value.match(/^[ivxlcmIVXLCM]+$/)?t[l].collapsible=!1:t[l].collapsible=!0;i.collapsible=t[e].collapsible}for(var p=i.collapsible,l=i.pos,u=i.pos+i.count;l<u;l++)i.count>1&&p&&(t[l].plural=1),t[l].numeric=i.numeric,t[l].collapsible=i.collapsible}function g(t,i,r){"var:"!==r.label.slice(0,4)&&(0===r.pos?(["locator","number","locator-extra","page"].indexOf(s)>-1&&void 0===n.getTerm(e.STATUTE_SUBDIV_STRINGS[r.label])&&(t[r.pos].labelVisibility=!0),-1===["locator","number","locator-extra","page"].indexOf(s)&&e.STATUTE_SUBDIV_STRINGS[r.label]!==s&&(t[0].labelVisibility=!0)):t[r.pos].labelVisibility=!0)}function b(t){return t.replace("\\-","-")}function _(i){var s=e.Util.cloneToken(t),r=new e.Token;n.tmp.just_looking||(r.decorations=s.decorations,s.decorations=[],r.strings.prefix=s.strings.prefix,s.strings.prefix="",r.strings.suffix=s.strings.suffix,s.strings.suffix="");var a=i.length?i[0].label:null;if(i.length){for(var o=0,l=i.length;o<l;o++){var u=i[o],p=e.Util.cloneToken(s);p.gender=t.gender,a===u.label&&(p.formatter=t.formatter),u.numeric&&(p.successor_prefix=u.successor_prefix),p.strings.suffix=p.strings.suffix+b(u.joiningSuffix),u.styling=p}n.tmp.just_looking||'"'!==i[0].value.slice(0,1)||'"'!==i[i.length-1].value.slice(-1)||(i[0].value=i[0].value.slice(1),i[i.length-1].value=i[i.length-1].value.slice(0,-1),r.decorations.push(["@quotes",!0]))}return r}function v(t,e){return"page"===t||["locator","locator-extra"].indexOf(t)>-1&&(["p."].indexOf(e.label)>-1||["p."].indexOf(e.origLabel)>-1)}function y(t,i,s,r){var a,o,l=v(t,i);return o=!0,["locator","locator-extra","page"].indexOf(t)>-1&&(a=i.origLabel?i.origLabel:i.label,o=!!n.getTerm(e.STATUTE_SUBDIV_STRINGS[a])),o&&"-"===s&&r&&((l||["locator","locator-extra","issue","volume","edition","number"].indexOf(t)>-1)&&((s=n.getTerm("page-range-delimiter"))||(s="–")),"collection-number"===t&&((s=n.getTerm("year-range-delimiter"))||(s="–"))),s}function x(t,e,i){if(!(e<1)&&2===i.count&&t[e-1].particle===t[e].particle){if("-"!==t[e-1].joiningSuffix){i.count=1;return}if(!n.opt["page-range-format"]&&parseInt(t[e-1].value,10)>parseInt(t[e].value,10)){t[e-1].joiningSuffix=y(s,t[e],t[e-1].joiningSuffix,!0);return}var r,a=t[e];!v(s,a)||isNaN(parseInt(t[e-1].value))||isNaN(parseInt(t[e].value))?((""+t[e-1].value).match(/^([0-9]+|[ivxlcmIVXLCM]+)$/)&&(""+t[e].value).match(/^([0-9]+|[ivxlcmIVXLCM]+)$/)&&(t[e-1].joiningSuffix=n.getTerm("page-range-delimiter")),r=t[e-1].value+b(t[e-1].joiningSuffix)+t[e].value):(r=t[e-1].particle+t[e-1].value+" - "+t[e].particle+t[e].value,r=n.fun.page_mangler(r));var o=r.match(/^((?:[0-9]*[a-zA-Z]+0*))?([0-9]+[a-z]*)(\s*[^0-9]+\s*)([-,a-zA-Z]?0*)([0-9]+[a-z]*)$/);if(o){var l=o[3];l=y(s,a,l,t[e].numeric),t[e-1].particle=o[1],t[e-1].value=o[2],t[e-1].joiningSuffix=l,t[e].particle=o[4],t[e].value=o[5]}i.count=0}}function I(e){if(t&&-1!==["page","chapter-number","collection-number","edition","issue","number","number-of-pages","number-of-volumes","volume","locator","locator-extra"].indexOf(s)){for(var i={count:0,label:null,lastHadRangeDelimiter:!1},r=0,n=e.length;r<n;r++){var a=e[r];if(a.collapsible)i.label===a.label&&"-"===a.joiningSuffix?i.count=1:i.label===a.label&&"-"!==a.joiningSuffix?(i.count++,2===i.count&&x(e,r,i)):i.label!==a.label?(i.label=a.label,i.count=1):(i.count=1,i.label=a.label);else{i.count=0,i.label=null;var o=a.numeric;a.joiningSuffix=y(s,a,a.joiningSuffix,o)}}2===i.count&&x(e,e.length-1,i)}}if(c===m&&(m="&"),t&&this.tmp.shadow_numbers[a]&&this.tmp.shadow_numbers[a].values.length){var O=this.tmp.shadow_numbers[a].values;I(O),this.tmp.shadow_numbers[a].masterStyling=_(O);return}if(this.tmp.shadow_numbers[a]||(this.tmp.shadow_numbers[a]={values:[]}),i){var T=e.LangPrefsMap[s];if(T){var S=this.opt["cite-lang-prefs"][T][0];r=(r=this.transform.getTextSubField(i,a,"locale-"+S,!0)).name}else r=i[a];if(r&&"number"===a&&"legal_case"===i.type&&(r=r.replace(/[\\]*-/g,"\\-")),r&&this.sys.getAbbreviation){if(this.sys.normalizeAbbrevsKey)var N=this.sys.normalizeAbbrevsKey(a,r);else var N=r;var A=this.transform.loadAbbreviation(i.jurisdiction,"number",N,i.language);this.transform.abbrevs[A].number&&(this.transform.abbrevs[A].number[N]?r=this.transform.abbrevs[A].number[N]:void 0!==this.transform.abbrevs[A].number[N]&&delete this.transform.abbrevs[A].number[N])}if(void 0!==r&&("string"==typeof r||"number"==typeof r)){"number"==typeof r&&(r=""+r);var E=e.STATUTE_SUBDIV_STRINGS_REVERSE[s];if(0===this.tmp.shadow_numbers[a].values.length){for(var k,R,w,O=function(t,r){if(t=function(t){var r=(t=t.trim()).match(/^([^ ]+)/);if(r&&!e.STATUTE_SUBDIV_STRINGS[r[1]]){var n=null;(n=["locator","locator-extra","page"].indexOf(s)>-1?i.label?e.STATUTE_SUBDIV_STRINGS_REVERSE[i.label]:"p.":e.STATUTE_SUBDIV_STRINGS_REVERSE[s])&&(t=n+" "+t)}return t}(t,r=r||""),"page"===s&&t.indexOf("–")>-1&&(t=t.replace(/\u2013/g,"-")),t.indexOf("\\-")>-1){v=new RegExp(p.source.replace("\\-","")),y=new RegExp(h.source.replace("\\-",""));for(var a=t.split("\\-"),o=0,l=a.length;o<l;o++)a[o]=a[o].replace(/\-/g,"–");x=(x=a.join("\\-")).replace(/\\/g,"")}else v=p,y=h,x=t;var c=[],d=x.match(v);if(d){for(var a=x.split(y),o=0,l=d.length;o<l;o++)d[o].match(u)&&(a[o].match(/[a-zA-Z]$/)&&a[o].match(/^[a-zA-Z]/)?d[o]=m:d[o]=" "+m+" ");for(var o in a)if((""+a[o]).replace(/^[a-z]\.\s+/,"").match(/[^\s0-9ivxlcmIVXLCM]/))break;for(var o=0,l=a.length-1;o<l;o++)c.push(a[o]),c.push(d[o]);c.push(a[a.length-1]),c=function(t){for(var e=t.length-2;e>-1;e-=2)"-"===t[e]&&t[e-1].match(/^(?:(?:[a-z]|[a-z][a-z]|[a-z][a-z][a-z]|[a-z][a-z][a-z][a-z])\.  *)*[0-9]+[,a-zA-Z]+$/)&&t[e+1].match(/^[,a-zA-Z]+$/)&&(t[e-1]=t.slice(e-1,e+2).join(""),t=t.slice(0,e).concat(t.slice(e+2)));return t}(c)}else var c=[x];for(var g=[],b=r,_="",o=0,l=c.length;o<l;o+=2){var v,y,x,I,d=c[o].match(/((?:^| )(?:[a-z]|[a-z][a-z]|[a-z][a-z][a-z]|[a-z][a-z][a-z][a-z]|subpara|subch|amend|bibliog|annot|illus|princ|intro|sched|subdiv|subsec)(?:\.| ) *)/g);if(d){for(var I,a=c[o].split(/(?:(?:^| )(?:[a-z]|[a-z][a-z]|[a-z][a-z][a-z]|[a-z][a-z][a-z][a-z]|subpara|subch|amend|bibliog|annot|illus|princ|intro|sched|subdiv|subsec)(?:\.| ) *)/),O=a.length-1;O>0;O--)!a[O-1]||a[O].match(/^[0-9]+([-;,:a-zA-Z]*)$/)&&a[O-1].match(/^[0-9]+([-;,:a-zA-Z]*)$/)||(a[O-1]=a[O-1]+d[O-1]+a[O],a=a.slice(0,O).concat(a.slice(O+1)),d=d.slice(0,O-1).concat(d.slice(O)));if(d.length>0){var T=d[0].trim();e.STATUTE_SUBDIV_STRINGS[T]&&void 0!==n.getTerm(e.STATUTE_SUBDIV_STRINGS[T])&&(-1!==["locator","number","locator-extra","page"].indexOf(s)||e.STATUTE_SUBDIV_STRINGS[T]===s)?_=T:0===o&&(d=d.slice(1),a[0]=a[0]+" "+T+" "+a[1],a=a.slice(0,1).concat(a.slice(2)))}for(var O=0,S=a.length;O<S;O++)(a[O]||O===a.length-1)&&(I=_===(b=d[O-1]?d[O-1]:b).trim()?"":_,x=a[O]?a[O].trim():"",O===a.length-1?g.push(f(I,b,x,c[o+1],o)):g.push(f(I,b,x,null,o)))}else I=_===b.trim()?"":_,g.push(f(I,b,c[o],c[o+1]))}return g}(r,E),j=O,C=0,L=j.length-1;C<L;C++)!j[C].joiningSuffix&&j[C+1].label&&(j[C].joiningSuffix=" ");for(var D of(!function(t){if(0!==t.length){for(var e=0,r=1,n=1,o=t.length;n<o;n++){var l=t[n-1],u=t[n];if(l.label===u.label&&l.particle==l.particle)r++;else{var p=JSON.parse(JSON.stringify(t[e]));p.pos=e,p.count=r,p.numeric=!0,d(t,e,p),l.label!==u.label&&g(t,e,p),e=n,r=1}}var p=JSON.parse(JSON.stringify(t[e]));p.pos=e,p.count=r,p.numeric=!0,d(t,e,p),g(t,e,p),t.length&&t[0].numeric&&"number-of-"===s.slice(0,10)&&parseInt(i[a],10)>1&&(t[0].plural=1)}}(O),O))D.numeric||(D.plural=0);this.tmp.shadow_numbers[a].values=O,t&&(I(O),this.tmp.shadow_numbers[a].masterStyling=_(O)),k=this.tmp.shadow_numbers,R=O,w=k[a],R.length&&(w.numeric=R[0].numeric,w.collapsible=R[0].collapsible,w.plural=R[0].plural,w.label=e.STATUTE_SUBDIV_STRINGS[R[0].label],"number"===s&&"issue"===w.label&&n.getTerm("number")&&(w.label="number"))}var P=this.tmp.shadow_numbers[a];"number"===s&&1===P.values.length&&P.values[0].value.indexOf("|")>-1&&(P.values[0].value=P.values[0].value.replace(/\|/g,", "),P.values[0].numeric=!0,P.values[0].plural=1,P.values[0].collapsible=!1,P.numeric=!0,P.plural=1,P.collapsible=!1),1===P.values.length&&P.values[0].value.match(/^[0-9]+(?:\/[0-9]+)+$/)&&(P.values[0].numeric=!0,P.values[0].plural=0,P.values[0].collapsible=!1,P.numeric=!0,P.plural=0,P.collapsible=!1),"page"===s&&P.values.length>0&&P.values[0].gotosleepability&&(P.labelForm="short")}}},e.Util.outputNumericField=function(t,i,s){t.output.openLevel(t.tmp.shadow_numbers[i].masterStyling);var r=t.tmp.shadow_numbers[i].masterStyling,n=t.tmp.shadow_numbers[i].values,a=n.length?n[0].label:null,o=t.tmp.shadow_numbers[i].labelForm,l=t.tmp.group_context.tip.label_static;f=o||"short";for(var u=t.tmp.shadow_numbers[i].labelCapitalizeIfFirst,p=t.tmp.shadow_numbers[i].labelDecorations,h=null,c=0,m=n.length;c<m;c++){var f,d,g,b=n[c],_="";b.label&&(d="var:"===b.label.slice(0,4)?b.label.slice(4):e.STATUTE_SUBDIV_STRINGS[b.label])&&(b.label===a?(l&&-1===(_=t.getTerm(d,"static",b.plural)).indexOf("%s")&&(_=""),_||(_=t.getTerm(d,o,b.plural))):(l&&-1===(_=t.getTerm(d,"static",b.plural)).indexOf("%s")&&(_=""),_||(_=t.getTerm(d,f,b.plural))),u&&(_=e.Output.Formatters["capitalize-first"](t,_)));var v=-1;_&&(v=_.indexOf("%s"));var y=e.Util.cloneToken(b.styling);if(y.formatter=b.styling.formatter,y.type=b.styling.type,y.num=b.styling.num,y.gender=b.styling.gender,v>0&&v<_.length-2)y.strings.prefix+=_.slice(0,v),y.strings.suffix=_.slice(v+2)+y.strings.suffix;else if(b.labelVisibility)if(_||(_=b.label,d=b.label),v>0){var x=new e.Token;x.decorations=p,t.output.append(_.slice(0,v),x)}else(v===_.length-2||-1===v)&&t.output.append(_+b.labelSuffix,"empty");if(e.UPDATE_GROUP_CONTEXT_CONDITION(t,r.strings.prefix,null,r,`${b.particle}${b.value}`),b.collapsible?(void 0===(g=b.value.match(/^[1-9][0-9]*$/)&&Number.isSafeInteger(parseInt(b.value,10))?new e.NumericBlob(t,b.particle,parseInt(b.value,10),y,s):new e.NumericBlob(t,b.particle,b.value,y,s)).gender&&(g.gender=t.locale[t.opt.lang]["noun-genders"][i]),t.output.append(g,"literal")):t.output.append(b.particle+b.value,y),0===v&&v<_.length-2&&(null===h&&(h=d),d!==h||c===n.length-1)){var I=new e.Token;I.decorations=p,t.output.append(_.slice(v+2),I)}h=d,t.tmp.term_predecessor=!0}t.output.closeLevel()},e.Util.PageRangeMangler={},e.Util.PageRangeMangler.getFunction=function(t,e){var i,s,r,n,a,o,l,u,p,h,c,m,f,d,g,b,_,v,y=t.getTerm(e+"-range-delimiter");i=/([0-9]*[a-zA-Z]+0*)?([0-9]+[a-z]*)\s*(?:\u2013|-)\s*([0-9]*[a-zA-Z]+0*)?([0-9]+[a-z]*)/,n=function(i){for(s=1,r=i.length;s<r;s+=2)"object"==typeof i[s]&&(i[s]=i[s].join(""));var n=i.join("");return n.replace(/([^\\])\-/g,"$1"+t.getTerm(e+"-range-delimiter"))},a=function(t){var e,i,n,a="\\s+\\-\\s+",o=RegExp("([^\\\\])[-"+("-"===y?"":y)+"\\u2013]","g");t=t.replace(o,"$1 - ").replace(/\s+-\s+/g," - ");var l=RegExp("((?:[0-9]*[a-zA-Z]+0*)?[0-9]+[a-z]*"+a+"(?:[0-9]*[a-zA-Z]+0*)?[0-9]+[a-z]*)","g"),u=RegExp("(?:[0-9]*[a-zA-Z]+0*)?[0-9]+[a-z]*"+a+"(?:[0-9]*[a-zA-Z]+0*)?[0-9]+[a-z]*");if(e=t.match(l),0===(i=t.split(u)).length)n=e;else for(s=1,n=[i[0]],r=i.length;s<r;s+=1)n.push(e[s-1].replace(/\s*\-\s*/g,"-")),n.push(i[s]);return n},o=function(t){for(s=1,r=(c=a(t=""+t)).length;s<r;s+=2)(m=c[s].match(i))&&(!m[3]||m[1]===m[3])&&(m[4].length<m[2].length&&(m[4]=m[2].slice(0,m[2].length-m[4].length)+m[4]),parseInt(m[2],10)<parseInt(m[4],10)&&(m[3]=y+(m[1]?m[1]:""),c[s]=m.slice(1))),"string"==typeof c[s]&&(c[s]=c[s].replace(/\-/g,y));return c},l=function(t,e,i){r=t.length;for(var s=1,a=t.length;s<a;s+=2)"object"==typeof t[s]&&(t[s][3]=u(t[s][1],t[s][3],e,i),t[s][2].slice(1)===t[s][0]&&(t[s][2]=y));return n(t)},u=function(t,e,i,s){if(i||(i=0),f=(""+t).split(""),(g=(d=(""+e).split("")).slice()).reverse(),f.length===d.length)for(var r=0,n=f.length;r<n;r+=1)if(f[r]===d[r]&&g.length>i)g.pop();else{if(i&&s&&3===g.length){var a=f.slice(0,r);a.reverse(),g=g.concat(a)}break}return g.reverse(),g.join("")},p=function(t){for(s=1,r=t.length;s<r;s+=2)"object"==typeof t[s]&&(b=parseInt((m=t[s])[1],10),_=parseInt(m[3],10),b>100&&b%100&&parseInt(b/100,10)===parseInt(_/100,10)?m[3]=""+_%100:b>=1e4&&(m[3]=""+_%1e3)),m[2].slice(1)===m[0]&&(m[2]=y);return n(t)},h=function(t){for(s=1,r=t.length;s<r;s+=2){if("object"==typeof t[s]&&(b=parseInt((m=t[s])[1],10),d=""+(_=parseInt(m[3],10)),b>100&&b%100))for(var e=2;e<d.length;e++){var i=Math.pow(10,e);if(Math.floor(b/i)===Math.floor(_/i)){m[3]=""+_%i;break}}m[2].slice(1)===m[0]&&(m[2]=y)}return n(t)};var x=function(t,e,i,s){return e(o(t=""+t),i,s)};return t.opt[e+"-range-format"]?"expanded"===t.opt[e+"-range-format"]?v=function(t){return x(t,n)}:"minimal"===t.opt[e+"-range-format"]?v=function(t){return x(t,l)}:"minimal-two"===t.opt[e+"-range-format"]?v=function(t,e){return x(t,l,2,e)}:"chicago"===t.opt[e+"-range-format"]?v=function(t){return x(t,p)}:"chicago-15"===t.opt[e+"-range-format"]?v=function(t){return x(t,p)}:"chicago-16"===t.opt[e+"-range-format"]&&(v=function(t){return x(t,h)}):v=function(t){return x(t,n)},v},e.Util.FlipFlopper=function(t){var i=[],s={'<span class="nocase">':{type:"nocase",opener:'<span class="nocase">',closer:"</span>",attr:null,outer:null,flipflop:null},'<span class="nodecor">':{type:"nodecor",opener:'<span class="nodecor">',closer:"</span>",attr:"@class",outer:"nodecor",flipflop:{nodecor:"nodecor"}},'<span style="font-variant:small-caps;">':{type:"tag",opener:'<span style="font-variant:small-caps;">',closer:"</span>",attr:"@font-variant",outer:"small-caps",flipflop:{"small-caps":"normal",normal:"small-caps"}},"<sc>":{type:"tag",opener:"<sc>",closer:"</sc>",attr:"@font-variant",outer:"small-caps",flipflop:{"small-caps":"normal",normal:"small-caps"}},"<i>":{type:"tag",opener:"<i>",closer:"</i>",attr:"@font-style",outer:"italic",flipflop:{italic:"normal",normal:"italic"}},"<b>":{type:"tag",opener:"<b>",closer:"</b>",attr:"@font-weight",outer:"bold",flipflop:{bold:"normal",normal:"bold"}},"<sup>":{type:"tag",opener:"<sup>",closer:"</sup>",attr:"@vertical-align",outer:"sup",flipflop:{sub:"sup",sup:"sup"}},"<sub>":{type:"tag",opener:"<sub>",closer:"</sub>",attr:"@vertical-align",outer:"sub",flipflop:{sup:"sub",sub:"sub"}},' "':{type:"quote",opener:' "',closer:'"',attr:"@quotes",outer:"true",flipflop:{true:"inner",inner:"true",false:"true"}}," '":{type:"quote",opener:" '",closer:"'",attr:"@quotes",outer:"inner",flipflop:{true:"inner",inner:"true",false:"true"}}};s['("']=s[' "'],s["('"]=s[" '"];var r=t.getTerm("open-quote"),n=t.getTerm("close-quote"),a=t.getTerm("open-inner-quote"),o=t.getTerm("close-inner-quote");r&&n&&-1===[' "'," '",'"',"'"].indexOf(r)&&(s[r]=JSON.parse(JSON.stringify(s[' "'])),s[r].opener=r,s[r].closer=n),a&&o&&-1===[' "'," '",'"',"'"].indexOf(a)&&(s[a]=JSON.parse(JSON.stringify(s[" '"])),s[a].opener=a,s[a].closer=o);var l=function(){for(var t={},e=Object.keys(s),i=0,r=e.length;i<r;i++){var n=e[i];t[n]=function(t){for(var e=[],i=Object.keys(s),r=0,n=i.length;r<n;r++){var a=i[r];"quote"===s[t].type&&s[t]||e.push(a)}var o=s[t];return o.opener=RegExp("^(?:"+e.map(function(t){return t.replace("(","\\(")}).join("|")+")"),o}(n)}return t}(),u=function(){var t=[],e=[],i={};for(var s in l)t.push(s),i[l[s].closer]=!0;for(var r=Object.keys(i),n=0,a=r.length;n<a;n++){var o=r[n];e.push(o)}var u=t.concat(e).map(function(t){return t.replace("(","\\(")}).join("|");return{matchAll:RegExp("((?:"+u+"))","g"),splitAll:RegExp("(?:"+u+")","g"),open:RegExp("(^(?:"+t.map(function(t){return t.replace("(","\\(")}).join("|")+")$)"),close:RegExp("(^(?:"+e.join("|")+")$)")}}(),p=function(e){var i=[];this.set=function(r){for(var n=s[r].attr,a=null,o=i.length-1;o>-1;o--){var l=i[o];if(l[0]===n){a=l;break}}if(!a){var u=[t[t.tmp.area].opt.layout_decorations].concat(e.alldecor);t:for(var o=u.length-1;o>-1;o--){var p=u[o];if(p)for(var h=p.length-1;h>-1;h--){var l=p[h];if(l[0]===n){a=l;break t}}}}a=a?[n,s[r].flipflop[a[1]]]:[n,s[r].outer],i.push(a)},this.pair=function(){return i[i.length-1]},this.pop=function(){i.pop()}};this.processTags=function(r){var n=r.blobs,a=!1;" "!==n.slice(0,1)||n.match(/^\s+[\'\"]/)||(a=!0);var o=RegExp("("+e.ROMANESQUE_REGEXP.source+")’("+e.ROMANESQUE_REGEXP.source+")","g"),n=" "+n.replace(o,"$1'$2"),h=function(t){var e=[],i=(t=(t=t.replace(/(<span)\s+(style=\"font-variant:)\s*(small-caps);?\"[^>]*(>)/g,'$1 $2$3;"$4')).replace(/(<span)\s+(class=\"no(?:case|decor)\")[^>]*(>)/g,"$1 $2$3")).match(u.matchAll);if(!i)return{tags:[],strings:[t],forcedSpaces:[]};for(var r=t.split(u.splitAll),n=0,a=i.length-1;n<a;n++)s[i[n]]&&(""===r[n+1]&&['"',"'"].indexOf(i[n+1])>-1?(i[n+1]=" "+i[n+1],e.push(!0)):e.push(!1));return{tags:i,strings:r,forcedSpaces:e}}(n);if(0!==h.tags.length){for(var c=!1,m=0,f=h.tags.length;m<f;m++){var d,g=h.tags[m],n=h.strings[m+1],b=function(t,e){if("'"===t){if(e&&e.match(/^[^\,\.\?\:\;\ ]/))return"’"}else if(" '"===t&&e&&e.match(/^[\ ]/))return" ’";return!1}(g,n);if(b)h.strings[m+1]=b+h.strings[m+1],h.tags[m]="";else{for(;;)if(d=function(t,e){if(t.match(u.open)){var s;return!(s=i[i.length-1])||t.match(s.opener)?(i.push({type:l[t].type,opener:l[t].opener,closer:l[t].closer,pos:e}),!1):(i.pop(),i.push({type:l[t].type,opener:l[t].opener,closer:l[t].closer,pos:e}),{fixtag:s.pos})}var r=i[i.length-1];return r&&t===r.closer?(i.pop(),"nocase"===r.type&&{nocase:{open:r.pos,close:e}}):r?{fixtag:r.pos}:{fixtag:e}}(g,m))if(Object.keys(d).indexOf("fixtag")>-1){if(g.match(u.close)&&"'"===g)h.strings[m+1]="’"+h.strings[m+1],h.tags[m]="";else{var _=h.tags[d.fixtag];h.forcedSpaces[d.fixtag-1]&&(_=_.slice(1)),h.strings[d.fixtag+1]=_+h.strings[d.fixtag+1],h.tags[d.fixtag]=""}if(i.length>0)if("'"!==g)i.pop();else break;else break}else if(d.nocase){h.tags[d.nocase.open]="",h.tags[d.nocase.close]="";break}else break;else break;d&&(d.fixtag||0===d.fixtag)&&(h.strings[m+1]=h.tags[m]+h.strings[m+1],h.tags[m]="")}}for(var m=i.length-1;m>-1;m--){var v=i[m].pos,g=h.tags[v];" '"===g||"'"===g?h.strings[v+1]=" ’"+h.strings[v+1]:h.strings[v+1]=h.tags[v]+h.strings[v+1],h.tags[v]="",i.pop()}for(var m=h.tags.length-1;m>-1;m--)h.tags[m]||(h.tags=h.tags.slice(0,m).concat(h.tags.slice(m+1)),h.strings[m]=h.strings[m]+h.strings[m+1],h.strings=h.strings.slice(0,m+1).concat(h.strings.slice(m+2)));for(var m=0,f=h.tags.length;m<f;m++){var y,g=h.tags[m],x=h.forcedSpaces[m-1];[' "'," '",'("',"('"].indexOf(g)>-1&&(c||(s[y=g].outer="true",s[({" '":' "',' "':" '",'("':"('","('":'("'})[y]].outer="inner",c=!0),x||(h.strings[m]+=g.slice(0,1)))}!function(i,s,r){var n=!0,a=new p(i);i.blobs=[];var o=new function(i){this.stack=[i],this.latest=i,this.addStyling=function(i,s){if(n&&(" "===i.slice(0,1)&&(i=i.slice(1))," "===i.slice(0,1)&&(i=i.slice(1)),n=!1),this.latest=this.stack[this.stack.length-1],s){if("string"==typeof this.latest.blobs){var r=new e.Blob;r.blobs=this.latest.blobs,r.alldecor=this.latest.alldecor.slice(),this.latest.blobs=[r]}var a=new e.Token,o=new e.Blob(null,a);if(o.alldecor=this.latest.alldecor.slice(),"@class"===s[0]&&"nodecor"===s[1]){for(var l=[],u={},p=[t[t.tmp.area].opt.layout_decorations].concat(o.alldecor),h=p.length-1;h>-1;h--){var c=p[h];if(c)for(var m=c.length-1;m>-1;m--){var f=c[m];["@font-weight","@font-style","@font-variant"].indexOf(f[0])>-1&&!u[f[0]]&&("normal"!==s[1]&&(o.decorations.push([f[0],"normal"]),l.push([f[0],"normal"])),u[f[0]]=!0)}}o.alldecor.push(l)}else o.decorations.push(s),o.alldecor.push([s]);if(this.latest.blobs.push(o),this.stack.push(o),this.latest=o,i){var a=new e.Token,o=new e.Blob(null,a);o.blobs=i,o.alldecor=this.latest.alldecor.slice(),this.latest.blobs.push(o)}}else if(i){var r=new e.Blob;r.blobs=i,r.alldecor=this.latest.alldecor.slice(),this.latest.blobs.push(r)}},this.popStyling=function(){this.stack.pop()}}(i);if(s.strings.length){var l=s.strings[0];r&&(l=" "+l),o.addStyling(l)}for(var h=0,c=s.tags.length;h<c;h++){var m=s.tags[h],l=s.strings[h+1];m.match(u.open)?(a.set(m),o.addStyling(l,a.pair())):(a.pop(),o.popStyling(),o.addStyling(l))}}(r,h,a)}}},e.Output.Formatters=function(){var t=new e.Doppeler('(?:‘|’|“|”| "| \'|"|\'|[-–—/.,;?!:]|\\[|\\]|\\(|\\)|<span style="font-variant: small-caps;">|<span class="no(?:case|decor)">|</span>|</?(?:i|sc|b|sub|sup)>)',function(t){return t.replace(/(<span)\s+(class=\"no(?:case|decor)\")[^>]*(>)/g,"$1 $2$3").replace(/(<span)\s+(style=\"font-variant:)\s*(small-caps);?(\")[^>]*(>)/g,"$1 $2 $3;$4$5")}),i=new e.Doppeler('(?:[-\\s]*<\\/*(?:spans+class="no(?:case|decor)"|i|sc|b|sub|sup)>[-\\s]*|[-\\s]+)'),s=new e.Doppeler("(?:[\xa0 \xa0 -​ 　]+)"),r={'<span style="font-variant: small-caps;">':"</span>",'<span class="nocase">':"</span>",'<span class="nodecor">':"</span>","<sc>":"</sc>","<sub>":"</sub>","<sup>":"</sup>"};function n(t){var i=t.match(/(^\s*)((?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]))(.*)/);return i&&!(i[2].match(/^[\u0370-\u03FF]$/)&&!i[3])?i[1]+e.toLocaleUpperCase.call(this,i[2])+i[3]:t}function a(i,a){if(!a)return"";i.doppel=t.split(a);var o={' "':{opener:" '",closer:'"'}," '":{opener:' "',closer:"'"},"‘":{opener:"‘",closer:"’"},"“":{opener:"“",closer:"”"}};i.doppel.strings.length&&i.doppel.strings[0].trim()&&(i.doppel.strings[0]=i.capitaliseWords(i.doppel.strings[0],0,i.doppel.tags[0]));for(var l=0,u=i.doppel.tags.length;l<u;l++){var p=i.doppel.tags[l],h=i.doppel.strings[l+1];if(null!==i.tagState&&(r[p]?i.tagState.push(r[p]):i.tagState.length&&p===i.tagState[i.tagState.length-1]&&i.tagState.pop()),null!==i.afterPunct&&p.match(/[\!\?\:]$/)&&(i.afterPunct=!0),0===i.tagState.length?i.doppel.strings[l+1]=i.capitaliseWords(h,l+1,i.doppel,i.doppel.tags[l+1]):i.doppel.strings[l+1].trim()&&(i.lastWordPos=null),null!==i.quoteState){var c=function(t,e){var s=t.match(/(^(?:\u2018|\u2019|\u201C|\u201D|\"|\')|(?: \"| \')$)/);if(s){var r=s[1],n=e;if(["“","‘",' "'," '"].indexOf(r)>-1){if(0===i.quoteState.length||r===i.quoteState[i.quoteState.length-1].opener)return i.quoteState.push({opener:o[r].opener,closer:o[r].closer,pos:n}),!1;var a=i.quoteState[i.quoteState.length-1].pos;return i.quoteState.pop(),i.quoteState.push({opener:o[r].opener,closer:o[r].closer,positions:n}),a}return i.quoteState.length>0&&r===i.quoteState[i.quoteState.length-1].closer?void i.quoteState.pop():n}}(p,l);if(c||0===c){var m=i.doppel.origStrings[c+1].slice(0,1);i.doppel.strings[c+1]=m+i.doppel.strings[c+1].slice(1),i.lastWordPos=null}}i.isFirst&&h.trim()&&(i.isFirst=!1),i.afterPunct&&h.trim()&&(i.afterPunct=!1)}if(i.quoteState)for(var l=0,u=i.quoteState.length;l<u;l++){var c=i.quoteState[l].pos;if(void 0!==c){var m=i.doppel.origStrings[c+1].slice(0,1);i.doppel.strings[c+1]=m+i.doppel.strings[c+1].slice(1)}}if(i.lastWordPos){var f=s.split(i.doppel.strings[i.lastWordPos.strings]),d=f.strings[i.lastWordPos.words];d.length>1&&e.toLocaleLowerCase.call(this,d).match(i.skipWordsRex)&&(d=n.call(this,d),f.strings[i.lastWordPos.words]=d),i.doppel.strings[i.lastWordPos.strings]=s.join(f)}return t.join(i.doppel)}return{nameDoppel:i,passthrough:function(t,e){return e},lowercase:function(t,i){return a.call(t,{quoteState:null,capitaliseWords:function(i){for(var s=i.split(" "),r=0,n=s.length;r<n;r++){var a=s[r];a&&(s[r]=e.toLocaleLowerCase.call(t,a))}return s.join(" ")},skipWordsRex:null,tagState:[],afterPunct:null,isFirst:null},i)},uppercase:function(t,i){return a.call(t,{quoteState:null,capitaliseWords:function(i){for(var s=i.split(" "),r=0,n=s.length;r<n;r++){var a=s[r];a&&(s[r]=e.toLocaleUpperCase.call(t,a))}return s.join(" ")},skipWordsRex:null,tagState:[],afterPunct:null,isFirst:null},i)},sentence:function(t,i){var s={quoteState:[],capitaliseWords:function(i){for(var r=i.split(" "),a=0,o=r.length;a<o;a++){var l=r[a];l&&(s.isFirst?(r[a]=n.call(t,l),s.isFirst=!1):r[a]=e.toLocaleLowerCase.call(t,l))}return r.join(" ")},skipWordsRex:null,tagState:[],afterPunct:null,isFirst:!0};return a.call(t,s,i)},title:function(t,i){var r={quoteState:[],capitaliseWords:function(i,a,o){if(i.trim()){for(var l=s.split(i),u=l.strings,p=0,h=u.length;p<h;p++){var c=u[p];if(!c)continue;let i=e.toLocaleLowerCase.call(t,c),s=!1;c.length>1&&!i.match(r.skipWordsRex)||p===u.length-1&&"-"===o||r.isFirst?s=!0:r.afterPunct&&(s=!0),s&&c===i&&(u[p]=n.call(t,c)),r.afterPunct=!1,r.isFirst=!1,r.lastWordPos={strings:a,words:p}}i=s.join(l)}return i},skipWordsRex:t.locale[t.opt.lang].opts["skip-words-regexp"],tagState:[],afterPunct:!1,isFirst:!0};return a.call(t,r,i)},"capitalize-first":function(t,i){var r={quoteState:[],capitaliseWords:function(i){for(var a=s.split(i),o=a.strings,l=0,u=o.length;l<u;l++){var p=o[l];if(p&&r.isFirst){p===e.toLocaleLowerCase.call(t,p)&&(o[l]=n.call(t,p)),r.isFirst=!1;break}}return s.join(a)},skipWordsRex:null,tagState:[],afterPunct:null,isFirst:!0};return a.call(t,r,i)},"capitalize-all":function(t,i){return a.call(t,{quoteState:[],capitaliseWords:function(i){for(var r=s.split(i),a=r.strings,o=0,l=a.length;o<l;o++){var u=a[o];u&&u===e.toLocaleLowerCase.call(t,u)&&(a[o]=n.call(t,u))}return s.join(r)},skipWordsRex:null,tagState:[],afterPunct:null,isFirst:null},i)}}}(),e.Output.Formats=function(){},e.Output.Formats.prototype.html={text_escape:function(t){return t||(t=""),t.replace(/&/g,"&#38;").replace(/</g,"&#60;").replace(/>/g,"&#62;").replace(/\s\s/g,"\xa0 ").replace(e.SUPERSCRIPTS_REGEXP,function(t){return"<sup>"+e.SUPERSCRIPTS[t]+"</sup>"})},bibstart:'<div class="csl-bib-body">\n',bibend:"</div>","@font-style/italic":"<i>%%STRING%%</i>","@font-style/oblique":"<em>%%STRING%%</em>","@font-style/normal":'<span style="font-style:normal;">%%STRING%%</span>',"@font-variant/small-caps":'<span style="font-variant:small-caps;">%%STRING%%</span>',"@passthrough/true":e.Output.Formatters.passthrough,"@font-variant/normal":'<span style="font-variant:normal;">%%STRING%%</span>',"@font-weight/bold":"<b>%%STRING%%</b>","@font-weight/normal":'<span style="font-weight:normal;">%%STRING%%</span>',"@font-weight/light":!1,"@text-decoration/none":'<span style="text-decoration:none;">%%STRING%%</span>',"@text-decoration/underline":'<span style="text-decoration:underline;">%%STRING%%</span>',"@vertical-align/sup":"<sup>%%STRING%%</sup>","@vertical-align/sub":"<sub>%%STRING%%</sub>","@vertical-align/baseline":'<span style="baseline">%%STRING%%</span>',"@strip-periods/true":e.Output.Formatters.passthrough,"@strip-periods/false":e.Output.Formatters.passthrough,"@quotes/true":function(t,e){return void 0===e?t.getTerm("open-quote"):t.getTerm("open-quote")+e+t.getTerm("close-quote")},"@quotes/inner":function(t,e){return void 0===e?"’":t.getTerm("open-inner-quote")+e+t.getTerm("close-inner-quote")},"@quotes/false":!1,"@cite/entry":function(t,e){return t.sys.wrapCitationEntry(e,this.item_id,this.locator_txt,this.suffix_txt)},"@bibliography/entry":function(t,e){var i="";return t.sys.embedBibliographyEntry&&(i=t.sys.embedBibliographyEntry(this.item_id)+"\n"),'  <div class="csl-entry">'+e+"</div>\n"+i},"@display/block":function(t,e){return'\n\n    <div class="csl-block">'+e+"</div>\n"},"@display/left-margin":function(t,e){return'\n    <div class="csl-left-margin">'+e+"</div>"},"@display/right-inline":function(t,e){return'<div class="csl-right-inline">'+e+"</div>\n  "},"@display/indent":function(t,e){return'<div class="csl-indent">'+e+"</div>\n  "},"@showid/true":function(t,i,s){if(t.tmp.just_looking||t.tmp.suppress_decorations)return i;if(s)return'<span class="'+t.opt.nodenames[s]+'" cslid="'+s+'">'+i+"</span>";if(!this.params||"string"!=typeof i)return i;var r="";if(i){var n=i.match(e.VARIABLE_WRAPPER_PREPUNCT_REX);r=n[1],i=n[2]}var a="";return i&&e.SWAPPING_PUNCTUATION.indexOf(i.slice(-1))>-1&&(a=i.slice(-1),i=i.slice(0,-1)),t.sys.variableWrapper(this.params,r,i,a)},"@URL/true":function(t,e){return'<a href="'+e+'">'+e+"</a>"},"@DOI/true":function(t,e){var i=e;return e.match(/^https?:\/\//)||(i="https://doi.org/"+e),'<a href="'+i+'">'+e+"</a>"}},e.Output.Formats.prototype.text={text_escape:function(t){return t||(t=""),t},bibstart:"",bibend:"","@font-style/italic":!1,"@font-style/oblique":!1,"@font-style/normal":!1,"@font-variant/small-caps":!1,"@passthrough/true":e.Output.Formatters.passthrough,"@font-variant/normal":!1,"@font-weight/bold":!1,"@font-weight/normal":!1,"@font-weight/light":!1,"@text-decoration/none":!1,"@text-decoration/underline":!1,"@vertical-align/baseline":!1,"@vertical-align/sup":!1,"@vertical-align/sub":!1,"@strip-periods/true":e.Output.Formatters.passthrough,"@strip-periods/false":e.Output.Formatters.passthrough,"@quotes/true":function(t,e){return void 0===e?t.getTerm("open-quote"):t.getTerm("open-quote")+e+t.getTerm("close-quote")},"@quotes/inner":function(t,e){return void 0===e?"’":t.getTerm("open-inner-quote")+e+t.getTerm("close-inner-quote")},"@quotes/false":!1,"@cite/entry":function(t,e){return t.sys.wrapCitationEntry(e,this.item_id,this.locator_txt,this.suffix_txt)},"@bibliography/entry":function(t,e){return e+"\n"},"@display/block":function(t,e){return"\n"+e},"@display/left-margin":function(t,e){return e+" "},"@display/right-inline":function(t,e){return e},"@display/indent":function(t,e){return"\n    "+e},"@showid/true":function(t,e){return e},"@URL/true":function(t,e){return e},"@DOI/true":function(t,e){return e}},e.Output.Formats.prototype.rtf={text_escape:function(t){return t||(t=""),t.replace(/([\\{}])/g,"\\$1").replace(e.SUPERSCRIPTS_REGEXP,function(t){return"\\super "+e.SUPERSCRIPTS[t]+"\\nosupersub{}"}).replace(/[\u007F-\uFFFF]/g,function(t){return"\\uc0\\u"+t.charCodeAt(0).toString()+"{}"}).split("	").join("\\tab{}")},"@passthrough/true":e.Output.Formatters.passthrough,"@font-style/italic":"{\\i{}%%STRING%%}","@font-style/normal":"{\\i0{}%%STRING%%}","@font-style/oblique":"{\\i{}%%STRING%%}","@font-variant/small-caps":"{\\scaps %%STRING%%}","@font-variant/normal":"{\\scaps0{}%%STRING%%}","@font-weight/bold":"{\\b{}%%STRING%%}","@font-weight/normal":"{\\b0{}%%STRING%%}","@font-weight/light":!1,"@text-decoration/none":!1,"@text-decoration/underline":"{\\ul{}%%STRING%%}","@vertical-align/baseline":!1,"@vertical-align/sup":"\\super %%STRING%%\\nosupersub{}","@vertical-align/sub":"\\sub %%STRING%%\\nosupersub{}","@strip-periods/true":e.Output.Formatters.passthrough,"@strip-periods/false":e.Output.Formatters.passthrough,"@quotes/true":function(t,i){return void 0===i?e.Output.Formats.rtf.text_escape(t.getTerm("open-quote")):e.Output.Formats.rtf.text_escape(t.getTerm("open-quote"))+i+e.Output.Formats.rtf.text_escape(t.getTerm("close-quote"))},"@quotes/inner":function(t,i){return void 0===i?e.Output.Formats.rtf.text_escape("’"):e.Output.Formats.rtf.text_escape(t.getTerm("open-inner-quote"))+i+e.Output.Formats.rtf.text_escape(t.getTerm("close-inner-quote"))},"@quotes/false":!1,bibstart:"{\\rtf ",bibend:"}","@display/block":"\\line{}%%STRING%%\\line\r\n","@cite/entry":function(t,e){return t.sys.wrapCitationEntry(e,this.item_id,this.locator_txt,this.suffix_txt)},"@bibliography/entry":function(t,e){return e},"@display/left-margin":function(t,e){return e+"\\tab "},"@display/right-inline":function(t,e){return e+"\r\n"},"@display/indent":function(t,e){return"\n\\tab "+e+"\\line\r\n"},"@showid/true":function(t,i){if(t.tmp.just_looking||t.tmp.suppress_decorations)return i;var s="";if(i){var r=i.match(e.VARIABLE_WRAPPER_PREPUNCT_REX);s=r[1],i=r[2]}var n="";return i&&e.SWAPPING_PUNCTUATION.indexOf(i.slice(-1))>-1&&(n=i.slice(-1),i=i.slice(0,-1)),t.sys.variableWrapper(this.params,s,i,n)},"@URL/true":function(t,e){return e},"@DOI/true":function(t,e){return e}},e.Output.Formats.prototype.asciidoc={text_escape:function(t){return t||(t=""),t.replace("*","pass:[*]","g").replace("_","pass:[_]","g").replace("#","pass:[#]","g").replace("^","pass:[^]","g").replace("~","pass:[~]","g").replace("[[","pass:[[[]","g").replace("  ","&#160; ","g").replace(e.SUPERSCRIPTS_REGEXP,function(t){return"^"+e.SUPERSCRIPTS[t]+"^"})},bibstart:"",bibend:"","@passthrough/true":e.Output.Formatters.passthrough,"@font-style/italic":"__%%STRING%%__","@font-style/oblique":"__%%STRING%%__","@font-style/normal":!1,"@font-variant/small-caps":"[small-caps]#%%STRING%%#","@font-variant/normal":!1,"@font-weight/bold":"**%%STRING%%**","@font-weight/normal":!1,"@font-weight/light":!1,"@text-decoration/none":!1,"@text-decoration/underline":"[underline]##%%STRING%%##","@vertical-align/sup":"^^%%STRING%%^^","@vertical-align/sub":"~~%%STRING%%~~","@vertical-align/baseline":!1,"@strip-periods/true":e.Output.Formatters.passthrough,"@strip-periods/false":e.Output.Formatters.passthrough,"@quotes/true":function(t,e){return void 0===e?"``":"``"+e+"''"},"@quotes/inner":function(t,e){return void 0===e?"`":"`"+e+"'"},"@quotes/false":!1,"@cite/entry":function(t,e){return t.sys.wrapCitationEntry(e,this.item_id,this.locator_txt,this.suffix_txt)},"@bibliography/entry":function(t,e){return e+"\n"},"@display/block":function(t,e){return e},"@display/left-margin":function(t,e){return e},"@display/right-inline":function(t,e){return" "+e},"@display/indent":function(t,e){return" "+e},"@showid/true":function(t,i){if(t.tmp.just_looking||t.tmp.suppress_decorations||!this.params||"string"!=typeof i)return i;var s="";if(i){var r=i.match(e.VARIABLE_WRAPPER_PREPUNCT_REX);s=r[1],i=r[2]}var n="";return i&&e.SWAPPING_PUNCTUATION.indexOf(i.slice(-1))>-1&&(n=i.slice(-1),i=i.slice(0,-1)),t.sys.variableWrapper(this.params,s,i,n)},"@URL/true":function(t,e){return e},"@DOI/true":function(t,e){var i=e;return e.match(/^https?:\/\//)||(i="https://doi.org/"+e),i+"["+e+"]"}},e.Output.Formats.prototype.fo={text_escape:function(t){return t||(t=""),t.replace(/&/g,"&#38;").replace(/</g,"&#60;").replace(/>/g,"&#62;").replace("  ","&#160; ","g").replace(e.SUPERSCRIPTS_REGEXP,function(t){return'<fo:inline vertical-align="super">'+e.SUPERSCRIPTS[t]+"</fo:inline>"})},bibstart:"",bibend:"","@passthrough/true":e.Output.Formatters.passthrough,"@font-style/italic":'<fo:inline font-style="italic">%%STRING%%</fo:inline>',"@font-style/oblique":'<fo:inline font-style="oblique">%%STRING%%</fo:inline>',"@font-style/normal":'<fo:inline font-style="normal">%%STRING%%</fo:inline>',"@font-variant/small-caps":'<fo:inline font-variant="small-caps">%%STRING%%</fo:inline>',"@font-variant/normal":'<fo:inline font-variant="normal">%%STRING%%</fo:inline>',"@font-weight/bold":'<fo:inline font-weight="bold">%%STRING%%</fo:inline>',"@font-weight/normal":'<fo:inline font-weight="normal">%%STRING%%</fo:inline>',"@font-weight/light":'<fo:inline font-weight="lighter">%%STRING%%</fo:inline>',"@text-decoration/none":'<fo:inline text-decoration="none">%%STRING%%</fo:inline>',"@text-decoration/underline":'<fo:inline text-decoration="underline">%%STRING%%</fo:inline>',"@vertical-align/sup":'<fo:inline vertical-align="super">%%STRING%%</fo:inline>',"@vertical-align/sub":'<fo:inline vertical-align="sub">%%STRING%%</fo:inline>',"@vertical-align/baseline":'<fo:inline vertical-align="baseline">%%STRING%%</fo:inline>',"@strip-periods/true":e.Output.Formatters.passthrough,"@strip-periods/false":e.Output.Formatters.passthrough,"@quotes/true":function(t,e){return void 0===e?t.getTerm("open-quote"):t.getTerm("open-quote")+e+t.getTerm("close-quote")},"@quotes/inner":function(t,e){return void 0===e?"’":t.getTerm("open-inner-quote")+e+t.getTerm("close-inner-quote")},"@quotes/false":!1,"@cite/entry":function(t,e){return t.sys.wrapCitationEntry(e,this.item_id,this.locator_txt,this.suffix_txt)},"@bibliography/entry":function(t,e){var i="";if(t.bibliography&&t.bibliography.opt&&t.bibliography.opt.hangingindent){var s=t.bibliography.opt.hangingindent;i=' start-indent="'+s+'em" text-indent="-'+s+'em"'}var r="";return t.sys.embedBibliographyEntry&&(r=t.sys.embedBibliographyEntry(this.item_id)+"\n"),'<fo:block id="'+this.system_id+'"'+i+">"+e+"</fo:block>\n"+r},"@display/block":function(t,e){return"\n  <fo:block>"+e+"</fo:block>\n"},"@display/left-margin":function(t,e){return'\n  <fo:table table-layout="fixed" width="100%">\n    <fo:table-column column-number="1" column-width="$$$__COLUMN_WIDTH_1__$$$"/>\n    <fo:table-column column-number="2" column-width="proportional-column-width(1)"/>\n    <fo:table-body>\n      <fo:table-row>\n        <fo:table-cell>\n          <fo:block>'+e+"</fo:block>\n        </fo:table-cell>\n        "},"@display/right-inline":function(t,e){return"<fo:table-cell>\n          <fo:block>"+e+"</fo:block>\n        </fo:table-cell>\n      </fo:table-row>\n    </fo:table-body>\n  </fo:table>\n"},"@display/indent":function(t,e){return'<fo:block margin-left="2em">'+e+"</fo:block>\n"},"@showid/true":function(t,i){if(t.tmp.just_looking||t.tmp.suppress_decorations||!this.params||"string"!=typeof i)return i;var s="";if(i){var r=i.match(e.VARIABLE_WRAPPER_PREPUNCT_REX);s=r[1],i=r[2]}var n="";return i&&e.SWAPPING_PUNCTUATION.indexOf(i.slice(-1))>-1&&(n=i.slice(-1),i=i.slice(0,-1)),t.sys.variableWrapper(this.params,s,i,n)},"@URL/true":function(t,e){return"<fo:basic-link external-destination=\"url('"+e+"')\">"+e+"</fo:basic-link>"},"@DOI/true":function(t,e){var i=e;return e.match(/^https?:\/\//)||(i="https://doi.org/"+e),"<fo:basic-link external-destination=\"url('"+i+"')\">"+e+"</fo:basic-link>"}},e.Output.Formats.prototype.latex={text_escape:function(t){return t||(t=""),t},bibstart:"\\begin{thebibliography}{4}",bibend:"\\end{thebibliography}","@font-style/italic":"{\\em %%STRING%%}","@font-style/oblique":!1,"@font-style/normal":!1,"@font-variant/small-caps":!1,"@passthrough/true":e.Output.Formatters.passthrough,"@font-variant/normal":!1,"@font-weight/bold":"{\\bf %%STRING%%}","@font-weight/normal":!1,"@font-weight/light":!1,"@text-decoration/none":!1,"@text-decoration/underline":!1,"@vertical-align/baseline":!1,"@vertical-align/sup":!1,"@vertical-align/sub":!1,"@strip-periods/true":e.Output.Formatters.passthrough,"@strip-periods/false":e.Output.Formatters.passthrough,"@quotes/true":function(t,e){return void 0===e?t.getTerm("open-quote"):t.getTerm("open-quote")+e+t.getTerm("close-quote")},"@quotes/inner":function(t,e){return void 0===e?"’":t.getTerm("open-inner-quote")+e+t.getTerm("close-inner-quote")},"@quotes/false":!1,"@cite/entry":function(t,e){return t.sys.wrapCitationEntry(e,this.item_id,this.locator_txt,this.suffix_txt)},"@bibliography/entry":function(t,e){return"\\bibitem{"+t.sys.embedBibliographyEntry(this.item_id)+"}\n"},"@display/block":function(t,e){return"\n"+e},"@display/left-margin":function(t,e){return e},"@display/right-inline":function(t,e){return e},"@display/indent":function(t,e){return"\n    "+e},"@showid/true":function(t,e,i){return e},"@URL/true":function(t,e){return e},"@DOI/true":function(t,e){return e}},e.Output.Formats=new e.Output.Formats,e.Registry=function(t){this.debug=!1,this.state=t,this.registry={},this.reflist=[],this.refhash={},this.namereg=new e.Registry.NameReg(t),this.citationreg=new e.Registry.CitationReg(t),this.authorstrings={},this.masterMap={},this.mylist=[],this.myhash={},this.deletes=[],this.inserts=[],this.uncited={},this.refreshes={},this.akeys={},this.oldseq={},this.return_data={},this.ambigcites={},this.ambigresets={},this.sorter=new e.Registry.Comparifier(t,"bibliography_sort"),this.getSortedIds=function(){for(var t=[],e=0,i=this.reflist.length;e<i;e+=1)t.push(""+this.reflist[e].id);return t},this.getSortedRegistryItems=function(){for(var t=[],e=0,i=this.reflist.length;e<i;e+=1)t.push(this.reflist[e]);return t}},e.Registry.prototype.init=function(t,e){var i,s;if(this.oldseq={},e){this.uncited={};for(var i=0,s=t.length;i<s;i+=1)this.myhash[t[i]]||this.mylist.push(""+t[i]),this.uncited[t[i]]=!0,this.myhash[t[i]]=!0}else{for(var r in this.uncited)t.push(r);var n={};for(i=t.length-1;i>-1;i+=-1)n[t[i]]?t=t.slice(0,i).concat(t.slice(i+1)):n[t[i]]=!0;this.mylist=t,this.myhash=n}this.refreshes={},this.touched={},this.ambigsTouched={},this.ambigresets={}},e.Registry.prototype.dopurge=function(t){for(var e=this.mylist.length-1;e>-1;e+=-1)!this.citationreg.citationsByItemId||this.citationreg.citationsByItemId&&this.citationreg.citationsByItemId[this.mylist[e]]||t[this.mylist[e]]||(delete this.myhash[this.mylist[e]],delete this.uncited[this.mylist[e]],this.mylist=this.mylist.slice(0,e).concat(this.mylist.slice(e+1)));this.dodeletes(this.myhash)},e.Registry.prototype.dodeletes=function(t){var e,i,s,r,n,a,o,l,u;if("string"==typeof t){var i=t;(t={})[i]=!0}for(var i in this.registry)if(!t[i]){if(this.uncited[i])continue;for(o in this.namereg.delitems(i))this.refreshes[o]=!0;for(s=this.registry[i].ambig,(l=this.ambigcites[s].indexOf(i))>-1&&(a=this.ambigcites[s].slice(),this.ambigcites[s]=a.slice(0,l).concat(a.slice(l+1,a.length)),this.ambigresets[s]=this.ambigcites[s].length),n=this.ambigcites[s].length,r=0;r<n;r+=1)u=""+this.ambigcites[s][r],this.refreshes[u]=!0;if(this.registry[i].siblings){if(1==this.registry[i].siblings.length){var p=this.registry[i].siblings[0];this.registry[p].siblings&&(this.registry[p].siblings.pop(),this.registry[p].master=!0)}else if(this.registry[i].siblings.length>1){var h=[i];if(this.registry[i].master){var c=this.registry[i].siblings[0];this.registry[c].master=!0,h.push(c)}for(var m=[],f=this.registry[i].siblings.length-1;f>-1;f+=-1){var d=this.registry[i].siblings.pop();-1===h.indexOf(d)&&m.push(d)}for(var f=m.length-1;f>-1;f+=-1)this.registry[i].siblings.push(m[f])}}for(var g=this.reflist.length-1;g>-1;g--)this.reflist[g].id===i&&(this.reflist=this.reflist.slice(0,g).concat(this.reflist.slice(g+1)));delete this.registry[i],delete this.refhash[i],this.return_data.bibchange=!0}},e.Registry.prototype.doinserts=function(t){var i,s,r,n,a,o,l;"string"==typeof t&&(t=[t]);for(var o=0,l=t.length;o<l;o+=1)i=t[o],this.registry[i]||(s=this.state.retrieveItem(i),r=e.getAmbiguousCite.call(this.state,s),this.ambigsTouched[r]=!0,s.legislation_id||(this.akeys[r]=!0),n={id:""+i,seq:0,offset:0,sortkeys:!1,ambig:!1,rendered:!1,disambig:!1,ref:s,newItem:!0},this.registry[i]=n,this.citationreg.citationsByItemId&&this.citationreg.citationsByItemId[i]&&(this.registry[i]["first-reference-note-number"]=this.citationreg.citationsByItemId[i][0].properties.noteIndex),a=e.getAmbigConfig.call(this.state),this.registerAmbigToken(r,i,a),this.touched[i]=!0,this.return_data.bibchange=!0)},e.Registry.prototype.rebuildlist=function(t){var e,i,s,r;if(t)for(i=0,this.reflist=[],e=this.mylist.length;i<e;i+=1)s=this.mylist[i],r=this.registry[s],this.reflist.push(r),this.oldseq[s]=this.registry[s].seq,this.registry[s].seq=i+1;else for(i=0,this.reflist_inserts=[],e=this.mylist.length;i<e;i+=1)s=this.mylist[i],(r=this.registry[s]).newItem&&this.reflist_inserts.push(r),this.oldseq[s]=this.registry[s].seq,this.registry[s].seq=i+1},e.Registry.prototype.dorefreshes=function(){var t,i,s,r,n;for(var t in this.refreshes)if(i=this.registry[t]){i.sortkeys=void 0,s=this.state.refetchItem(t);var r=i.ambig;for(var a in void 0===r&&(this.state.tmp.disambig_settings=!1,r=e.getAmbiguousCite.call(this.state,s),n=e.getAmbigConfig.call(this.state),this.registerAmbigToken(r,t,n)),this.ambigresets)if(1===this.ambigresets[a]){var o=this.ambigcites[r][0],s=this.state.refetchItem(o);this.registry[o].disambig=new e.AmbigConfig,this.state.tmp.disambig_settings=!1;var r=e.getAmbiguousCite.call(this.state,s),n=e.getAmbigConfig.call(this.state);this.registerAmbigToken(r,o,n)}this.state.tmp.taintedItemIDs[t]=!0,this.ambigsTouched[r]=!0,s.legislation_id||(this.akeys[r]=!0),this.touched[t]=!0}},e.Registry.prototype.setdisambigs=function(){for(var t in this.ambigsTouched)this.state.disambiguate.run(t);this.ambigsTouched={},this.akeys={}},e.Registry.prototype.renumber=function(){var t,i,s;for(this.state.bibliography_sort.opt.citation_number_sort_direction===e.DESCENDING&&(this.state.bibliography_sort.tmp.citation_number_map={}),t=this.reflist.length,i=0;i<t;i+=1)(s=this.reflist[i]).seq=i+1,this.state.bibliography_sort.opt.citation_number_sort_direction===e.DESCENDING&&(this.state.bibliography_sort.tmp.citation_number_map[s.seq]=this.reflist.length-s.seq+1),this.state.opt.update_mode===e.NUMERIC&&s.seq!=this.oldseq[s.id]&&(this.state.tmp.taintedItemIDs[s.id]=!0),s.seq!=this.oldseq[s.id]&&(this.return_data.bibchange=!0)},e.Registry.prototype.setsortkeys=function(){for(var t,i=0,s=this.mylist.length;i<s;i+=1){var t=this.mylist[i];(this.touched[t]||this.state.tmp.taintedItemIDs[t]||!this.registry[t].sortkeys)&&(this.registry[t].sortkeys=e.getSortKeys.call(this.state,this.state.retrieveItem(t),"bibliography_sort"))}},e.Registry.prototype._insertItem=function(t,e){return e.splice(this._locationOf(t,e)+1,0,t),e},e.Registry.prototype._locationOf=function(t,e,i,s){if(0===e.length)return -1;var r=(i=i||0)+(s=s||e.length)>>1,n=this.sorter.compareKeys(t,e[r]);if(s-i<=1)return -1==n?r-1:r;switch(n){case -1:return this._locationOf(t,e,i,r);case 0:return r;case 1:return this._locationOf(t,e,r,s)}},e.Registry.prototype.sorttokens=function(t){var e,i,s,r;if(!t){for(r=0,this.reflist_inserts=[],e=this.mylist.length;r<e;r+=1)i=this.mylist[r],(s=this.registry[i]).newItem&&this.reflist_inserts.push(s);for(var n in this.state.tmp.taintedItemIDs)if(this.registry[n]&&!this.registry[n].newItem)for(var a=this.reflist.length-1;a>-1;a--)this.reflist[a].id===n&&(this.reflist_inserts.push(this.reflist[a]),this.reflist=this.reflist.slice(0,a).concat(this.reflist.slice(a+1)));for(var a=0,o=this.reflist_inserts.length;a<o;a++){var s=this.reflist_inserts[a];delete s.newItem,this.reflist=this._insertItem(s,this.reflist)}for(r=0;r<e;r+=1)i=this.mylist[r],s=this.registry[i],this.registry[i].seq=r+1}},e.Registry.Comparifier=function(t,i){var s,r,n,a,o=e.getSortCompare.call(t,t.opt["default-locale-sort"]);s=t[i].opt.sort_directions,this.compareKeys=function(t,e){for(n=0,r=t.sortkeys?t.sortkeys.length:0;n<r;n+=1){var i=0;if(0<(i=t.sortkeys[n]===e.sortkeys[n]?0:void 0===t.sortkeys[n]?s[n][1]:void 0===e.sortkeys[n]?s[n][0]:o(t.sortkeys[n],e.sortkeys[n])))return s[n][1];if(0>i)return s[n][0]}return t.seq>e.seq?1:t.seq<e.seq?-1:0},a=this.compareKeys,this.compareCompositeKeys=function(t,e){return a(t[1],e[1])}},e.Registry.prototype.compareRegistryTokens=function(t,e){return t.seq>e.seq?1:t.seq<e.seq?-1:0},e.Registry.prototype.registerAmbigToken=function(t,i,s){if(this.registry[i]||e.debug("Warning: unregistered item: itemID=("+i+"), akey=("+t+")"),this.registry[i]&&this.registry[i].disambig&&this.registry[i].disambig.names){for(var r=0,n=s.names.length;r<n;r+=1)if(s.names[r]!==this.registry[i].disambig.names[r])this.state.tmp.taintedItemIDs[i]=!0;else if(s.givens[r])for(var a=0,o=s.givens[r].length;a<o;a+=1)s.givens[r][a]!==this.registry[i].disambig.givens[r][a]&&(this.state.tmp.taintedItemIDs[i]=!0)}this.ambigcites[t]||(this.ambigcites[t]=[]),-1===this.ambigcites[t].indexOf(""+i)&&this.ambigcites[t].push(""+i),this.registry[i].ambig=t,this.registry[i].disambig=e.cloneAmbigConfig(s)},e.getSortKeys=function(t,i){var s,r,n,a,o,l;for(s=this.tmp.area,r=this.tmp.root,n=this.tmp.extension,a=e.Util.Sort.strip_prepositions,this.tmp.area=i,this.tmp.root=i.indexOf("_")>-1?i.slice(0,-5):i,this.tmp.extension="_sort",this.tmp.disambig_override=!0,this.tmp.disambig_request=!1,this.tmp.suppress_decorations=!0,e.getCite.call(this,t),this.tmp.suppress_decorations=!1,this.tmp.disambig_override=!1,o=this[i].keys.length,l=0;l<o;l+=1)this[i].keys[l]=a(this[i].keys[l]);return this.tmp.area=s,this.tmp.root=r,this.tmp.extension=n,this[i].keys},e.Registry.NameReg=function(t){var i,s,r,n,a,o,l,u,p;this.state=t,this.namereg={},this.nameind={},this.nameindpkeys={},this.itemkeyreg={},l=function(t){return t||(t=""),t.replace(/\./g," ").replace(/\s+/g," ").replace(/\s+$/,"")},u=function(t,n,a){i=l(a.family),"never"===t.opt["demote-non-dropping-particle"]&&a["non-dropping-particle"]&&a.family&&(i=`${i} ${a["non-dropping-particle"]}`);var o=(r=l(a.given)).match(/[,\!]* ([^,]+)$/);o&&o[1]===o[1].toLowerCase()&&(r=r.replace(/[,\!]* [^,]+$/,"")),s=e.Util.Names.initializeWith(t,r,"%s"),"by-cite"===t.citation.opt["givenname-disambiguation-rule"]&&(i=""+n+i)},this.addname=function(e,n,a){var o,l;if(n=t.nameOutput.getName(n,"locale-translit",!0).name,!t.citation.opt["givenname-disambiguation-rule"]||"primary-"!==t.citation.opt["givenname-disambiguation-rule"].slice(0,8)||0===a){if(u(this.state,""+e,n),i&&(void 0===this.namereg[i]?(this.namereg[i]={},this.namereg[i].count=0,this.namereg[i].ikey={},this.namereg[i].items=[e]):-1===this.namereg[i].items.indexOf(e)&&this.namereg[i].items.push(e)),i&&s)if(void 0===this.namereg[i].ikey[s]){if(this.namereg[i].ikey[s]={},this.namereg[i].ikey[s].count=0,this.namereg[i].ikey[s].skey={},this.namereg[i].ikey[s].items=[e],this.namereg[i].count+=1,2===this.namereg[i].count)for(var o=0,l=this.namereg[i].items.length;o<l;o+=1)t.tmp.taintedItemIDs[this.namereg[i].items[o]]=!0}else -1===this.namereg[i].ikey[s].items.indexOf(e)&&this.namereg[i].ikey[s].items.push(e);if(i&&s&&r)if(void 0===this.namereg[i].ikey[s].skey[r]){if(this.namereg[i].ikey[s].skey[r]={},this.namereg[i].ikey[s].skey[r].items=[e],this.namereg[i].ikey[s].count+=1,2===this.namereg[i].ikey[s].count)for(var o=0,l=this.namereg[i].ikey[s].items.length;o<l;o+=1)t.tmp.taintedItemIDs[this.namereg[i].ikey[s].items[o]]=!0}else -1===this.namereg[i].ikey[s].skey[r].items.indexOf(e)&&this.namereg[i].ikey[s].skey[r].items.push(e);void 0===this.nameind[e]&&(this.nameind[e]={},this.nameindpkeys[e]={}),i&&(this.nameind[e][i+"::"+s+"::"+r]=!0,this.nameindpkeys[e][i]=this.namereg[i])}},this.delitems=function(e){var n,a,l,u,h;for(("string"==typeof e||"number"==typeof e)&&(e=[""+e]),a=e.length,n=0;n<a;n+=1)if(u=""+e[n],this.nameind[u]){for(h in this.nameind[u])if(this.nameind[u].hasOwnProperty(h)){var c=h.split("::");if(i=c[0],s=c[1],r=c[2],void 0===this.namereg[i])continue;if(o=this.namereg[i].items,r&&this.namereg[i].ikey[s]&&this.namereg[i].ikey[s].skey[r]&&((l=(p=this.namereg[i].ikey[s].skey[r].items).indexOf(""+u))>-1&&(this.namereg[i].ikey[s].skey[r].items=p.slice(0,l).concat(p.slice([l+1]))),0===this.namereg[i].ikey[s].skey[r].items.length)&&(delete this.namereg[i].ikey[s].skey[r],this.namereg[i].ikey[s].count+=-1,this.namereg[i].ikey[s].count<2))for(var m=0,f=this.namereg[i].ikey[s].items.length;m<f;m+=1)t.tmp.taintedItemIDs[this.namereg[i].ikey[s].items[m]]=!0;if(s&&this.namereg[i].ikey[s]&&((l=this.namereg[i].ikey[s].items.indexOf(""+u))>-1&&(o=this.namereg[i].ikey[s].items.slice(),this.namereg[i].ikey[s].items=o.slice(0,l).concat(o.slice([l+1]))),0===this.namereg[i].ikey[s].items.length)&&(delete this.namereg[i].ikey[s],this.namereg[i].count+=-1,this.namereg[i].count<2))for(var m=0,f=this.namereg[i].items.length;m<f;m+=1)t.tmp.taintedItemIDs[this.namereg[i].items[m]]=!0;i&&((l=this.namereg[i].items.indexOf(""+u))>-1&&(o=this.namereg[i].items.slice(),this.namereg[i].items=o.slice(0,l).concat(o.slice([l+1],o.length))),this.namereg[i].items.length<2&&delete this.namereg[i]),delete this.nameind[u][h]}delete this.nameind[u],delete this.nameindpkeys[u]}return{}},this.evalname=function(e,r,o,l,p,h){if("bibliography"===t.tmp.area.slice(0,12)&&!p)if("string"==typeof h)return 1;else return 2;r=t.nameOutput.getName(r,"locale-translit",!0).name,u(this.state,""+e,r),c=2,n=t.opt["disambiguate-add-givenname"];var c,m=a=t.citation.opt["givenname-disambiguation-rule"];return("by-cite"===a&&(a="all-names"),"short"===p?c=0:"string"==typeof h&&(c=1),void 0===this.namereg[i]||void 0===this.namereg[i].ikey[s])?c:"by-cite"===m&&c<=l?l:!n||"string"==typeof a&&"primary-name"===a.slice(0,12)&&o>0||(a&&"all-names"!==a&&"primary-name"!==a?("all-names-with-initials"===a||"primary-name-with-initials"===a)&&(c=+(this.namereg[i].count>1)):(this.namereg[i].count>1&&(c=1),(this.namereg[i].ikey&&this.namereg[i].ikey[s].count>1||this.namereg[i].count>1&&"string"!=typeof h)&&(c=2)),t.registry.registry[e])?c:"short"==p?0:"string"==typeof h?1:void 0}},e.Registry.CitationReg=function(){this.citationById={},this.citationByIndex=[]},e.Disambiguation=function(t){this.state=t,this.sys=this.state.sys,this.registry=t.registry.registry,this.ambigcites=t.registry.ambigcites,this.configModes(),this.debug=!1},e.Disambiguation.prototype.run=function(t){this.modes.length&&(this.debug&&this.state.sys.print("[A] === RUN ==="),this.akey=t,this.initVars(t)&&this.runDisambig())},e.Disambiguation.prototype.runDisambig=function(){var t;for(this.debug&&this.state.sys.print("[C] === runDisambig() ==="),this.initGivens=!0;this.lists.length;){for(this.gnameset=0,this.gname=0,this.clashes=[1,0];this.lists[0][1].length;)this.listpos=0,this.base||(this.base=this.lists[0][0]),t=this.incrementDisambig(),this.scanItems(this.lists[0]),this.evalScan(t);this.lists=this.lists.slice(1)}},e.Disambiguation.prototype.scanItems=function(t){this.debug&&this.state.sys.print("[2] === scanItems() ==="),this.Item=t[1][0],this.ItemCite=e.getAmbiguousCite.call(this.state,this.Item,this.base,!0),this.scanlist=t[1],this.partners=[],this.partners.push(this.Item),this.nonpartners=[];for(var i,s,r,n=0,i=1,s=t[1].length;i<s;i+=1){r=t[1][i];var a=e.getAmbiguousCite.call(this.state,r,this.base,!0);this.debug&&i>1&&this.state.sys.print("  -----------"),this.ItemCite===a?(this.debug&&(this.state.sys.print("  [CLASH]--\x3e "+this.Item.id+": "+this.ItemCite),this.state.sys.print("             "+r.id+": "+a)),n+=1,this.partners.push(r)):(this.debug&&(this.state.sys.print("  [clear]--\x3e "+this.Item.id+": "+this.ItemCite),this.state.sys.print("             "+r.id+": "+a)),this.nonpartners.push(r))}this.clashes[0]=this.clashes[1],this.clashes[1]=n},e.Disambiguation.prototype.evalScan=function(t){this[this.modes[this.modeindex]](t),t&&(this.modeindex<this.modes.length-1?this.modeindex+=1:this.lists[this.listpos+1]=[this.base,[]])},e.Disambiguation.prototype.disNames=function(t){var e,i;if(this.debug&&this.state.sys.print("[3] == disNames() =="),0===this.clashes[1]&&1===this.nonpartners.length)this.captureStepToBase(),this.debug&&(this.state.sys.print("  ** RESOLUTION [a]: lone partner, one nonpartner"),this.state.sys.print("  registering "+this.partners[0].id+" and "+this.nonpartners[0].id)),this.state.registry.registerAmbigToken(this.akey,""+this.nonpartners[0].id,this.betterbase),this.state.registry.registerAmbigToken(this.akey,""+this.partners[0].id,this.betterbase),this.lists[this.listpos]=[this.betterbase,[]];else if(0===this.clashes[1])this.captureStepToBase(),this.debug&&(this.state.sys.print("  ** RESOLUTION [b]: lone partner, unknown number of remaining nonpartners"),this.state.sys.print("  registering "+this.partners[0].id)),this.state.registry.registerAmbigToken(this.akey,""+this.partners[0].id,this.betterbase),this.lists[this.listpos]=[this.betterbase,this.nonpartners],this.nonpartners.length&&(this.initGivens=!0);else if(1===this.nonpartners.length)this.captureStepToBase(),this.debug&&(this.state.sys.print("  ** RESOLUTION [c]: lone nonpartner, unknown number of partners remaining"),this.state.sys.print("  registering "+this.nonpartners[0].id)),this.state.registry.registerAmbigToken(this.akey,""+this.nonpartners[0].id,this.betterbase),this.lists[this.listpos]=[this.betterbase,this.partners];else if(this.clashes[1]<this.clashes[0])this.captureStepToBase(),this.debug&&this.state.sys.print("  ** RESOLUTION [d]: better result, but no entries safe to register"),this.lists[this.listpos]=[this.betterbase,this.partners],this.lists.push([this.betterbase,this.nonpartners]);else if(this.debug&&this.state.sys.print("  ** RESOLUTION [e]: no improvement, and clashes remain"),t&&(this.lists[this.listpos]=[this.betterbase,this.nonpartners],this.lists.push([this.betterbase,this.partners]),this.modeindex===this.modes.length-1)){this.debug&&this.state.sys.print("     (registering clashing entries because we've run out of options)");for(var e=0,i=this.partners.length;e<i;e+=1)this.state.registry.registerAmbigToken(this.akey,""+this.partners[e].id,this.betterbase);this.lists[this.listpos]=[this.betterbase,[]]}},e.Disambiguation.prototype.disExtraText=function(){this.debug&&this.state.sys.print("[3] === disExtraText ==");var t=!1;if(0===this.clashes[1]&&this.nonpartners.length<2&&(t=!0),t||this.base.disambiguate&&this.state.tmp.disambiguate_count===this.state.tmp.disambiguate_maxMax){if(t||this.state.tmp.disambiguate_count===this.state.tmp.disambiguate_maxMax)if(t||this.modeindex===this.modes.length-1){for(var e=this.lists[this.listpos][0],i=0,s=this.lists[this.listpos][1].length;i<s;i+=1)this.state.tmp.taintedItemIDs[this.lists[this.listpos][1][i].id]=!0,this.state.registry.registerAmbigToken(this.akey,""+this.lists[this.listpos][1][i].id,e);this.lists[this.listpos]=[this.betterbase,[]]}else{this.modeindex=this.modes.length-1;var e=this.lists[this.listpos][0];e.disambiguate=!0;for(var i=0,s=this.lists[this.listpos][1].length;i<s;i+=1)this.state.tmp.taintedItemIDs[this.lists[this.listpos][1][i].id]=!0,this.state.registry.registerAmbigToken(this.akey,""+this.lists[this.listpos][1][i].id,e)}}else if(this.modeindex=0,this.base.disambiguate=this.state.tmp.disambiguate_count,this.betterbase.disambiguate=this.state.tmp.disambiguate_count,this.base.disambiguate)this.disNames();else{this.initGivens=!0,this.base.disambiguate=1;for(var i=0,s=this.lists[this.listpos][1].length;i<s;i+=1)this.state.tmp.taintedItemIDs[this.lists[this.listpos][1][i].id]=!0}},e.Disambiguation.prototype.disYears=function(){this.debug&&this.state.sys.print("[3] === disYears ==");var t,i,s,r=[],n=this.lists[this.listpos][0];if(this.clashes[1])for(var a=0,o=this.state.registry.mylist.length;a<o;a+=1)for(var l=this.state.registry.mylist[a],u=0,p=this.lists[this.listpos][1].length;u<p;u+=1){var s=this.lists[this.listpos][1][u];if(s.id==l){r.push(this.registry[s.id]);break}}r.sort(this.state.registry.sorter.compareKeys);for(var t=0,i=r.length;t<i;t+=1){n.year_suffix=""+t;var h=this.state.registry.registry[r[t].id].disambig;this.state.registry.registerAmbigToken(this.akey,""+r[t].id,n),e.ambigConfigDiff(h,n)&&(this.state.tmp.taintedItemIDs[r[t].id]=!0)}this.lists[this.listpos]=[this.betterbase,[]]},e.Disambiguation.prototype.incrementDisambig=function(){if(this.debug&&this.state.sys.print("\n[1] === incrementDisambig() ==="),this.initGivens)return this.initGivens=!1,!1;var t=!1,e=!0;if("disNames"===this.modes[this.modeindex]){e=!1,"number"!=typeof this.givensMax&&(e=!0);var i=!1;"number"!=typeof this.namesMax&&(i=!0),"number"==typeof this.givensMax&&(this.base.givens.length&&this.base.givens[this.gnameset][this.gname]<this.givensMax?this.base.givens[this.gnameset][this.gname]+=1:e=!0),"number"==typeof this.namesMax&&e&&(this.state.opt["disambiguate-add-names"]?(i=!1,this.gname<this.namesMax?(this.base.names[this.gnameset]+=1,this.gname+=1):i=!0):i=!0),"number"==typeof this.namesetsMax&&i&&this.gnameset<this.namesetsMax&&(this.gnameset+=1,this.base.names[this.gnameset]=1,this.gname=0),this.debug&&(this.state.sys.print("    ------------------"),this.state.sys.print("    incremented values"),this.state.sys.print("    ------------------"),this.state.sys.print("    | gnameset: "+this.gnameset),this.state.sys.print("    | gname: "+this.gname),this.state.sys.print("    | names value: "+this.base.names[this.gnameset]),this.base.givens.length?this.state.sys.print("    | givens value: "+this.base.givens[this.gnameset][this.gname]):this.state.sys.print("    | givens value: nil"),this.state.sys.print("    | namesetsMax: "+this.namesetsMax),this.state.sys.print("    | namesMax: "+this.namesMax),this.state.sys.print("    | givensMax: "+this.givensMax)),("number"!=typeof this.namesetsMax||-1===this.namesetsMax||this.gnameset===this.namesetsMax)&&(!this.state.opt["disambiguate-add-names"]||"number"!=typeof this.namesMax||this.gname===this.namesMax)&&("number"!=typeof this.givensMax||void 0===this.base.givens[this.gnameset]||void 0===this.base.givens[this.gnameset][this.gname]||this.base.givens[this.gnameset][this.gname]===this.givensMax)&&(t=!0,this.debug&&this.state.sys.print("    MAXED"))}else"disExtraText"===this.modes[this.modeindex]&&(this.base.disambiguate+=1,this.betterbase.disambiguate+=1);return t},e.Disambiguation.prototype.initVars=function(t){if(this.debug&&this.state.sys.print("[B] === initVars() ==="),this.lists=[],this.base=!1,this.betterbase=!1,this.akey=t,this.maxNamesByItemId={},s=[],!(i=this.ambigcites[t])||!i.length)return!1;var i,s,r,n,a,o=this.state.refetchItem(""+i[0]);if(this.getCiteData(o),this.base=e.getAmbigConfig.call(this.state),i&&i.length>1){s.push([this.maxNamesByItemId[o.id],o]);for(var n=1,a=i.length;n<a;n+=1)o=this.state.refetchItem(""+i[n]),this.getCiteData(o,this.base),s.push([this.maxNamesByItemId[o.id],o]);s.sort(function(t,e){return t[0]>e[0]?1:t[0]<e[0]?-1:t[1].id>e[1].id?1:t[1].id<e[1].id?-1:0}),r=[];for(var n=0,a=s.length;n<a;n+=1)r.push(s[n][1]);this.lists.push([this.base,r]),this.Item=this.lists[0][1][0]}else this.Item=this.state.refetchItem(""+i[0]);return this.modeindex=0,this.state.citation.opt["disambiguate-add-names"],this.namesMax=this.maxNamesByItemId[this.Item.id][0],this.padBase(this.base),this.padBase(this.betterbase),this.base.year_suffix=!1,this.base.disambiguate=!1,this.betterbase.year_suffix=!1,this.betterbase.disambiguate=!1,"by-cite"===this.state.citation.opt["givenname-disambiguation-rule"]&&this.state.opt["disambiguate-add-givenname"]&&(this.givensMax=2),!0},e.Disambiguation.prototype.padBase=function(t){for(var e=0,i=t.names.length;e<i;e+=1){t.givens[e]||(t.givens[e]=[]);for(var s=0,r=t.names[e];s<r;s+=1)t.givens[e][s]||(t.givens[e][s]=0)}},e.Disambiguation.prototype.configModes=function(){var t,e;this.modes=[],t=this.state.opt["disambiguate-add-givenname"],e=this.state.citation.opt["givenname-disambiguation-rule"],(this.state.opt["disambiguate-add-names"]||t&&"by-cite"===e)&&this.modes.push("disNames"),this.state.opt.development_extensions.prioritize_disambiguate_condition?(this.state.opt.has_disambiguate&&this.modes.push("disExtraText"),this.state.opt["disambiguate-add-year-suffix"]&&this.modes.push("disYears")):(this.state.opt["disambiguate-add-year-suffix"]&&this.modes.push("disYears"),this.state.opt.has_disambiguate&&this.modes.push("disExtraText"))},e.Disambiguation.prototype.getCiteData=function(t,i){if(!this.maxNamesByItemId[t.id]){e.getAmbiguousCite.call(this.state,t,i),i=e.getAmbigConfig.call(this.state),this.maxNamesByItemId[t.id]=e.getMaxVals.call(this.state),this.state.registry.registry[t.id].disambig.givens=this.state.tmp.disambig_settings.givens.slice();for(var s=0,r=this.state.registry.registry[t.id].disambig.givens.length;s<r;s+=1)this.state.registry.registry[t.id].disambig.givens[s]=this.state.tmp.disambig_settings.givens[s].slice();this.namesetsMax=this.state.registry.registry[t.id].disambig.names.length-1,this.base||(this.base=i,this.betterbase=e.cloneAmbigConfig(i)),i.names.length<this.base.names.length&&(this.base=i);for(var s=0,r=i.names.length;s<r;s+=1)i.names[s]>this.base.names[s]&&(this.base.givens[s]=i.givens[s].slice(),this.base.names[s]=i.names[s],this.betterbase.names=this.base.names.slice(),this.betterbase.givens=this.base.givens.slice(),this.padBase(this.base),this.padBase(this.betterbase));this.betterbase.givens=this.base.givens.slice();for(var n=0,a=this.base.givens.length;n<a;n+=1)this.betterbase.givens[n]=this.base.givens[n].slice()}},e.Disambiguation.prototype.captureStepToBase=function(){"by-cite"===this.state.citation.opt["givenname-disambiguation-rule"]&&this.base.givens&&this.base.givens.length&&void 0!==this.base.givens[this.gnameset][this.gname]&&(this.betterbase.givens.length<this.base.givens.length&&(this.betterbase.givens=JSON.parse(JSON.stringify(this.base.givens))),this.betterbase.givens[this.gnameset][this.gname]=this.base.givens[this.gnameset][this.gname]),this.betterbase.names[this.gnameset]=this.base.names[this.gnameset]},e.Engine.prototype.getJurisdictionList=function(t){for(var e=[],i=t.split(":"),s=i.length;s>0;s--){var r=i.slice(0,s).join(":");if(e.push(r),this.opt.jurisdiction_fallbacks[r]){var n=this.opt.jurisdiction_fallbacks[r];e.push(n)}}return -1===e.indexOf("us")&&e.push("us"),e},e.Engine.prototype.loadStyleModule=function(t,i,s){var r=null;this.juris[t]={};var n=e.setupXml(i);n.addMissingNameNodes(n.dataObj),n.addInstitutionNodes(n.dataObj),n.insertPublisherAndPlace(n.dataObj),n.flagDateMacros(n.dataObj);for(var a=n.getNodesByName(n.dataObj,"law-module"),o=0,l=a.length;o<l;o++){var u=n.getAttributeValue(a[o],"types");if(u){this.juris[t].types={},u=u.split(/\s+/);for(var p=0,h=u.length;p<h;p++)this.juris[t].types[u[p]]=!0}!s&&(r=n.getAttributeValue(a[o],"fallback"))&&"us"!==t&&(this.opt.jurisdiction_fallbacks[t]=r)}var c=this.opt.lang?this.opt.lang:this.opt["default-locale"][0];e.SET_COURT_CLASSES(this,c,n,n.dataObj),this.juris[t].types||(this.juris[t].types=e.MODULE_TYPES);for(var a=n.getNodesByName(n.dataObj,"macro"),o=0,l=a.length;o<l;o++){var m=n.getAttributeValue(a[o],"name");if(!e.MODULE_MACROS[m]){e.debug('CSL: skipping non-modular macro name "'+m+'" in module context');continue}this.juris[t][m]=[],this.buildTokenLists(a[o],this.juris[t][m]),this.configureTokenList(this.juris[t][m])}return r},e.Engine.prototype.retrieveAllStyleModules=function(t){var e={},i=this.locale[this.opt.lang].opts["jurisdiction-preference"];i=[""].concat(i=i||[]);for(var s=i.length-1;s>-1;s--)for(var r=i[s],n=0,a=t.length;n<a;n++){var o=t[n];if(!this.opt.jurisdictions_seen[o]){var l=this.sys.retrieveStyleModule(o,r);(l||r)&&!l||(this.opt.jurisdictions_seen[o]=!0),l&&(e[o]=l)}}return e},e.ParticleList=function(){var t=[[[0,1],null]],e=[[null,[0,1]]],i=[[null,[0,2]]],s=[[null,[0,3]]],r=[[null,[0,1]],[[0,1],null]],n=[[null,[0,2]],[[0,2],null]],a=[[[0,1],null],[null,[0,1]]],o=[[[0,2],null],[null,[0,2]]],l=[[null,[0,2]],[[0,1],[1,2]]];return[["'s",e],["'s-",e],["'t",e],["a",e],["aan 't",i],["aan de",i],["aan den",i],["aan der",i],["aan het",i],["aan t",i],["aan",e],["ad-",r],["adh-",r],["af",r],["al",r],["al-",r],["am de",i],["am",e],["an-",r],["ar-",r],["as-",r],["ash-",r],["at-",r],["ath-",r],["auf dem",o],["auf den",o],["auf der",o],["auf ter",i],["auf",a],["aus 'm",o],["aus dem",o],["aus den",o],["aus der",o],["aus m",o],["aus",a],["aus'm",o],["az-",r],["aš-",r],["aḍ-",r],["aḏ-",r],["aṣ-",r],["aṭ-",r],["aṯ-",r],["aẓ-",r],["ben",e],["bij 't",i],["bij de",i],["bij den",i],["bij het",i],["bij t",i],["bij",e],["bin",e],["boven d",i],["boven d'",i],["d",e],["d'",r],["da",r],["dal",e],["dal'",e],["dall'",e],["dalla",e],["das",r],["de die le",s],["de die",i],["de l",i],["de l'",i],["de la",l],["de las",l],["de le",i],["de li",n],["de van der",s],["de",r],["de'",r],["deca",e],["degli",r],["dei",r],["del",r],["dela",t],["dell'",r],["della",r],["delle",r],["dello",r],["den",r],["der",r],["des",r],["di",r],["die le",i],["do",e],["don",e],["dos",r],["du",r],["ed-",r],["edh-",r],["el",r],["el-",r],["en-",r],["er-",r],["es-",r],["esh-",r],["et-",r],["eth-",r],["ez-",r],["eš-",r],["eḍ-",r],["eḏ-",r],["eṣ-",r],["eṭ-",r],["eṯ-",r],["eẓ-",r],["het",e],["i",e],["il",t],["im",e],["in 't",i],["in de",i],["in den",i],["in der",n],["in het",i],["in t",i],["in",e],["l",e],["l'",e],["la",e],["las",e],["le",e],["les",r],["lo",r],["los",e],["lou",e],["of",e],["onder 't",i],["onder de",i],["onder den",i],["onder het",i],["onder t",i],["onder",e],["op 't",i],["op de",n],["op den",i],["op der",i],["op gen",i],["op het",i],["op t",i],["op ten",i],["op",e],["over 't",i],["over de",i],["over den",i],["over het",i],["over t",i],["over",e],["s",e],["s'",e],["sen",t],["t",e],["te",e],["ten",e],["ter",e],["tho",e],["thoe",e],["thor",e],["to",e],["toe",e],["tot",e],["uijt 't",i],["uijt de",i],["uijt den",i],["uijt te de",s],["uijt ten",i],["uijt",e],["uit 't",i],["uit de",i],["uit den",i],["uit het",i],["uit t",i],["uit te de",s],["uit ten",i],["uit",e],["unter",e],["v",e],["v.",e],["v.d.",e],["van 't",i],["van de l",s],["van de l'",s],["van de",i],["van de",i],["van den",i],["van der",i],["van gen",i],["van het",i],["van la",i],["van t",i],["van ter",i],["van van de",s],["van",r],["vander",e],["vd",e],["ver",e],["vom und zum",[[[0,3],null]]],["vom",r],["von 't",i],["von dem",o],["von den",o],["von der",o],["von t",i],["von und zu",[[[0,3],null],[null,[0,3]]]],["von zu",o],["von",a],["voor 't",i],["voor de",i],["voor den",i],["voor in 't",s],["voor in t",s],["voor",e],["vor der",o],["vor",a],["z",t],["ze",t],["zu",a],["zum",r],["zur",r]]}(),e.parseParticles=function(){function t(t,i,s){var r,n,a=t;t=s?t.toLowerCase():t;var o=[];i?(t=t.split("").reverse().join(""),r=e.PARTICLE_GIVEN_REGEXP):r=e.PARTICLE_FAMILY_REGEXP;for(var l=t.match(r);l;){var u=i?l[1].split("").reverse().join(""):l[1],p=!!l&&u,p=!!p&&u.replace(/^[-\'\u02bb\u2019\s]*(.).*$/,"$1");if(!(n=!!p&&p.toUpperCase()!==p))break;i?(o.push(a.slice(-1*u.length)),a=a.slice(0,-1*u.length)):(o.push(a.slice(0,u.length)),a=a.slice(u.length)),l=(t=l[2]).match(r)}if(i){t=t.split("").reverse().join(""),o.reverse();for(var h=1,c=o.length;h<c;h++)" "==o[h].slice(0,1)&&(o[h-1]+=" ");for(var h=0,c=o.length;h<c;h++)" "==o[h].slice(0,1)&&(o[h]=o[h].slice(1));t=a.slice(0,t.length)}else t=a.slice(-1*t.length);return[n,t,o]}return function(e){var i,s,r=t(e.family),n=r[1],a=r[2];e.family=n;var o=(s=(i=a.join("")).slice(-1),i=i.trim()," "===s&&["'","’"].indexOf(i.slice(-1))>-1&&(i+=" "),i);o&&(e["non-dropping-particle"]=o);if(!e.suffix&&e.given){var l=e.given.match(/(\s*,!*\s*)/);if(l){var u=e.given.indexOf(l[1]),p=e.given.slice(u+l[1].length),h=e.given.slice(u,u+l[1].length).replace(/\s*/g,"");"et al"!==p.replace(/\./g,"")||e["dropping-particle"]?(2===h.length&&(e["comma-suffix"]=!0),e.suffix=p):(e["dropping-particle"]=p,e["comma-dropping-particle"]=","),e.given=e.given.slice(0,u)}}var r=t(e.given,!0),c=r[1],m=r[2];e.given=c;var f=m.join("").trim();f&&(e["dropping-particle"]=f)}}(),t.exports=e}}]);