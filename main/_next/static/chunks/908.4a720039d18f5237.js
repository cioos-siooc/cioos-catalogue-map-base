"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[908],{1908:(e,t,o)=>{o.r(t),o.d(t,{default:()=>L});var r=o(5155);o(5603),o(8033);var n=o(3105),a=o(7054),l=o(525),s=o(5384),i=o(4755),u=o(6246),c=o(6264),d=o(2782),m=o(9240),p=o(9091),h=o(853),f=o(8575),g=o(2115),y=o(5027),x=o.n(y),b=o(28),v=o(352);let{BaseLayer:_,Overlay:k}=n.In,j=()=>getComputedStyle(document.documentElement).getPropertyValue("--color-primary-500").trim(),w=e=>{e.eachLayer(t=>{(t instanceof x().Polygon||t instanceof x().GeoJSON)&&e.removeLayer(t)})},C=e=>{let{bounds:t}=e;console.log("Before bounds:",t);let o=(0,a.ko)();return(0,g.useLayoutEffect)(()=>{A(t,o)},[t,o]),null};function A(e,t){if(console.log("FitBounds effect triggered with bounds:",e),e){w(t);let o=x().geoJSON(e,{color:j()}).addTo(t),r=window.innerWidth<768;t.flyToBounds(o.getBounds(),{animate:!0,padding:r?[50,50]:[150,250],maxZoom:r?13:10,duration:.3})}}let N=e=>{let{record:t,handleListItemClick:o,lang:n,openDrawer:a}=e,s=m.N(t.spatial);p.m(s,t.spatial)||(s=h.Q(t.spatial));let[i,u]=s.geometry.coordinates,d=b.A.map.center[1];for(;i-d>180;)i-=360;for(;i-d<-180;)i+=360;function f(e){let t=e.target._map;e.target._hoverPolygon&&(t.removeLayer(e.target._hoverPolygon),e.target._hoverPolygon=null)}return(0,r.jsx)(c.p,{position:[u,i],eventHandlers:{click:e=>{f(e),o(t),a()},mouseover:e=>{if(e.target._hoverPolygon||"Point"===t.spatial.type)return;let o=e.target._map,r=x().geoJSON(t.spatial,{style:{color:j(),weight:2,fillColor:j(),fillOpacity:.5}}).addTo(o);e.target._hoverPolygon=r},mouseout:e=>{f(e)}},children:(0,r.jsx)(l.m,{children:(0,r.jsxs)("div",{className:"w-[200px]",children:[(0,r.jsx)("h2",{className:"font-bold text-wrap",children:t.title_translated[n]}),(0,r.jsx)("p",{className:"text-xs text-wrap",children:t.organization.title_translated[n]})]})})},t.id)},E=e=>{let{basemaps:t,lang:o}=e;return(0,r.jsx)(r.Fragment,{children:t.map(e=>(0,r.jsx)(_,{checked:e.checked||!1,name:e.name[o],children:(0,r.jsx)(s.e,{url:e.url,attribution:e.attribution,minZoom:e.minZoom||0,maxZoom:e.maxZoom||10})},e.key))})},S=e=>{let{overlays:t,lang:o}=e,n=(0,a.ko)();return(0,g.useEffect)(()=>{},[n]),(0,r.jsx)(r.Fragment,{children:t&&t.length?t.map(e=>(0,r.jsx)(k,{name:e.name&&e.name[o]?e.name[o]:e.key,checked:e.checked||!1,children:(0,r.jsx)(s.e,{url:e.url,attribution:e.attribution,minZoom:e.minZoom||0,maxZoom:e.maxZoom||10})},e.key)):null})};function z(){let[e,t]=(0,g.useState)(!1),[o,n]=(0,g.useState)([]),l=(0,a.ko)();return((0,g.useEffect)(()=>{if(!l)return;let e=()=>{let e=[];try{for(let t of b.A.basemaps||[]){let o=l._layers[Object.keys(l._layers).find(e=>{let o=l._layers[e];return o.options&&o.options.attribution===t.attribution})];if(o&&l.hasLayer(o)&&t.attribution){e.push(t.attribution);break}}for(let t of b.A.overlays||[]){let o=l._layers[Object.keys(l._layers).find(e=>{let o=l._layers[e];return o.options&&o.options.attribution===t.attribution})];o&&l.hasLayer(o)&&t.attribution&&e.push(t.attribution)}}catch(e){}n([...new Set(e)])};return e(),l.on("layeradd layerremove",e),()=>{l.off("layeradd layerremove",e)}},[l]),o.length)?(0,r.jsxs)("div",{className:"pointer-events-none absolute right-[64px] bottom-[20px] z-[600] flex flex-col items-end gap-2",onMouseEnter:()=>t(!0),onMouseLeave:()=>t(!1),children:[e&&(0,r.jsx)("div",{className:"pointer-events-auto max-h-40 w-64 overflow-y-auto rounded-md bg-black/40 p-2 text-[10px] leading-relaxed shadow-md backdrop-blur",children:o.map((e,t)=>(0,r.jsx)("div",{className:"mb-1 last:mb-0",dangerouslySetInnerHTML:{__html:e}},t))}),(0,r.jsx)("div",{className:"bg-primary-500 dark:bg-background-dark pointer-events-auto rounded-xl px-2 py-1 text-[11px] font-medium text-white shadow",children:"?"})]}):null}let L=(0,g.forwardRef)(function(e,t){let{bounds:o,filteredItems:a,handleListItemClick:l,lang:s}=e,{openDrawer:c}=(0,g.useContext)(f.l9),m=(0,v.J)(s),p=(0,g.useRef)(),h=(0,g.useMemo)(()=>{try{let e=0;for(let t of a){let o=String(t.id);for(let t=0;t<o.length;t++)e=(e<<5)-e+o.charCodeAt(t)|0}return"cluster-".concat(a.length,"-").concat(e)}catch(e){return"cluster-".concat(a.length)}},[a]),[y,_]=(0,g.useState)({p33:10,p66:50});(0,g.useEffect)(()=>{let e=p.current;if(!e)return;let t=()=>{if(!e||!e._layers)return;let t=[];if(Object.values(e._layers).forEach(e=>{e.getAllChildMarkers&&"function"==typeof e.getAllChildMarkers&&e._featureGroup&&e._featureGroup._layers&&Object.values(e._featureGroup._layers).forEach(e=>{e.getChildCount&&"function"==typeof e.getChildCount&&t.push(e.getChildCount())})}),t.length>0){t.sort((e,t)=>e-t);let e=Math.floor(.33*t.length),o=Math.floor(.66*t.length);_({p33:t[e]||t[0],p66:t[o]||t[t.length-1]})}};return e.on("zoomend moveend",t),setTimeout(t,100),()=>{e.off("zoomend moveend",t)}},[a]);let j=(0,g.useMemo)(()=>e=>{let t=e.getChildCount(),o="marker-cluster-small";return t>=y.p66?o="marker-cluster-large":t>=y.p33&&(o="marker-cluster-medium"),x().divIcon({html:"<div><span>".concat(t,"</span></div>"),className:"marker-cluster ".concat(o),iconSize:x().point(40,40)})},[y]);return(0,g.useImperativeHandle)(t,()=>({clearMapLayers:()=>{p.current&&w(p.current)},recenterToDefault:()=>{p.current&&(b.A.map.default_bounds?p.current.fitBounds(b.A.map.default_bounds):p.current.setView(b.A.map.center,b.A.map.zoom))},updateBounds:(e,t)=>{console.log("UPDATE BOUND : ",e),p.current&&(A(e,p.current),t&&t(null))}})),(0,r.jsxs)(i.W,{className:"h-full w-full",center:b.A.map.default_bounds?void 0:b.A.map.center,zoom:b.A.map.default_bounds?void 0:window.innerWidth<1024?b.A.map.zoom_mobile:b.A.map.zoom,bounds:b.A.map.default_bounds,zoomControl:!1,scrollWheelZoom:!0,boundsOptions:{padding:[1,1]},attributionControl:!1,ref:p,whenReady:e=>{p.current=e,console.log("This function will fire once the map is created",p.current)},whenCreated:e=>{console.log("The underlying leaflet map instance:",e)},children:[(0,r.jsx)(u.p,{position:"topright"}),(0,r.jsxs)(n.In,{position:"bottomright",children:[(0,r.jsx)(E,{basemaps:b.A.basemaps,lang:s}),(0,r.jsx)(S,{overlays:b.A.overlays,lang:s}),o&&(0,r.jsx)(C,{bounds:o},o),(0,r.jsx)(k,{checked:!0,name:m.dataset_markers,children:(0,r.jsx)(d.A,{iconCreateFunction:j,children:a.map(e=>(0,r.jsx)(N,{record:e,handleListItemClick:l,lang:s,openDrawer:c},e.id))},h)})]}),(0,r.jsx)(z,{})]})})}}]);