"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[717],{4717:(e,t,o)=>{o.r(t),o.d(t,{default:()=>E});var r=o(5155);o(8413),o(5427);var n=o(4192),a=o(8255),l=o(2036),s=o(9540),i=o(3704),u=o(5307),d=o(7195),c=o(453),m=o(6943),p=o(4345),h=o(5091),f=o(9844),g=o(2115),x=o(5752),y=o.n(x),b=o(8070),v=o(3013);let{BaseLayer:j,Overlay:_}=n.In,k=()=>getComputedStyle(document.documentElement).getPropertyValue("--color-primary-500").trim(),w=e=>{e.eachLayer(t=>{(t instanceof y().Polygon||t instanceof y().GeoJSON)&&e.removeLayer(t)})},A=e=>{let{bounds:t}=e;console.log("Before bounds:",t);let o=(0,a.ko)();return(0,g.useLayoutEffect)(()=>{N(t,o)},[t,o]),null};function N(e,t){if(console.log("FitBounds effect triggered with bounds:",e),e){w(t);let o=y().geoJSON(e,{color:k()}).addTo(t);t.flyToBounds(o.getBounds(),{animate:!0,padding:[150,250],maxZoom:10,duration:.3})}}let C=e=>{let{record:t,handleListItemClick:o,lang:n,openDrawer:a}=e,s=m.N(t.spatial);function i(e){let t=e.target._map;e.target._hoverPolygon&&(t.removeLayer(e.target._hoverPolygon),e.target._hoverPolygon=null)}return p.m(s,t.spatial)||(s=h.Q(t.spatial)),(0,r.jsx)(d.p,{position:[s.geometry.coordinates[1],s.geometry.coordinates[0]],eventHandlers:{click:e=>{i(e),o(t),a()},mouseover:e=>{i(e);let o=e.target._map,r=y().geoJSON(t.spatial,{style:{color:k(),weight:2,fillColor:k(),fillOpacity:.5}}).addTo(o);e.target._hoverPolygon=r},mouseout:e=>{i(e)}},children:(0,r.jsx)(l.m,{children:(0,r.jsxs)("div",{className:"w-[200px]",children:[(0,r.jsx)("h2",{className:"font-bold text-wrap",children:t.title_translated[n]}),(0,r.jsx)("p",{className:"text-xs text-wrap",children:t.organization.title_translated[n]})]})})},t.id)},L=e=>{let{basemaps:t,lang:o}=e;return(0,r.jsx)(r.Fragment,{children:t.map(e=>(0,r.jsx)(j,{checked:e.checked||!1,name:e.name[o],children:(0,r.jsx)(s.e,{url:e.url,attribution:e.attribution,minZoom:e.minZoom||0,maxZoom:e.maxZoom||10})},e.key))})},Z=e=>{let{overlays:t,lang:o}=e,n=(0,a.ko)();return(0,g.useEffect)(()=>{},[n]),(0,r.jsx)(r.Fragment,{children:t&&t.length?t.map(e=>(0,r.jsx)(_,{name:e.name&&e.name[o]?e.name[o]:e.key,checked:e.checked||!1,children:(0,r.jsx)(s.e,{url:e.url,attribution:e.attribution,minZoom:e.minZoom||0,maxZoom:e.maxZoom||10})},e.key)):null})};function S(){let[e,t]=(0,g.useState)(!1),[o,n]=(0,g.useState)([]),l=(0,a.ko)();return((0,g.useEffect)(()=>{if(!l)return;let e=()=>{let e=[];try{for(let t of b.A.basemaps||[]){let o=l._layers[Object.keys(l._layers).find(e=>{let o=l._layers[e];return o.options&&o.options.attribution===t.attribution})];if(o&&l.hasLayer(o)&&t.attribution){e.push(t.attribution);break}}for(let t of b.A.overlays||[]){let o=l._layers[Object.keys(l._layers).find(e=>{let o=l._layers[e];return o.options&&o.options.attribution===t.attribution})];o&&l.hasLayer(o)&&t.attribution&&e.push(t.attribution)}}catch(e){}n([...new Set(e)])};return e(),l.on("layeradd layerremove",e),()=>{l.off("layeradd layerremove",e)}},[l]),o.length)?(0,r.jsxs)("div",{className:"pointer-events-none absolute right-[64px] bottom-[20px] z-[600] flex flex-col items-end gap-2",onMouseEnter:()=>t(!0),onMouseLeave:()=>t(!1),children:[e&&(0,r.jsx)("div",{className:"pointer-events-auto max-h-40 w-64 overflow-y-auto rounded-md bg-black/40 p-2 text-[10px] leading-relaxed shadow-md backdrop-blur",children:o.map((e,t)=>(0,r.jsx)("div",{className:"mb-1 last:mb-0",dangerouslySetInnerHTML:{__html:e}},t))}),(0,r.jsx)("div",{className:"bg-primary-500 dark:bg-primary-600 pointer-events-auto rounded-xl px-2 py-1 text-[11px] font-medium text-white shadow",children:"?"})]}):null}let E=(0,g.forwardRef)(function(e,t){let{bounds:o,filteredItems:a,handleListItemClick:l,lang:s}=e,{openDrawer:d}=(0,g.useContext)(f.l9),m=(0,v.J)(s),p=(0,g.useRef)(),h=(0,g.useMemo)(()=>{try{let e=0;for(let t of a){let o=String(t.id);for(let t=0;t<o.length;t++)e=(e<<5)-e+o.charCodeAt(t)|0}return"cluster-".concat(a.length,"-").concat(e)}catch(e){return"cluster-".concat(a.length)}},[a]);return(0,g.useImperativeHandle)(t,()=>({clearMapLayers:()=>{p.current&&w(p.current)},recenterToDefault:()=>{p.current&&(b.A.map.default_bounds?p.current.fitBounds(b.A.map.default_bounds):p.current.setView(b.A.map.center,b.A.map.zoom))},updateBounds:(e,t)=>{console.log("UPDATE BOUND : ",e),p.current&&(N(e,p.current),t&&t(null))}})),(0,r.jsxs)(i.W,{className:"h-full w-full",center:b.A.map.default_bounds?void 0:b.A.map.center,zoom:b.A.map.default_bounds?void 0:window.innerWidth<1024?b.A.map.zoom_mobile:b.A.map.zoom,bounds:b.A.map.default_bounds,zoomControl:!1,scrollWheelZoom:!0,boundsOptions:{padding:[1,1]},attributionControl:!1,ref:p,whenReady:e=>{p.current=e,console.log("This function will fire once the map is created",p.current)},whenCreated:e=>{console.log("The underlying leaflet map instance:",e)},children:[(0,r.jsx)(u.p,{position:"topright"}),(0,r.jsxs)(n.In,{position:"bottomright",children:[(0,r.jsx)(L,{basemaps:b.A.basemaps,lang:s}),(0,r.jsx)(Z,{overlays:b.A.overlays,lang:s}),o&&(0,r.jsx)(A,{bounds:o},o),(0,r.jsx)(_,{checked:!0,name:m.dataset_markers,children:(0,r.jsx)(c.A,{children:a.map(e=>(0,r.jsx)(C,{record:e,handleListItemClick:l,lang:s,openDrawer:d},e.id))},h)})]}),(0,r.jsx)(S,{})]})})}}]);